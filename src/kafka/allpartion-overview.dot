digraph allpartionsoverview {
  node[shape=box];
  newrank=true;
  rankdir=LR;
  subgraph cluster_zookeeper {
    graph[label="zookeeper";fontsize=20;];
    topic;
    controller;
    broker;
    partition;
  }
  {topic, controller, broker, partition} -> zkHandlers;
  controller -> borker1_controllerChangeHandler;
  controller -> borker2_controllerChangeHandler;

  subgraph cluster_KafkaController {
    graph[label="KafkaController";fontsize=20;];
    zkHandlers -> PartitionStateMachine -> ControllerChannelManager;
    ControllerChannelManager ->{
      RequestSendThread1;
      RequestSendThread2;
    }
  }

  subgraph cluster_KafkaBroker1 {
    graph[label="KafkaBroker1";fontsize=20;];
    borker1_controllerChangeHandler[shape="record";
      label="{{
          controllerChangeHandler|
          如果controller挂了，\l 
          就自己尝试成为controller
      }}";
    ];
    borker1_KafkaApi[label="KafkaApi"];
    borker1_ReplicaManager[label="ReplicaManager"];
    borker1_KafkaApi ->borker1_ReplicaManager;
  }

  subgraph cluster_KafkaBroker2 {
    graph[label="KafkaBroker2";fontsize=20;];
    borker2_controllerChangeHandler[shape="record";
      label="{{
          controllerChangeHandler|
          如果controller挂了，\l 
          就自己尝试成为controller
      }}";
    ];
    borker2_KafkaApi[label="KafkaApi"];
    borker2_ReplicaManager[label="ReplicaManager"];
    borker2_KafkaApi -> borker2_ReplicaManager;
  }
  RequestSendThread1 -> borker1_KafkaApi;
  RequestSendThread2 -> borker2_KafkaApi;

}
