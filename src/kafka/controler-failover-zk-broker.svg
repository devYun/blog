<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: controller_failover_zk Pages: 1 -->
<svg width="2109pt" height="1271pt"
 viewBox="0.00 0.00 2108.51 1271.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1267)">
<title>controller_failover_zk</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1267 2104.5068,-1267 2104.5068,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_controllerContext</title>
<path fill="none" stroke="#000000" d="M499.7129,-308C499.7129,-308 2045.9102,-308 2045.9102,-308 2051.9102,-308 2057.9102,-314 2057.9102,-320 2057.9102,-320 2057.9102,-620 2057.9102,-620 2057.9102,-626 2051.9102,-632 2045.9102,-632 2045.9102,-632 499.7129,-632 499.7129,-632 493.7129,-632 487.7129,-626 487.7129,-620 487.7129,-620 487.7129,-320 487.7129,-320 487.7129,-314 493.7129,-308 499.7129,-308"/>
<text text-anchor="middle" x="1272.8115" y="-612" font-family="Times,serif" font-size="20.00" fill="#000000">controllerContext</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_ControllerChannelManager</title>
<path fill="none" stroke="#000000" d="M491.7354,-1092C491.7354,-1092 2030.7515,-1092 2030.7515,-1092 2036.7515,-1092 2042.7515,-1098 2042.7515,-1104 2042.7515,-1104 2042.7515,-1243 2042.7515,-1243 2042.7515,-1249 2036.7515,-1255 2030.7515,-1255 2030.7515,-1255 491.7354,-1255 491.7354,-1255 485.7354,-1255 479.7354,-1249 479.7354,-1243 479.7354,-1243 479.7354,-1104 479.7354,-1104 479.7354,-1098 485.7354,-1092 491.7354,-1092"/>
<text text-anchor="middle" x="1261.2434" y="-1235" font-family="Times,serif" font-size="20.00" fill="#000000">ControllerChannelManager</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_replicaStateMachine</title>
<path fill="none" stroke="#000000" d="M1384.1504,-988C1384.1504,-988 1857.4443,-988 1857.4443,-988 1863.4443,-988 1869.4443,-994 1869.4443,-1000 1869.4443,-1000 1869.4443,-1070 1869.4443,-1070 1869.4443,-1076 1863.4443,-1082 1857.4443,-1082 1857.4443,-1082 1384.1504,-1082 1384.1504,-1082 1378.1504,-1082 1372.1504,-1076 1372.1504,-1070 1372.1504,-1070 1372.1504,-1000 1372.1504,-1000 1372.1504,-994 1378.1504,-988 1384.1504,-988"/>
<text text-anchor="middle" x="1620.7974" y="-1062" font-family="Times,serif" font-size="20.00" fill="#000000">replicaStateMachine</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_PartitionStateMachine</title>
<path fill="none" stroke="#000000" d="M1129.5742,-728C1129.5742,-728 2080.5068,-728 2080.5068,-728 2086.5068,-728 2092.5068,-734 2092.5068,-740 2092.5068,-740 2092.5068,-898 2092.5068,-898 2092.5068,-904 2086.5068,-910 2080.5068,-910 2080.5068,-910 1129.5742,-910 1129.5742,-910 1123.5742,-910 1117.5742,-904 1117.5742,-898 1117.5742,-898 1117.5742,-740 1117.5742,-740 1117.5742,-734 1123.5742,-728 1129.5742,-728"/>
<text text-anchor="middle" x="1605.0405" y="-890" font-family="Times,serif" font-size="20.00" fill="#000000">PartitionStateMachine</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_topicDeletionManager</title>
<path fill="none" stroke="#000000" d="M1144.9639,-640C1144.9639,-640 1316.585,-640 1316.585,-640 1322.585,-640 1328.585,-646 1328.585,-652 1328.585,-652 1328.585,-708 1328.585,-708 1328.585,-714 1322.585,-720 1316.585,-720 1316.585,-720 1144.9639,-720 1144.9639,-720 1138.9639,-720 1132.9639,-714 1132.9639,-708 1132.9639,-708 1132.9639,-652 1132.9639,-652 1132.9639,-646 1138.9639,-640 1144.9639,-640"/>
<text text-anchor="middle" x="1230.7744" y="-700" font-family="Times,serif" font-size="20.00" fill="#000000">topicDeletionManager</text>
</g>
<g id="clust18" class="cluster">
<title>cluster_zkClient</title>
<path fill="none" stroke="#000000" d="M190.1313,-8C190.1313,-8 1028.8052,-8 1028.8052,-8 1034.8052,-8 1040.8052,-14 1040.8052,-20 1040.8052,-20 1040.8052,-130 1040.8052,-130 1040.8052,-136 1034.8052,-142 1028.8052,-142 1028.8052,-142 190.1313,-142 190.1313,-142 184.1313,-142 178.1313,-136 178.1313,-130 178.1313,-130 178.1313,-20 178.1313,-20 178.1313,-14 184.1313,-8 190.1313,-8"/>
<text text-anchor="middle" x="609.4683" y="-122" font-family="Times,serif" font-size="20.00" fill="#000000">zkClient</text>
</g>
<!-- partitionsInStates -->
<g id="node1" class="node">
<title>partitionsInStates</title>
<polygon fill="none" stroke="#000000" points="1546.6094,-592 1432.6367,-592 1432.6367,-556 1546.6094,-556 1546.6094,-592"/>
<text text-anchor="middle" x="1489.623" y="-569.8" font-family="Times,serif" font-size="14.00" fill="#000000">partitionsInStates</text>
</g>
<!-- partitionStates -->
<g id="node2" class="node">
<title>partitionStates</title>
<polygon fill="#95e1d3" stroke="#000000" points="1686.0337,-546.2 1686.0337,-595.8 1819.4683,-595.8 1819.4683,-546.2 1686.0337,-546.2"/>
<text text-anchor="start" x="1694.0337" y="-580.6" font-family="Times,serif" font-size="14.00" fill="#000000">partitionStates</text>
<polyline fill="none" stroke="#000000" points="1686.0337,-573.8 1819.4683,-573.8 "/>
<text text-anchor="start" x="1694.0337" y="-558.6" font-family="Times,serif" font-size="14.00" fill="#000000">所有partition的状态</text>
</g>
<!-- partitionsInStates&#45;&gt;partitionStates -->
<g id="edge1" class="edge">
<title>partitionsInStates&#45;&gt;partitionStates</title>
<path fill="none" stroke="#000000" d="M1546.7179,-573.349C1584.559,-572.9176 1634.6558,-572.3464 1675.9748,-571.8753"/>
<polygon fill="#000000" stroke="#000000" points="1676.0451,-575.3749 1686.0046,-571.761 1675.9653,-568.3753 1676.0451,-575.3749"/>
</g>
<!-- partitionLeadershipInfo -->
<g id="node3" class="node">
<title>partitionLeadershipInfo</title>
<polygon fill="none" stroke="#000000" points="1564.0752,-354 1415.1709,-354 1415.1709,-318 1564.0752,-318 1564.0752,-354"/>
<text text-anchor="middle" x="1489.623" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#000000">partitionLeadershipInfo</text>
</g>
<!-- replicasOnOfflineDirs -->
<g id="node4" class="node">
<title>replicasOnOfflineDirs</title>
<polygon fill="#95e1d3" stroke="#000000" points="1682.5439,-458.2 1682.5439,-507.8 1822.958,-507.8 1822.958,-458.2 1682.5439,-458.2"/>
<text text-anchor="middle" x="1752.751" y="-492.6" font-family="Times,serif" font-size="14.00" fill="#000000">replicasOnOfflineDirs</text>
<polyline fill="none" stroke="#000000" points="1682.5439,-485.8 1822.958,-485.8 "/>
<text text-anchor="middle" x="1752.751" y="-470.6" font-family="Times,serif" font-size="14.00" fill="#000000">这个作用是？</text>
</g>
<!-- isReplicaOnline -->
<g id="node5" class="node">
<title>isReplicaOnline</title>
<polygon fill="none" stroke="#000000" points="1542.8234,-440 1436.4227,-440 1436.4227,-404 1542.8234,-404 1542.8234,-440"/>
<text text-anchor="middle" x="1489.623" y="-417.8" font-family="Times,serif" font-size="14.00" fill="#000000">isReplicaOnline</text>
</g>
<!-- isReplicaOnline&#45;&gt;replicasOnOfflineDirs -->
<g id="edge2" class="edge">
<title>isReplicaOnline&#45;&gt;replicasOnOfflineDirs</title>
<path fill="none" stroke="#000000" d="M1542.8709,-434.3443C1579.9903,-442.9495 1630.1869,-454.5864 1672.1822,-464.322"/>
<polygon fill="#000000" stroke="#000000" points="1671.5811,-467.7754 1682.1132,-466.6243 1673.162,-460.9563 1671.5811,-467.7754"/>
</g>
<!-- liveOrShuttingDownBrokerIds -->
<g id="node6" class="node">
<title>liveOrShuttingDownBrokerIds</title>
<polygon fill="none" stroke="#000000" points="1847.6792,-440 1657.8228,-440 1657.8228,-404 1847.6792,-404 1847.6792,-440"/>
<text text-anchor="middle" x="1752.751" y="-417.8" font-family="Times,serif" font-size="14.00" fill="#000000">liveOrShuttingDownBrokerIds</text>
</g>
<!-- isReplicaOnline&#45;&gt;liveOrShuttingDownBrokerIds -->
<g id="edge3" class="edge">
<title>isReplicaOnline&#45;&gt;liveOrShuttingDownBrokerIds</title>
<path fill="none" stroke="#000000" d="M1542.8709,-422C1573.0004,-422 1611.7457,-422 1647.7275,-422"/>
<polygon fill="#000000" stroke="#000000" points="1647.7936,-425.5001 1657.7935,-422 1647.7935,-418.5001 1647.7936,-425.5001"/>
</g>
<!-- liveBrokerEpochs -->
<g id="node9" class="node">
<title>liveBrokerEpochs</title>
<polygon fill="#95e1d3" stroke="#000000" points="1932.8271,-404 1932.8271,-440 2049.9102,-440 2049.9102,-404 1932.8271,-404"/>
<text text-anchor="middle" x="1991.3687" y="-417.8" font-family="Times,serif" font-size="14.00" fill="#000000">liveBrokerEpochs</text>
</g>
<!-- liveOrShuttingDownBrokerIds&#45;&gt;liveBrokerEpochs -->
<g id="edge6" class="edge">
<title>liveOrShuttingDownBrokerIds&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M1847.7446,-422C1872.7647,-422 1899.2746,-422 1922.6168,-422"/>
<polygon fill="#000000" stroke="#000000" points="1922.7563,-425.5001 1932.7563,-422 1922.7563,-418.5001 1922.7563,-425.5001"/>
</g>
<!-- partitionsBeingReassigned -->
<g id="node7" class="node">
<title>partitionsBeingReassigned</title>
<polygon fill="#95e1d3" stroke="#000000" points="1147.7295,-546.2 1147.7295,-595.8 1313.8193,-595.8 1313.8193,-546.2 1147.7295,-546.2"/>
<text text-anchor="middle" x="1230.7744" y="-580.6" font-family="Times,serif" font-size="14.00" fill="#000000">partitionsBeingReassigned</text>
<polyline fill="none" stroke="#000000" points="1147.7295,-573.8 1313.8193,-573.8 "/>
<text text-anchor="middle" x="1230.7744" y="-558.6" font-family="Times,serif" font-size="14.00" fill="#000000">迁移中的partition;</text>
</g>
<!-- addLiveBrokersAndEpochs -->
<g id="node8" class="node">
<title>addLiveBrokersAndEpochs</title>
<polygon fill="none" stroke="#000000" points="1666.9922,-316.4001 1666.9922,-385.5999 1838.5098,-385.5999 1838.5098,-316.4001 1666.9922,-316.4001"/>
<text text-anchor="middle" x="1752.751" y="-370.3999" font-family="Times,serif" font-size="14.00" fill="#000000">addLiveBrokersAndEpochs</text>
<polyline fill="none" stroke="#000000" points="1666.9922,-363.5999 1838.5098,-363.5999 "/>
<text text-anchor="start" x="1674.9922" y="-348.3999" font-family="Times,serif" font-size="14.00" fill="#000000">将新增的broker加入</text>
<text text-anchor="start" x="1674.9922" y="-328.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 到liveBrokerEpochs中</text>
</g>
<!-- addLiveBrokersAndEpochs&#45;&gt;liveBrokerEpochs -->
<g id="edge5" class="edge">
<title>addLiveBrokersAndEpochs&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M1838.5603,-376.5323C1866.2838,-384.7814 1896.6333,-393.8118 1922.9272,-401.6354"/>
<polygon fill="#000000" stroke="#000000" points="1922.2092,-405.0734 1932.7921,-404.5707 1924.2056,-398.3641 1922.2092,-405.0734"/>
</g>
<!-- removeLiveBrokers -->
<g id="node10" class="node">
<title>removeLiveBrokers</title>
<polygon fill="none" stroke="#000000" points="495.7129,-405.4001 495.7129,-474.5999 658.2959,-474.5999 658.2959,-405.4001 495.7129,-405.4001"/>
<text text-anchor="middle" x="577.0044" y="-459.3999" font-family="Times,serif" font-size="14.00" fill="#000000">removeLiveBrokers</text>
<polyline fill="none" stroke="#000000" points="495.7129,-452.5999 658.2959,-452.5999 "/>
<text text-anchor="start" x="503.7129" y="-437.3999" font-family="Times,serif" font-size="14.00" fill="#000000">将挂掉的broker从</text>
<text text-anchor="start" x="503.7129" y="-417.8" font-family="Times,serif" font-size="14.00" fill="#000000"> liveBrokerEpochs中删掉</text>
</g>
<!-- removeLiveBrokers&#45;&gt;liveBrokerEpochs -->
<g id="edge4" class="edge">
<title>removeLiveBrokers&#45;&gt;liveBrokerEpochs</title>
<path fill="none" stroke="#000000" d="M658.3353,-457.8683C781.5254,-483.3289 1023.0958,-527 1230.7744,-527 1230.7744,-527 1230.7744,-527 1489.623,-527 1574.057,-527 1789.9604,-545.4851 1869.4443,-517 1908.9346,-502.8477 1945.6606,-470.5541 1968.2725,-447.5529"/>
<polygon fill="#000000" stroke="#000000" points="1970.9812,-449.7853 1975.3833,-440.1483 1965.9323,-444.9367 1970.9812,-449.7853"/>
</g>
<!-- replicasOnBrokers -->
<g id="node11" class="node">
<title>replicasOnBrokers</title>
<polygon fill="none" stroke="#000000" points="814.6323,-415.2 814.6323,-464.8 1017.2534,-464.8 1017.2534,-415.2 814.6323,-415.2"/>
<text text-anchor="middle" x="915.9429" y="-449.6" font-family="Times,serif" font-size="14.00" fill="#000000">replicasOnBrokers</text>
<polyline fill="none" stroke="#000000" points="814.6323,-442.8 1017.2534,-442.8 "/>
<text text-anchor="middle" x="915.9429" y="-427.6" font-family="Times,serif" font-size="14.00" fill="#000000">获取broker列表上的所有replica</text>
</g>
<!-- partitionAssignment -->
<g id="node13" class="node">
<title>partitionAssignment</title>
<polygon fill="#95e1d3" stroke="#000000" points="1159.7744,-415.2 1159.7744,-464.8 1301.7744,-464.8 1301.7744,-415.2 1159.7744,-415.2"/>
<text text-anchor="middle" x="1230.7744" y="-449.6" font-family="Times,serif" font-size="14.00" fill="#000000">partitionAssignment</text>
<polyline fill="none" stroke="#000000" points="1159.7744,-442.8 1301.7744,-442.8 "/>
<text text-anchor="middle" x="1230.7744" y="-427.6" font-family="Times,serif" font-size="14.00" fill="#000000">记录了所有分区映射</text>
</g>
<!-- replicasOnBrokers&#45;&gt;partitionAssignment -->
<g id="edge7" class="edge">
<title>replicasOnBrokers&#45;&gt;partitionAssignment</title>
<path fill="none" stroke="#000000" d="M1017.2905,-440C1060.0445,-440 1109.1457,-440 1149.4709,-440"/>
<polygon fill="#000000" stroke="#000000" points="1149.5249,-443.5001 1159.5248,-440 1149.5248,-436.5001 1149.5249,-443.5001"/>
</g>
<!-- shuttingDownBrokerIds -->
<g id="node12" class="node">
<title>shuttingDownBrokerIds</title>
<polygon fill="#95e1d3" stroke="#000000" points="840.2808,-317 840.2808,-353 991.605,-353 991.605,-317 840.2808,-317"/>
<text text-anchor="middle" x="915.9429" y="-330.8" font-family="Times,serif" font-size="14.00" fill="#000000">shuttingDownBrokerIds</text>
</g>
<!-- sendRequest -->
<g id="node14" class="node">
<title>sendRequest</title>
<polygon fill="none" stroke="#000000" points="2034.6346,-1136 1948.1027,-1136 1948.1027,-1100 2034.6346,-1100 2034.6346,-1136"/>
<text text-anchor="middle" x="1991.3687" y="-1113.8" font-family="Times,serif" font-size="14.00" fill="#000000">sendRequest</text>
</g>
<!-- controllerChannelManager_removeBroker -->
<g id="node15" class="node">
<title>controllerChannelManager_removeBroker</title>
<polygon fill="none" stroke="#000000" points="487.7354,-1169.2 487.7354,-1218.8 666.2734,-1218.8 666.2734,-1169.2 487.7354,-1169.2"/>
<text text-anchor="middle" x="577.0044" y="-1203.6" font-family="Times,serif" font-size="14.00" fill="#000000">removeBroker</text>
<polyline fill="none" stroke="#000000" points="487.7354,-1196.8 666.2734,-1196.8 "/>
<text text-anchor="start" x="495.7354" y="-1181.6" font-family="Times,serif" font-size="14.00" fill="#000000">删掉挂掉的broker通信线程</text>
</g>
<!-- controllerChannelManager_addBroker -->
<g id="node16" class="node">
<title>controllerChannelManager_addBroker</title>
<polygon fill="none" stroke="#000000" points="491.5122,-1100.2 491.5122,-1149.8 662.4966,-1149.8 662.4966,-1100.2 491.5122,-1100.2"/>
<text text-anchor="middle" x="577.0044" y="-1134.6" font-family="Times,serif" font-size="14.00" fill="#000000">addBroker</text>
<polyline fill="none" stroke="#000000" points="491.5122,-1127.8 662.4966,-1127.8 "/>
<text text-anchor="start" x="499.5122" y="-1112.6" font-family="Times,serif" font-size="14.00" fill="#000000">新增broker, 创建通信线程</text>
</g>
<!-- replicaStateMachine_handleStateChanges_OnlineReplica -->
<g id="node17" class="node">
<title>replicaStateMachine_handleStateChanges_OnlineReplica</title>
<polygon fill="none" stroke="#000000" points="1644.0576,-996.2 1644.0576,-1045.8 1861.4443,-1045.8 1861.4443,-996.2 1644.0576,-996.2"/>
<text text-anchor="middle" x="1752.751" y="-1030.6" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChanges_OnlineReplica</text>
<polyline fill="none" stroke="#000000" points="1644.0576,-1023.8 1861.4443,-1023.8 "/>
<text text-anchor="middle" x="1752.751" y="-1008.6" font-family="Times,serif" font-size="14.00" fill="#000000">将副本设置为在线状态</text>
</g>
<!-- replicaStateMachine_handleStateChanges_OnlineReplica&#45;&gt;sendRequest -->
<g id="edge44" class="edge">
<title>replicaStateMachine_handleStateChanges_OnlineReplica&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1813.8911,-1045.8539C1852.4252,-1061.5184 1901.6775,-1081.5398 1938.5168,-1096.5153"/>
<polygon fill="#000000" stroke="#000000" points="1937.4971,-1099.8789 1948.079,-1100.4024 1940.1332,-1093.3942 1937.4971,-1099.8789"/>
</g>
<!-- replicaStateMachine_handleStateChanges_OfflineReplica -->
<g id="node18" class="node">
<title>replicaStateMachine_handleStateChanges_OfflineReplica</title>
<polygon fill="none" stroke="#000000" points="1380.1504,-996.2 1380.1504,-1045.8 1599.0957,-1045.8 1599.0957,-996.2 1380.1504,-996.2"/>
<text text-anchor="middle" x="1489.623" y="-1030.6" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChanges_OfflineReplica</text>
<polyline fill="none" stroke="#000000" points="1380.1504,-1023.8 1599.0957,-1023.8 "/>
<text text-anchor="middle" x="1489.623" y="-1008.6" font-family="Times,serif" font-size="14.00" fill="#000000">将副本设置为离线状态</text>
</g>
<!-- replicaStateMachine_handleStateChanges_OfflineReplica&#45;&gt;sendRequest -->
<g id="edge45" class="edge">
<title>replicaStateMachine_handleStateChanges_OfflineReplica&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1556.561,-996.1919C1634.9749,-971.2883 1767.1629,-942.4683 1869.4443,-987 1917.9282,-1008.1091 1955.8361,-1059.0535 1975.8002,-1090.8313"/>
<polygon fill="#000000" stroke="#000000" points="1972.9792,-1092.9273 1981.1807,-1099.6345 1978.952,-1089.2767 1972.9792,-1092.9273"/>
</g>
<!-- triggerOnlinePartitionStateChange -->
<g id="node19" class="node">
<title>triggerOnlinePartitionStateChange</title>
<polygon fill="none" stroke="#000000" points="1125.5742,-766.4001 1125.5742,-835.5999 1335.9746,-835.5999 1335.9746,-766.4001 1125.5742,-766.4001"/>
<text text-anchor="middle" x="1230.7744" y="-820.3999" font-family="Times,serif" font-size="14.00" fill="#000000">triggerOnlinePartitionStateChange</text>
<polyline fill="none" stroke="#000000" points="1125.5742,-813.5999 1335.9746,-813.5999 "/>
<text text-anchor="start" x="1133.5742" y="-798.3999" font-family="Times,serif" font-size="14.00" fill="#000000">从partitionStates过滤出处于</text>
<text text-anchor="start" x="1133.5742" y="-778.8" font-family="Times,serif" font-size="14.00" fill="#000000"> Newpartition和Offline的partition</text>
</g>
<!-- triggerOnlinePartitionStateChange&#45;&gt;partitionsInStates -->
<g id="edge8" class="edge">
<title>triggerOnlinePartitionStateChange&#45;&gt;partitionsInStates</title>
<path fill="none" stroke="#000000" d="M1281.1164,-766.3623C1298.871,-753.5748 1318.7017,-738.6261 1335.9746,-724 1384.2325,-683.137 1435.9964,-630.5701 1465.4332,-599.7496"/>
<polygon fill="#000000" stroke="#000000" points="1468.0651,-602.061 1472.4204,-592.4027 1462.9927,-597.237 1468.0651,-602.061"/>
</g>
<!-- triggerOnlineStateChangeForPartitions -->
<g id="node20" class="node">
<title>triggerOnlineStateChangeForPartitions</title>
<polygon fill="none" stroke="#000000" points="1607.4201,-810 1371.826,-810 1371.826,-774 1607.4201,-774 1607.4201,-810"/>
<text text-anchor="middle" x="1489.623" y="-787.8" font-family="Times,serif" font-size="14.00" fill="#000000">triggerOnlineStateChangeForPartitions</text>
</g>
<!-- triggerOnlinePartitionStateChange&#45;&gt;triggerOnlineStateChangeForPartitions -->
<g id="edge9" class="edge">
<title>triggerOnlinePartitionStateChange&#45;&gt;triggerOnlineStateChangeForPartitions</title>
<path fill="none" stroke="#000000" d="M1336.0581,-797.3394C1344.5086,-797.0455 1353.1016,-796.7468 1361.6858,-796.4483"/>
<polygon fill="#000000" stroke="#000000" points="1361.8775,-799.9438 1371.7498,-796.0984 1361.6342,-792.9481 1361.8775,-799.9438"/>
</g>
<!-- partitionStateMachine_handleStateChange_OnlinePartition -->
<g id="node21" class="node">
<title>partitionStateMachine_handleStateChange_OnlinePartition</title>
<polygon fill="none" stroke="#000000" points="1644.0508,-736.2 1644.0508,-785.8 1861.4512,-785.8 1861.4512,-736.2 1644.0508,-736.2"/>
<text text-anchor="middle" x="1752.751" y="-770.6" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChange_OnlinePartition</text>
<polyline fill="none" stroke="#000000" points="1644.0508,-763.8 1861.4512,-763.8 "/>
<text text-anchor="middle" x="1752.751" y="-748.6" font-family="Times,serif" font-size="14.00" fill="#000000">触发partition leader选举</text>
</g>
<!-- triggerOnlineStateChangeForPartitions&#45;&gt;partitionStateMachine_handleStateChange_OnlinePartition -->
<g id="edge10" class="edge">
<title>triggerOnlineStateChangeForPartitions&#45;&gt;partitionStateMachine_handleStateChange_OnlinePartition</title>
<path fill="none" stroke="#000000" d="M1607.334,-778.1321C1616.1823,-777.0896 1625.115,-776.0372 1633.9699,-774.994"/>
<polygon fill="#000000" stroke="#000000" points="1634.4037,-778.4672 1643.9254,-773.8211 1633.5846,-771.5153 1634.4037,-778.4672"/>
</g>
<!-- partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;sendRequest -->
<g id="edge46" class="edge">
<title>partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1858.9711,-785.8741C1862.7216,-788.6109 1866.2383,-791.6424 1869.4443,-795 1907.0226,-834.3547 1880.4529,-862.5717 1898.2305,-914 1920.8618,-979.4697 1957.0243,-1052.4747 1976.9777,-1090.9167"/>
<polygon fill="#000000" stroke="#000000" points="1973.9492,-1092.6785 1981.6832,-1099.9198 1980.153,-1089.436 1973.9492,-1092.6785"/>
</g>
<!-- electLeaderForPartitions -->
<g id="node23" class="node">
<title>electLeaderForPartitions</title>
<polygon fill="none" stroke="#000000" points="1898.2305,-736.2 1898.2305,-785.8 2084.5068,-785.8 2084.5068,-736.2 1898.2305,-736.2"/>
<text text-anchor="middle" x="1991.3687" y="-770.6" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaderForPartitions</text>
<polyline fill="none" stroke="#000000" points="1898.2305,-763.8 2084.5068,-763.8 "/>
<text text-anchor="middle" x="1991.3687" y="-748.6" font-family="Times,serif" font-size="14.00" fill="#000000">从备选的replica中选出leader</text>
</g>
<!-- partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;electLeaderForPartitions -->
<g id="edge11" class="edge">
<title>partitionStateMachine_handleStateChange_OnlinePartition&#45;&gt;electLeaderForPartitions</title>
<path fill="none" stroke="#000000" d="M1861.5857,-761C1870.3319,-761 1879.1538,-761 1887.8614,-761"/>
<polygon fill="#000000" stroke="#000000" points="1888.0195,-764.5001 1898.0195,-761 1888.0195,-757.5001 1888.0195,-764.5001"/>
</g>
<!-- partitionStateMachine_handleStateChange_OfflinePartition -->
<g id="node22" class="node">
<title>partitionStateMachine_handleStateChange_OfflinePartition</title>
<polygon fill="none" stroke="#000000" points="1643.2715,-804.4001 1643.2715,-873.5999 1862.2305,-873.5999 1862.2305,-804.4001 1643.2715,-804.4001"/>
<text text-anchor="middle" x="1752.751" y="-858.3999" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChange_OfflinePartition</text>
<polyline fill="none" stroke="#000000" points="1643.2715,-851.5999 1862.2305,-851.5999 "/>
<text text-anchor="start" x="1651.2715" y="-836.3999" font-family="Times,serif" font-size="14.00" fill="#000000">partitionleader挂了</text>
<text text-anchor="start" x="1651.2715" y="-816.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 将partition设置为offline状态</text>
</g>
<!-- partitionStateMachine_handleStateChange_OfflinePartition&#45;&gt;sendRequest -->
<g id="edge47" class="edge">
<title>partitionStateMachine_handleStateChange_OfflinePartition&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1790.7506,-873.6171C1814.316,-895.7593 1844.707,-925.5667 1869.4443,-954 1909.5259,-1000.07 1950.8254,-1058.3254 1973.5866,-1091.5552"/>
<polygon fill="#000000" stroke="#000000" points="1970.7068,-1093.5445 1979.2303,-1099.8375 1976.4915,-1089.6027 1970.7068,-1093.5445"/>
</g>
<!-- failReplicaDeletion -->
<g id="node24" class="node">
<title>failReplicaDeletion</title>
<polygon fill="none" stroke="#000000" points="1293.3961,-684 1168.1528,-684 1168.1528,-648 1293.3961,-648 1293.3961,-684"/>
<text text-anchor="middle" x="1230.7744" y="-661.8" font-family="Times,serif" font-size="14.00" fill="#000000">failReplicaDeletion</text>
</g>
<!-- onBrokerFailure -->
<g id="node25" class="node">
<title>onBrokerFailure</title>
<polygon fill="#f38181" stroke="#000000" points="463.4438,-230.4001 463.4438,-299.5999 690.5649,-299.5999 690.5649,-230.4001 463.4438,-230.4001"/>
<text text-anchor="middle" x="577.0044" y="-284.3999" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerFailure</text>
<polyline fill="none" stroke="#000000" points="463.4438,-277.5999 690.5649,-277.5999 "/>
<text text-anchor="start" x="471.4438" y="-262.3999" font-family="Times,serif" font-size="14.00" fill="#000000">1. 对于dead broker调用onBrokerFail</text>
<text text-anchor="middle" x="577.0044" y="-242.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 2. 取消注册brokerModify zk回调</text>
</g>
<!-- onBrokerFailure&#45;&gt;replicasOnOfflineDirs -->
<g id="edge28" class="edge">
<title>onBrokerFailure&#45;&gt;replicasOnOfflineDirs</title>
<path fill="none" stroke="#000000" d="M690.6098,-255.7834C943.9264,-236.3747 1538.2443,-197.6036 1607.2715,-255 1674.7006,-311.0677 1585.0147,-383.4529 1643.2715,-449 1651.3283,-458.0651 1661.7528,-464.741 1672.9612,-469.6515"/>
<polygon fill="#000000" stroke="#000000" points="1671.9374,-473.0088 1682.5259,-473.3749 1674.4768,-466.4856 1671.9374,-473.0088"/>
</g>
<!-- onBrokerFailure&#45;&gt;replicasOnBrokers -->
<g id="edge29" class="edge">
<title>onBrokerFailure&#45;&gt;replicasOnBrokers</title>
<path fill="none" stroke="#000000" d="M690.5873,-293.6718C696.1105,-296.7696 701.3949,-300.2004 706.3115,-304 730.6175,-322.7836 719.2209,-342.741 742.3115,-363 765.695,-383.516 795.4227,-399.3677 823.6435,-411.2068"/>
<polygon fill="#000000" stroke="#000000" points="822.563,-414.5456 833.1449,-415.0689 825.199,-408.0609 822.563,-414.5456"/>
</g>
<!-- onBrokerFailure&#45;&gt;shuttingDownBrokerIds -->
<g id="edge30" class="edge">
<title>onBrokerFailure&#45;&gt;shuttingDownBrokerIds</title>
<path fill="none" stroke="#000000" d="M690.8089,-288.5037C736.2985,-297.8986 787.8076,-308.5366 830.0655,-317.264"/>
<polygon fill="#000000" stroke="#000000" points="829.5413,-320.7295 840.0425,-319.3245 830.9571,-313.8742 829.5413,-320.7295"/>
</g>
<!-- onReplicasBecomeOffline -->
<g id="node26" class="node">
<title>onReplicasBecomeOffline</title>
<polygon fill="none" stroke="#000000" points="742.3115,-640.6001 742.3115,-729.3999 1089.5742,-729.3999 1089.5742,-640.6001 742.3115,-640.6001"/>
<text text-anchor="middle" x="915.9429" y="-714.1999" font-family="Times,serif" font-size="14.00" fill="#000000">onReplicasBecomeOffline</text>
<polyline fill="none" stroke="#000000" points="742.3115,-707.3999 1089.5742,-707.3999 "/>
<text text-anchor="start" x="750.3115" y="-692.1999" font-family="Times,serif" font-size="14.00" fill="#000000">1. 将该broker上的replica设置为离线</text>
<text text-anchor="start" x="750.3115" y="-672.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 2. 如果parition leader为该broker，将partition设置offline</text>
<text text-anchor="start" x="750.3115" y="-653" font-family="Times,serif" font-size="14.00" fill="#000000"> 3. 更新所有live broker的metadata</text>
</g>
<!-- onBrokerFailure&#45;&gt;onReplicasBecomeOffline -->
<g id="edge31" class="edge">
<title>onBrokerFailure&#45;&gt;onReplicasBecomeOffline</title>
<path fill="none" stroke="#000000" d="M690.6083,-289.6633C696.4277,-293.753 701.7431,-298.4977 706.3115,-304 798.9931,-415.6258 653.3044,-517.9635 740.0351,-632.6015"/>
<polygon fill="#000000" stroke="#000000" points="737.401,-634.9113 746.3874,-640.5234 742.8621,-630.5322 737.401,-634.9113"/>
</g>
<!-- unregisterBrokerModificationsHandler -->
<g id="node36" class="node">
<title>unregisterBrokerModificationsHandler</title>
<polygon fill="none" stroke="#000000" points="1032.6676,-52 799.2181,-52 799.2181,-16 1032.6676,-16 1032.6676,-52"/>
<text text-anchor="middle" x="915.9429" y="-29.8" font-family="Times,serif" font-size="14.00" fill="#000000">unregisterBrokerModificationsHandler</text>
</g>
<!-- onBrokerFailure&#45;&gt;unregisterBrokerModificationsHandler -->
<g id="edge32" class="edge">
<title>onBrokerFailure&#45;&gt;unregisterBrokerModificationsHandler</title>
<path fill="none" stroke="#000000" d="M623.8531,-230.2051C650.7345,-208.3711 683.5567,-178.2982 706.3115,-146 729.9403,-112.4613 709.9569,-86.2258 742.3115,-61 755.9872,-50.3375 772.1505,-43.0789 789.0222,-38.2383"/>
<polygon fill="#000000" stroke="#000000" points="790.2146,-41.5454 799.0245,-35.6602 788.4674,-34.767 790.2146,-41.5454"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;replicaStateMachine_handleStateChanges_OfflineReplica -->
<g id="edge33" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;replicaStateMachine_handleStateChanges_OfflineReplica</title>
<path fill="none" stroke="#000000" d="M1080.3145,-729.5786C1083.5833,-732.5234 1086.6801,-735.6598 1089.5742,-739 1141.1537,-798.5299 1061.636,-858.5458 1117.5742,-914 1152.4326,-948.5567 1289.0739,-932.5227 1335.9746,-947 1371.3305,-957.9136 1408.784,-975.8074 1437.8609,-991.2652"/>
<polygon fill="#000000" stroke="#000000" points="1436.5302,-994.5239 1446.9938,-996.1864 1439.8508,-988.3616 1436.5302,-994.5239"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;triggerOnlinePartitionStateChange -->
<g id="edge34" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;triggerOnlinePartitionStateChange</title>
<path fill="none" stroke="#000000" d="M1063.7094,-729.4709C1072.5026,-732.5766 1081.1799,-735.7625 1089.5742,-739 1102.3755,-743.9371 1105.0553,-746.3855 1117.5742,-752 1125.0879,-755.3697 1132.8984,-758.8327 1140.7471,-762.2849"/>
<polygon fill="#000000" stroke="#000000" points="1139.399,-765.5154 1149.9627,-766.3263 1142.2103,-759.1047 1139.399,-765.5154"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;partitionStateMachine_handleStateChange_OfflinePartition -->
<g id="edge35" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;partitionStateMachine_handleStateChange_OfflinePartition</title>
<path fill="none" stroke="#000000" d="M1089.7935,-719.8462C1099.1746,-721.3451 1108.4796,-722.7434 1117.5742,-724 1333.9237,-753.8921 1405.1952,-682.14 1607.2715,-765 1626.5417,-772.9016 1625.391,-784.3198 1643.2715,-795 1645.9121,-796.5773 1648.6197,-798.1209 1651.3772,-799.6295"/>
<polygon fill="#000000" stroke="#000000" points="1649.851,-802.7812 1660.3327,-804.3257 1653.102,-796.5819 1649.851,-802.7812"/>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;failReplicaDeletion -->
<g id="edge36" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;failReplicaDeletion</title>
<path fill="none" stroke="#000000" d="M1089.9337,-674.4997C1113.7785,-673.0607 1137.1103,-671.6526 1157.7078,-670.4096"/>
<polygon fill="#000000" stroke="#000000" points="1158.1318,-673.8904 1167.9028,-669.7943 1157.7101,-666.9031 1158.1318,-673.8904"/>
</g>
<!-- sendUpdateMetadataRequest -->
<g id="node33" class="node">
<title>sendUpdateMetadataRequest</title>
<polygon fill="none" stroke="#000000" points="1320.551,-1046 1140.9978,-1046 1140.9978,-1010 1320.551,-1010 1320.551,-1046"/>
<text text-anchor="middle" x="1230.7744" y="-1023.8" font-family="Times,serif" font-size="14.00" fill="#000000">sendUpdateMetadataRequest</text>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;sendUpdateMetadataRequest -->
<g id="edge37" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;sendUpdateMetadataRequest</title>
<path fill="none" stroke="#000000" d="M1080.8929,-729.7018C1083.9652,-732.6118 1086.8685,-735.7074 1089.5742,-739 1163.925,-829.4772 1040.218,-913.0785 1117.5742,-1001 1121.822,-1005.8279 1126.7633,-1009.8727 1132.1601,-1013.2545"/>
<polygon fill="#000000" stroke="#000000" points="1130.5226,-1016.3479 1140.9814,-1018.0401 1133.8606,-1010.1951 1130.5226,-1016.3479"/>
</g>
<!-- partitionsWithoutLeader -->
<g id="node37" class="node">
<title>partitionsWithoutLeader</title>
<polygon fill="none" stroke="#000000" points="1307.3418,-300 1154.207,-300 1154.207,-264 1307.3418,-264 1307.3418,-300"/>
<text text-anchor="middle" x="1230.7744" y="-277.8" font-family="Times,serif" font-size="14.00" fill="#000000">partitionsWithoutLeader</text>
</g>
<!-- onReplicasBecomeOffline&#45;&gt;partitionsWithoutLeader -->
<g id="edge38" class="edge">
<title>onReplicasBecomeOffline&#45;&gt;partitionsWithoutLeader</title>
<path fill="none" stroke="#000000" d="M1085.5515,-640.5678C1086.9364,-639.0924 1088.2784,-637.5703 1089.5742,-636 1136.6998,-578.8944 1068.1172,-359.0988 1117.5742,-304 1124.8951,-295.844 1134.2612,-290.1702 1144.4631,-286.2899"/>
<polygon fill="#000000" stroke="#000000" points="1145.5852,-289.6056 1154.0325,-283.2108 1143.4411,-282.9421 1145.5852,-289.6056"/>
</g>
<!-- onBrokerStartup -->
<g id="node27" class="node">
<title>onBrokerStartup</title>
<polygon fill="#f38181" stroke="#000000" points="447.6973,-709.2003 447.6973,-856.7997 706.3115,-856.7997 706.3115,-709.2003 447.6973,-709.2003"/>
<text text-anchor="middle" x="577.0044" y="-841.5997" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerStartup</text>
<polyline fill="none" stroke="#000000" points="447.6973,-834.7997 706.3115,-834.7997 "/>
<text text-anchor="start" x="455.6973" y="-819.5997" font-family="Times,serif" font-size="14.00" fill="#000000">新增的broker，调用onBrokerStartup</text>
<text text-anchor="start" x="455.6973" y="-799.9998" font-family="Times,serif" font-size="14.00" fill="#000000"> 1. 注册brokerModify的zk回调</text>
<text text-anchor="start" x="455.6973" y="-780.3999" font-family="Times,serif" font-size="14.00" fill="#000000"> 2. 向所有live broker发送updateMeta请求</text>
<text text-anchor="start" x="455.6973" y="-760.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3. 将该broker上的replica设置为在线</text>
<text text-anchor="start" x="455.6973" y="-741.2001" font-family="Times,serif" font-size="14.00" fill="#000000"> 4. 可能触发partition leader选举</text>
<text text-anchor="start" x="455.6973" y="-721.6002" font-family="Times,serif" font-size="14.00" fill="#000000"> 5. 检查是否要恢复parition 迁移</text>
</g>
<!-- onBrokerStartup&#45;&gt;replicasOnBrokers -->
<g id="edge22" class="edge">
<title>onBrokerStartup&#45;&gt;replicasOnBrokers</title>
<path fill="none" stroke="#000000" d="M650.1317,-708.9964C722.8048,-635.4525 830.8722,-526.0901 884.0428,-472.2823"/>
<polygon fill="#000000" stroke="#000000" points="886.6324,-474.6412 891.1717,-465.068 881.6533,-469.721 886.6324,-474.6412"/>
</g>
<!-- onBrokerStartup&#45;&gt;replicaStateMachine_handleStateChanges_OnlineReplica -->
<g id="edge23" class="edge">
<title>onBrokerStartup&#45;&gt;replicaStateMachine_handleStateChanges_OnlineReplica</title>
<path fill="none" stroke="#000000" d="M642.0651,-857.0624C670.4461,-885.6737 705.603,-916.6036 742.3115,-938 893.2455,-1025.9752 944.8634,-1028.7003 1117.5742,-1055 1332.7371,-1087.7642 1391.0607,-1079.9294 1607.2715,-1055 1621.5076,-1053.3586 1636.375,-1050.842 1650.9382,-1047.9044"/>
<polygon fill="#000000" stroke="#000000" points="1651.8882,-1051.2816 1660.9603,-1045.8091 1650.4556,-1044.4297 1651.8882,-1051.2816"/>
</g>
<!-- onBrokerStartup&#45;&gt;triggerOnlinePartitionStateChange -->
<g id="edge24" class="edge">
<title>onBrokerStartup&#45;&gt;triggerOnlinePartitionStateChange</title>
<path fill="none" stroke="#000000" d="M706.7617,-820.916C718.7019,-823.3789 730.6798,-825.4785 742.3115,-827 895.3468,-847.0183 935.8745,-841.0328 1089.5742,-827 1097.9597,-826.2344 1106.5908,-825.2181 1115.2567,-824.0307"/>
<polygon fill="#000000" stroke="#000000" points="1116.0352,-827.4547 1125.4331,-822.5628 1115.0358,-820.5264 1116.0352,-827.4547"/>
</g>
<!-- onBrokerStartup&#45;&gt;sendUpdateMetadataRequest -->
<g id="edge25" class="edge">
<title>onBrokerStartup&#45;&gt;sendUpdateMetadataRequest</title>
<path fill="none" stroke="#000000" d="M706.3579,-841.5249C814.637,-888.9636 974.046,-955.2241 1117.5742,-1001 1124.4557,-1003.1947 1131.6228,-1005.303 1138.8615,-1007.3062"/>
<polygon fill="#000000" stroke="#000000" points="1138.1907,-1010.7502 1148.7568,-1009.9709 1140.0109,-1003.991 1138.1907,-1010.7502"/>
</g>
<!-- maybeResumeReassignments -->
<g id="node34" class="node">
<title>maybeResumeReassignments</title>
<polygon fill="none" stroke="#000000" points="824.7358,-748.4001 824.7358,-817.5999 1007.1499,-817.5999 1007.1499,-748.4001 824.7358,-748.4001"/>
<text text-anchor="middle" x="915.9429" y="-802.3999" font-family="Times,serif" font-size="14.00" fill="#000000">maybeResumeReassignments</text>
<polyline fill="none" stroke="#000000" points="824.7358,-795.5999 1007.1499,-795.5999 "/>
<text text-anchor="start" x="832.7358" y="-780.3999" font-family="Times,serif" font-size="14.00" fill="#000000">判断partition是否在迁移中</text>
<text text-anchor="start" x="832.7358" y="-760.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 触发partition迁移</text>
</g>
<!-- onBrokerStartup&#45;&gt;maybeResumeReassignments -->
<g id="edge26" class="edge">
<title>onBrokerStartup&#45;&gt;maybeResumeReassignments</title>
<path fill="none" stroke="#000000" d="M706.5933,-783C742.244,-783 780.391,-783 814.225,-783"/>
<polygon fill="#000000" stroke="#000000" points="814.5793,-786.5001 824.5793,-783 814.5792,-779.5001 814.5793,-786.5001"/>
</g>
<!-- registerBrokerModificationsHandler -->
<g id="node35" class="node">
<title>registerBrokerModificationsHandler</title>
<polygon fill="none" stroke="#000000" points="1025.6677,-106 806.2181,-106 806.2181,-70 1025.6677,-70 1025.6677,-106"/>
<text text-anchor="middle" x="915.9429" y="-83.8" font-family="Times,serif" font-size="14.00" fill="#000000">registerBrokerModificationsHandler</text>
</g>
<!-- onBrokerStartup&#45;&gt;registerBrokerModificationsHandler -->
<g id="edge27" class="edge">
<title>onBrokerStartup&#45;&gt;registerBrokerModificationsHandler</title>
<path fill="none" stroke="#000000" d="M657.7656,-708.866C676.7173,-687.2353 694.7385,-662.2862 706.3115,-636 766.1168,-500.1619 685.5342,-441.1313 742.3115,-304 775.3553,-224.191 847.4465,-150.0895 887.5663,-112.9413"/>
<polygon fill="#000000" stroke="#000000" points="890.1246,-115.3447 895.1429,-106.0137 885.401,-110.1786 890.1246,-115.3447"/>
</g>
<!-- onControllerFailover -->
<g id="node28" class="node">
<title>onControllerFailover</title>
<polygon fill="none" stroke="#000000" points="137.3971,-79 2.9964,-79 2.9964,-43 137.3971,-43 137.3971,-79"/>
<text text-anchor="middle" x="70.1968" y="-56.8" font-family="Times,serif" font-size="14.00" fill="#000000">onControllerFailover</text>
</g>
<!-- registerZNodeChildChangeHandler -->
<g id="node29" class="node">
<title>registerZNodeChildChangeHandler</title>
<polygon fill="none" stroke="#000000" points="401.8736,-79 186.2172,-79 186.2172,-43 401.8736,-43 401.8736,-79"/>
<text text-anchor="middle" x="294.0454" y="-56.8" font-family="Times,serif" font-size="14.00" fill="#000000">registerZNodeChildChangeHandler</text>
</g>
<!-- onControllerFailover&#45;&gt;registerZNodeChildChangeHandler -->
<g id="edge12" class="edge">
<title>onControllerFailover&#45;&gt;registerZNodeChildChangeHandler</title>
<path fill="none" stroke="#000000" d="M137.3587,-61C149.5708,-61 162.6341,-61 175.8144,-61"/>
<polygon fill="#000000" stroke="#000000" points="175.9042,-64.5001 185.9041,-61 175.9041,-57.5001 175.9042,-64.5001"/>
</g>
<!-- processBrokerChange -->
<g id="node30" class="node">
<title>processBrokerChange</title>
<polygon fill="none" stroke="#000000" points="176.3936,-297.8002 176.3936,-406.1998 411.6973,-406.1998 411.6973,-297.8002 176.3936,-297.8002"/>
<text text-anchor="middle" x="294.0454" y="-390.9998" font-family="Times,serif" font-size="14.00" fill="#000000">processBrokerChange</text>
<polyline fill="none" stroke="#000000" points="176.3936,-384.1998 411.6973,-384.1998 "/>
<text text-anchor="start" x="184.3936" y="-368.9998" font-family="Times,serif" font-size="14.00" fill="#000000">从zk中获取所有的BrokerAndEpochsl</text>
<text text-anchor="start" x="184.3936" y="-349.3999" font-family="Times,serif" font-size="14.00" fill="#000000"> 和context中的作比较，</text>
<text text-anchor="start" x="184.3936" y="-329.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 计算出新增的和挂掉的</text>
<text text-anchor="start" x="184.3936" y="-310.2001" font-family="Times,serif" font-size="14.00" fill="#000000"> 然后分别处理</text>
</g>
<!-- processBrokerChange&#45;&gt;liveOrShuttingDownBrokerIds -->
<g id="edge14" class="edge">
<title>processBrokerChange&#45;&gt;liveOrShuttingDownBrokerIds</title>
<path fill="none" stroke="#000000" d="M340.9081,-297.5611C368.7753,-269.271 406.6388,-237.282 447.6973,-221 544.5406,-182.5962 811.7628,-198 915.9429,-198 915.9429,-198 915.9429,-198 1230.7744,-198 1314.6102,-198 1543.9481,-167.0582 1607.2715,-222 1666.5917,-273.4685 1588.7646,-338.4589 1643.2715,-395 1645.1736,-396.9731 1647.1951,-398.8112 1649.3173,-400.5231"/>
<polygon fill="#000000" stroke="#000000" points="1647.7502,-403.6956 1657.9619,-406.5191 1651.7398,-397.9438 1647.7502,-403.6956"/>
</g>
<!-- processBrokerChange&#45;&gt;addLiveBrokersAndEpochs -->
<g id="edge15" class="edge">
<title>processBrokerChange&#45;&gt;addLiveBrokersAndEpochs</title>
<path fill="none" stroke="#000000" d="M326.9799,-297.6064C354.0346,-258.3958 396.2158,-208.2738 447.6973,-184 541.9381,-139.5649 811.7517,-160 915.9429,-160 915.9429,-160 915.9429,-160 1230.7744,-160 1398.4461,-160 1456.9478,-109.7264 1607.2715,-184 1661.4345,-210.7615 1703.9122,-267.5787 1728.6461,-307.4784"/>
<polygon fill="#000000" stroke="#000000" points="1725.771,-309.4872 1733.9509,-316.2207 1731.7555,-305.8558 1725.771,-309.4872"/>
</g>
<!-- processBrokerChange&#45;&gt;removeLiveBrokers -->
<g id="edge16" class="edge">
<title>processBrokerChange&#45;&gt;removeLiveBrokers</title>
<path fill="none" stroke="#000000" d="M411.9965,-388.6827C436.6532,-396.3509 462.2908,-404.3242 485.7995,-411.6354"/>
<polygon fill="#000000" stroke="#000000" points="484.7988,-414.9894 495.3871,-414.6171 486.8777,-408.3052 484.7988,-414.9894"/>
</g>
<!-- processBrokerChange&#45;&gt;controllerChannelManager_removeBroker -->
<g id="edge17" class="edge">
<title>processBrokerChange&#45;&gt;controllerChannelManager_removeBroker</title>
<path fill="none" stroke="#000000" d="M297.0495,-406.3586C307.1383,-569.1464 345.1288,-1048.303 447.6973,-1159 456.1786,-1168.1535 466.7852,-1175.0075 478.2534,-1180.1239"/>
<polygon fill="#000000" stroke="#000000" points="477.0266,-1183.4027 487.6114,-1183.8652 479.6253,-1176.9029 477.0266,-1183.4027"/>
</g>
<!-- processBrokerChange&#45;&gt;controllerChannelManager_addBroker -->
<g id="edge18" class="edge">
<title>processBrokerChange&#45;&gt;controllerChannelManager_addBroker</title>
<path fill="none" stroke="#000000" d="M306.9871,-406.3108C330.3278,-501.2306 383.1044,-702.7492 447.6973,-866 480.7022,-949.416 530.5454,-1042.4232 557.7003,-1091.0934"/>
<polygon fill="#000000" stroke="#000000" points="554.7146,-1092.925 562.6573,-1099.9367 560.8208,-1089.5023 554.7146,-1092.925"/>
</g>
<!-- processBrokerChange&#45;&gt;onBrokerFailure -->
<g id="edge19" class="edge">
<title>processBrokerChange&#45;&gt;onBrokerFailure</title>
<path fill="none" stroke="#000000" d="M411.8726,-315.0617C423.9671,-311.309 436.0756,-307.5678 447.6973,-304 449.5886,-303.4194 451.4957,-302.8347 453.4155,-302.2468"/>
<polygon fill="#000000" stroke="#000000" points="454.5658,-305.5551 463.106,-299.2848 452.5196,-298.8608 454.5658,-305.5551"/>
</g>
<!-- processBrokerChange&#45;&gt;onBrokerStartup -->
<g id="edge20" class="edge">
<title>processBrokerChange&#45;&gt;onBrokerStartup</title>
<path fill="none" stroke="#000000" d="M318.9471,-406.4498C346.8545,-465.2346 395.1283,-560.5751 447.6973,-636 463.1211,-658.1297 481.4088,-680.666 499.3025,-701.23"/>
<polygon fill="#000000" stroke="#000000" points="496.9059,-703.8052 506.1343,-709.0098 502.1658,-699.1863 496.9059,-703.8052"/>
</g>
<!-- getAllBrokerAndEpochsInCluster -->
<g id="node31" class="node">
<title>getAllBrokerAndEpochsInCluster</title>
<polygon fill="none" stroke="#000000" points="461.2974,-56.2 461.2974,-105.8 692.7114,-105.8 692.7114,-56.2 461.2974,-56.2"/>
<text text-anchor="middle" x="577.0044" y="-90.6" font-family="Times,serif" font-size="14.00" fill="#000000">getAllBrokerAndEpochsInCluster</text>
<polyline fill="none" stroke="#000000" points="461.2974,-83.8 692.7114,-83.8 "/>
<text text-anchor="start" x="469.2974" y="-68.6" font-family="Times,serif" font-size="14.00" fill="#000000">从zk中获取所有的BrokerAndEpochs</text>
</g>
<!-- processBrokerChange&#45;&gt;getAllBrokerAndEpochsInCluster -->
<g id="edge21" class="edge">
<title>processBrokerChange&#45;&gt;getAllBrokerAndEpochsInCluster</title>
<path fill="none" stroke="#000000" d="M324.8846,-297.4124C352.4796,-252.3378 396.4181,-189.0047 447.6973,-146 464.4002,-131.9923 484.6335,-120.0134 504.0858,-110.2972"/>
<polygon fill="#000000" stroke="#000000" points="505.7814,-113.3648 513.2519,-105.852 502.7269,-107.0664 505.7814,-113.3648"/>
</g>
<!-- brokerChangeHandler -->
<g id="node32" class="node">
<title>brokerChangeHandler</title>
<polygon fill="none" stroke="#000000" points="140.5909,-370 -.1973,-370 -.1973,-334 140.5909,-334 140.5909,-370"/>
<text text-anchor="middle" x="70.1968" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#000000">brokerChangeHandler</text>
</g>
<!-- brokerChangeHandler&#45;&gt;processBrokerChange -->
<g id="edge13" class="edge">
<title>brokerChangeHandler&#45;&gt;processBrokerChange</title>
<path fill="none" stroke="#000000" d="M140.4097,-352C148.6116,-352 157.1623,-352 165.8465,-352"/>
<polygon fill="#000000" stroke="#000000" points="166.0895,-355.5001 176.0895,-352 166.0895,-348.5001 166.0895,-355.5001"/>
</g>
<!-- sendUpdateMetadataRequest&#45;&gt;sendRequest -->
<g id="edge48" class="edge">
<title>sendUpdateMetadataRequest&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1265.3823,-1046.092C1293.3255,-1059.7354 1334.0916,-1077.5014 1371.9746,-1086 1577.0661,-1132.0099 1829.5192,-1126.4592 1937.861,-1121.2277"/>
<polygon fill="#000000" stroke="#000000" points="1938.0775,-1124.7214 1947.8893,-1120.7242 1937.7264,-1117.7302 1938.0775,-1124.7214"/>
</g>
<!-- maybeResumeReassignments&#45;&gt;partitionsBeingReassigned -->
<g id="edge42" class="edge">
<title>maybeResumeReassignments&#45;&gt;partitionsBeingReassigned</title>
<path fill="none" stroke="#000000" d="M1007.4336,-777.9111C1036.9893,-771.9341 1067.7291,-760.4716 1089.5742,-739 1123.4067,-705.746 1088.5825,-673.5493 1117.5742,-636 1128.4571,-621.9049 1143.3243,-610.3386 1158.7045,-601.0767"/>
<polygon fill="#000000" stroke="#000000" points="1160.8441,-603.8855 1167.7932,-595.888 1157.3735,-597.8064 1160.8441,-603.8855"/>
</g>
<!-- onPartitionReassignment -->
<g id="node39" class="node">
<title>onPartitionReassignment</title>
<polygon fill="none" stroke="#000000" points="1309.0402,-992 1152.5086,-992 1152.5086,-956 1309.0402,-956 1309.0402,-992"/>
<text text-anchor="middle" x="1230.7744" y="-969.8" font-family="Times,serif" font-size="14.00" fill="#000000">onPartitionReassignment</text>
</g>
<!-- maybeResumeReassignments&#45;&gt;onPartitionReassignment -->
<g id="edge43" class="edge">
<title>maybeResumeReassignments&#45;&gt;onPartitionReassignment</title>
<path fill="none" stroke="#000000" d="M950.8099,-817.6345C988.7982,-853.5532 1052.8413,-908.9864 1117.5742,-942 1125.5239,-946.0543 1134.0577,-949.6569 1142.7447,-952.8438"/>
<polygon fill="#000000" stroke="#000000" points="1141.6158,-956.1568 1152.2106,-956.1405 1143.9181,-949.5462 1141.6158,-956.1568"/>
</g>
<!-- partitionsWithoutLeader&#45;&gt;partitionLeadershipInfo -->
<g id="edge39" class="edge">
<title>partitionsWithoutLeader&#45;&gt;partitionLeadershipInfo</title>
<path fill="none" stroke="#000000" d="M1307.3869,-297.9826C1338.0575,-304.381 1373.5041,-311.7757 1404.9363,-318.333"/>
<polygon fill="#000000" stroke="#000000" points="1404.4853,-321.8142 1414.9894,-320.4302 1405.9149,-314.9617 1404.4853,-321.8142"/>
</g>
<!-- partitionsWithoutLeader&#45;&gt;isReplicaOnline -->
<g id="edge40" class="edge">
<title>partitionsWithoutLeader&#45;&gt;isReplicaOnline</title>
<path fill="none" stroke="#000000" d="M1307.4428,-290.2707C1317.6011,-293.5336 1327.4374,-297.9752 1335.9746,-304 1361.0725,-321.7116 1349.3709,-342.1991 1371.9746,-363 1388.5216,-378.2273 1409.7332,-390.4663 1429.5774,-399.7643"/>
<polygon fill="#000000" stroke="#000000" points="1428.3242,-403.0386 1438.8788,-403.9607 1431.203,-396.6579 1428.3242,-403.0386"/>
</g>
<!-- isTopicQueuedUpForDeletion -->
<g id="node38" class="node">
<title>isTopicQueuedUpForDeletion</title>
<polygon fill="none" stroke="#000000" points="1582.4427,-300 1396.8034,-300 1396.8034,-264 1582.4427,-264 1582.4427,-300"/>
<text text-anchor="middle" x="1489.623" y="-277.8" font-family="Times,serif" font-size="14.00" fill="#000000">isTopicQueuedUpForDeletion</text>
</g>
<!-- partitionsWithoutLeader&#45;&gt;isTopicQueuedUpForDeletion -->
<g id="edge41" class="edge">
<title>partitionsWithoutLeader&#45;&gt;isTopicQueuedUpForDeletion</title>
<path fill="none" stroke="#000000" d="M1307.3869,-282C1332.2388,-282 1360.2264,-282 1386.6732,-282"/>
<polygon fill="#000000" stroke="#000000" points="1386.7241,-285.5001 1396.7241,-282 1386.724,-278.5001 1386.7241,-285.5001"/>
</g>
</g>
</svg>
