<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: partition_isr Pages: 1 -->
<svg width="2432pt" height="1350pt"
 viewBox="0.00 0.00 2432.00 1350.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1346)">
<title>partition_isr</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1346 2428,-1346 2428,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_zk</title>
<polygon fill="none" stroke="#000000" points="2262,-373 2262,-535 2416,-535 2416,-373 2262,-373"/>
<text text-anchor="middle" x="2339" y="-515" font-family="Times,serif" font-size="20.00" fill="#000000">zk server</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_KafkaZkClient</title>
<polygon fill="none" stroke="#000000" points="1898.5,-362 1898.5,-444 2242,-444 2242,-362 1898.5,-362"/>
<text text-anchor="middle" x="2070.25" y="-424" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaZkClient</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_replicaManager</title>
<polygon fill="none" stroke="#000000" points="257,-124 257,-286 2044,-286 2044,-124 257,-124"/>
<text text-anchor="middle" x="1150.5" y="-266" font-family="Times,serif" font-size="20.00" fill="#000000">replicaManager</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_ZkPartitionStateStore</title>
<polygon fill="none" stroke="#000000" points="1529.5,-294 1529.5,-430 1840.5,-430 1840.5,-294 1529.5,-294"/>
<text text-anchor="middle" x="1685" y="-410" font-family="Times,serif" font-size="20.00" fill="#000000">ZkPartitionStateStore</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_replica</title>
<polygon fill="none" stroke="#000000" points="1489.5,-1172 1489.5,-1334 2053,-1334 2053,-1172 1489.5,-1172"/>
<text text-anchor="middle" x="1771.25" y="-1314" font-family="Times,serif" font-size="20.00" fill="#000000">replica</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_Partition</title>
<polygon fill="none" stroke="#000000" points="811,-438 811,-1164 1868,-1164 1868,-438 811,-438"/>
<text text-anchor="middle" x="1339.5" y="-1144" font-family="Times,serif" font-size="20.00" fill="#000000">Partition</text>
</g>
<g id="clust19" class="cluster">
<title>cluster_fetchThread</title>
<polygon fill="none" stroke="#000000" points="8,-8 8,-116 409,-116 409,-8 8,-8"/>
<text text-anchor="middle" x="208.5" y="-96" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaFetcher thread</text>
</g>
<g id="clust20" class="cluster">
<title>cluster_KafkaApi</title>
<polygon fill="none" stroke="#000000" points="594,-34 594,-116 781,-116 781,-34 594,-34"/>
<text text-anchor="middle" x="687.5" y="-96" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<!-- zk_partitionState -->
<g id="node1" class="node">
<title>zk_partitionState</title>
<polygon fill="#95e1d3" stroke="#000000" points="2270,-381.5 2270,-496.5 2408,-496.5 2408,-381.5 2270,-381.5"/>
<text text-anchor="middle" x="2339" y="-481.3" font-family="Times,serif" font-size="14.00" fill="#000000">partitionState</text>
<polyline fill="none" stroke="#000000" points="2270,-473.5 2408,-473.5 "/>
<text text-anchor="start" x="2278" y="-458.3" font-family="Times,serif" font-size="14.00" fill="#000000">ControllerEpoch int32</text>
<polyline fill="none" stroke="#000000" points="2270,-450.5 2408,-450.5 "/>
<text text-anchor="start" x="2278" y="-435.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader int32</text>
<polyline fill="none" stroke="#000000" points="2270,-427.5 2408,-427.5 "/>
<text text-anchor="start" x="2278" y="-412.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader_epoch int32</text>
<polyline fill="none" stroke="#000000" points="2270,-404.5 2408,-404.5 "/>
<text text-anchor="start" x="2278" y="-389.3" font-family="Times,serif" font-size="14.00" fill="#000000">isr []int32</text>
</g>
<!-- updateLeaderAndIsr -->
<g id="node2" class="node">
<title>updateLeaderAndIsr</title>
<polygon fill="none" stroke="#000000" points="2034.5,-406 1906.5,-406 1906.5,-370 2034.5,-370 2034.5,-406"/>
<text text-anchor="middle" x="1970.5" y="-384.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateLeaderAndIsr</text>
</g>
<!-- setTopicAssignmentRaw -->
<g id="node3" class="node">
<title>setTopicAssignmentRaw</title>
<polygon fill="none" stroke="#000000" points="2234,-406 2081,-406 2081,-370 2234,-370 2234,-406"/>
<text text-anchor="middle" x="2157.5" y="-384.3" font-family="Times,serif" font-size="14.00" fill="#000000">setTopicAssignmentRaw</text>
</g>
<!-- updateLeaderAndIsr&#45;&gt;setTopicAssignmentRaw -->
<g id="edge1" class="edge">
<title>updateLeaderAndIsr&#45;&gt;setTopicAssignmentRaw</title>
<path fill="none" stroke="#000000" d="M2034.5932,-388C2046.2398,-388 2058.5641,-388 2070.7354,-388"/>
<polygon fill="#000000" stroke="#000000" points="2070.9052,-391.5001 2080.9051,-388 2070.9051,-384.5001 2070.9052,-391.5001"/>
</g>
<!-- setTopicAssignmentRaw&#45;&gt;zk_partitionState -->
<g id="edge2" class="edge">
<title>setTopicAssignmentRaw&#45;&gt;zk_partitionState</title>
<path fill="none" stroke="#000000" d="M2221.7455,-406.0525C2234.1787,-409.5461 2247.3394,-413.2441 2260.1761,-416.8511"/>
<polygon fill="#000000" stroke="#000000" points="2259.3379,-420.2511 2269.9119,-419.5868 2261.2316,-413.5121 2259.3379,-420.2511"/>
</g>
<!-- isrShrinkRate -->
<g id="node4" class="node">
<title>isrShrinkRate</title>
<polygon fill="none" stroke="#000000" points="1823,-248 1732,-248 1732,-212 1823,-212 1823,-248"/>
<text text-anchor="middle" x="1777.5" y="-226.3" font-family="Times,serif" font-size="14.00" fill="#000000">isrShrinkRate</text>
</g>
<!-- isrExpandRate -->
<g id="node5" class="node">
<title>isrExpandRate</title>
<polygon fill="none" stroke="#000000" points="1825.5,-194 1729.5,-194 1729.5,-158 1825.5,-158 1825.5,-194"/>
<text text-anchor="middle" x="1777.5" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#000000">isrExpandRate</text>
</g>
<!-- recordIsrChange -->
<g id="node6" class="node">
<title>recordIsrChange</title>
<polygon fill="none" stroke="#000000" points="2024,-248 1917,-248 1917,-212 2024,-212 2024,-248"/>
<text text-anchor="middle" x="1970.5" y="-226.3" font-family="Times,serif" font-size="14.00" fill="#000000">recordIsrChange</text>
</g>
<!-- failedIsrUpdatesRate -->
<g id="node7" class="node">
<title>failedIsrUpdatesRate</title>
<polygon fill="none" stroke="#000000" points="2036,-194 1905,-194 1905,-158 2036,-158 2036,-194"/>
<text text-anchor="middle" x="1970.5" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#000000">failedIsrUpdatesRate</text>
</g>
<!-- stateStore_expandIsr -->
<g id="node8" class="node">
<title>stateStore_expandIsr</title>
<polygon fill="none" stroke="#000000" points="1607.5,-338 1537.5,-338 1537.5,-302 1607.5,-302 1607.5,-338"/>
<text text-anchor="middle" x="1572.5" y="-316.3" font-family="Times,serif" font-size="14.00" fill="#000000">expandIsr</text>
</g>
<!-- stateStore_expandIsr&#45;&gt;isrExpandRate -->
<g id="edge5" class="edge">
<title>stateStore_expandIsr&#45;&gt;isrExpandRate</title>
<path fill="none" stroke="#000000" d="M1607.6257,-318.516C1624.9242,-316.0846 1645.0135,-310.4869 1659,-298 1692.682,-267.9294 1662.3477,-234.1856 1695,-203 1701.9562,-196.3562 1710.5723,-191.347 1719.588,-187.5702"/>
<polygon fill="#000000" stroke="#000000" points="1720.9088,-190.8135 1729.0753,-184.0637 1718.482,-184.2476 1720.9088,-190.8135"/>
</g>
<!-- updateFetchState -->
<g id="node11" class="node">
<title>updateFetchState</title>
<polygon fill="none" stroke="#000000" points="1832.5,-338 1722.5,-338 1722.5,-302 1832.5,-302 1832.5,-338"/>
<text text-anchor="middle" x="1777.5" y="-316.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFetchState</text>
</g>
<!-- stateStore_expandIsr&#45;&gt;updateFetchState -->
<g id="edge6" class="edge">
<title>stateStore_expandIsr&#45;&gt;updateFetchState</title>
<path fill="none" stroke="#000000" d="M1607.7408,-320C1636.3937,-320 1677.6011,-320 1712.241,-320"/>
<polygon fill="#000000" stroke="#000000" points="1712.2889,-323.5001 1722.2888,-320 1712.2888,-316.5001 1712.2889,-323.5001"/>
</g>
<!-- LeaderAndIsr -->
<g id="node15" class="node">
<title>LeaderAndIsr</title>
<polygon fill="#95e1d3" stroke="#000000" points="1724,-446.5 1724,-561.5 1831,-561.5 1831,-446.5 1724,-446.5"/>
<text text-anchor="middle" x="1777.5" y="-546.3" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAndIsr</text>
<polyline fill="none" stroke="#000000" points="1724,-538.5 1831,-538.5 "/>
<text text-anchor="start" x="1732" y="-523.3" font-family="Times,serif" font-size="14.00" fill="#000000">leader: Int</text>
<polyline fill="none" stroke="#000000" points="1724,-515.5 1831,-515.5 "/>
<text text-anchor="start" x="1732" y="-500.3" font-family="Times,serif" font-size="14.00" fill="#000000">leaderEpoch: Int</text>
<polyline fill="none" stroke="#000000" points="1724,-492.5 1831,-492.5 "/>
<text text-anchor="start" x="1732" y="-477.3" font-family="Times,serif" font-size="14.00" fill="#000000">isr: List[Int]</text>
<polyline fill="none" stroke="#000000" points="1724,-469.5 1831,-469.5 "/>
<text text-anchor="start" x="1732" y="-454.3" font-family="Times,serif" font-size="14.00" fill="#000000">zkVersion: Int</text>
</g>
<!-- stateStore_expandIsr&#45;&gt;LeaderAndIsr -->
<g id="edge27" class="edge">
<title>stateStore_expandIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M1591.3477,-338.0454C1615.1901,-360.755 1657.6493,-400.806 1695,-434 1701.8053,-440.0479 1708.9909,-446.315 1716.1691,-452.5013"/>
<polygon fill="#000000" stroke="#000000" points="1714.069,-455.3112 1723.9367,-459.1684 1718.6281,-449.9995 1714.069,-455.3112"/>
</g>
<!-- stateStore_shrinkIsr -->
<g id="node9" class="node">
<title>stateStore_shrinkIsr</title>
<polygon fill="none" stroke="#000000" points="1605,-392 1540,-392 1540,-356 1605,-356 1605,-392"/>
<text text-anchor="middle" x="1572.5" y="-370.3" font-family="Times,serif" font-size="14.00" fill="#000000">shrinkIsr</text>
</g>
<!-- stateStore_shrinkIsr&#45;&gt;isrShrinkRate -->
<g id="edge3" class="edge">
<title>stateStore_shrinkIsr&#45;&gt;isrShrinkRate</title>
<path fill="none" stroke="#000000" d="M1605.1285,-371.7841C1622.5586,-369.1929 1643.544,-363.6741 1659,-352 1684.4261,-332.7953 1673.6553,-313.6583 1695,-290 1707.3965,-276.2598 1723.4181,-263.7401 1738.0401,-253.7337"/>
<polygon fill="#000000" stroke="#000000" points="1740.0602,-256.5936 1746.4496,-248.1422 1736.1844,-250.7645 1740.0602,-256.5936"/>
</g>
<!-- updateIsr -->
<g id="node10" class="node">
<title>updateIsr</title>
<polygon fill="none" stroke="#000000" points="1811,-392 1744,-392 1744,-356 1811,-356 1811,-392"/>
<text text-anchor="middle" x="1777.5" y="-370.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateIsr</text>
</g>
<!-- stateStore_shrinkIsr&#45;&gt;updateIsr -->
<g id="edge4" class="edge">
<title>stateStore_shrinkIsr&#45;&gt;updateIsr</title>
<path fill="none" stroke="#000000" d="M1605.4368,-374C1640.1976,-374 1695.1681,-374 1733.5948,-374"/>
<polygon fill="#000000" stroke="#000000" points="1733.9639,-377.5001 1743.9639,-374 1733.9639,-370.5001 1733.9639,-377.5001"/>
</g>
<!-- stateStore_shrinkIsr&#45;&gt;LeaderAndIsr -->
<g id="edge28" class="edge">
<title>stateStore_shrinkIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M1601.0044,-392.0759C1630.4613,-410.7559 1677.3765,-440.5071 1715.4347,-464.6415"/>
<polygon fill="#000000" stroke="#000000" points="1713.5869,-467.6142 1723.9064,-470.0138 1717.3357,-461.7026 1713.5869,-467.6142"/>
</g>
<!-- updateIsr&#45;&gt;updateLeaderAndIsr -->
<g id="edge7" class="edge">
<title>updateIsr&#45;&gt;updateLeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M1811.118,-376.4386C1834.594,-378.1415 1866.8642,-380.4824 1896.23,-382.6125"/>
<polygon fill="#000000" stroke="#000000" points="1896.2497,-386.1231 1906.4768,-383.3558 1896.7562,-379.1414 1896.2497,-386.1231"/>
</g>
<!-- updateIsr&#45;&gt;recordIsrChange -->
<g id="edge8" class="edge">
<title>updateIsr&#45;&gt;recordIsrChange</title>
<path fill="none" stroke="#000000" d="M1811.2235,-368.6271C1829.1225,-364.6604 1850.8902,-357.9825 1868,-347 1904.548,-323.5404 1935.6275,-283.3827 1953.6858,-256.7646"/>
<polygon fill="#000000" stroke="#000000" points="1956.6891,-258.5686 1959.2998,-248.3004 1950.8556,-254.6994 1956.6891,-258.5686"/>
</g>
<!-- updateIsr&#45;&gt;failedIsrUpdatesRate -->
<g id="edge9" class="edge">
<title>updateIsr&#45;&gt;failedIsrUpdatesRate</title>
<path fill="none" stroke="#000000" d="M1811.2851,-372.2926C1830.5696,-369.5072 1853.6835,-362.7913 1868,-347 1911.7917,-298.6973 1853.6213,-252.5471 1896,-203 1896.6259,-202.2682 1897.2734,-201.5562 1897.9406,-200.8635"/>
<polygon fill="#000000" stroke="#000000" points="1900.4546,-203.3186 1905.7736,-194.1557 1895.9015,-198.0017 1900.4546,-203.3186"/>
</g>
<!-- Replica -->
<g id="node12" class="node">
<title>Replica</title>
<polygon fill="none" stroke="#000000" points="1896,-1180.5 1896,-1295.5 2045,-1295.5 2045,-1180.5 1896,-1180.5"/>
<text text-anchor="middle" x="1970.5" y="-1280.3" font-family="Times,serif" font-size="14.00" fill="#000000">Replica</text>
<polyline fill="none" stroke="#000000" points="1896,-1272.5 2045,-1272.5 "/>
<text text-anchor="start" x="1904" y="-1257.3" font-family="Times,serif" font-size="14.00" fill="#000000">brokerId</text>
<polyline fill="none" stroke="#000000" points="1896,-1249.5 2045,-1249.5 "/>
<text text-anchor="start" x="1904" y="-1234.3" font-family="Times,serif" font-size="14.00" fill="#000000">topicPartition</text>
<polyline fill="none" stroke="#000000" points="1896,-1226.5 2045,-1226.5 "/>
<text text-anchor="start" x="1904" y="-1211.3" font-family="Times,serif" font-size="14.00" fill="#000000">logEndOffsetMetadata</text>
<polyline fill="none" stroke="#000000" points="1896,-1203.5 2045,-1203.5 "/>
<text text-anchor="start" x="1904" y="-1188.3" font-family="Times,serif" font-size="14.00" fill="#000000">lastSentHighWatermark</text>
</g>
<!-- replica_updateFetchState -->
<g id="node13" class="node">
<title>replica_updateFetchState</title>
<polygon fill="none" stroke="#000000" points="1517.5,-1245 1517.5,-1291 1627.5,-1291 1627.5,-1245 1517.5,-1245"/>
<text text-anchor="middle" x="1572.5" y="-1275.8" font-family="Times,serif" font-size="14.00" fill="#000000">updateFetchState</text>
<polyline fill="none" stroke="#000000" points="1517.5,-1268 1627.5,-1268 "/>
<text text-anchor="start" x="1525.5" y="-1252.8" font-family="Times,serif" font-size="14.00" fill="#000000">更新replica状态</text>
</g>
<!-- replica_updateFetchState&#45;&gt;Replica -->
<g id="edge11" class="edge">
<title>replica_updateFetchState&#45;&gt;Replica</title>
<path fill="none" stroke="#000000" d="M1627.8402,-1263.8286C1694.6839,-1258.7902 1807.832,-1250.2614 1885.7064,-1244.3915"/>
<polygon fill="#000000" stroke="#000000" points="1886.2663,-1247.8593 1895.9749,-1243.6175 1885.7401,-1240.8791 1886.2663,-1247.8593"/>
</g>
<!-- replica_resetLastCaughtUpTime -->
<g id="node14" class="node">
<title>replica_resetLastCaughtUpTime</title>
<polygon fill="none" stroke="#000000" points="1497.5,-1180 1497.5,-1226 1647.5,-1226 1647.5,-1180 1497.5,-1180"/>
<text text-anchor="middle" x="1572.5" y="-1210.8" font-family="Times,serif" font-size="14.00" fill="#000000">resetLastCaughtUpTime</text>
<polyline fill="none" stroke="#000000" points="1497.5,-1203 1647.5,-1203 "/>
<text text-anchor="start" x="1505.5" y="-1187.8" font-family="Times,serif" font-size="14.00" fill="#000000">更新replica状态</text>
</g>
<!-- replica_resetLastCaughtUpTime&#45;&gt;Replica -->
<g id="edge10" class="edge">
<title>replica_resetLastCaughtUpTime&#45;&gt;Replica</title>
<path fill="none" stroke="#000000" d="M1647.8287,-1209.6244C1715.5969,-1215.5839 1815.0671,-1224.3313 1885.6237,-1230.536"/>
<polygon fill="#000000" stroke="#000000" points="1885.5485,-1234.0428 1895.8167,-1231.4324 1886.1618,-1227.0697 1885.5485,-1234.0428"/>
</g>
<!-- LeaderAndIsr&#45;&gt;zk_partitionState -->
<g id="edge29" class="edge">
<title>LeaderAndIsr&#45;&gt;zk_partitionState</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1831.0846,-497.797C1930.3361,-486.3075 2143.2166,-461.6642 2259.3805,-448.2169"/>
<polygon fill="#000000" stroke="#000000" points="2260.0972,-451.6574 2269.6283,-447.0306 2259.2922,-444.7038 2260.0972,-451.6574"/>
</g>
<!-- remoteReplicasMap -->
<g id="node16" class="node">
<title>remoteReplicasMap</title>
<polygon fill="#95e1d3" stroke="#000000" points="1841,-1126 1718,-1126 1714,-1122 1714,-1090 1837,-1090 1841,-1094 1841,-1126"/>
<polyline fill="none" stroke="#000000" points="1837,-1122 1714,-1122 "/>
<polyline fill="none" stroke="#000000" points="1837,-1122 1837,-1090 "/>
<polyline fill="none" stroke="#000000" points="1837,-1122 1841,-1126 "/>
<text text-anchor="middle" x="1777.5" y="-1104.3" font-family="Times,serif" font-size="14.00" fill="#000000">remoteReplicasMap</text>
</g>
<!-- remoteReplicasMap&#45;&gt;Replica -->
<g id="edge12" class="edge">
<title>remoteReplicasMap&#45;&gt;Replica</title>
<path fill="none" stroke="#000000" d="M1804.891,-1126.0193C1822.8735,-1137.8838 1846.8861,-1153.7923 1868,-1168 1874.3481,-1172.2717 1880.9072,-1176.7051 1887.4965,-1181.1732"/>
<polygon fill="#000000" stroke="#000000" points="1885.6063,-1184.1203 1895.8457,-1186.8417 1889.5383,-1178.3289 1885.6063,-1184.1203"/>
</g>
<!-- updateAssignmentAndIsr -->
<g id="node17" class="node">
<title>updateAssignmentAndIsr</title>
<polygon fill="#f38181" stroke="#000000" points="1492,-765 1492,-841 1653,-841 1653,-765 1492,-765"/>
<text text-anchor="middle" x="1572.5" y="-825.8" font-family="Times,serif" font-size="14.00" fill="#000000">updateAssignmentAndIsr</text>
<polyline fill="none" stroke="#000000" points="1492,-818 1653,-818 "/>
<text text-anchor="start" x="1500" y="-802.8" font-family="Times,serif" font-size="14.00" fill="#000000">使用partitionState中信息</text>
<text text-anchor="start" x="1500" y="-787.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 更新topic partition 分配</text>
<text text-anchor="start" x="1500" y="-772.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 以及ISR</text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;remoteReplicasMap -->
<g id="edge13" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;remoteReplicasMap</title>
<path fill="none" stroke="#ff0000" d="M1579.0511,-841.1407C1591.2586,-900.7377 1623.0752,-1015.8497 1695,-1081 1697.9931,-1083.7112 1701.2635,-1086.1506 1704.7204,-1088.3454"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1703.2057,-1091.5079 1713.6456,-1093.3129 1706.61,-1085.3914 1703.2057,-1091.5079"/>
</g>
<!-- inSyncReplicaIds -->
<g id="node18" class="node">
<title>inSyncReplicaIds</title>
<polygon fill="#95e1d3" stroke="#000000" points="1714,-899 1714,-945 1841,-945 1841,-899 1714,-899"/>
<text text-anchor="middle" x="1777.5" y="-929.8" font-family="Times,serif" font-size="14.00" fill="#000000">inSyncReplicaIds</text>
<polyline fill="none" stroke="#000000" points="1714,-922 1841,-922 "/>
<text text-anchor="start" x="1722" y="-906.8" font-family="Times,serif" font-size="14.00" fill="#000000">处于同步的副本id</text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;inSyncReplicaIds -->
<g id="edge14" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;inSyncReplicaIds</title>
<path fill="none" stroke="#ff0000" d="M1621.1755,-841.0815C1642.9997,-857.1109 1669.5223,-875.2036 1695,-889 1698.4866,-890.888 1702.1048,-892.7296 1705.793,-894.515"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1704.5266,-897.7861 1715.0697,-898.8319 1707.4799,-891.4396 1704.5266,-897.7861"/>
</g>
<!-- assignmentState -->
<g id="node19" class="node">
<title>assignmentState</title>
<polygon fill="#95e1d3" stroke="#000000" points="1704.5,-964.5 1704.5,-1071.5 1850.5,-1071.5 1850.5,-964.5 1704.5,-964.5"/>
<text text-anchor="start" x="1712.5" y="-1056.3" font-family="Times,serif" font-size="14.00" fill="#000000">assignmentState</text>
<text text-anchor="start" x="1712.5" y="-1041.3" font-family="Times,serif" font-size="14.00" fill="#000000"> partion assigment状态</text>
<polyline fill="none" stroke="#000000" points="1704.5,-1033.5 1850.5,-1033.5 "/>
<text text-anchor="start" x="1712.5" y="-1018.3" font-family="Times,serif" font-size="14.00" fill="#000000">replicas Seq[Int]</text>
<polyline fill="none" stroke="#000000" points="1704.5,-1010.5 1850.5,-1010.5 "/>
<text text-anchor="start" x="1712.5" y="-995.3" font-family="Times,serif" font-size="14.00" fill="#000000">replicationFactor Int</text>
<polyline fill="none" stroke="#000000" points="1704.5,-987.5 1850.5,-987.5 "/>
<text text-anchor="start" x="1712.5" y="-972.3" font-family="Times,serif" font-size="14.00" fill="#000000">isAddingReplica bool </text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;assignmentState -->
<g id="edge15" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;assignmentState</title>
<path fill="none" stroke="#ff0000" d="M1599.1509,-841.0327C1622.5479,-873.1302 1658.4633,-919.4072 1695,-955 1695.8068,-955.786 1696.6234,-956.5711 1697.4488,-957.355"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1695.3546,-960.1835 1705.0897,-964.3644 1700.0867,-955.0252 1695.3546,-960.1835"/>
</g>
<!-- partitionState -->
<g id="node32" class="node">
<title>partitionState</title>
<polygon fill="#95e1d3" stroke="#000000" points="1695,-580.5 1695,-879.5 1860,-879.5 1860,-580.5 1695,-580.5"/>
<text text-anchor="middle" x="1777.5" y="-864.3" font-family="Times,serif" font-size="14.00" fill="#000000">partitionState</text>
<polyline fill="none" stroke="#000000" points="1695,-856.5 1860,-856.5 "/>
<text text-anchor="start" x="1703" y="-841.3" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAndIsrPartitionState</text>
<polyline fill="none" stroke="#000000" points="1695,-833.5 1860,-833.5 "/>
<text text-anchor="middle" x="1777.5" y="-818.3" font-family="Times,serif" font-size="14.00" fill="#000000">TopicName string</text>
<polyline fill="none" stroke="#000000" points="1695,-810.5 1860,-810.5 "/>
<text text-anchor="middle" x="1777.5" y="-795.3" font-family="Times,serif" font-size="14.00" fill="#000000">PartitionIndex int32</text>
<polyline fill="none" stroke="#000000" points="1695,-787.5 1860,-787.5 "/>
<text text-anchor="middle" x="1777.5" y="-772.3" font-family="Times,serif" font-size="14.00" fill="#000000">ControllerEpoch int32</text>
<polyline fill="none" stroke="#000000" points="1695,-764.5 1860,-764.5 "/>
<text text-anchor="middle" x="1777.5" y="-749.3" font-family="Times,serif" font-size="14.00" fill="#000000">Leader int32</text>
<polyline fill="none" stroke="#000000" points="1695,-741.5 1860,-741.5 "/>
<text text-anchor="middle" x="1777.5" y="-726.3" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderEpoch int32</text>
<polyline fill="none" stroke="#000000" points="1695,-718.5 1860,-718.5 "/>
<text text-anchor="middle" x="1777.5" y="-703.3" font-family="Times,serif" font-size="14.00" fill="#000000">Isr []int32</text>
<polyline fill="none" stroke="#000000" points="1695,-695.5 1860,-695.5 "/>
<text text-anchor="middle" x="1777.5" y="-680.3" font-family="Times,serif" font-size="14.00" fill="#000000">zkVersion int32</text>
<polyline fill="none" stroke="#000000" points="1695,-672.5 1860,-672.5 "/>
<text text-anchor="middle" x="1777.5" y="-657.3" font-family="Times,serif" font-size="14.00" fill="#000000">Replicas []int32</text>
<polyline fill="none" stroke="#000000" points="1695,-649.5 1860,-649.5 "/>
<text text-anchor="middle" x="1777.5" y="-634.3" font-family="Times,serif" font-size="14.00" fill="#000000">AddingReplicas []int32</text>
<polyline fill="none" stroke="#000000" points="1695,-626.5 1860,-626.5 "/>
<text text-anchor="middle" x="1777.5" y="-611.3" font-family="Times,serif" font-size="14.00" fill="#000000">RemovingReplicas []int32</text>
<polyline fill="none" stroke="#000000" points="1695,-603.5 1860,-603.5 "/>
<text text-anchor="middle" x="1777.5" y="-588.3" font-family="Times,serif" font-size="14.00" fill="#000000">isNew bool</text>
</g>
<!-- updateAssignmentAndIsr&#45;&gt;partitionState -->
<g id="edge43" class="edge">
<title>updateAssignmentAndIsr&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" d="M1653.2272,-774.2533C1663.6928,-770.5265 1674.4759,-766.6866 1685.1124,-762.899"/>
<polygon fill="#000000" stroke="#000000" points="1686.5797,-766.0919 1694.8261,-759.44 1684.2314,-759.4975 1686.5797,-766.0919"/>
</g>
<!-- maybeExpandIsr -->
<g id="node20" class="node">
<title>maybeExpandIsr</title>
<polygon fill="#ffd3b6" stroke="#000000" points="1046,-446.5 1046,-507.5 1190,-507.5 1190,-446.5 1046,-446.5"/>
<text text-anchor="middle" x="1118" y="-492.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeExpandIsr</text>
<polyline fill="none" stroke="#000000" points="1046,-484.5 1190,-484.5 "/>
<text text-anchor="start" x="1054" y="-469.3" font-family="Times,serif" font-size="14.00" fill="#000000">follower已经in sync了</text>
<text text-anchor="start" x="1054" y="-454.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 增加ISR</text>
</g>
<!-- isFollowerInSync -->
<g id="node22" class="node">
<title>isFollowerInSync</title>
<polygon fill="none" stroke="#000000" points="1226,-855 1226,-901 1450,-901 1450,-855 1226,-855"/>
<text text-anchor="middle" x="1338" y="-885.8" font-family="Times,serif" font-size="14.00" fill="#000000">isFollowerInSync</text>
<polyline fill="none" stroke="#000000" points="1226,-878 1450,-878 "/>
<text text-anchor="start" x="1234" y="-862.8" font-family="Times,serif" font-size="14.00" fill="#000000">判断follower的replica是否已经sync</text>
</g>
<!-- maybeExpandIsr&#45;&gt;isFollowerInSync -->
<g id="edge16" class="edge">
<title>maybeExpandIsr&#45;&gt;isFollowerInSync</title>
<path fill="none" stroke="#000000" d="M1122.7995,-507.5469C1135.4667,-584.5067 1172.1101,-784.4508 1223.4942,-847.3327"/>
<polygon fill="#000000" stroke="#000000" points="1221.1567,-849.9614 1230.5036,-854.9501 1226.3078,-845.2214 1221.1567,-849.9614"/>
</g>
<!-- expandIsr -->
<g id="node23" class="node">
<title>expandIsr</title>
<polygon fill="none" stroke="#000000" points="1373,-493 1303,-493 1303,-457 1373,-457 1373,-493"/>
<text text-anchor="middle" x="1338" y="-471.3" font-family="Times,serif" font-size="14.00" fill="#000000">expandIsr</text>
</g>
<!-- maybeExpandIsr&#45;&gt;expandIsr -->
<g id="edge17" class="edge">
<title>maybeExpandIsr&#45;&gt;expandIsr</title>
<path fill="none" stroke="#000000" d="M1190.0362,-476.3451C1223.8899,-476.0374 1263.2116,-475.6799 1292.8063,-475.4109"/>
<polygon fill="#000000" stroke="#000000" points="1292.876,-478.9105 1302.8438,-475.3196 1292.8123,-471.9108 1292.876,-478.9105"/>
</g>
<!-- maybeShrinkIsr -->
<g id="node21" class="node">
<title>maybeShrinkIsr</title>
<polygon fill="#dcedc1" stroke="#000000" points="819,-506 819,-552 1010,-552 1010,-506 819,-506"/>
<text text-anchor="middle" x="914.5" y="-536.8" font-family="Times,serif" font-size="14.00" fill="#000000">maybeShrinkIsr</text>
<polyline fill="none" stroke="#000000" points="819,-529 1010,-529 "/>
<text text-anchor="start" x="827" y="-513.8" font-family="Times,serif" font-size="14.00" fill="#000000">从ISR中踢掉out sync的replica</text>
</g>
<!-- shrinkIsr -->
<g id="node24" class="node">
<title>shrinkIsr</title>
<polygon fill="none" stroke="#000000" points="1370.5,-547 1305.5,-547 1305.5,-511 1370.5,-511 1370.5,-547"/>
<text text-anchor="middle" x="1338" y="-525.3" font-family="Times,serif" font-size="14.00" fill="#000000">shrinkIsr</text>
</g>
<!-- maybeShrinkIsr&#45;&gt;shrinkIsr -->
<g id="edge18" class="edge">
<title>maybeShrinkIsr&#45;&gt;shrinkIsr</title>
<path fill="none" stroke="#000000" d="M1010.0697,-529C1099.4559,-529 1228.8466,-529 1295.2096,-529"/>
<polygon fill="#000000" stroke="#000000" points="1295.3036,-532.5001 1305.3035,-529 1295.3035,-525.5001 1295.3036,-532.5001"/>
</g>
<!-- getOutOfSyncReplicas -->
<g id="node25" class="node">
<title>getOutOfSyncReplicas</title>
<polygon fill="none" stroke="#000000" points="1188.5,-944 1047.5,-944 1047.5,-908 1188.5,-908 1188.5,-944"/>
<text text-anchor="middle" x="1118" y="-922.3" font-family="Times,serif" font-size="14.00" fill="#000000">getOutOfSyncReplicas</text>
</g>
<!-- maybeShrinkIsr&#45;&gt;getOutOfSyncReplicas -->
<g id="edge19" class="edge">
<title>maybeShrinkIsr&#45;&gt;getOutOfSyncReplicas</title>
<path fill="none" stroke="#000000" d="M926.3206,-552.0604C961.554,-620.7958 1065.7666,-824.0999 1103.8548,-898.4046"/>
<polygon fill="#000000" stroke="#000000" points="1100.8966,-900.3066 1108.5729,-907.609 1107.1259,-897.1135 1100.8966,-900.3066"/>
</g>
<!-- leaderEpochStartOffsetOpt -->
<g id="node30" class="node">
<title>leaderEpochStartOffsetOpt</title>
<polygon fill="#95e1d3" stroke="#000000" points="1490.5,-860 1490.5,-906 1654.5,-906 1654.5,-860 1490.5,-860"/>
<text text-anchor="middle" x="1572.5" y="-890.8" font-family="Times,serif" font-size="14.00" fill="#000000">leaderEpochStartOffsetOpt</text>
<polyline fill="none" stroke="#000000" points="1490.5,-883 1654.5,-883 "/>
<text text-anchor="start" x="1498.5" y="-867.8" font-family="Times,serif" font-size="14.00" fill="#000000">记录leader的LogOffset</text>
</g>
<!-- isFollowerInSync&#45;&gt;leaderEpochStartOffsetOpt -->
<g id="edge34" class="edge">
<title>isFollowerInSync&#45;&gt;leaderEpochStartOffsetOpt</title>
<path fill="none" stroke="#000000" d="M1450.0989,-880.3902C1460.1495,-880.6045 1470.2507,-880.8198 1480.1062,-881.03"/>
<polygon fill="#000000" stroke="#000000" points="1480.2031,-884.5327 1490.2755,-881.2468 1480.3524,-877.5343 1480.2031,-884.5327"/>
</g>
<!-- expandIsr&#45;&gt;stateStore_expandIsr -->
<g id="edge24" class="edge">
<title>expandIsr&#45;&gt;stateStore_expandIsr</title>
<path fill="none" stroke="#000000" d="M1373.0002,-473.7293C1396.1213,-471.5872 1426.3961,-466.2097 1450,-453 1496.1256,-427.1862 1534.5694,-377.7924 1555.4822,-347.0045"/>
<polygon fill="#000000" stroke="#000000" points="1558.533,-348.7373 1561.1533,-338.4715 1552.7031,-344.8626 1558.533,-348.7373"/>
</g>
<!-- expandIsr&#45;&gt;LeaderAndIsr -->
<g id="edge25" class="edge">
<title>expandIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M1373.2232,-477.3242C1447.1432,-482.2017 1619.3739,-493.5662 1713.4184,-499.7716"/>
<polygon fill="#000000" stroke="#000000" points="1713.4472,-503.2811 1723.6559,-500.4471 1713.9081,-496.2962 1713.4472,-503.2811"/>
</g>
<!-- maybeUpdateIsrAndVersion -->
<g id="node26" class="node">
<title>maybeUpdateIsrAndVersion</title>
<polygon fill="none" stroke="#000000" points="1659,-530 1486,-530 1486,-494 1659,-494 1659,-530"/>
<text text-anchor="middle" x="1572.5" y="-508.3" font-family="Times,serif" font-size="14.00" fill="#000000">maybeUpdateIsrAndVersion</text>
</g>
<!-- expandIsr&#45;&gt;maybeUpdateIsrAndVersion -->
<g id="edge26" class="edge">
<title>expandIsr&#45;&gt;maybeUpdateIsrAndVersion</title>
<path fill="none" stroke="#000000" d="M1373.107,-480.5393C1400.3188,-484.8328 1439.3932,-490.9981 1475.7527,-496.735"/>
<polygon fill="#000000" stroke="#000000" points="1475.5005,-500.2384 1485.9238,-498.3398 1476.5915,-493.3239 1475.5005,-500.2384"/>
</g>
<!-- shrinkIsr&#45;&gt;stateStore_shrinkIsr -->
<g id="edge20" class="edge">
<title>shrinkIsr&#45;&gt;stateStore_shrinkIsr</title>
<path fill="none" stroke="#000000" d="M1370.5434,-530.011C1394.7357,-529.1369 1427.3408,-524.3439 1450,-507 1478.726,-485.0123 1462.3855,-461.4043 1486,-434 1498.5662,-419.4171 1515.4348,-406.6772 1530.9383,-396.7324"/>
<polygon fill="#000000" stroke="#000000" points="1533.2045,-399.446 1539.8658,-391.2073 1529.5207,-393.4937 1533.2045,-399.446"/>
</g>
<!-- shrinkIsr&#45;&gt;LeaderAndIsr -->
<g id="edge21" class="edge">
<title>shrinkIsr&#45;&gt;LeaderAndIsr</title>
<path fill="none" stroke="#000000" d="M1370.6093,-534.9789C1428.9092,-544.6817 1554.6754,-561.1327 1659,-544 1677.3497,-540.9865 1696.6838,-535.5128 1714.2902,-529.5621"/>
<polygon fill="#000000" stroke="#000000" points="1715.5864,-532.8168 1723.8766,-526.2196 1713.2818,-526.2071 1715.5864,-532.8168"/>
</g>
<!-- shrinkIsr&#45;&gt;maybeUpdateIsrAndVersion -->
<g id="edge22" class="edge">
<title>shrinkIsr&#45;&gt;maybeUpdateIsrAndVersion</title>
<path fill="none" stroke="#000000" d="M1370.6062,-526.6362C1397.9278,-524.6556 1438.379,-521.7231 1475.9129,-519.002"/>
<polygon fill="#000000" stroke="#000000" points="1476.1732,-522.4925 1485.8939,-518.2785 1475.667,-515.5108 1476.1732,-522.4925"/>
</g>
<!-- getOutOfSyncReplicas&#45;&gt;inSyncReplicaIds -->
<g id="edge33" class="edge">
<title>getOutOfSyncReplicas&#45;&gt;inSyncReplicaIds</title>
<path fill="none" stroke="#000000" d="M1188.5781,-925.5719C1314.2692,-924.8096 1575.6765,-923.2241 1703.6686,-922.4478"/>
<polygon fill="#000000" stroke="#000000" points="1703.7897,-925.9472 1713.7683,-922.3865 1703.7472,-918.9474 1703.7897,-925.9472"/>
</g>
<!-- isFollowerOutOfSync -->
<g id="node28" class="node">
<title>isFollowerOutOfSync</title>
<polygon fill="none" stroke="#000000" points="1241,-979.5 1241,-1040.5 1435,-1040.5 1435,-979.5 1241,-979.5"/>
<text text-anchor="middle" x="1338" y="-1025.3" font-family="Times,serif" font-size="14.00" fill="#000000">isFollowerOutOfSync</text>
<polyline fill="none" stroke="#000000" points="1241,-1017.5 1435,-1017.5 "/>
<text text-anchor="start" x="1249" y="-1002.3" font-family="Times,serif" font-size="14.00" fill="#000000">根据logEndoffset和maxLagMx</text>
<text text-anchor="start" x="1249" y="-987.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 判断follower是否同步</text>
</g>
<!-- getOutOfSyncReplicas&#45;&gt;isFollowerOutOfSync -->
<g id="edge31" class="edge">
<title>getOutOfSyncReplicas&#45;&gt;isFollowerOutOfSync</title>
<path fill="none" stroke="#000000" d="M1155.0076,-944.1555C1175.6402,-953.93 1201.953,-965.8275 1226,-975 1227.6685,-975.6364 1229.354,-976.2703 1231.0534,-976.901"/>
<polygon fill="#000000" stroke="#000000" points="1230.3229,-980.359 1240.9171,-980.4754 1232.7078,-973.7778 1230.3229,-980.359"/>
</g>
<!-- maybeUpdateIsrAndVersion&#45;&gt;inSyncReplicaIds -->
<g id="edge23" class="edge">
<title>maybeUpdateIsrAndVersion&#45;&gt;inSyncReplicaIds</title>
<path fill="none" stroke="#000000" d="M1579.4923,-530.2048C1594.8655,-570.54 1632.3542,-670.6223 1659,-756 1677.2442,-814.4575 1654.2847,-843.2574 1695,-889 1698.0833,-892.464 1701.5802,-895.5696 1705.3509,-898.3531"/>
<polygon fill="#000000" stroke="#000000" points="1703.6928,-901.449 1713.9891,-903.9463 1707.4974,-895.5732 1703.6928,-901.449"/>
</g>
<!-- updateFollowerFetchState -->
<g id="node27" class="node">
<title>updateFollowerFetchState</title>
<polygon fill="none" stroke="#000000" points="993.5,-484 835.5,-484 835.5,-448 993.5,-448 993.5,-484"/>
<text text-anchor="middle" x="914.5" y="-462.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFollowerFetchState</text>
</g>
<!-- updateFollowerFetchState&#45;&gt;maybeExpandIsr -->
<g id="edge30" class="edge">
<title>updateFollowerFetchState&#45;&gt;maybeExpandIsr</title>
<path fill="none" stroke="#000000" d="M993.7611,-470.2844C1007.5908,-471.0319 1022.004,-471.811 1035.9081,-472.5626"/>
<polygon fill="#000000" stroke="#000000" points="1035.7525,-476.0592 1045.9268,-473.1042 1036.1304,-469.0694 1035.7525,-476.0592"/>
</g>
<!-- getReplicaOrException -->
<g id="node29" class="node">
<title>getReplicaOrException</title>
<polygon fill="none" stroke="#000000" points="1644,-1096 1501,-1096 1501,-1060 1644,-1060 1644,-1096"/>
<text text-anchor="middle" x="1572.5" y="-1074.3" font-family="Times,serif" font-size="14.00" fill="#000000">getReplicaOrException</text>
</g>
<!-- isFollowerOutOfSync&#45;&gt;getReplicaOrException -->
<g id="edge32" class="edge">
<title>isFollowerOutOfSync&#45;&gt;getReplicaOrException</title>
<path fill="none" stroke="#000000" d="M1433.7159,-1040.551C1451.0688,-1045.8611 1469.0391,-1051.2109 1486,-1056 1487.6404,-1056.4632 1489.2995,-1056.9272 1490.9727,-1057.3911"/>
<polygon fill="#000000" stroke="#000000" points="1490.1086,-1060.7832 1500.6774,-1060.0402 1491.9521,-1054.0303 1490.1086,-1060.7832"/>
</g>
<!-- getReplicaOrException&#45;&gt;remoteReplicasMap -->
<g id="edge35" class="edge">
<title>getReplicaOrException&#45;&gt;remoteReplicasMap</title>
<path fill="none" stroke="#000000" d="M1644.1991,-1088.4925C1663.4702,-1091.3127 1684.3427,-1094.3672 1703.7246,-1097.2036"/>
<polygon fill="#000000" stroke="#000000" points="1703.3064,-1100.6796 1713.7079,-1098.6646 1704.3201,-1093.7534 1703.3064,-1100.6796"/>
</g>
<!-- makeLeader -->
<g id="node31" class="node">
<title>makeLeader</title>
<polygon fill="none" stroke="#000000" points="1380,-831 1296,-831 1296,-795 1380,-795 1380,-831"/>
<text text-anchor="middle" x="1338" y="-809.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeader</text>
</g>
<!-- makeLeader&#45;&gt;replica_updateFetchState -->
<g id="edge36" class="edge">
<title>makeLeader&#45;&gt;replica_updateFetchState</title>
<path fill="none" stroke="#000000" d="M1355.4785,-831.0153C1380.9777,-858.4866 1427.7548,-913.6285 1450,-970 1494.6,-1083.0208 1407.7116,-1148.0818 1486,-1241 1491.8183,-1247.9055 1499.376,-1253.0718 1507.6006,-1256.9315"/>
<polygon fill="#000000" stroke="#000000" points="1506.5289,-1260.2729 1517.1126,-1260.7572 1509.1409,-1253.7785 1506.5289,-1260.2729"/>
</g>
<!-- makeLeader&#45;&gt;replica_resetLastCaughtUpTime -->
<g id="edge37" class="edge">
<title>makeLeader&#45;&gt;replica_resetLastCaughtUpTime</title>
<path fill="none" stroke="#000000" d="M1355.1826,-831.1356C1380.3043,-858.7603 1426.6056,-914.0956 1450,-970 1485.8792,-1055.7386 1424.6711,-1106.1632 1486,-1176 1487.0381,-1177.1821 1488.127,-1178.313 1489.2613,-1179.395"/>
<polygon fill="#000000" stroke="#000000" points="1487.3476,-1182.3457 1497.3467,-1185.8485 1491.7144,-1176.8747 1487.3476,-1182.3457"/>
</g>
<!-- makeLeader&#45;&gt;updateAssignmentAndIsr -->
<g id="edge38" class="edge">
<title>makeLeader&#45;&gt;updateAssignmentAndIsr</title>
<path fill="none" stroke="#000000" d="M1380.1947,-811.2007C1408.3985,-809.9979 1446.598,-808.369 1481.5198,-806.8798"/>
<polygon fill="#000000" stroke="#000000" points="1481.9111,-810.3663 1491.7529,-806.4434 1481.6128,-803.3727 1481.9111,-810.3663"/>
</g>
<!-- makeLeader&#45;&gt;leaderEpochStartOffsetOpt -->
<g id="edge39" class="edge">
<title>makeLeader&#45;&gt;leaderEpochStartOffsetOpt</title>
<path fill="none" stroke="#000000" d="M1380.1947,-825.5954C1409.3633,-834.3025 1449.223,-846.2009 1485.0915,-856.9079"/>
<polygon fill="#000000" stroke="#000000" points="1484.5068,-860.3859 1495.0902,-859.8926 1486.5091,-853.6784 1484.5068,-860.3859"/>
</g>
<!-- makeLeader&#45;&gt;partitionState -->
<g id="edge40" class="edge">
<title>makeLeader&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" d="M1380.1411,-805.0416C1449.8965,-791.8682 1590.9669,-765.227 1684.8584,-747.4955"/>
<polygon fill="#000000" stroke="#000000" points="1685.7514,-750.8888 1694.9282,-745.5938 1684.4523,-744.0104 1685.7514,-750.8888"/>
</g>
<!-- makeFollower -->
<g id="node33" class="node">
<title>makeFollower</title>
<polygon fill="none" stroke="#000000" points="1385.5,-743 1290.5,-743 1290.5,-707 1385.5,-707 1385.5,-743"/>
<text text-anchor="middle" x="1338" y="-721.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollower</text>
</g>
<!-- makeFollower&#45;&gt;updateAssignmentAndIsr -->
<g id="edge41" class="edge">
<title>makeFollower&#45;&gt;updateAssignmentAndIsr</title>
<path fill="none" stroke="#000000" d="M1385.7372,-740.8785C1413.4047,-750.0813 1449.1543,-761.9724 1481.9582,-772.8837"/>
<polygon fill="#000000" stroke="#000000" points="1480.9823,-776.2476 1491.5759,-776.0828 1483.1917,-769.6054 1480.9823,-776.2476"/>
</g>
<!-- makeFollower&#45;&gt;partitionState -->
<g id="edge42" class="edge">
<title>makeFollower&#45;&gt;partitionState</title>
<path fill="none" stroke="#000000" d="M1385.8708,-725.5446C1457.3863,-726.3582 1593.4719,-727.9064 1684.8598,-728.9461"/>
<polygon fill="#000000" stroke="#000000" points="1684.9041,-732.4467 1694.9433,-729.0608 1684.9838,-725.4472 1684.9041,-732.4467"/>
</g>
<!-- startup -->
<g id="node34" class="node">
<title>startup</title>
<polygon fill="none" stroke="#000000" points="319,-235 265,-235 265,-199 319,-199 319,-235"/>
<text text-anchor="middle" x="292" y="-213.3" font-family="Times,serif" font-size="14.00" fill="#000000">startup</text>
</g>
<!-- scheduler_schedule -->
<g id="node35" class="node">
<title>scheduler_schedule</title>
<polygon fill="none" stroke="#000000" points="437,-186.5 437,-247.5 556,-247.5 556,-186.5 437,-186.5"/>
<text text-anchor="middle" x="496.5" y="-232.3" font-family="Times,serif" font-size="14.00" fill="#000000">scheduler.schedule</text>
<polyline fill="none" stroke="#000000" points="437,-224.5 556,-224.5 "/>
<text text-anchor="start" x="445" y="-209.3" font-family="Times,serif" font-size="14.00" fill="#000000">后台线程</text>
<text text-anchor="start" x="445" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 周期性调用</text>
</g>
<!-- startup&#45;&gt;scheduler_schedule -->
<g id="edge44" class="edge">
<title>startup&#45;&gt;scheduler_schedule</title>
<path fill="none" stroke="#000000" d="M319.156,-217C346.4667,-217 389.7067,-217 426.6523,-217"/>
<polygon fill="#000000" stroke="#000000" points="426.8875,-220.5001 436.8875,-217 426.8874,-213.5001 426.8875,-220.5001"/>
</g>
<!-- replicaManager_maybeShrinkIsr -->
<g id="node36" class="node">
<title>replicaManager_maybeShrinkIsr</title>
<polygon fill="#dcedc1" stroke="#000000" points="592,-197 592,-243 783,-243 783,-197 592,-197"/>
<text text-anchor="middle" x="687.5" y="-227.8" font-family="Times,serif" font-size="14.00" fill="#000000">maybeShrinkIsr</text>
<polyline fill="none" stroke="#000000" points="592,-220 783,-220 "/>
<text text-anchor="start" x="600" y="-204.8" font-family="Times,serif" font-size="14.00" fill="#000000">从ISR中踢掉out sync的replica</text>
</g>
<!-- scheduler_schedule&#45;&gt;replicaManager_maybeShrinkIsr -->
<g id="edge45" class="edge">
<title>scheduler_schedule&#45;&gt;replicaManager_maybeShrinkIsr</title>
<path fill="none" stroke="#000000" d="M556.1479,-217.9369C564.3298,-218.0654 572.9224,-218.2004 581.6313,-218.3371"/>
<polygon fill="#000000" stroke="#000000" points="581.8369,-221.8407 591.8907,-218.4983 581.9469,-214.8416 581.8369,-221.8407"/>
</g>
<!-- replicaManager_maybeShrinkIsr&#45;&gt;maybeShrinkIsr -->
<g id="edge49" class="edge">
<title>replicaManager_maybeShrinkIsr&#45;&gt;maybeShrinkIsr</title>
<path fill="none" stroke="#000000" d="M691.5401,-243.0099C701.8585,-295.0342 734.0023,-422.6447 811,-493 813.9571,-495.702 817.1278,-498.203 820.4571,-500.5178"/>
<polygon fill="#000000" stroke="#000000" points="818.6973,-503.5456 829.0279,-505.8969 822.4184,-497.6165 818.6973,-503.5456"/>
</g>
<!-- replicaManager_updateFollowerFetchState -->
<g id="node37" class="node">
<title>replicaManager_updateFollowerFetchState</title>
<polygon fill="none" stroke="#000000" points="766.5,-175 608.5,-175 608.5,-139 766.5,-139 766.5,-175"/>
<text text-anchor="middle" x="687.5" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#000000">updateFollowerFetchState</text>
</g>
<!-- replicaManager_updateFollowerFetchState&#45;&gt;updateFollowerFetchState -->
<g id="edge50" class="edge">
<title>replicaManager_updateFollowerFetchState&#45;&gt;updateFollowerFetchState</title>
<path fill="none" stroke="#000000" d="M766.4487,-175.1968C772.5419,-178.7342 778.1842,-182.9576 783,-188 815.4687,-221.9965 792.7039,-246.6961 811,-290 834.682,-346.0515 873.1413,-406.0682 895.9119,-439.5297"/>
<polygon fill="#000000" stroke="#000000" points="893.0734,-441.5791 901.6188,-447.8423 898.8443,-437.6172 893.0734,-441.5791"/>
</g>
<!-- fetchMessages -->
<g id="node38" class="node">
<title>fetchMessages</title>
<polygon fill="none" stroke="#000000" points="545,-168 448,-168 448,-132 545,-132 545,-168"/>
<text text-anchor="middle" x="496.5" y="-146.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchMessages</text>
</g>
<!-- fetchMessages&#45;&gt;replicaManager_updateFollowerFetchState -->
<g id="edge46" class="edge">
<title>fetchMessages&#45;&gt;replicaManager_updateFollowerFetchState</title>
<path fill="none" stroke="#000000" d="M545.1916,-151.7845C561.4179,-152.3792 580.0395,-153.0617 598.3486,-153.7327"/>
<polygon fill="#000000" stroke="#000000" points="598.3494,-157.235 608.4709,-154.1036 598.6059,-150.2397 598.3494,-157.235"/>
</g>
<!-- becomLeaderOrFollower -->
<g id="node39" class="node">
<title>becomLeaderOrFollower</title>
<polygon fill="none" stroke="#000000" points="991.5,-194 837.5,-194 837.5,-158 991.5,-158 991.5,-194"/>
<text text-anchor="middle" x="914.5" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#000000">becomLeaderOrFollower</text>
</g>
<!-- makeFollowers -->
<g id="node40" class="node">
<title>makeFollowers</title>
<polygon fill="none" stroke="#000000" points="1168.5,-194 1067.5,-194 1067.5,-158 1168.5,-158 1168.5,-194"/>
<text text-anchor="middle" x="1118" y="-172.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollowers</text>
</g>
<!-- becomLeaderOrFollower&#45;&gt;makeFollowers -->
<g id="edge47" class="edge">
<title>becomLeaderOrFollower&#45;&gt;makeFollowers</title>
<path fill="none" stroke="#000000" d="M991.7248,-176C1013.367,-176 1036.5834,-176 1057.1317,-176"/>
<polygon fill="#000000" stroke="#000000" points="1057.2977,-179.5001 1067.2976,-176 1057.2976,-172.5001 1057.2977,-179.5001"/>
</g>
<!-- makeLeaders -->
<g id="node41" class="node">
<title>makeLeaders</title>
<polygon fill="none" stroke="#000000" points="1162.5,-248 1073.5,-248 1073.5,-212 1162.5,-212 1162.5,-248"/>
<text text-anchor="middle" x="1118" y="-226.3" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeaders</text>
</g>
<!-- becomLeaderOrFollower&#45;&gt;makeLeaders -->
<g id="edge48" class="edge">
<title>becomLeaderOrFollower&#45;&gt;makeLeaders</title>
<path fill="none" stroke="#000000" d="M982.5455,-194.0563C1008.8477,-201.0358 1038.5374,-208.9141 1063.4031,-215.5124"/>
<polygon fill="#000000" stroke="#000000" points="1062.8216,-218.9791 1073.3848,-218.1611 1064.617,-212.2133 1062.8216,-218.9791"/>
</g>
<!-- makeFollowers&#45;&gt;makeFollower -->
<g id="edge51" class="edge">
<title>makeFollowers&#45;&gt;makeFollower</title>
<path fill="none" stroke="#000000" d="M1168.6643,-186.5333C1176.9365,-190.4159 1184.5645,-195.7292 1190,-203 1256.701,-292.2225 1152.1812,-619.5706 1226,-703 1239.5361,-718.2984 1260.3312,-724.8435 1280.3445,-727.2042"/>
<polygon fill="#000000" stroke="#000000" points="1280.1201,-730.6977 1290.3825,-728.0644 1280.7179,-723.7233 1280.1201,-730.6977"/>
</g>
<!-- makeLeaders&#45;&gt;makeLeader -->
<g id="edge52" class="edge">
<title>makeLeaders&#45;&gt;makeLeader</title>
<path fill="none" stroke="#000000" d="M1126.0625,-248.1305C1141.2948,-283.2337 1174.1886,-363.2589 1190,-434 1207.3926,-511.8156 1172.3136,-732.0462 1226,-791 1240.9735,-807.4426 1264.343,-813.6968 1285.8695,-815.5356"/>
<polygon fill="#000000" stroke="#000000" points="1285.7372,-819.0336 1295.9177,-816.0999 1286.1297,-812.0446 1285.7372,-819.0336"/>
</g>
<!-- processFetchRequest -->
<g id="node42" class="node">
<title>processFetchRequest</title>
<polygon fill="none" stroke="#000000" points="147,-65 16,-65 16,-29 147,-29 147,-65"/>
<text text-anchor="middle" x="81.5" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#000000">processFetchRequest</text>
</g>
<!-- fetchFromLeader -->
<g id="node43" class="node">
<title>fetchFromLeader</title>
<polygon fill="#ffd3b6" stroke="#000000" points="183,-16.5 183,-77.5 401,-77.5 401,-16.5 183,-16.5"/>
<text text-anchor="middle" x="292" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#000000">fetchFromLeader</text>
<polyline fill="none" stroke="#000000" points="183,-54.5 401,-54.5 "/>
<text text-anchor="start" x="191" y="-39.3" font-family="Times,serif" font-size="14.00" fill="#000000">每个partition的follower</text>
<text text-anchor="start" x="191" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 有个线程负从leader fetchMessage</text>
</g>
<!-- processFetchRequest&#45;&gt;fetchFromLeader -->
<g id="edge53" class="edge">
<title>processFetchRequest&#45;&gt;fetchFromLeader</title>
<path fill="none" stroke="#000000" d="M147.2376,-47C155.3878,-47 163.9077,-47 172.5579,-47"/>
<polygon fill="#000000" stroke="#000000" points="172.758,-50.5001 182.758,-47 172.7579,-43.5001 172.758,-50.5001"/>
</g>
<!-- fetchFromLeader&#45;&gt;fetchMessages -->
<g id="edge54" class="edge">
<title>fetchFromLeader&#45;&gt;fetchMessages</title>
<path fill="none" stroke="#000000" d="M352.8031,-77.6245C384.4622,-93.5702 422.5025,-112.7299 451.4889,-127.3294"/>
<polygon fill="#000000" stroke="#000000" points="450.0568,-130.5269 460.5624,-131.8994 453.2057,-124.2751 450.0568,-130.5269"/>
</g>
<!-- handleLeaderAndIsrRequest -->
<g id="node44" class="node">
<title>handleLeaderAndIsrRequest</title>
<polygon fill="none" stroke="#000000" points="773,-78 602,-78 602,-42 773,-42 773,-78"/>
<text text-anchor="middle" x="687.5" y="-56.3" font-family="Times,serif" font-size="14.00" fill="#000000">handleLeaderAndIsrRequest</text>
</g>
<!-- handleLeaderAndIsrRequest&#45;&gt;becomLeaderOrFollower -->
<g id="edge55" class="edge">
<title>handleLeaderAndIsrRequest&#45;&gt;becomLeaderOrFollower</title>
<path fill="none" stroke="#000000" d="M722.9688,-78.125C762.583,-98.3684 826.7773,-131.1726 869.7969,-153.1561"/>
<polygon fill="#000000" stroke="#000000" points="868.4091,-156.3774 878.9065,-157.8112 871.5944,-150.1441 868.4091,-156.3774"/>
</g>
</g>
</svg>
