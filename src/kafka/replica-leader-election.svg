<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: replica_leader_election Pages: 1 -->
<svg width="1888pt" height="766pt"
 viewBox="0.00 0.00 1888.00 766.43" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 762.4279)">
<title>replica_leader_election</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-762.4279 1884,-762.4279 1884,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_KafkaBroker</title>
<polygon fill="none" stroke="#000000" points="220,-76.4279 220,-374.4279 1577,-374.4279 1577,-76.4279 220,-76.4279"/>
<text text-anchor="middle" x="898.5" y="-354.4279" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaBroker</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_KafkaApi</title>
<polygon fill="none" stroke="#000000" points="228,-86.4279 228,-222.4279 415,-222.4279 415,-86.4279 228,-86.4279"/>
<text text-anchor="middle" x="321.5" y="-202.4279" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_partition</title>
<polygon fill="none" stroke="#000000" points="1228,-84.4279 1228,-220.4279 1569,-220.4279 1569,-84.4279 1228,-84.4279"/>
<text text-anchor="middle" x="1398.5" y="-200.4279" font-family="Times,serif" font-size="20.00" fill="#000000">partition</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_ReplicaFetchThread</title>
<polygon fill="none" stroke="#000000" points="1185,-228.4279 1185,-336.4279 1382,-336.4279 1382,-228.4279 1185,-228.4279"/>
<text text-anchor="middle" x="1283.5" y="-316.4279" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaFetchThread</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_ReplicaManager</title>
<polygon fill="none" stroke="#000000" points="473,-146.4279 473,-336.4279 1099,-336.4279 1099,-146.4279 473,-146.4279"/>
<text text-anchor="middle" x="786" y="-316.4279" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaManager</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_KafkaController</title>
<polygon fill="none" stroke="#000000" points="8,-382.4279 8,-750.4279 1872,-750.4279 1872,-382.4279 8,-382.4279"/>
<text text-anchor="middle" x="940" y="-730.4279" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaController</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_PartionStateMachine</title>
<polygon fill="none" stroke="#000000" points="1402,-436.4279 1402,-560.4279 1587,-560.4279 1587,-436.4279 1402,-436.4279"/>
<text text-anchor="middle" x="1494.5" y="-540.4279" font-family="Times,serif" font-size="20.00" fill="#000000">PartionStateMachine</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_ControllerChannelManager</title>
<polygon fill="none" stroke="#000000" points="1607,-390.4279 1607,-514.4279 1864,-514.4279 1864,-390.4279 1607,-390.4279"/>
<text text-anchor="middle" x="1735.5" y="-494.4279" font-family="Times,serif" font-size="20.00" fill="#000000">ControllerChannelManager</text>
</g>
<g id="clust14" class="cluster">
<title>cluster_KafkaAdminClient</title>
<polygon fill="none" stroke="#000000" points="22,-135.4279 22,-228.4279 190,-228.4279 190,-135.4279 22,-135.4279"/>
<text text-anchor="middle" x="106" y="-208.4279" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaAdminClient</text>
</g>
<!-- handleLeaderAndIsrRequest -->
<g id="node1" class="node">
<title>handleLeaderAndIsrRequest</title>
<polygon fill="none" stroke="#000000" points="407,-130.4279 236,-130.4279 236,-94.4279 407,-94.4279 407,-130.4279"/>
<text text-anchor="middle" x="321.5" y="-108.7279" font-family="Times,serif" font-size="14.00" fill="#000000">handleLeaderAndIsrRequest</text>
</g>
<!-- LeaderAndIsrRequest -->
<g id="node12" class="node">
<title>LeaderAndIsrRequest</title>
<polygon fill="#95e1d3" stroke="#000000" points="456,-92.4279 456,-138.4279 591,-138.4279 591,-92.4279 456,-92.4279"/>
<text text-anchor="middle" x="523.5" y="-123.2279" font-family="Times,serif" font-size="14.00" fill="#000000">LeaderAndIsrRequest</text>
<polyline fill="none" stroke="#000000" points="456,-115.4279 591,-115.4279 "/>
<text text-anchor="start" x="464" y="-100.2279" font-family="Times,serif" font-size="14.00" fill="#000000">field </text>
</g>
<!-- handleLeaderAndIsrRequest&#45;&gt;LeaderAndIsrRequest -->
<g id="edge7" class="edge">
<title>handleLeaderAndIsrRequest&#45;&gt;LeaderAndIsrRequest</title>
<path fill="none" stroke="#000000" d="M407.1662,-113.7002C419.9782,-113.8904 433.1272,-114.0857 445.7625,-114.2734"/>
<polygon fill="#000000" stroke="#000000" points="445.7185,-117.773 455.7694,-114.422 445.8226,-110.7738 445.7185,-117.773"/>
</g>
<!-- handleElectReplicaLeader -->
<g id="node2" class="node">
<title>handleElectReplicaLeader</title>
<polygon fill="none" stroke="#000000" points="401,-184.4279 242,-184.4279 242,-148.4279 401,-148.4279 401,-184.4279"/>
<text text-anchor="middle" x="321.5" y="-162.7279" font-family="Times,serif" font-size="14.00" fill="#000000">handleElectReplicaLeader</text>
</g>
<!-- replica_electLeaders -->
<g id="node11" class="node">
<title>replica_electLeaders</title>
<polygon fill="none" stroke="#000000" points="566,-245.4279 481,-245.4279 481,-209.4279 566,-209.4279 566,-245.4279"/>
<text text-anchor="middle" x="523.5" y="-223.7279" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaders</text>
</g>
<!-- handleElectReplicaLeader&#45;&gt;replica_electLeaders -->
<g id="edge9" class="edge">
<title>handleElectReplicaLeader&#45;&gt;replica_electLeaders</title>
<path fill="none" stroke="#000000" d="M378.587,-184.449C400.0117,-191.1383 424.5946,-198.7257 447,-205.4279 454.8126,-207.7649 463.088,-210.1934 471.1978,-212.547"/>
<polygon fill="#000000" stroke="#000000" points="470.387,-215.9559 480.9656,-215.3697 472.3304,-209.231 470.387,-215.9559"/>
</g>
<!-- makeLeader -->
<g id="node3" class="node">
<title>makeLeader</title>
<polygon fill="none" stroke="#000000" points="1325.5,-128.4279 1241.5,-128.4279 1241.5,-92.4279 1325.5,-92.4279 1325.5,-128.4279"/>
<text text-anchor="middle" x="1283.5" y="-106.7279" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeader</text>
</g>
<!-- createLogIfNotExists -->
<g id="node5" class="node">
<title>createLogIfNotExists</title>
<polygon fill="none" stroke="#000000" points="1561,-155.4279 1428,-155.4279 1428,-119.4279 1561,-119.4279 1561,-155.4279"/>
<text text-anchor="middle" x="1494.5" y="-133.7279" font-family="Times,serif" font-size="14.00" fill="#000000">createLogIfNotExists</text>
</g>
<!-- makeLeader&#45;&gt;createLogIfNotExists -->
<g id="edge1" class="edge">
<title>makeLeader&#45;&gt;createLogIfNotExists</title>
<path fill="none" stroke="#000000" d="M1325.6919,-115.8269C1352.0621,-119.2012 1386.8063,-123.6472 1417.9155,-127.628"/>
<polygon fill="#000000" stroke="#000000" points="1417.5095,-131.1045 1427.8729,-128.9022 1418.3981,-124.1611 1417.5095,-131.1045"/>
</g>
<!-- makeFollower -->
<g id="node4" class="node">
<title>makeFollower</title>
<polygon fill="none" stroke="#000000" points="1331,-182.4279 1236,-182.4279 1236,-146.4279 1331,-146.4279 1331,-182.4279"/>
<text text-anchor="middle" x="1283.5" y="-160.7279" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollower</text>
</g>
<!-- makeFollower&#45;&gt;createLogIfNotExists -->
<g id="edge2" class="edge">
<title>makeFollower&#45;&gt;createLogIfNotExists</title>
<path fill="none" stroke="#000000" d="M1331.1156,-158.3349C1356.6667,-155.0653 1388.7786,-150.9562 1417.7566,-147.2481"/>
<polygon fill="#000000" stroke="#000000" points="1418.3851,-150.6963 1427.8599,-145.9553 1417.4965,-143.753 1418.3851,-150.6963"/>
</g>
<!-- ReplicaFetcherThread -->
<g id="node6" class="node">
<title>ReplicaFetcherThread</title>
<polygon fill="none" stroke="#000000" points="1193,-236.9279 1193,-297.9279 1374,-297.9279 1374,-236.9279 1193,-236.9279"/>
<text text-anchor="middle" x="1283.5" y="-282.7279" font-family="Times,serif" font-size="14.00" fill="#000000">ReplicaFetcherThread</text>
<polyline fill="none" stroke="#000000" points="1193,-274.9279 1374,-274.9279 "/>
<text text-anchor="start" x="1201" y="-259.7279" font-family="Times,serif" font-size="14.00" fill="#000000">follower启动fetch线程，</text>
<text text-anchor="start" x="1201" y="-244.7279" font-family="Times,serif" font-size="14.00" fill="#000000"> 同步和partion leader的消息</text>
</g>
<!-- becomeLeaderOrFollower -->
<g id="node7" class="node">
<title>becomeLeaderOrFollower</title>
<polygon fill="none" stroke="#000000" points="641,-171.4279 641,-247.4279 883,-247.4279 883,-171.4279 641,-171.4279"/>
<text text-anchor="middle" x="762" y="-232.2279" font-family="Times,serif" font-size="14.00" fill="#000000">becomeLeaderOrFollower</text>
<polyline fill="none" stroke="#000000" points="641,-224.4279 883,-224.4279 "/>
<text text-anchor="start" x="649" y="-209.2279" font-family="Times,serif" font-size="14.00" fill="#000000">根据收到的LeaderAndIsrRequest</text>
<text text-anchor="start" x="649" y="-194.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 以及自己的brokerID</text>
<text text-anchor="start" x="649" y="-179.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 来判断自己是成为leader还是follower</text>
</g>
<!-- makeLeaders -->
<g id="node8" class="node">
<title>makeLeaders</title>
<polygon fill="none" stroke="#000000" points="1085,-190.4279 996,-190.4279 996,-154.4279 1085,-154.4279 1085,-190.4279"/>
<text text-anchor="middle" x="1040.5" y="-168.7279" font-family="Times,serif" font-size="14.00" fill="#000000">makeLeaders</text>
</g>
<!-- becomeLeaderOrFollower&#45;&gt;makeLeaders -->
<g id="edge3" class="edge">
<title>becomeLeaderOrFollower&#45;&gt;makeLeaders</title>
<path fill="none" stroke="#000000" d="M883.344,-193.3068C919.1404,-188.5511 956.5419,-183.5821 985.8739,-179.6852"/>
<polygon fill="#000000" stroke="#000000" points="986.4446,-183.1402 995.8966,-178.3537 985.5227,-176.2012 986.4446,-183.1402"/>
</g>
<!-- makeFollowers -->
<g id="node9" class="node">
<title>makeFollowers</title>
<polygon fill="none" stroke="#000000" points="1091,-244.4279 990,-244.4279 990,-208.4279 1091,-208.4279 1091,-244.4279"/>
<text text-anchor="middle" x="1040.5" y="-222.7279" font-family="Times,serif" font-size="14.00" fill="#000000">makeFollowers</text>
</g>
<!-- becomeLeaderOrFollower&#45;&gt;makeFollowers -->
<g id="edge4" class="edge">
<title>becomeLeaderOrFollower&#45;&gt;makeFollowers</title>
<path fill="none" stroke="#000000" d="M883.344,-216.8349C916.6342,-218.867 951.3126,-220.9838 979.5977,-222.7103"/>
<polygon fill="#000000" stroke="#000000" points="979.5201,-226.212 989.7148,-223.3279 979.9467,-219.225 979.5201,-226.212"/>
</g>
<!-- allPartitions -->
<g id="node10" class="node">
<title>allPartitions</title>
<polygon fill="#95e1d3" stroke="#000000" points="1081.5,-298.4279 1003.5,-298.4279 999.5,-294.4279 999.5,-262.4279 1077.5,-262.4279 1081.5,-266.4279 1081.5,-298.4279"/>
<polyline fill="none" stroke="#000000" points="1077.5,-294.4279 999.5,-294.4279 "/>
<polyline fill="none" stroke="#000000" points="1077.5,-294.4279 1077.5,-262.4279 "/>
<polyline fill="none" stroke="#000000" points="1077.5,-294.4279 1081.5,-298.4279 "/>
<text text-anchor="middle" x="1040.5" y="-276.7279" font-family="Times,serif" font-size="14.00" fill="#000000">allPartitions</text>
</g>
<!-- becomeLeaderOrFollower&#45;&gt;allPartitions -->
<g id="edge5" class="edge">
<title>becomeLeaderOrFollower&#45;&gt;allPartitions</title>
<path fill="none" stroke="#000000" d="M883.0621,-242.8406C896.8498,-246.4879 910.7163,-250.0859 924,-253.4279 945.3581,-258.8014 969.0191,-264.3576 989.4073,-269.0224"/>
<polygon fill="#000000" stroke="#000000" points="988.9064,-272.4979 999.4339,-271.3053 990.4605,-265.6726 988.9064,-272.4979"/>
</g>
<!-- makeLeaders&#45;&gt;makeLeader -->
<g id="edge10" class="edge">
<title>makeLeaders&#45;&gt;makeLeader</title>
<path fill="none" stroke="#000000" d="M1085.0699,-161.0561C1126.3821,-150.5156 1187.852,-134.8319 1231.4113,-123.718"/>
<polygon fill="#000000" stroke="#000000" points="1232.4221,-127.0723 1241.2464,-121.2087 1230.6915,-120.2896 1232.4221,-127.0723"/>
</g>
<!-- makeFollowers&#45;&gt;makeFollower -->
<g id="edge11" class="edge">
<title>makeFollowers&#45;&gt;makeFollower</title>
<path fill="none" stroke="#000000" d="M1091.0749,-215.1955C1111.5844,-210.5133 1135.4691,-204.8989 1157,-199.4279 1179.695,-193.6611 1204.5531,-186.8844 1226.1808,-180.8378"/>
<polygon fill="#000000" stroke="#000000" points="1227.1895,-184.19 1235.8712,-178.1173 1225.2974,-177.4506 1227.1895,-184.19"/>
</g>
<!-- makeFollowers&#45;&gt;ReplicaFetcherThread -->
<g id="edge6" class="edge">
<title>makeFollowers&#45;&gt;ReplicaFetcherThread</title>
<path fill="none" stroke="#000000" d="M1091.145,-234.9729C1117.6278,-239.4412 1151.014,-245.0743 1182.5073,-250.388"/>
<polygon fill="#000000" stroke="#000000" points="1182.2117,-253.8875 1192.6547,-252.1001 1183.3764,-246.9851 1182.2117,-253.8875"/>
</g>
<!-- controller_electLeaders -->
<g id="node13" class="node">
<title>controller_electLeaders</title>
<polygon fill="none" stroke="#000000" points="804.5,-426.4279 719.5,-426.4279 719.5,-390.4279 804.5,-390.4279 804.5,-426.4279"/>
<text text-anchor="middle" x="762" y="-404.7279" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaders</text>
</g>
<!-- replica_electLeaders&#45;&gt;controller_electLeaders -->
<g id="edge12" class="edge">
<title>replica_electLeaders&#45;&gt;controller_electLeaders</title>
<path fill="none" stroke="#000000" d="M538.5014,-245.5036C558.8621,-269.2842 597.1788,-311.4482 636,-340.4279 659.6683,-358.096 688.5095,-374.0122 712.623,-385.9965"/>
<polygon fill="#000000" stroke="#000000" points="711.0916,-389.1437 721.6126,-390.3926 714.1668,-382.8553 711.0916,-389.1437"/>
</g>
<!-- LeaderAndIsrRequest&#45;&gt;becomeLeaderOrFollower -->
<g id="edge8" class="edge">
<title>LeaderAndIsrRequest&#45;&gt;becomeLeaderOrFollower</title>
<path fill="none" stroke="#000000" d="M587.0171,-138.4767C591.4174,-140.1347 595.7787,-141.7961 600,-143.4279 619.6854,-151.0376 640.6212,-159.3795 660.6778,-167.4952"/>
<polygon fill="#000000" stroke="#000000" points="659.55,-170.8147 670.1323,-171.3303 662.1813,-164.328 659.55,-170.8147"/>
</g>
<!-- processReplicaLeaderElection -->
<g id="node16" class="node">
<title>processReplicaLeaderElection</title>
<polygon fill="none" stroke="#000000" points="1131,-426.4279 950,-426.4279 950,-390.4279 1131,-390.4279 1131,-426.4279"/>
<text text-anchor="middle" x="1040.5" y="-404.7279" font-family="Times,serif" font-size="14.00" fill="#000000">processReplicaLeaderElection</text>
</g>
<!-- controller_electLeaders&#45;&gt;processReplicaLeaderElection -->
<g id="edge13" class="edge">
<title>controller_electLeaders&#45;&gt;processReplicaLeaderElection</title>
<path fill="none" stroke="#000000" d="M804.6013,-408.4279C840.446,-408.4279 893.1501,-408.4279 939.6548,-408.4279"/>
<polygon fill="#000000" stroke="#000000" points="939.7825,-411.928 949.7824,-408.4279 939.7824,-404.928 939.7825,-411.928"/>
</g>
<!-- handleStateChange -->
<g id="node14" class="node">
<title>handleStateChange</title>
<polygon fill="none" stroke="#000000" points="1410,-445.4279 1410,-521.4279 1579,-521.4279 1579,-445.4279 1410,-445.4279"/>
<text text-anchor="middle" x="1494.5" y="-506.2279" font-family="Times,serif" font-size="14.00" fill="#000000">handleStateChange</text>
<polyline fill="none" stroke="#000000" points="1410,-498.4279 1579,-498.4279 "/>
<text text-anchor="start" x="1418" y="-483.2279" font-family="Times,serif" font-size="14.00" fill="#000000">将partion状态改变转换为</text>
<text text-anchor="start" x="1418" y="-468.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> LeaderAndIsrReuest</text>
<text text-anchor="start" x="1418" y="-453.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 群发给所有的broker</text>
</g>
<!-- sendRequest -->
<g id="node15" class="node">
<title>sendRequest</title>
<polygon fill="none" stroke="#000000" points="1615,-399.4279 1615,-475.4279 1856,-475.4279 1856,-399.4279 1615,-399.4279"/>
<text text-anchor="middle" x="1735.5" y="-460.2279" font-family="Times,serif" font-size="14.00" fill="#000000">sendRequest</text>
<polyline fill="none" stroke="#000000" points="1615,-452.4279 1856,-452.4279 "/>
<text text-anchor="start" x="1623" y="-437.2279" font-family="Times,serif" font-size="14.00" fill="#000000">Controller和每个broker之间</text>
<text text-anchor="start" x="1623" y="-422.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 都有个发送请求的线程</text>
<text text-anchor="middle" x="1735.5" y="-407.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 线程由ControllerChannelManager管理</text>
</g>
<!-- handleStateChange&#45;&gt;sendRequest -->
<g id="edge15" class="edge">
<title>handleStateChange&#45;&gt;sendRequest</title>
<path fill="none" stroke="#000000" d="M1579.1287,-467.2747C1587.5048,-465.6759 1596.1354,-464.0286 1604.8371,-462.3677"/>
<polygon fill="#000000" stroke="#000000" points="1605.5157,-465.8015 1614.6821,-460.4886 1604.2032,-458.9256 1605.5157,-465.8015"/>
</g>
<!-- sendRequest&#45;&gt;handleLeaderAndIsrRequest -->
<g id="edge18" class="edge">
<title>sendRequest&#45;&gt;handleLeaderAndIsrRequest</title>
<path fill="none" stroke="#000000" d="M1726.8977,-399.3199C1705.5665,-308.501 1647.5656,-83.5767 1587,-39.4279 1477.8812,40.1134 1418.5323,-25.4279 1283.5,-25.4279 762,-25.4279 762,-25.4279 762,-25.4279 621.8618,-25.4279 581.4606,.0571 447,-39.4279 412.5366,-49.5482 377.5546,-71.0208 353.3098,-88.0715"/>
<polygon fill="#000000" stroke="#000000" points="350.9639,-85.4472 344.8842,-94.1241 355.0479,-91.1324 350.9639,-85.4472"/>
</g>
<!-- sendRequest&#45;&gt;handleElectReplicaLeader -->
<g id="edge19" class="edge">
<title>sendRequest&#45;&gt;handleElectReplicaLeader</title>
<path fill="none" stroke="#000000" d="M1732.4183,-399.1659C1724.0673,-323.6213 1693.8178,-156.0875 1587,-80.4279 1476.7534,-2.3396 1418.6003,-63.4279 1283.5,-63.4279 762,-63.4279 762,-63.4279 762,-63.4279 621.8618,-63.4279 565.03,-1.8789 447,-77.4279 420.8827,-94.1451 438.9607,-119.7437 415,-139.4279 413.4334,-140.7149 411.8082,-141.9406 410.1333,-143.1079"/>
<polygon fill="#000000" stroke="#000000" points="408.0822,-140.26 401.3868,-148.4711 411.7413,-146.2275 408.0822,-140.26"/>
</g>
<!-- onReplicaElection -->
<g id="node17" class="node">
<title>onReplicaElection</title>
<polygon fill="none" stroke="#000000" points="1341.5,-501.4279 1225.5,-501.4279 1225.5,-465.4279 1341.5,-465.4279 1341.5,-501.4279"/>
<text text-anchor="middle" x="1283.5" y="-479.7279" font-family="Times,serif" font-size="14.00" fill="#000000">onReplicaElection</text>
</g>
<!-- processReplicaLeaderElection&#45;&gt;onReplicaElection -->
<g id="edge24" class="edge">
<title>processReplicaLeaderElection&#45;&gt;onReplicaElection</title>
<path fill="none" stroke="#000000" d="M1121.0581,-426.4557C1133.1676,-429.5502 1145.459,-432.9109 1157,-436.4279 1181.0123,-443.7455 1207.0837,-453.1707 1229.2844,-461.6576"/>
<polygon fill="#000000" stroke="#000000" points="1228.2772,-465.0204 1238.8668,-465.3538 1230.7964,-458.4894 1228.2772,-465.0204"/>
</g>
<!-- onReplicaElection&#45;&gt;handleStateChange -->
<g id="edge14" class="edge">
<title>onReplicaElection&#45;&gt;handleStateChange</title>
<path fill="none" stroke="#000000" d="M1341.7152,-483.4279C1359.5818,-483.4279 1379.7295,-483.4279 1399.3912,-483.4279"/>
<polygon fill="#000000" stroke="#000000" points="1399.6141,-486.928 1409.614,-483.4279 1399.614,-479.928 1399.6141,-486.928"/>
</g>
<!-- onBrokerFailure -->
<g id="node18" class="node">
<title>onBrokerFailure</title>
<polygon fill="#f38181" stroke="#000000" points="943.5,-635.4279 943.5,-711.4279 1137.5,-711.4279 1137.5,-635.4279 943.5,-635.4279"/>
<text text-anchor="middle" x="1040.5" y="-696.2279" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerFailure</text>
<polyline fill="none" stroke="#000000" points="943.5,-688.4279 1137.5,-688.4279 "/>
<text text-anchor="start" x="951.5" y="-673.2279" font-family="Times,serif" font-size="14.00" fill="#000000">broker下线了，它上面的所有</text>
<text text-anchor="start" x="951.5" y="-658.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> leader partition都下线了</text>
<text text-anchor="middle" x="1040.5" y="-643.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> , 需要重新选取leader</text>
</g>
<!-- onReplicaBecomeOffline -->
<g id="node19" class="node">
<title>onReplicaBecomeOffline</title>
<polygon fill="none" stroke="#000000" points="1361,-623.4279 1206,-623.4279 1206,-587.4279 1361,-587.4279 1361,-623.4279"/>
<text text-anchor="middle" x="1283.5" y="-601.7279" font-family="Times,serif" font-size="14.00" fill="#000000">onReplicaBecomeOffline</text>
</g>
<!-- onBrokerFailure&#45;&gt;onReplicaBecomeOffline -->
<g id="edge16" class="edge">
<title>onBrokerFailure&#45;&gt;onReplicaBecomeOffline</title>
<path fill="none" stroke="#000000" d="M1137.5877,-646.2593C1161.425,-639.5888 1186.5699,-632.5524 1209.1448,-626.2351"/>
<polygon fill="#000000" stroke="#000000" points="1210.2986,-629.5468 1218.9855,-623.4813 1208.4122,-622.8057 1210.2986,-629.5468"/>
</g>
<!-- onReplicaBecomeOffline&#45;&gt;handleStateChange -->
<g id="edge17" class="edge">
<title>onReplicaBecomeOffline&#45;&gt;handleStateChange</title>
<path fill="none" stroke="#000000" d="M1314.6338,-587.4264C1342.2161,-571.4783 1383.5966,-547.5521 1419.7154,-526.6683"/>
<polygon fill="#000000" stroke="#000000" points="1421.868,-529.4666 1428.7731,-521.4311 1418.3641,-523.4067 1421.868,-529.4666"/>
</g>
<!-- onBrokerStartup -->
<g id="node20" class="node">
<title>onBrokerStartup</title>
<polygon fill="#f38181" stroke="#000000" points="16,-444.9279 16,-505.9279 196,-505.9279 196,-444.9279 16,-444.9279"/>
<text text-anchor="middle" x="106" y="-490.7279" font-family="Times,serif" font-size="14.00" fill="#000000">onBrokerStartup</text>
<polyline fill="none" stroke="#000000" points="16,-482.9279 196,-482.9279 "/>
<text text-anchor="start" x="24" y="-467.7279" font-family="Times,serif" font-size="14.00" fill="#000000">新启动一个broker可能触发</text>
<text text-anchor="middle" x="106" y="-452.7279" font-family="Times,serif" font-size="14.00" fill="#000000"> partition leader rebalance;</text>
</g>
<!-- maybeResumeReassignments -->
<g id="node21" class="node">
<title>maybeResumeReassignments</title>
<polygon fill="none" stroke="#000000" points="411,-491.4279 232,-491.4279 232,-455.4279 411,-455.4279 411,-491.4279"/>
<text text-anchor="middle" x="321.5" y="-469.7279" font-family="Times,serif" font-size="14.00" fill="#000000">maybeResumeReassignments</text>
</g>
<!-- onBrokerStartup&#45;&gt;maybeResumeReassignments -->
<g id="edge20" class="edge">
<title>onBrokerStartup&#45;&gt;maybeResumeReassignments</title>
<path fill="none" stroke="#000000" d="M196.1428,-474.5913C204.5065,-474.5137 213.0157,-474.4347 221.4614,-474.3563"/>
<polygon fill="#000000" stroke="#000000" points="221.7507,-477.8539 231.7178,-474.2611 221.6857,-470.8542 221.7507,-477.8539"/>
</g>
<!-- onPartitionReassignment -->
<g id="node22" class="node">
<title>onPartitionReassignment</title>
<polygon fill="none" stroke="#000000" points="600,-489.4279 447,-489.4279 447,-453.4279 600,-453.4279 600,-489.4279"/>
<text text-anchor="middle" x="523.5" y="-467.7279" font-family="Times,serif" font-size="14.00" fill="#000000">onPartitionReassignment</text>
</g>
<!-- maybeResumeReassignments&#45;&gt;onPartitionReassignment -->
<g id="edge21" class="edge">
<title>maybeResumeReassignments&#45;&gt;onPartitionReassignment</title>
<path fill="none" stroke="#000000" d="M411.2765,-472.539C419.7415,-472.4552 428.3129,-472.3703 436.749,-472.2868"/>
<polygon fill="#000000" stroke="#000000" points="436.991,-475.7847 446.9558,-472.1858 436.9216,-468.785 436.991,-475.7847"/>
</g>
<!-- removePartitionFromReassigningPartitions -->
<g id="node23" class="node">
<title>removePartitionFromReassigningPartitions</title>
<polygon fill="none" stroke="#000000" points="888,-486.4279 636,-486.4279 636,-450.4279 888,-450.4279 888,-486.4279"/>
<text text-anchor="middle" x="762" y="-464.7279" font-family="Times,serif" font-size="14.00" fill="#000000">removePartitionFromReassigningPartitions</text>
</g>
<!-- onPartitionReassignment&#45;&gt;removePartitionFromReassigningPartitions -->
<g id="edge22" class="edge">
<title>onPartitionReassignment&#45;&gt;removePartitionFromReassigningPartitions</title>
<path fill="none" stroke="#000000" d="M600.2757,-470.4622C608.4972,-470.3587 617.0286,-470.2514 625.6824,-470.1426"/>
<polygon fill="#000000" stroke="#000000" points="625.931,-473.6398 635.8862,-470.0142 625.8429,-466.6404 625.931,-473.6398"/>
</g>
<!-- removePartitionFromReassigningPartitions&#45;&gt;processReplicaLeaderElection -->
<g id="edge23" class="edge">
<title>removePartitionFromReassigningPartitions&#45;&gt;processReplicaLeaderElection</title>
<path fill="none" stroke="#000000" d="M845.5592,-450.4259C877.3583,-443.5751 913.7965,-435.7249 946.499,-428.6795"/>
<polygon fill="#000000" stroke="#000000" points="947.4803,-432.0484 956.5189,-426.5208 946.006,-425.2054 947.4803,-432.0484"/>
</g>
<!-- onControllerFailover -->
<g id="node24" class="node">
<title>onControllerFailover</title>
<polygon fill="#f38181" stroke="#000000" points="946,-540.4279 946,-616.4279 1135,-616.4279 1135,-540.4279 946,-540.4279"/>
<text text-anchor="middle" x="1040.5" y="-601.2279" font-family="Times,serif" font-size="14.00" fill="#000000">onControllerFailover</text>
<polyline fill="none" stroke="#000000" points="946,-593.4279 1135,-593.4279 "/>
<text text-anchor="start" x="954" y="-578.2279" font-family="Times,serif" font-size="14.00" fill="#000000">Controller故障了</text>
<text text-anchor="start" x="954" y="-563.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 会选举新的controller</text>
<text text-anchor="middle" x="1040.5" y="-548.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> ,然后触发新的leader election</text>
</g>
<!-- onControllerFailover&#45;&gt;onReplicaElection -->
<g id="edge25" class="edge">
<title>onControllerFailover&#45;&gt;onReplicaElection</title>
<path fill="none" stroke="#000000" d="M1135.146,-541.4264C1166.4975,-529.1696 1200.3602,-515.9311 1227.8068,-505.201"/>
<polygon fill="#000000" stroke="#000000" points="1229.1936,-508.4168 1237.2328,-501.5159 1226.6448,-501.8973 1229.1936,-508.4168"/>
</g>
<!-- checkAndTriggerAutoLeaderRebalance -->
<g id="node25" class="node">
<title>checkAndTriggerAutoLeaderRebalance</title>
<polygon fill="#f38181" stroke="#000000" points="924,-445.4279 924,-521.4279 1157,-521.4279 1157,-445.4279 924,-445.4279"/>
<text text-anchor="middle" x="1040.5" y="-506.2279" font-family="Times,serif" font-size="14.00" fill="#000000">checkAndTriggerAutoLeaderRebalance</text>
<polyline fill="none" stroke="#000000" points="924,-498.4279 1157,-498.4279 "/>
<text text-anchor="start" x="932" y="-483.2279" font-family="Times,serif" font-size="14.00" fill="#000000">后台周期性检查</text>
<text text-anchor="start" x="932" y="-468.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 是否要leader rebalance</text>
<text text-anchor="start" x="932" y="-453.2279" font-family="Times,serif" font-size="14.00" fill="#000000"> 需要的话会触发leader election</text>
</g>
<!-- checkAndTriggerAutoLeaderRebalance&#45;&gt;onReplicaElection -->
<g id="edge26" class="edge">
<title>checkAndTriggerAutoLeaderRebalance&#45;&gt;onReplicaElection</title>
<path fill="none" stroke="#000000" d="M1157.0178,-483.4279C1176.9659,-483.4279 1197.0933,-483.4279 1215.2444,-483.4279"/>
<polygon fill="#000000" stroke="#000000" points="1215.398,-486.928 1225.398,-483.4279 1215.398,-479.928 1215.398,-486.928"/>
</g>
<!-- partitionAssignments -->
<g id="node26" class="node">
<title>partitionAssignments</title>
<polygon fill="#95e1d3" stroke="#000000" points="172.5,-426.4279 43.5,-426.4279 39.5,-422.4279 39.5,-390.4279 168.5,-390.4279 172.5,-394.4279 172.5,-426.4279"/>
<polyline fill="none" stroke="#000000" points="168.5,-422.4279 39.5,-422.4279 "/>
<polyline fill="none" stroke="#000000" points="168.5,-422.4279 168.5,-390.4279 "/>
<polyline fill="none" stroke="#000000" points="168.5,-422.4279 172.5,-426.4279 "/>
<text text-anchor="middle" x="106" y="-404.7279" font-family="Times,serif" font-size="14.00" fill="#000000">partitionAssignments</text>
</g>
<!-- admin_electLeaders -->
<g id="node27" class="node">
<title>admin_electLeaders</title>
<polygon fill="#f38181" stroke="#000000" points="35,-143.4279 35,-189.4279 177,-189.4279 177,-143.4279 35,-143.4279"/>
<text text-anchor="middle" x="106" y="-174.2279" font-family="Times,serif" font-size="14.00" fill="#000000">electLeaders</text>
<polyline fill="none" stroke="#000000" points="35,-166.4279 177,-166.4279 "/>
<text text-anchor="middle" x="106" y="-151.2279" font-family="Times,serif" font-size="14.00" fill="#000000">手动出发electLeaders</text>
</g>
<!-- admin_electLeaders&#45;&gt;handleElectReplicaLeader -->
<g id="edge27" class="edge">
<title>admin_electLeaders&#45;&gt;handleElectReplicaLeader</title>
<path fill="none" stroke="#000000" d="M177.16,-166.4279C194.6418,-166.4279 213.5817,-166.4279 231.8116,-166.4279"/>
<polygon fill="#000000" stroke="#000000" points="231.8525,-169.928 241.8525,-166.4279 231.8525,-162.928 231.8525,-169.928"/>
</g>
</g>
</svg>
