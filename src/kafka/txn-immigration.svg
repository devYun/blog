<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: immigration Pages: 1 -->
<svg width="1790pt" height="273pt"
 viewBox="0.00 0.00 1790.38 273.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 269)">
<title>immigration</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-269 1786.3848,-269 1786.3848,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_ReplicaManager</title>
<path fill="none" stroke="#000000" d="M760.6313,-8C760.6313,-8 884.2866,-8 884.2866,-8 890.2866,-8 896.2866,-14 896.2866,-20 896.2866,-20 896.2866,-76 896.2866,-76 896.2866,-82 890.2866,-88 884.2866,-88 884.2866,-88 760.6313,-88 760.6313,-88 754.6313,-88 748.6313,-82 748.6313,-76 748.6313,-76 748.6313,-20 748.6313,-20 748.6313,-14 754.6313,-8 760.6313,-8"/>
<text text-anchor="middle" x="822.459" y="-68" font-family="Times,serif" font-size="20.00" fill="#000000">ReplicaManager</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_TransactionMetadata</title>
<path fill="none" stroke="#000000" d="M1509.624,-35C1509.624,-35 1762.3848,-35 1762.3848,-35 1768.3848,-35 1774.3848,-41 1774.3848,-47 1774.3848,-47 1774.3848,-245 1774.3848,-245 1774.3848,-251 1768.3848,-257 1762.3848,-257 1762.3848,-257 1509.624,-257 1509.624,-257 1503.624,-257 1497.624,-251 1497.624,-245 1497.624,-245 1497.624,-47 1497.624,-47 1497.624,-41 1503.624,-35 1509.624,-35"/>
<text text-anchor="middle" x="1636.0044" y="-237" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionMetadata</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_TransactionStateManager</title>
<path fill="none" stroke="#000000" d="M458.0146,-96C458.0146,-96 1465.624,-96 1465.624,-96 1471.624,-96 1477.624,-102 1477.624,-108 1477.624,-108 1477.624,-228 1477.624,-228 1477.624,-234 1471.624,-240 1465.624,-240 1465.624,-240 458.0146,-240 458.0146,-240 452.0146,-240 446.0146,-234 446.0146,-228 446.0146,-228 446.0146,-108 446.0146,-108 446.0146,-102 452.0146,-96 458.0146,-96"/>
<text text-anchor="middle" x="961.8193" y="-220" font-family="Times,serif" font-size="20.00" fill="#000000">TransactionStateManager</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_TranscationCoordinator</title>
<path fill="none" stroke="#000000" d="M232.1592,-106C232.1592,-106 414.0146,-106 414.0146,-106 420.0146,-106 426.0146,-112 426.0146,-118 426.0146,-118 426.0146,-174 426.0146,-174 426.0146,-180 420.0146,-186 414.0146,-186 414.0146,-186 232.1592,-186 232.1592,-186 226.1592,-186 220.1592,-180 220.1592,-174 220.1592,-174 220.1592,-118 220.1592,-118 220.1592,-112 226.1592,-106 232.1592,-106"/>
<text text-anchor="middle" x="323.0869" y="-166" font-family="Times,serif" font-size="20.00" fill="#000000">TranscationCoordinator</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_KafkaApi</title>
<path fill="none" stroke="#000000" d="M20,-106C20,-106 188.1592,-106 188.1592,-106 194.1592,-106 200.1592,-112 200.1592,-118 200.1592,-118 200.1592,-174 200.1592,-174 200.1592,-180 194.1592,-186 188.1592,-186 188.1592,-186 20,-186 20,-186 14,-186 8,-180 8,-174 8,-174 8,-118 8,-118 8,-112 14,-106 20,-106"/>
<text text-anchor="middle" x="104.0796" y="-166" font-family="Times,serif" font-size="20.00" fill="#000000">KafkaApi</text>
</g>
<!-- getLog -->
<g id="node1" class="node">
<title>getLog</title>
<polygon fill="none" stroke="#000000" points="850.1153,-52 794.8026,-52 794.8026,-16 850.1153,-16 850.1153,-52"/>
<text text-anchor="middle" x="822.459" y="-29.8" font-family="Times,serif" font-size="14.00" fill="#000000">getLog</text>
</g>
<!-- TransactionMetadata -->
<g id="node2" class="node">
<title>TransactionMetadata</title>
<polygon fill="#95e1d3" stroke="#000000" points="1505.624,-44 1505.624,-220 1766.3848,-220 1766.3848,-44 1505.624,-44"/>
<text text-anchor="middle" x="1636.0044" y="-204.8" font-family="Times,serif" font-size="14.00" fill="#000000">TransactionMetadata</text>
<polyline fill="none" stroke="#000000" points="1505.624,-198 1766.3848,-198 "/>
<text text-anchor="start" x="1513.624" y="-182.8" font-family="Times,serif" font-size="14.00" fill="#000000">transactionalId: String </text>
<polyline fill="none" stroke="#000000" points="1505.624,-176 1766.3848,-176 "/>
<text text-anchor="start" x="1513.624" y="-160.8" font-family="Times,serif" font-size="14.00" fill="#000000">producerId: long </text>
<polyline fill="none" stroke="#000000" points="1505.624,-154 1766.3848,-154 "/>
<text text-anchor="start" x="1513.624" y="-138.8" font-family="Times,serif" font-size="14.00" fill="#000000">lastProducerId: Long </text>
<polyline fill="none" stroke="#000000" points="1505.624,-132 1766.3848,-132 "/>
<text text-anchor="start" x="1513.624" y="-116.8" font-family="Times,serif" font-size="14.00" fill="#000000">producerEpoch: short </text>
<polyline fill="none" stroke="#000000" points="1505.624,-110 1766.3848,-110 "/>
<text text-anchor="start" x="1513.624" y="-94.8" font-family="Times,serif" font-size="14.00" fill="#000000">txnTimeoutMs: Int </text>
<polyline fill="none" stroke="#000000" points="1505.624,-88 1766.3848,-88 "/>
<text text-anchor="start" x="1513.624" y="-72.8" font-family="Times,serif" font-size="14.00" fill="#000000">state: TransactionState </text>
<polyline fill="none" stroke="#000000" points="1505.624,-66 1766.3848,-66 "/>
<text text-anchor="start" x="1513.624" y="-50.8" font-family="Times,serif" font-size="14.00" fill="#000000">topicPartitions: mutable.Set[TopicPartition]</text>
</g>
<!-- transactionMetadataCache -->
<g id="node3" class="node">
<title>transactionMetadataCache</title>
<polygon fill="#95e1d3" stroke="#000000" points="957.8555,-118.2 957.8555,-181.8 1220.4619,-181.8 1220.4619,-118.2 957.8555,-118.2"/>
<text text-anchor="middle" x="1089.1587" y="-166.6" font-family="Times,serif" font-size="14.00" fill="#000000">transactionMetadataCache</text>
<polyline fill="none" stroke="#000000" points="957.8555,-159.8 1220.4619,-159.8 "/>
<text text-anchor="start" x="965.8555" y="-144.6" font-family="Times,serif" font-size="14.00" fill="#000000">mutable.Map[Int, TxnMetadataCacheEntry]</text>
<text text-anchor="middle" x="1089.1587" y="-130.6" font-family="Times,serif" font-size="14.00" fill="#000000"> parition 到cacheEntry的映射</text>
</g>
<!-- TxnMetadataCacheEntry -->
<g id="node4" class="node">
<title>TxnMetadataCacheEntry</title>
<polygon fill="#95e1d3" stroke="#000000" points="1256.4619,-104.2 1256.4619,-203.8 1469.624,-203.8 1469.624,-104.2 1256.4619,-104.2"/>
<text text-anchor="middle" x="1363.043" y="-188.6" font-family="Times,serif" font-size="14.00" fill="#000000">TxnMetadataCacheEntry</text>
<polyline fill="none" stroke="#000000" points="1256.4619,-181.8 1469.624,-181.8 "/>
<text text-anchor="start" x="1264.4619" y="-166.6" font-family="Times,serif" font-size="14.00" fill="#000000">coordinatorEpoch Int </text>
<polyline fill="none" stroke="#000000" points="1256.4619,-159.8 1469.624,-159.8 "/>
<text text-anchor="start" x="1264.4619" y="-144.6" font-family="Times,serif" font-size="14.00" fill="#000000">metadataPerTransactionalId </text>
<text text-anchor="start" x="1264.4619" y="-130.6" font-family="Times,serif" font-size="14.00" fill="#000000"> Pool[String, TransactionMetadata]</text>
<text text-anchor="middle" x="1363.043" y="-116.6" font-family="Times,serif" font-size="14.00" fill="#000000"> 事务ID到事务metadata映射</text>
</g>
<!-- transactionMetadataCache&#45;&gt;TxnMetadataCacheEntry -->
<g id="edge1" class="edge">
<title>transactionMetadataCache:entry&#45;&gt;TxnMetadataCacheEntry</title>
<path fill="none" stroke="#000000" d="M1220.1587,-139C1228.5846,-139 1237.2748,-139.2612 1246.0129,-139.7146"/>
<polygon fill="#000000" stroke="#000000" points="1246.0877,-143.2254 1256.2796,-140.3311 1246.5074,-136.2379 1246.0877,-143.2254"/>
</g>
<!-- TxnMetadataCacheEntry&#45;&gt;TransactionMetadata -->
<g id="edge2" class="edge">
<title>TxnMetadataCacheEntry:meta&#45;&gt;TransactionMetadata</title>
<path fill="none" stroke="#000000" d="M1470.043,-132C1478.3266,-132 1486.8429,-132 1495.435,-132"/>
<polygon fill="#000000" stroke="#000000" points="1495.5468,-135.5001 1505.5468,-132 1495.5468,-128.5001 1495.5468,-135.5001"/>
</g>
<!-- loadTransactionsForTxnTopicPartition -->
<g id="node5" class="node">
<title>loadTransactionsForTxnTopicPartition</title>
<polygon fill="none" stroke="#000000" points="454.0146,-107.2 454.0146,-156.8 687.0625,-156.8 687.0625,-107.2 454.0146,-107.2"/>
<text text-anchor="middle" x="570.5386" y="-141.6" font-family="Times,serif" font-size="14.00" fill="#000000">loadTransactionsForTxnTopicPartition</text>
<polyline fill="none" stroke="#000000" points="454.0146,-134.8 687.0625,-134.8 "/>
<text text-anchor="middle" x="570.5386" y="-119.6" font-family="Times,serif" font-size="14.00" fill="#000000">从tp 日志恢复事务metadata内存中</text>
</g>
<!-- loadTransactionsForTxnTopicPartition&#45;&gt;getLog -->
<g id="edge3" class="edge">
<title>loadTransactionsForTxnTopicPartition&#45;&gt;getLog</title>
<path fill="none" stroke="#000000" d="M634.4344,-107.1438C682.0054,-88.6381 745.3218,-64.0073 784.9853,-48.5777"/>
<polygon fill="#000000" stroke="#000000" points="786.4849,-51.7499 794.5356,-44.8625 783.947,-45.2262 786.4849,-51.7499"/>
</g>
<!-- addLoadedTransactionsToCache -->
<g id="node6" class="node">
<title>addLoadedTransactionsToCache</title>
<polygon fill="none" stroke="#000000" points="921.7521,-159 723.1659,-159 723.1659,-123 921.7521,-123 921.7521,-159"/>
<text text-anchor="middle" x="822.459" y="-136.8" font-family="Times,serif" font-size="14.00" fill="#000000">addLoadedTransactionsToCache</text>
</g>
<!-- loadTransactionsForTxnTopicPartition&#45;&gt;addLoadedTransactionsToCache -->
<g id="edge4" class="edge">
<title>loadTransactionsForTxnTopicPartition&#45;&gt;addLoadedTransactionsToCache</title>
<path fill="none" stroke="#000000" d="M687.2805,-136.1707C695.7902,-136.4747 704.3564,-136.7807 712.8224,-137.0832"/>
<polygon fill="#000000" stroke="#000000" points="712.9704,-140.5906 723.089,-137.45 713.2204,-133.5951 712.9704,-140.5906"/>
</g>
<!-- addLoadedTransactionsToCache&#45;&gt;transactionMetadataCache -->
<g id="edge5" class="edge">
<title>addLoadedTransactionsToCache&#45;&gt;transactionMetadataCache</title>
<path fill="none" stroke="#000000" d="M921.7681,-144.3513C930.1773,-144.635 938.7801,-144.9254 947.4301,-145.2173"/>
<polygon fill="#000000" stroke="#000000" points="947.485,-148.721 957.5973,-145.5604 947.7211,-141.725 947.485,-148.721"/>
</g>
<!-- handleTxnImmigration -->
<g id="node7" class="node">
<title>handleTxnImmigration</title>
<polygon fill="none" stroke="#000000" points="395.9425,-150 250.2314,-150 250.2314,-114 395.9425,-114 395.9425,-150"/>
<text text-anchor="middle" x="323.0869" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#000000">handleTxnImmigration</text>
</g>
<!-- handleTxnImmigration&#45;&gt;loadTransactionsForTxnTopicPartition -->
<g id="edge6" class="edge">
<title>handleTxnImmigration&#45;&gt;loadTransactionsForTxnTopicPartition</title>
<path fill="none" stroke="#000000" d="M395.9922,-132C410.9858,-132 427.1845,-132 443.4607,-132"/>
<polygon fill="#000000" stroke="#000000" points="443.5949,-135.5001 453.5949,-132 443.5948,-128.5001 443.5949,-135.5001"/>
</g>
<!-- handleLeaderAndIsrRequest -->
<g id="node8" class="node">
<title>handleLeaderAndIsrRequest</title>
<polygon fill="none" stroke="#000000" points="192.2388,-150 15.9203,-150 15.9203,-114 192.2388,-114 192.2388,-150"/>
<text text-anchor="middle" x="104.0796" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#000000">handleLeaderAndIsrRequest</text>
</g>
<!-- handleLeaderAndIsrRequest&#45;&gt;handleTxnImmigration -->
<g id="edge7" class="edge">
<title>handleLeaderAndIsrRequest&#45;&gt;handleTxnImmigration</title>
<path fill="none" stroke="#000000" d="M192.2116,-132C208.007,-132 224.4196,-132 240.065,-132"/>
<polygon fill="#000000" stroke="#000000" points="240.2213,-135.5001 250.2213,-132 240.2212,-128.5001 240.2213,-135.5001"/>
</g>
</g>
</svg>
