<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.44.1 (20200629.0846)
 -->
<!-- Title: tidb_main_server Pages: 1 -->
<svg width="1703pt" height="411pt"
 viewBox="0.00 0.00 1703.00 411.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 407)">
<title>tidb_main_server</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-407 1699,-407 1699,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_main</title>
<polygon fill="none" stroke="black" points="8,-232 8,-368 199,-368 199,-232 8,-232"/>
<text text-anchor="middle" x="103.5" y="-348" font-family="Times,serif" font-size="20.00">tidb&#45;server/main.go</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_server</title>
<polygon fill="none" stroke="black" points="220,-175 220,-395 558,-395 558,-175 220,-175"/>
<text text-anchor="middle" x="389" y="-375" font-family="Times,serif" font-size="20.00">server/server.go</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_forloop</title>
<polygon fill="none" stroke="black" points="366,-183 366,-357 550,-357 550,-183 366,-183"/>
<text text-anchor="middle" x="458" y="-337" font-family="Times,serif" font-size="20.00">loop</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_conn</title>
<polygon fill="none" stroke="black" points="577,-8 577,-344 1687,-344 1687,-8 577,-8"/>
<text text-anchor="middle" x="1132" y="-324" font-family="Times,serif" font-size="20.00">conn</text>
</g>
<!-- main -->
<g id="node1" class="node">
<title>main</title>
<polygon fill="none" stroke="black" points="70,-303 16,-303 16,-267 70,-267 70,-303"/>
<text text-anchor="middle" x="43" y="-281.3" font-family="Times,serif" font-size="14.00">main</text>
</g>
<!-- runServer -->
<g id="node2" class="node">
<title>runServer</title>
<polygon fill="none" stroke="black" points="184,-276 114,-276 114,-240 184,-240 184,-276"/>
<text text-anchor="middle" x="149" y="-254.3" font-family="Times,serif" font-size="14.00">runServer</text>
</g>
<!-- main&#45;&gt;runServer -->
<g id="edge1" class="edge">
<title>main&#45;&gt;runServer</title>
<path fill="none" stroke="black" d="M70.24,-278.19C80.48,-275.53 92.5,-272.41 103.99,-269.43"/>
<polygon fill="black" stroke="black" points="105.09,-272.76 113.89,-266.85 103.33,-265.98 105.09,-272.76"/>
</g>
<!-- createServer -->
<g id="node3" class="node">
<title>createServer</title>
<polygon fill="none" stroke="black" points="191,-330 107,-330 107,-294 191,-294 191,-330"/>
<text text-anchor="middle" x="149" y="-308.3" font-family="Times,serif" font-size="14.00">createServer</text>
</g>
<!-- main&#45;&gt;createServer -->
<g id="edge2" class="edge">
<title>main&#45;&gt;createServer</title>
<path fill="none" stroke="black" d="M70.24,-291.81C78.37,-293.92 87.63,-296.33 96.85,-298.72"/>
<polygon fill="black" stroke="black" points="96.23,-302.17 106.78,-301.3 97.98,-295.4 96.23,-302.17"/>
</g>
<!-- server_Run -->
<g id="node4" class="node">
<title>server_Run</title>
<polygon fill="none" stroke="black" points="282,-276 228,-276 228,-240 282,-240 282,-276"/>
<text text-anchor="middle" x="255" y="-254.3" font-family="Times,serif" font-size="14.00">Run</text>
</g>
<!-- runServer&#45;&gt;server_Run -->
<g id="edge3" class="edge">
<title>runServer&#45;&gt;server_Run</title>
<path fill="none" stroke="black" d="M184.05,-258C194.83,-258 206.77,-258 217.7,-258"/>
<polygon fill="black" stroke="black" points="217.79,-261.5 227.79,-258 217.79,-254.5 217.79,-261.5"/>
</g>
<!-- onConn -->
<g id="node5" class="node">
<title>onConn</title>
<polygon fill="none" stroke="black" points="374,-191.5 374,-252.5 542,-252.5 542,-191.5 374,-191.5"/>
<text text-anchor="middle" x="458" y="-237.3" font-family="Times,serif" font-size="14.00">onConn</text>
<polyline fill="none" stroke="black" points="374,-229.5 542,-229.5 "/>
<text text-anchor="start" x="382" y="-214.3" font-family="Times,serif" font-size="14.00">启动一个goroutine来处理</text>
<text text-anchor="start" x="382" y="-199.3" font-family="Times,serif" font-size="14.00"> 这个connection</text>
</g>
<!-- server_Run&#45;&gt;onConn -->
<g id="edge4" class="edge">
<title>server_Run&#45;&gt;onConn</title>
<path fill="none" stroke="black" d="M282.28,-253.29C303.21,-249.54 333.86,-244.05 363.67,-238.72"/>
<polygon fill="black" stroke="black" points="364.5,-242.12 373.73,-236.91 363.27,-235.23 364.5,-242.12"/>
<text text-anchor="middle" x="328" y="-252.8" font-family="Times,serif" font-size="14.00">go routine</text>
</g>
<!-- listener_Accept -->
<g id="node6" class="node">
<title>listener_Accept</title>
<polygon fill="none" stroke="black" points="391.5,-272 391.5,-318 524.5,-318 524.5,-272 391.5,-272"/>
<text text-anchor="middle" x="458" y="-302.8" font-family="Times,serif" font-size="14.00">listener_Accept</text>
<polyline fill="none" stroke="black" points="391.5,-295 524.5,-295 "/>
<text text-anchor="middle" x="458" y="-279.8" font-family="Times,serif" font-size="14.00">监听接受connection</text>
</g>
<!-- server_Run&#45;&gt;listener_Accept -->
<g id="edge5" class="edge">
<title>server_Run&#45;&gt;listener_Accept</title>
<path fill="none" stroke="black" d="M282.01,-264.15C287.91,-265.48 294.16,-266.84 300,-268 326.34,-273.25 355.29,-278.41 381.07,-282.78"/>
<polygon fill="black" stroke="black" points="380.72,-286.27 391.16,-284.48 381.88,-279.37 380.72,-286.27"/>
</g>
<!-- conn_Run -->
<g id="node7" class="node">
<title>conn_Run</title>
<polygon fill="none" stroke="black" points="585,-176.5 585,-267.5 699,-267.5 699,-176.5 585,-176.5"/>
<text text-anchor="middle" x="642" y="-252.3" font-family="Times,serif" font-size="14.00">conn_Run</text>
<polyline fill="none" stroke="black" points="585,-244.5 699,-244.5 "/>
<text text-anchor="start" x="593" y="-229.3" font-family="Times,serif" font-size="14.00">处理客户端conn</text>
<text text-anchor="start" x="593" y="-214.3" font-family="Times,serif" font-size="14.00"> 读取packet</text>
<text text-anchor="start" x="593" y="-199.3" font-family="Times,serif" font-size="14.00"> 处理请求</text>
<text text-anchor="start" x="593" y="-184.3" font-family="Times,serif" font-size="14.00"> 回写返回数据</text>
</g>
<!-- onConn&#45;&gt;conn_Run -->
<g id="edge6" class="edge">
<title>onConn&#45;&gt;conn_Run</title>
<path fill="none" stroke="black" d="M542.01,-222C553.02,-222 564.19,-222 574.87,-222"/>
<polygon fill="black" stroke="black" points="574.93,-225.5 584.93,-222 574.93,-218.5 574.93,-225.5"/>
</g>
<!-- dispatch -->
<g id="node8" class="node">
<title>dispatch</title>
<polygon fill="none" stroke="black" points="736,-124.5 736,-185.5 911,-185.5 911,-124.5 736,-124.5"/>
<text text-anchor="middle" x="823.5" y="-170.3" font-family="Times,serif" font-size="14.00">dispatch</text>
<polyline fill="none" stroke="black" points="736,-162.5 911,-162.5 "/>
<text text-anchor="start" x="744" y="-147.3" font-family="Times,serif" font-size="14.00">根据mysql cmd</text>
<text text-anchor="start" x="744" y="-132.3" font-family="Times,serif" font-size="14.00"> 分发给不同的handler处理</text>
</g>
<!-- conn_Run&#45;&gt;dispatch -->
<g id="edge8" class="edge">
<title>conn_Run&#45;&gt;dispatch</title>
<path fill="none" stroke="black" d="M699.3,-200.98C709.48,-197.19 720.33,-193.14 731.21,-189.08"/>
<polygon fill="black" stroke="black" points="732.62,-192.29 740.76,-185.51 730.17,-185.73 732.62,-192.29"/>
</g>
<!-- writeError -->
<g id="node9" class="node">
<title>writeError</title>
<polygon fill="none" stroke="black" points="860,-240 787,-240 787,-204 860,-204 860,-240"/>
<text text-anchor="middle" x="823.5" y="-218.3" font-family="Times,serif" font-size="14.00">writeError</text>
</g>
<!-- conn_Run&#45;&gt;writeError -->
<g id="edge9" class="edge">
<title>conn_Run&#45;&gt;writeError</title>
<path fill="none" stroke="black" d="M699.3,-222C724.2,-222 753.11,-222 776.66,-222"/>
<polygon fill="black" stroke="black" points="776.73,-225.5 786.73,-222 776.73,-218.5 776.73,-225.5"/>
</g>
<!-- readPacket -->
<g id="node11" class="node">
<title>readPacket</title>
<polygon fill="none" stroke="black" points="765.5,-259 765.5,-305 881.5,-305 881.5,-259 765.5,-259"/>
<text text-anchor="middle" x="823.5" y="-289.8" font-family="Times,serif" font-size="14.00">readPacket</text>
<polyline fill="none" stroke="black" points="765.5,-282 881.5,-282 "/>
<text text-anchor="middle" x="823.5" y="-266.8" font-family="Times,serif" font-size="14.00">读取网络请求包</text>
</g>
<!-- conn_Run&#45;&gt;readPacket -->
<g id="edge10" class="edge">
<title>conn_Run&#45;&gt;readPacket</title>
<path fill="none" stroke="black" d="M699.3,-240.82C717.25,-246.82 737.28,-253.51 755.89,-259.73"/>
<polygon fill="black" stroke="black" points="754.88,-263.09 765.47,-262.94 757.1,-256.45 754.88,-263.09"/>
</g>
<!-- handleQuery -->
<g id="node12" class="node">
<title>handleQuery</title>
<polygon fill="none" stroke="black" points="970,-16.5 970,-77.5 1069,-77.5 1069,-16.5 970,-16.5"/>
<text text-anchor="middle" x="1019.5" y="-62.3" font-family="Times,serif" font-size="14.00">handleQuery</text>
<polyline fill="none" stroke="black" points="970,-54.5 1069,-54.5 "/>
<text text-anchor="start" x="978" y="-39.3" font-family="Times,serif" font-size="14.00">执行SQL语句</text>
<text text-anchor="start" x="978" y="-24.3" font-family="Times,serif" font-size="14.00"> 返回结果集</text>
</g>
<!-- dispatch&#45;&gt;handleQuery -->
<g id="edge11" class="edge">
<title>dispatch&#45;&gt;handleQuery</title>
<path fill="none" stroke="black" d="M879.31,-124.48C904.77,-110.31 935.05,-93.46 960.85,-79.1"/>
<polygon fill="black" stroke="black" points="962.74,-82.05 969.77,-74.13 959.33,-75.93 962.74,-82.05"/>
</g>
<!-- handleStmtPrepare -->
<g id="node13" class="node">
<title>handleStmtPrepare</title>
<polygon fill="none" stroke="black" points="1079.5,-132 959.5,-132 959.5,-96 1079.5,-96 1079.5,-132"/>
<text text-anchor="middle" x="1019.5" y="-110.3" font-family="Times,serif" font-size="14.00">handleStmtPrepare</text>
</g>
<!-- dispatch&#45;&gt;handleStmtPrepare -->
<g id="edge12" class="edge">
<title>dispatch&#45;&gt;handleStmtPrepare</title>
<path fill="none" stroke="black" d="M911,-136.72C923.92,-133.99 937.09,-131.21 949.57,-128.57"/>
<polygon fill="black" stroke="black" points="950.37,-131.98 959.43,-126.48 948.92,-125.13 950.37,-131.98"/>
</g>
<!-- handleStmtExecute -->
<g id="node14" class="node">
<title>handleStmtExecute</title>
<polygon fill="none" stroke="black" points="1080.5,-186 958.5,-186 958.5,-150 1080.5,-150 1080.5,-186"/>
<text text-anchor="middle" x="1019.5" y="-164.3" font-family="Times,serif" font-size="14.00">handleStmtExecute</text>
</g>
<!-- dispatch&#45;&gt;handleStmtExecute -->
<g id="edge13" class="edge">
<title>dispatch&#45;&gt;handleStmtExecute</title>
<path fill="none" stroke="black" d="M911,-160.8C923.48,-161.63 936.18,-162.48 948.29,-163.29"/>
<polygon fill="black" stroke="black" points="948.08,-166.79 958.29,-163.97 948.55,-159.8 948.08,-166.79"/>
</g>
<!-- handleStmtClose -->
<g id="node15" class="node">
<title>handleStmtClose</title>
<polygon fill="none" stroke="black" points="1074.5,-240 964.5,-240 964.5,-204 1074.5,-204 1074.5,-240"/>
<text text-anchor="middle" x="1019.5" y="-218.3" font-family="Times,serif" font-size="14.00">handleStmtClose</text>
</g>
<!-- dispatch&#45;&gt;handleStmtClose -->
<g id="edge14" class="edge">
<title>dispatch&#45;&gt;handleStmtClose</title>
<path fill="none" stroke="black" d="M911,-184.87C926.27,-190.15 941.89,-195.54 956.33,-200.53"/>
<polygon fill="black" stroke="black" points="955.52,-203.95 966.11,-203.91 957.8,-197.34 955.52,-203.95"/>
</g>
<!-- writePacket -->
<g id="node10" class="node">
<title>writePacket</title>
<polygon fill="none" stroke="black" points="948,-259 948,-305 1091,-305 1091,-259 948,-259"/>
<text text-anchor="middle" x="1019.5" y="-289.8" font-family="Times,serif" font-size="14.00">writePacket</text>
<polyline fill="none" stroke="black" points="948,-282 1091,-282 "/>
<text text-anchor="middle" x="1019.5" y="-266.8" font-family="Times,serif" font-size="14.00">向conn写入返回数据</text>
</g>
<!-- writeError&#45;&gt;writePacket -->
<g id="edge7" class="edge">
<title>writeError&#45;&gt;writePacket</title>
<path fill="none" stroke="black" d="M860.08,-233C881.91,-239.75 910.77,-248.68 937.88,-257.07"/>
<polygon fill="black" stroke="black" points="937.19,-260.52 947.78,-260.13 939.26,-253.83 937.19,-260.52"/>
</g>
<!-- Parse -->
<g id="node17" class="node">
<title>Parse</title>
<polygon fill="none" stroke="black" points="1128,-20 1128,-66 1266,-66 1266,-20 1128,-20"/>
<text text-anchor="middle" x="1197" y="-50.8" font-family="Times,serif" font-size="14.00">Parse</text>
<polyline fill="none" stroke="black" points="1128,-43 1266,-43 "/>
<text text-anchor="start" x="1136" y="-27.8" font-family="Times,serif" font-size="14.00">将sql语句解析为smt</text>
</g>
<!-- handleQuery&#45;&gt;Parse -->
<g id="edge15" class="edge">
<title>handleQuery&#45;&gt;Parse</title>
<path fill="none" stroke="black" d="M1069.39,-45.89C1084.34,-45.55 1101.17,-45.16 1117.57,-44.79"/>
<polygon fill="black" stroke="black" points="1117.79,-48.28 1127.7,-44.56 1117.63,-41.29 1117.79,-48.28"/>
</g>
<!-- handleStmt -->
<g id="node18" class="node">
<title>handleStmt</title>
<polygon fill="none" stroke="black" points="1236.5,-121 1157.5,-121 1157.5,-85 1236.5,-85 1236.5,-121"/>
<text text-anchor="middle" x="1197" y="-99.3" font-family="Times,serif" font-size="14.00">handleStmt</text>
</g>
<!-- handleQuery&#45;&gt;handleStmt -->
<g id="edge16" class="edge">
<title>handleQuery&#45;&gt;handleStmt</title>
<path fill="none" stroke="black" d="M1069.39,-62.6C1093.81,-70.39 1123.27,-79.79 1147.62,-87.56"/>
<polygon fill="black" stroke="black" points="1146.78,-90.97 1157.37,-90.67 1148.91,-84.3 1146.78,-90.97"/>
</g>
<!-- writeResultset -->
<g id="node16" class="node">
<title>writeResultset</title>
<polygon fill="none" stroke="black" points="1491,-94 1303,-94 1303,-56 1491,-56 1491,-94"/>
<text text-anchor="start" x="1311" y="-78.8" font-family="Times,serif" font-size="14.00">writeResultset</text>
<text text-anchor="middle" x="1397" y="-63.8" font-family="Times,serif" font-size="14.00"> 调用ResultSet Next获取结果</text>
</g>
<!-- handleStmt&#45;&gt;writeResultset -->
<g id="edge17" class="edge">
<title>handleStmt&#45;&gt;writeResultset</title>
<path fill="none" stroke="black" d="M1236.65,-97.53C1252.92,-95.23 1272.7,-92.44 1292.73,-89.6"/>
<polygon fill="black" stroke="black" points="1293.47,-93.03 1302.88,-88.17 1292.49,-86.1 1293.47,-93.03"/>
</g>
<!-- ExecuteStmt -->
<g id="node19" class="node">
<title>ExecuteStmt</title>
<polygon fill="none" stroke="black" points="1440,-148 1354,-148 1354,-112 1440,-112 1440,-148"/>
<text text-anchor="middle" x="1397" y="-126.3" font-family="Times,serif" font-size="14.00">ExecuteStmt</text>
</g>
<!-- handleStmt&#45;&gt;ExecuteStmt -->
<g id="edge18" class="edge">
<title>handleStmt&#45;&gt;ExecuteStmt</title>
<path fill="none" stroke="black" d="M1236.65,-108.27C1267.14,-112.43 1309.99,-118.27 1343.58,-122.85"/>
<polygon fill="black" stroke="black" points="1343.3,-126.35 1353.68,-124.23 1344.25,-119.41 1343.3,-126.35"/>
</g>
<!-- Compile -->
<g id="node20" class="node">
<title>Compile</title>
<polygon fill="none" stroke="black" points="1528,-48.5 1528,-109.5 1679,-109.5 1679,-48.5 1528,-48.5"/>
<text text-anchor="middle" x="1603.5" y="-94.3" font-family="Times,serif" font-size="14.00">Compile</text>
<polyline fill="none" stroke="black" points="1528,-86.5 1679,-86.5 "/>
<text text-anchor="start" x="1536" y="-71.3" font-family="Times,serif" font-size="14.00">将stmt的ast tree转换为</text>
<text text-anchor="start" x="1536" y="-56.3" font-family="Times,serif" font-size="14.00"> physical plan</text>
</g>
<!-- ExecuteStmt&#45;&gt;Compile -->
<g id="edge19" class="edge">
<title>ExecuteStmt&#45;&gt;Compile</title>
<path fill="none" stroke="black" d="M1440.37,-119.43C1462.88,-113.82 1491.36,-106.72 1518.15,-100.04"/>
<polygon fill="black" stroke="black" points="1519.07,-103.41 1527.93,-97.6 1517.38,-96.62 1519.07,-103.41"/>
</g>
<!-- runStmt -->
<g id="node21" class="node">
<title>runStmt</title>
<polygon fill="none" stroke="black" points="1550,-129 1550,-205 1657,-205 1657,-129 1550,-129"/>
<text text-anchor="middle" x="1603.5" y="-189.8" font-family="Times,serif" font-size="14.00">runStmt</text>
<polyline fill="none" stroke="black" points="1550,-182 1657,-182 "/>
<text text-anchor="start" x="1558" y="-166.8" font-family="Times,serif" font-size="14.00">执行statement</text>
<text text-anchor="start" x="1558" y="-151.8" font-family="Times,serif" font-size="14.00"> 成功了commit</text>
<text text-anchor="start" x="1558" y="-136.8" font-family="Times,serif" font-size="14.00"> 失败了rollback</text>
</g>
<!-- ExecuteStmt&#45;&gt;runStmt -->
<g id="edge20" class="edge">
<title>ExecuteStmt&#45;&gt;runStmt</title>
<path fill="none" stroke="black" d="M1440.37,-137.67C1468.98,-142.84 1507.24,-149.77 1539.42,-155.59"/>
<polygon fill="black" stroke="black" points="1539.16,-159.1 1549.63,-157.43 1540.41,-152.21 1539.16,-159.1"/>
</g>
</g>
</svg>
