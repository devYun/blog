<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: handleSingleBatch Pages: 1 -->
<svg width="744pt" height="330pt"
 viewBox="0.00 0.00 744.00 329.62" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 325.62)">
<title>handleSingleBatch</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-325.62 740,-325.62 740,4 -4,4"/>
<!-- handleSingleBatch -->
<g id="node1" class="node">
<title>handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M12,-166.33C12,-166.33 107,-166.33 107,-166.33 113,-166.33 119,-172.33 119,-178.33 119,-178.33 119,-200.33 119,-200.33 119,-206.33 113,-212.33 107,-212.33 107,-212.33 12,-212.33 12,-212.33 6,-212.33 0,-206.33 0,-200.33 0,-200.33 0,-178.33 0,-178.33 0,-172.33 6,-166.33 12,-166.33"/>
<text text-anchor="middle" x="59.5" y="-197.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionCommit</text>
<polyline fill="none" stroke="#1c2123" points="0,-189.33 119,-189.33 "/>
<text text-anchor="middle" x="59.5" y="-174.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSingleBatch</text>
</g>
<!-- CommitRequest -->
<g id="node2" class="node">
<title>CommitRequest</title>
<path fill="none" stroke="#1c2123" d="M683,-299.33C683,-299.33 601,-299.33 601,-299.33 595,-299.33 589,-293.33 589,-287.33 589,-287.33 589,-275.33 589,-275.33 589,-269.33 595,-263.33 601,-263.33 601,-263.33 683,-263.33 683,-263.33 689,-263.33 695,-269.33 695,-275.33 695,-275.33 695,-287.33 695,-287.33 695,-293.33 689,-299.33 683,-299.33"/>
<text text-anchor="middle" x="642" y="-277.63" font-family="Times,serif" font-size="14.00" fill="#2f3638">CommitRequest</text>
</g>
<!-- handleSingleBatch&#45;&gt;CommitRequest -->
<g id="edge1" class="edge">
<title>handleSingleBatch&#45;&gt;CommitRequest</title>
<path fill="none" stroke="#666666" d="M75.23,-212.74C91.49,-236.14 120.05,-270.7 155,-285.33 297.07,-344.84 483.63,-317.45 579.01,-296.83"/>
<polygon fill="#666666" stroke="#666666" points="579.77,-300.25 588.78,-294.67 578.26,-293.41 579.77,-300.25"/>
</g>
<!-- NewRegionRequestSender -->
<g id="node3" class="node">
<title>NewRegionRequestSender</title>
<path fill="none" stroke="#1c2123" d="M308.5,-276.33C308.5,-276.33 170.5,-276.33 170.5,-276.33 164.5,-276.33 158.5,-270.33 158.5,-264.33 158.5,-264.33 158.5,-252.33 158.5,-252.33 158.5,-246.33 164.5,-240.33 170.5,-240.33 170.5,-240.33 308.5,-240.33 308.5,-240.33 314.5,-240.33 320.5,-246.33 320.5,-252.33 320.5,-252.33 320.5,-264.33 320.5,-264.33 320.5,-270.33 314.5,-276.33 308.5,-276.33"/>
<text text-anchor="middle" x="239.5" y="-254.63" font-family="Times,serif" font-size="14.00" fill="#2f3638">NewRegionRequestSender</text>
</g>
<!-- handleSingleBatch&#45;&gt;NewRegionRequestSender -->
<g id="edge2" class="edge">
<title>handleSingleBatch&#45;&gt;NewRegionRequestSender</title>
<path fill="none" stroke="#666666" d="M119.2,-212.39C131.05,-217.02 143.42,-221.85 155,-226.33 163.61,-229.67 172.73,-233.18 181.65,-236.61"/>
<polygon fill="#666666" stroke="#666666" points="180.64,-239.97 191.23,-240.28 183.14,-233.43 180.64,-239.97"/>
</g>
<!-- SendReq -->
<g id="node4" class="node">
<title>SendReq</title>
<path fill="none" stroke="#1c2123" d="M456.5,-276.33C456.5,-276.33 415.5,-276.33 415.5,-276.33 409.5,-276.33 403.5,-270.33 403.5,-264.33 403.5,-264.33 403.5,-252.33 403.5,-252.33 403.5,-246.33 409.5,-240.33 415.5,-240.33 415.5,-240.33 456.5,-240.33 456.5,-240.33 462.5,-240.33 468.5,-246.33 468.5,-252.33 468.5,-252.33 468.5,-264.33 468.5,-264.33 468.5,-270.33 462.5,-276.33 456.5,-276.33"/>
<text text-anchor="middle" x="436" y="-254.63" font-family="Times,serif" font-size="14.00" fill="#2f3638">SendReq</text>
</g>
<!-- handleSingleBatch&#45;&gt;SendReq -->
<g id="edge3" class="edge">
<title>handleSingleBatch&#45;&gt;SendReq</title>
<path fill="none" stroke="#666666" d="M119.09,-197.29C172.65,-204.89 253.95,-217.25 324,-231.33 347.06,-235.97 372.58,-242.1 393.32,-247.35"/>
<polygon fill="#666666" stroke="#666666" points="392.54,-250.77 403.09,-249.85 394.27,-243.98 392.54,-250.77"/>
</g>
<!-- GetRegionError -->
<g id="node5" class="node">
<title>GetRegionError</title>
<path fill="none" stroke="#1c2123" d="M279.5,-184.33C279.5,-184.33 199.5,-184.33 199.5,-184.33 193.5,-184.33 187.5,-178.33 187.5,-172.33 187.5,-172.33 187.5,-160.33 187.5,-160.33 187.5,-154.33 193.5,-148.33 199.5,-148.33 199.5,-148.33 279.5,-148.33 279.5,-148.33 285.5,-148.33 291.5,-154.33 291.5,-160.33 291.5,-160.33 291.5,-172.33 291.5,-172.33 291.5,-178.33 285.5,-184.33 279.5,-184.33"/>
<text text-anchor="middle" x="239.5" y="-162.63" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetRegionError</text>
</g>
<!-- handleSingleBatch&#45;&gt;GetRegionError -->
<g id="edge4" class="edge">
<title>handleSingleBatch&#45;&gt;GetRegionError</title>
<path fill="none" stroke="#666666" d="M119.28,-181.74C137.9,-179.33 158.53,-176.67 177.33,-174.24"/>
<polygon fill="#666666" stroke="#666666" points="177.79,-177.71 187.26,-172.95 176.89,-170.77 177.79,-177.71"/>
</g>
<!-- GetCommitTsExpired -->
<g id="node6" class="node">
<title>GetCommitTsExpired</title>
<path fill="none" stroke="#1c2123" d="M167,-53.33C167,-53.33 312,-53.33 312,-53.33 318,-53.33 324,-59.33 324,-65.33 324,-65.33 324,-117.33 324,-117.33 324,-123.33 318,-129.33 312,-129.33 312,-129.33 167,-129.33 167,-129.33 161,-129.33 155,-123.33 155,-117.33 155,-117.33 155,-65.33 155,-65.33 155,-59.33 161,-53.33 167,-53.33"/>
<text text-anchor="middle" x="239.5" y="-114.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">GetCommitTsExpired</text>
<polyline fill="none" stroke="#1c2123" points="155,-106.33 324,-106.33 "/>
<text text-anchor="start" x="163" y="-91.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">CommitTs rejected by Tikv</text>
<text text-anchor="start" x="163" y="-76.13" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重新获取一个commit ts</text>
<text text-anchor="start" x="163" y="-61.13" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 重新提交</text>
</g>
<!-- handleSingleBatch&#45;&gt;GetCommitTsExpired -->
<g id="edge5" class="edge">
<title>handleSingleBatch&#45;&gt;GetCommitTsExpired</title>
<path fill="none" stroke="#666666" d="M102.68,-166.11C119.89,-156.64 140.36,-145.37 160.12,-134.49"/>
<polygon fill="#666666" stroke="#666666" points="162.06,-137.41 169.14,-129.52 158.69,-131.28 162.06,-137.41"/>
</g>
<!-- NewRegionRequestSender&#45;&gt;SendReq -->
<g id="edge6" class="edge">
<title>NewRegionRequestSender&#45;&gt;SendReq</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M320.73,-258.33C345.62,-258.33 372.04,-258.33 393.2,-258.33"/>
<polygon fill="green" stroke="green" points="393.44,-261.83 403.44,-258.33 393.44,-254.83 393.44,-261.83"/>
</g>
<!-- SendReq&#45;&gt;CommitRequest -->
<g id="edge7" class="edge">
<title>SendReq&#45;&gt;CommitRequest</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M468.88,-261.93C498.17,-265.23 542.42,-270.22 578.72,-274.31"/>
<polygon fill="green" stroke="green" points="578.4,-277.8 588.73,-275.44 579.18,-270.84 578.4,-277.8"/>
</g>
<!-- doActionOnMutations -->
<g id="node7" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M560,-24.33C560,-24.33 724,-24.33 724,-24.33 730,-24.33 736,-30.33 736,-36.33 736,-36.33 736,-88.33 736,-88.33 736,-94.33 730,-100.33 724,-100.33 724,-100.33 560,-100.33 560,-100.33 554,-100.33 548,-94.33 548,-88.33 548,-88.33 548,-36.33 548,-36.33 548,-30.33 554,-24.33 560,-24.33"/>
<text text-anchor="middle" x="642" y="-85.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
<polyline fill="none" stroke="#1c2123" points="548,-77.33 736,-77.33 "/>
<text text-anchor="start" x="556" y="-62.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">有regionErr，重新对key分组</text>
<text text-anchor="start" x="556" y="-47.13" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后重新提交</text>
<text text-anchor="start" x="556" y="-32.13" font-family="Times,serif" font-size="14.00" fill="#2f3638"> actionCommit{retry:true}</text>
</g>
<!-- GetRegionError&#45;&gt;doActionOnMutations -->
<g id="edge8" class="edge">
<title>GetRegionError&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M291.65,-172.83C347.46,-177.99 438.65,-180.67 512,-155.33 541.76,-145.05 570.61,-125.47 593.45,-106.92"/>
<polygon fill="green" stroke="green" points="595.82,-109.5 601.27,-100.42 591.35,-104.12 595.82,-109.5"/>
</g>
<!-- getTimestampWithRetry -->
<g id="node8" class="node">
<title>getTimestampWithRetry</title>
<path fill="none" stroke="#1c2123" d="M372,-99.33C372,-99.33 500,-99.33 500,-99.33 506,-99.33 512,-105.33 512,-111.33 512,-111.33 512,-133.33 512,-133.33 512,-139.33 506,-145.33 500,-145.33 500,-145.33 372,-145.33 372,-145.33 366,-145.33 360,-139.33 360,-133.33 360,-133.33 360,-111.33 360,-111.33 360,-105.33 366,-99.33 372,-99.33"/>
<text text-anchor="middle" x="436" y="-130.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">getTimestampWithRetry</text>
<polyline fill="none" stroke="#1c2123" points="360,-122.33 512,-122.33 "/>
<text text-anchor="start" x="368" y="-107.13" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取新的commit ts</text>
</g>
<!-- GetCommitTsExpired&#45;&gt;getTimestampWithRetry -->
<g id="edge9" class="edge">
<title>GetCommitTsExpired&#45;&gt;getTimestampWithRetry</title>
<path fill="none" stroke="#666666" d="M324.11,-104.66C332.62,-106.02 341.28,-107.4 349.8,-108.75"/>
<polygon fill="#666666" stroke="#666666" points="349.31,-112.22 359.74,-110.34 350.42,-105.31 349.31,-112.22"/>
</g>
<!-- commitMutations -->
<g id="node9" class="node">
<title>commitMutations</title>
<path fill="none" stroke="#1c2123" d="M481.5,-80.33C481.5,-80.33 390.5,-80.33 390.5,-80.33 384.5,-80.33 378.5,-74.33 378.5,-68.33 378.5,-68.33 378.5,-56.33 378.5,-56.33 378.5,-50.33 384.5,-44.33 390.5,-44.33 390.5,-44.33 481.5,-44.33 481.5,-44.33 487.5,-44.33 493.5,-50.33 493.5,-56.33 493.5,-56.33 493.5,-68.33 493.5,-68.33 493.5,-74.33 487.5,-80.33 481.5,-80.33"/>
<text text-anchor="middle" x="436" y="-58.63" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitMutations</text>
</g>
<!-- GetCommitTsExpired&#45;&gt;commitMutations -->
<g id="edge10" class="edge">
<title>GetCommitTsExpired&#45;&gt;commitMutations</title>
<path fill="none" stroke="#666666" d="M324.11,-78.87C338.86,-76.67 354.04,-74.41 368.24,-72.29"/>
<polygon fill="#666666" stroke="#666666" points="369.03,-75.71 378.4,-70.77 367.99,-68.79 369.03,-75.71"/>
</g>
<!-- doActionOnMutations&#45;&gt;handleSingleBatch -->
<g id="edge12" class="edge">
<title>doActionOnMutations&#45;&gt;handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M547.73,-31.09C444.49,-2.46 276.62,25.93 155,-43.33 111.66,-68.02 84.9,-121.64 71.38,-156.57"/>
<polygon fill="green" stroke="green" points="67.95,-155.73 67.75,-166.33 74.52,-158.17 67.95,-155.73"/>
</g>
<!-- commitMutations&#45;&gt;doActionOnMutations -->
<g id="edge11" class="edge">
<title>commitMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M493.55,-62.33C507.39,-62.33 522.62,-62.33 537.89,-62.33"/>
<polygon fill="#666666" stroke="#666666" points="537.91,-65.83 547.91,-62.33 537.91,-58.83 537.91,-65.83"/>
</g>
</g>
</svg>
