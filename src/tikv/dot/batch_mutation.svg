<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: batch_mutations Pages: 1 -->
<svg width="1635pt" height="124pt"
 viewBox="0.00 0.00 1635.00 124.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 120)">
<title>batch_mutations</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-120 1631,-120 1631,4 -4,4"/>
<!-- KVTxn -->
<g id="node1" class="node">
<title>KVTxn</title>
<path fill="none" stroke="#1c2123" d="M12,-20.5C12,-20.5 213,-20.5 213,-20.5 219,-20.5 225,-26.5 225,-32.5 225,-32.5 225,-69.5 225,-69.5 225,-75.5 219,-81.5 213,-81.5 213,-81.5 12,-81.5 12,-81.5 6,-81.5 0,-75.5 0,-69.5 0,-69.5 0,-32.5 0,-32.5 0,-26.5 6,-20.5 12,-20.5"/>
<text text-anchor="middle" x="112.5" y="-66.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">KVTxn</text>
<polyline fill="none" stroke="#1c2123" points="0,-58.5 225,-58.5 "/>
<text text-anchor="start" x="8" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write操作先保存在MemDB中</text>
<text text-anchor="start" x="8" y="-28.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit时转成memBufferMutations</text>
</g>
<!-- twoPhaseCommitter -->
<g id="node2" class="node">
<title>twoPhaseCommitter</title>
<path fill="none" stroke="#1c2123" d="M407,-54.5C407,-54.5 565,-54.5 565,-54.5 571,-54.5 577,-60.5 577,-66.5 577,-66.5 577,-103.5 577,-103.5 577,-109.5 571,-115.5 565,-115.5 565,-115.5 407,-115.5 407,-115.5 401,-115.5 395,-109.5 395,-103.5 395,-103.5 395,-66.5 395,-66.5 395,-60.5 401,-54.5 407,-54.5"/>
<text text-anchor="middle" x="486" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">twoPhaseCommitter</text>
<polyline fill="none" stroke="#1c2123" points="395,-92.5 577,-92.5 "/>
<text text-anchor="start" x="403" y="-77.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历MemDB</text>
<text text-anchor="start" x="403" y="-62.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 转换成memBufferMutations</text>
</g>
<!-- KVTxn&#45;&gt;twoPhaseCommitter -->
<g id="edge1" class="edge">
<title>KVTxn&#45;&gt;twoPhaseCommitter</title>
<path fill="none" stroke="#666666" d="M225.21,-61.22C275.99,-65.87 335.6,-71.33 384.89,-75.84"/>
<polygon fill="#666666" stroke="#666666" points="384.65,-79.33 394.93,-76.76 385.29,-72.36 384.65,-79.33"/>
</g>
<!-- KVUnionStore -->
<g id="node8" class="node">
<title>KVUnionStore</title>
<path fill="none" stroke="#1c2123" d="M347,-46C347,-46 273,-46 273,-46 267,-46 261,-40 261,-34 261,-34 261,-22 261,-22 261,-16 267,-10 273,-10 273,-10 347,-10 347,-10 353,-10 359,-16 359,-22 359,-22 359,-34 359,-34 359,-40 353,-46 347,-46"/>
<text text-anchor="middle" x="310" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">KVUnionStore</text>
</g>
<!-- KVTxn&#45;&gt;KVUnionStore -->
<g id="edge7" class="edge">
<title>KVTxn&#45;&gt;KVUnionStore</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M225.24,-37.85C234.02,-36.82 242.65,-35.81 250.83,-34.84"/>
<polygon fill="green" stroke="green" points="251.41,-38.3 260.93,-33.66 250.59,-31.35 251.41,-38.3"/>
</g>
<!-- groupMutations -->
<g id="node3" class="node">
<title>groupMutations</title>
<path fill="none" stroke="#1c2123" d="M797,-20.5C797,-20.5 895,-20.5 895,-20.5 901,-20.5 907,-26.5 907,-32.5 907,-32.5 907,-69.5 907,-69.5 907,-75.5 901,-81.5 895,-81.5 895,-81.5 797,-81.5 797,-81.5 791,-81.5 785,-75.5 785,-69.5 785,-69.5 785,-32.5 785,-32.5 785,-26.5 791,-20.5 797,-20.5"/>
<text text-anchor="middle" x="846" y="-66.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">groupMutations</text>
<polyline fill="none" stroke="#1c2123" points="785,-58.5 907,-58.5 "/>
<text text-anchor="start" x="793" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">先对mutation根据</text>
<text text-anchor="start" x="793" y="-28.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> region做分组</text>
</g>
<!-- twoPhaseCommitter&#45;&gt;groupMutations -->
<g id="edge2" class="edge">
<title>twoPhaseCommitter&#45;&gt;groupMutations</title>
<path fill="none" stroke="#666666" d="M577.34,-76.42C638.47,-70.61 718.06,-63.06 774.52,-57.69"/>
<polygon fill="#666666" stroke="#666666" points="775.16,-61.15 784.78,-56.72 774.5,-54.18 775.16,-61.15"/>
</g>
<!-- batchMutations -->
<g id="node4" class="node">
<title>batchMutations</title>
<path fill="none" stroke="#1c2123" d="M955,-20.5C955,-20.5 1105,-20.5 1105,-20.5 1111,-20.5 1117,-26.5 1117,-32.5 1117,-32.5 1117,-69.5 1117,-69.5 1117,-75.5 1111,-81.5 1105,-81.5 1105,-81.5 955,-81.5 955,-81.5 949,-81.5 943,-75.5 943,-69.5 943,-69.5 943,-32.5 943,-32.5 943,-26.5 949,-20.5 955,-20.5"/>
<text text-anchor="middle" x="1030" y="-66.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">batchMutations</text>
<polyline fill="none" stroke="#1c2123" points="943,-58.5 1117,-58.5 "/>
<text text-anchor="start" x="951" y="-43.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">对每个分组内的mutations </text>
<text text-anchor="start" x="951" y="-28.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 按照size limit 做batch</text>
</g>
<!-- groupMutations&#45;&gt;batchMutations -->
<g id="edge3" class="edge">
<title>groupMutations&#45;&gt;batchMutations</title>
<path fill="none" stroke="#666666" d="M907.1,-51C915.36,-51 924,-51 932.72,-51"/>
<polygon fill="#666666" stroke="#666666" points="932.95,-54.5 942.95,-51 932.95,-47.5 932.95,-54.5"/>
</g>
<!-- batchExecutor -->
<g id="node5" class="node">
<title>batchExecutor</title>
<path fill="none" stroke="#1c2123" d="M1165,-54C1165,-54 1299,-54 1299,-54 1305,-54 1311,-60 1311,-66 1311,-66 1311,-88 1311,-88 1311,-94 1305,-100 1299,-100 1299,-100 1165,-100 1165,-100 1159,-100 1153,-94 1153,-88 1153,-88 1153,-66 1153,-66 1153,-60 1159,-54 1165,-54"/>
<text text-anchor="middle" x="1232" y="-84.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">batchExecutor</text>
<polyline fill="none" stroke="#1c2123" points="1153,-77 1311,-77 "/>
<text text-anchor="start" x="1161" y="-61.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">并发处理batchMutations</text>
</g>
<!-- batchMutations&#45;&gt;batchExecutor -->
<g id="edge4" class="edge">
<title>batchMutations&#45;&gt;batchExecutor</title>
<path fill="none" stroke="#666666" d="M1117.27,-62.21C1125.78,-63.32 1134.43,-64.45 1142.95,-65.55"/>
<polygon fill="#666666" stroke="#666666" points="1142.53,-69.03 1152.9,-66.85 1143.43,-62.09 1142.53,-69.03"/>
</g>
<!-- twoPhaseCommitAction -->
<g id="node6" class="node">
<title>twoPhaseCommitAction</title>
<path fill="#feed9b" stroke="#f7e495" d="M1359,-13C1359,-13 1525,-13 1525,-13 1531,-13 1537,-19 1537,-25 1537,-25 1537,-77 1537,-77 1537,-83 1531,-89 1525,-89 1525,-89 1359,-89 1359,-89 1353,-89 1347,-83 1347,-77 1347,-77 1347,-25 1347,-25 1347,-19 1353,-13 1359,-13"/>
<text text-anchor="middle" x="1442" y="-73.8" font-family="Times,serif" font-size="14.00" fill="#40575d">twoPhaseCommitAction</text>
<polyline fill="none" stroke="#f7e495" points="1347,-66 1537,-66 "/>
<text text-anchor="start" x="1355" y="-50.8" font-family="Times,serif" font-size="14.00" fill="#40575d">handleSingleBatch</text>
<text text-anchor="start" x="1355" y="-35.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 处理一批mutations</text>
<text text-anchor="start" x="1355" y="-20.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 会发送一些cmd请求到TiKV</text>
</g>
<!-- batchMutations&#45;&gt;twoPhaseCommitAction -->
<g id="edge11" class="edge">
<title>batchMutations&#45;&gt;twoPhaseCommitAction</title>
<path fill="none" stroke="#666666" d="M1117.28,-45.43C1129.28,-44.84 1141.44,-44.33 1153,-44 1223.19,-41.99 1240.8,-42.11 1311,-44 1319.36,-44.23 1328.03,-44.53 1336.73,-44.89"/>
<polygon fill="#666666" stroke="#666666" points="1336.8,-48.4 1346.94,-45.34 1337.1,-41.4 1336.8,-48.4"/>
</g>
<!-- batchExecutor&#45;&gt;twoPhaseCommitAction -->
<g id="edge5" class="edge">
<title>batchExecutor&#45;&gt;twoPhaseCommitAction</title>
<path fill="none" stroke="#666666" d="M1311.04,-67.24C1319.41,-66.2 1328.02,-65.12 1336.63,-64.05"/>
<polygon fill="#666666" stroke="#666666" points="1337.24,-67.5 1346.73,-62.78 1336.37,-60.55 1337.24,-67.5"/>
</g>
<!-- TiKV -->
<g id="node7" class="node">
<title>TiKV</title>
<path fill="none" stroke="#1c2123" d="M1615,-69C1615,-69 1585,-69 1585,-69 1579,-69 1573,-63 1573,-57 1573,-57 1573,-45 1573,-45 1573,-39 1579,-33 1585,-33 1585,-33 1615,-33 1615,-33 1621,-33 1627,-39 1627,-45 1627,-45 1627,-57 1627,-57 1627,-63 1621,-69 1615,-69"/>
<text text-anchor="middle" x="1600" y="-47.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">TiKV</text>
</g>
<!-- twoPhaseCommitAction&#45;&gt;TiKV -->
<g id="edge6" class="edge">
<title>twoPhaseCommitAction&#45;&gt;TiKV</title>
<path fill="none" stroke="#666666" d="M1537.34,-51C1546.26,-51 1554.87,-51 1562.69,-51"/>
<polygon fill="#666666" stroke="#666666" points="1562.82,-54.5 1572.82,-51 1562.82,-47.5 1562.82,-54.5"/>
</g>
<!-- MemDB -->
<g id="node9" class="node">
<title>MemDB</title>
<path fill="none" stroke="#1c2123" d="M506.5,-36C506.5,-36 465.5,-36 465.5,-36 459.5,-36 453.5,-30 453.5,-24 453.5,-24 453.5,-12 453.5,-12 453.5,-6 459.5,0 465.5,0 465.5,0 506.5,0 506.5,0 512.5,0 518.5,-6 518.5,-12 518.5,-12 518.5,-24 518.5,-24 518.5,-30 512.5,-36 506.5,-36"/>
<text text-anchor="middle" x="486" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">MemDB</text>
</g>
<!-- KVUnionStore&#45;&gt;MemDB -->
<g id="edge8" class="edge">
<title>KVUnionStore&#45;&gt;MemDB</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M359.01,-25.24C385.44,-23.72 417.93,-21.85 443.3,-20.4"/>
<polygon fill="green" stroke="green" points="443.56,-23.89 453.34,-19.82 443.16,-16.9 443.56,-23.89"/>
</g>
<!-- memBufferMutations -->
<g id="node10" class="node">
<title>memBufferMutations</title>
<path fill="none" stroke="#1c2123" d="M737,-46C737,-46 625,-46 625,-46 619,-46 613,-40 613,-34 613,-34 613,-22 613,-22 613,-16 619,-10 625,-10 625,-10 737,-10 737,-10 743,-10 749,-16 749,-22 749,-22 749,-34 749,-34 749,-40 743,-46 737,-46"/>
<text text-anchor="middle" x="681" y="-24.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">memBufferMutations</text>
</g>
<!-- MemDB&#45;&gt;memBufferMutations -->
<g id="edge9" class="edge">
<title>MemDB&#45;&gt;memBufferMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M518.87,-19.65C541.66,-20.83 573.36,-22.47 602.62,-23.99"/>
<polygon fill="green" stroke="green" points="602.68,-27.5 612.85,-24.52 603.04,-20.51 602.68,-27.5"/>
</g>
<!-- memBufferMutations&#45;&gt;groupMutations -->
<g id="edge10" class="edge">
<title>memBufferMutations&#45;&gt;groupMutations</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M749.24,-37.49C757.75,-38.69 766.47,-39.92 775.02,-41.13"/>
<polygon fill="green" stroke="green" points="774.57,-44.6 784.96,-42.53 775.54,-37.66 774.57,-44.6"/>
</g>
</g>
</svg>
