<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="2987pt" height="892pt"
 viewBox="0.00 0.00 2987.00 892.37" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 888.37)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-888.37 2983,-888.37 2983,4 -4,4"/>
<!-- CheckSecondaryLocks__process_write -->
<g id="node1" class="node">
<title>CheckSecondaryLocks__process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-279.5C12,-279.5 179,-279.5 179,-279.5 185,-279.5 191,-285.5 191,-291.5 191,-291.5 191,-412.5 191,-412.5 191,-418.5 185,-424.5 179,-424.5 179,-424.5 12,-424.5 12,-424.5 6,-424.5 0,-418.5 0,-412.5 0,-412.5 0,-291.5 0,-291.5 0,-285.5 6,-279.5 12,-279.5"/>
<text text-anchor="start" x="8" y="-409.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckSecondaryLocks</text>
<text text-anchor="start" x="8" y="-394.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-386.5 191,-386.5 "/>
<text text-anchor="start" x="8" y="-371.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Check locks of an async</text>
<text text-anchor="start" x="8" y="-356.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit transaction</text>
<polyline fill="none" stroke="#1c2123" points="0,-348.5 191,-348.5 "/>
<text text-anchor="start" x="8" y="-333.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">keys: Vec&lt;Key&gt;</text>
<polyline fill="none" stroke="#1c2123" points="0,-325.5 191,-325.5 "/>
<text text-anchor="start" x="8" y="-310.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">start_ts: txn_types::TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="0,-302.5 191,-302.5 "/>
<text text-anchor="start" x="8" y="-287.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历每个key</text>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node2" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M312.5,-529.5C312.5,-529.5 419.5,-529.5 419.5,-529.5 425.5,-529.5 431.5,-535.5 431.5,-541.5 431.5,-541.5 431.5,-578.5 431.5,-578.5 431.5,-584.5 425.5,-590.5 419.5,-590.5 419.5,-590.5 312.5,-590.5 312.5,-590.5 306.5,-590.5 300.5,-584.5 300.5,-578.5 300.5,-578.5 300.5,-541.5 300.5,-541.5 300.5,-535.5 306.5,-529.5 312.5,-529.5"/>
<text text-anchor="start" x="308.5" y="-575.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="308.5" y="-560.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
<polyline fill="none" stroke="#1c2123" points="300.5,-552.5 431.5,-552.5 "/>
<text text-anchor="start" x="308.5" y="-537.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取key对应的lock</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__load_lock -->
<g id="edge1" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M183.71,-424.61C198.07,-436.25 212.87,-448.05 227,-459 255.27,-480.91 287.49,-504.56 313.69,-523.47"/>
<polygon fill="#666666" stroke="#666666" points="311.81,-526.43 321.97,-529.43 315.9,-520.75 311.81,-526.43"/>
</g>
<!-- SnapshotReader__get_txn_commit_record -->
<g id="node3" class="node">
<title>SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M1020,-478C1020,-478 1148,-478 1148,-478 1154,-478 1160,-484 1160,-490 1160,-490 1160,-504 1160,-504 1160,-510 1154,-516 1148,-516 1148,-516 1020,-516 1020,-516 1014,-516 1008,-510 1008,-504 1008,-504 1008,-490 1008,-490 1008,-484 1014,-478 1020,-478"/>
<text text-anchor="start" x="1016" y="-500.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="1016" y="-485.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_txn_commit_record</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge2" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M191.29,-394.88C203.14,-399.15 215.24,-403.01 227,-406 371.53,-442.77 810.97,-477.52 997.65,-491.05"/>
<polygon fill="#666666" stroke="#666666" points="997.47,-494.54 1007.69,-491.77 997.97,-487.56 997.47,-494.54"/>
</g>
<!-- SecondaryLockStatus__Committed -->
<g id="node4" class="node">
<title>SecondaryLockStatus__Committed</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1389.5,-339C1389.5,-339 1499.5,-339 1499.5,-339 1505.5,-339 1511.5,-345 1511.5,-351 1511.5,-351 1511.5,-365 1511.5,-365 1511.5,-371 1505.5,-377 1499.5,-377 1499.5,-377 1389.5,-377 1389.5,-377 1383.5,-377 1377.5,-371 1377.5,-365 1377.5,-365 1377.5,-351 1377.5,-351 1377.5,-345 1383.5,-339 1389.5,-339"/>
<text text-anchor="start" x="1385.5" y="-361.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="1385.5" y="-346.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Committed</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Committed -->
<g id="edge3" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Committed</title>
<path fill="none" stroke="#666666" d="M191.33,-347.73C381.72,-339.41 824.09,-321.26 1196,-315 1254.66,-314.01 1270.26,-304.6 1328,-315 1350.17,-318.99 1373.64,-326.97 1393.59,-334.99"/>
<polygon fill="#666666" stroke="#666666" points="1392.5,-338.32 1403.08,-338.91 1395.17,-331.85 1392.5,-338.32"/>
</g>
<!-- SecondaryLockStatus__RolledBack -->
<g id="node5" class="node">
<title>SecondaryLockStatus__RolledBack</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1389.5,-439C1389.5,-439 1499.5,-439 1499.5,-439 1505.5,-439 1511.5,-445 1511.5,-451 1511.5,-451 1511.5,-465 1511.5,-465 1511.5,-471 1505.5,-477 1499.5,-477 1499.5,-477 1389.5,-477 1389.5,-477 1383.5,-477 1377.5,-471 1377.5,-465 1377.5,-465 1377.5,-451 1377.5,-451 1377.5,-445 1383.5,-439 1389.5,-439"/>
<text text-anchor="start" x="1385.5" y="-461.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="1385.5" y="-446.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Rollbacked</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge4" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M191.44,-363.41C298.18,-375.23 476.76,-392 631,-392 631,-392 631,-392 866.5,-392 997.22,-392 1034.2,-375.49 1160,-411 1177.41,-415.92 1178.71,-424.67 1196,-430 1251.77,-447.2 1317.52,-454.04 1367.23,-456.67"/>
<polygon fill="#666666" stroke="#666666" points="1367.11,-460.17 1377.26,-457.16 1367.45,-453.18 1367.11,-460.17"/>
</g>
<!-- SecondaryLockStatus__Locked -->
<g id="node6" class="node">
<title>SecondaryLockStatus__Locked</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1389.5,-717C1389.5,-717 1499.5,-717 1499.5,-717 1505.5,-717 1511.5,-723 1511.5,-729 1511.5,-729 1511.5,-743 1511.5,-743 1511.5,-749 1505.5,-755 1499.5,-755 1499.5,-755 1389.5,-755 1389.5,-755 1383.5,-755 1377.5,-749 1377.5,-743 1377.5,-743 1377.5,-729 1377.5,-729 1377.5,-723 1383.5,-717 1389.5,-717"/>
<text text-anchor="start" x="1385.5" y="-739.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">SecondaryLockStatus</text>
<text text-anchor="start" x="1385.5" y="-724.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Locked</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Locked -->
<g id="edge5" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;SecondaryLockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M118.98,-424.73C139.28,-479.55 174.17,-553.06 227,-600 370.77,-727.73 438.68,-755 631,-755 631,-755 631,-755 1085,-755 1182.42,-755 1294.53,-747.92 1367.07,-742.4"/>
<polygon fill="#666666" stroke="#666666" points="1367.78,-745.86 1377.48,-741.6 1367.24,-738.88 1367.78,-745.86"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="node7" class="node">
<title>MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="#f5b691" stroke="#d69043" d="M1573,-594.5C1573,-594.5 1777,-594.5 1777,-594.5 1783,-594.5 1789,-600.5 1789,-606.5 1789,-606.5 1789,-673.5 1789,-673.5 1789,-679.5 1783,-685.5 1777,-685.5 1777,-685.5 1573,-685.5 1573,-685.5 1567,-685.5 1561,-679.5 1561,-673.5 1561,-673.5 1561,-606.5 1561,-606.5 1561,-600.5 1567,-594.5 1573,-594.5"/>
<text text-anchor="start" x="1569" y="-670.3" font-family="Times,serif" font-size="14.00" fill="#6b6969">MvccTxn</text>
<text text-anchor="start" x="1569" y="-655.3" font-family="Times,serif" font-size="14.00" fill="#6b6969"> mark_rollback_on_mismatching_lock</text>
<polyline fill="none" stroke="#d69043" points="1561,-647.5 1789,-647.5 "/>
<text text-anchor="start" x="1569" y="-632.3" font-family="Times,serif" font-size="14.00" fill="#6b6969">将ts加入mismatch lock</text>
<text text-anchor="start" x="1569" y="-617.3" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 的rollback_t数组中</text>
<text text-anchor="start" x="1569" y="-602.3" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 然后更新locks</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge6" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M105.25,-424.56C118.34,-501.06 150.34,-619.77 227,-688 365.58,-811.35 445.48,-793 631,-793 631,-793 631,-793 1263,-793 1380.11,-793 1419.69,-816.23 1525,-765 1545.63,-754.96 1543.91,-743.31 1561,-728 1574.6,-715.82 1589.69,-703.39 1604.3,-691.86"/>
<polygon fill="#666666" stroke="#666666" points="1606.64,-694.47 1612.35,-685.55 1602.32,-688.96 1606.64,-694.47"/>
</g>
<!-- make_rollback -->
<g id="node8" class="node">
<title>make_rollback</title>
<path fill="none" stroke="#1c2123" d="M1603.5,-737.5C1603.5,-737.5 1746.5,-737.5 1746.5,-737.5 1752.5,-737.5 1758.5,-743.5 1758.5,-749.5 1758.5,-749.5 1758.5,-786.5 1758.5,-786.5 1758.5,-792.5 1752.5,-798.5 1746.5,-798.5 1746.5,-798.5 1603.5,-798.5 1603.5,-798.5 1597.5,-798.5 1591.5,-792.5 1591.5,-786.5 1591.5,-786.5 1591.5,-749.5 1591.5,-749.5 1591.5,-743.5 1597.5,-737.5 1603.5,-737.5"/>
<text text-anchor="start" x="1599.5" y="-783.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">make_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1591.5,-775.5 1758.5,-775.5 "/>
<text text-anchor="start" x="1599.5" y="-760.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建WriteType为Rollback</text>
<text text-anchor="start" x="1599.5" y="-745.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 类型的Write</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;make_rollback -->
<g id="edge7" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M98.7,-424.5C105.59,-515.53 131.65,-669.93 227,-754 364.1,-874.89 448.21,-831 631,-831 631,-831 631,-831 1263,-831 1373.29,-831 1498.34,-808.56 1581.23,-790.46"/>
<polygon fill="#666666" stroke="#666666" points="1582.12,-793.85 1591.13,-788.28 1580.61,-787.02 1582.12,-793.85"/>
</g>
<!-- MvccTxn__put_write -->
<g id="node9" class="node">
<title>MvccTxn__put_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M2491,-756.5C2491,-756.5 2626,-756.5 2626,-756.5 2632,-756.5 2638,-762.5 2638,-768.5 2638,-768.5 2638,-835.5 2638,-835.5 2638,-841.5 2632,-847.5 2626,-847.5 2626,-847.5 2491,-847.5 2491,-847.5 2485,-847.5 2479,-841.5 2479,-835.5 2479,-835.5 2479,-768.5 2479,-768.5 2479,-762.5 2485,-756.5 2491,-756.5"/>
<text text-anchor="start" x="2487" y="-832.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="2487" y="-817.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_write</text>
<polyline fill="none" stroke="#8a8898" points="2479,-809.5 2638,-809.5 "/>
<text text-anchor="start" x="2487" y="-794.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">写入rollback write record</text>
<text text-anchor="start" x="2487" y="-779.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 注意这个地方用的是</text>
<text text-anchor="start" x="2487" y="-764.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> key, start_ts</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__put_write -->
<g id="edge8" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M107.46,-424.64C126.47,-540.53 169.15,-759.35 227,-810 363.53,-929.53 449.54,-869 631,-869 631,-869 631,-869 2123.5,-869 2244.26,-869 2381.73,-843.35 2469,-823.79"/>
<polygon fill="#666666" stroke="#666666" points="2469.89,-827.18 2478.87,-821.56 2468.34,-820.35 2469.89,-827.18"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node10" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M2618,-509C2618,-509 2499,-509 2499,-509 2493,-509 2487,-503 2487,-497 2487,-497 2487,-485 2487,-485 2487,-479 2493,-473 2499,-473 2499,-473 2618,-473 2618,-473 2624,-473 2630,-479 2630,-485 2630,-485 2630,-497 2630,-497 2630,-503 2624,-509 2618,-509"/>
<text text-anchor="middle" x="2558.5" y="-487.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;collapse_prev_rollback -->
<g id="edge9" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M127.27,-279.32C148.8,-238.18 181.83,-190.07 227,-165 305.6,-121.37 541.1,-144 631,-144 631,-144 631,-144 2123.5,-144 2328.32,-144 2491.92,-382.68 2541.79,-464.14"/>
<polygon fill="#666666" stroke="#666666" points="2538.88,-466.08 2547.05,-472.83 2544.87,-462.46 2538.88,-466.08"/>
</g>
<!-- ReleasedLocks__push -->
<g id="node11" class="node">
<title>ReleasedLocks__push</title>
<path fill="none" stroke="#1c2123" d="M1501,-276C1501,-276 1388,-276 1388,-276 1382,-276 1376,-270 1376,-264 1376,-264 1376,-252 1376,-252 1376,-246 1382,-240 1388,-240 1388,-240 1501,-240 1501,-240 1507,-240 1513,-246 1513,-252 1513,-252 1513,-264 1513,-264 1513,-270 1507,-276 1501,-276"/>
<text text-anchor="middle" x="1444.5" y="-254.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__push</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__push -->
<g id="edge10" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="#666666" d="M190.41,-279.37C202.27,-272.6 214.61,-266.58 227,-262 396.35,-199.48 450.48,-220 631,-220 631,-220 631,-220 1085,-220 1182.29,-220 1293.6,-234.01 1366.04,-245.02"/>
<polygon fill="#666666" stroke="#666666" points="1365.58,-248.49 1376,-246.55 1366.65,-241.57 1365.58,-248.49"/>
</g>
<!-- WriteResult__set_allowed_on_disk_almost_full -->
<g id="node12" class="node">
<title>WriteResult__set_allowed_on_disk_almost_full</title>
<path fill="none" stroke="#1c2123" d="M493,-116C493,-116 239,-116 239,-116 233,-116 227,-110 227,-104 227,-104 227,-92 227,-92 227,-86 233,-80 239,-80 239,-80 493,-80 493,-80 499,-80 505,-86 505,-92 505,-92 505,-104 505,-104 505,-110 499,-116 493,-116"/>
<text text-anchor="middle" x="366" y="-94.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteResult__set_allowed_on_disk_almost_full</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;WriteResult__set_allowed_on_disk_almost_full -->
<g id="edge11" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;WriteResult__set_allowed_on_disk_almost_full</title>
<path fill="none" stroke="#666666" d="M121.53,-279.39C142.26,-229.98 176.56,-167.06 227,-130 231.82,-126.46 236.98,-123.3 242.36,-120.48"/>
<polygon fill="#666666" stroke="#666666" points="244.09,-123.53 251.6,-116.06 241.07,-117.21 244.09,-123.53"/>
</g>
<!-- ConcurrencyManager__update_max_ts -->
<g id="node13" class="node">
<title>ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M310.5,-0.5C310.5,-0.5 421.5,-0.5 421.5,-0.5 427.5,-0.5 433.5,-6.5 433.5,-12.5 433.5,-12.5 433.5,-49.5 433.5,-49.5 433.5,-55.5 427.5,-61.5 421.5,-61.5 421.5,-61.5 310.5,-61.5 310.5,-61.5 304.5,-61.5 298.5,-55.5 298.5,-49.5 298.5,-49.5 298.5,-12.5 298.5,-12.5 298.5,-6.5 304.5,-0.5 310.5,-0.5"/>
<text text-anchor="start" x="306.5" y="-46.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConcurrencyManager</text>
<text text-anchor="start" x="306.5" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> update_max_ts</text>
<polyline fill="none" stroke="#1c2123" points="298.5,-23.5 433.5,-23.5 "/>
<text text-anchor="start" x="306.5" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新max_ts</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge12" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M112.2,-279.41C129.68,-215.67 164.13,-124.94 227,-71 244.24,-56.21 266.67,-46.88 288.43,-41"/>
<polygon fill="#666666" stroke="#666666" points="289.49,-44.34 298.35,-38.53 287.8,-37.55 289.49,-44.34"/>
</g>
<!-- ReleasedLocks__new -->
<g id="node14" class="node">
<title>ReleasedLocks__new</title>
<path fill="none" stroke="#1c2123" d="M687,-284C687,-284 577,-284 577,-284 571,-284 565,-278 565,-272 565,-272 565,-260 565,-260 565,-254 571,-248 577,-248 577,-248 687,-248 687,-248 693,-248 699,-254 699,-260 699,-260 699,-272 699,-272 699,-278 693,-284 687,-284"/>
<text text-anchor="middle" x="632" y="-262.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__new</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__new -->
<g id="edge13" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__new</title>
<path fill="none" stroke="#666666" d="M191.21,-308.81C203.08,-304.59 215.2,-300.83 227,-298 338.86,-271.14 472.64,-265.53 554.7,-264.99"/>
<polygon fill="#666666" stroke="#666666" points="554.96,-268.49 564.94,-264.95 554.93,-261.49 554.96,-268.49"/>
</g>
<!-- ReleasedLocks__wake_up -->
<g id="node15" class="node">
<title>ReleasedLocks__wake_up</title>
<path fill="none" stroke="#1c2123" d="M1743.5,-276C1743.5,-276 1606.5,-276 1606.5,-276 1600.5,-276 1594.5,-270 1594.5,-264 1594.5,-264 1594.5,-252 1594.5,-252 1594.5,-246 1600.5,-240 1606.5,-240 1606.5,-240 1743.5,-240 1743.5,-240 1749.5,-240 1755.5,-246 1755.5,-252 1755.5,-252 1755.5,-264 1755.5,-264 1755.5,-270 1749.5,-276 1743.5,-276"/>
<text text-anchor="middle" x="1675" y="-254.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__wake_up</text>
</g>
<!-- CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge14" class="edge">
<title>CheckSecondaryLocks__process_write&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="#666666" d="M146.74,-279.28C168.33,-253.85 195.8,-227.94 227,-213 389.41,-135.2 450.92,-182 631,-182 631,-182 631,-182 1263,-182 1384.78,-182 1523.52,-214.66 1604.65,-237.16"/>
<polygon fill="#666666" stroke="#666666" points="1604.16,-240.66 1614.74,-239.99 1606.05,-233.92 1604.16,-240.66"/>
</g>
<!-- lock__mismatch -->
<g id="node16" class="node">
<title>lock__mismatch</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M562.5,-529.5C562.5,-529.5 701.5,-529.5 701.5,-529.5 707.5,-529.5 713.5,-535.5 713.5,-541.5 713.5,-541.5 713.5,-578.5 713.5,-578.5 713.5,-584.5 707.5,-590.5 701.5,-590.5 701.5,-590.5 562.5,-590.5 562.5,-590.5 556.5,-590.5 550.5,-584.5 550.5,-578.5 550.5,-578.5 550.5,-541.5 550.5,-541.5 550.5,-535.5 556.5,-529.5 562.5,-529.5"/>
<text text-anchor="start" x="558.5" y="-575.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock mismatch</text>
<polyline fill="none" stroke="#8a8898" points="550.5,-567.5 713.5,-567.5 "/>
<text text-anchor="start" x="558.5" y="-552.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">1. lock为None</text>
<text text-anchor="start" x="558.5" y="-537.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2. 或者Lock.ts != start_ts</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;lock__mismatch -->
<g id="edge15" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;lock__mismatch</title>
<path fill="none" stroke="#666666" d="M431.58,-560C464.09,-560 504.06,-560 539.66,-560"/>
<polygon fill="#666666" stroke="#666666" points="540.06,-563.5 550.06,-560 540.06,-556.5 540.06,-563.5"/>
</g>
<!-- lock__exists -->
<g id="node17" class="node">
<title>lock__exists</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M553,-609.5C553,-609.5 711,-609.5 711,-609.5 717,-609.5 723,-615.5 723,-621.5 723,-621.5 723,-658.5 723,-658.5 723,-664.5 717,-670.5 711,-670.5 711,-670.5 553,-670.5 553,-670.5 547,-670.5 541,-664.5 541,-658.5 541,-658.5 541,-621.5 541,-621.5 541,-615.5 547,-609.5 553,-609.5"/>
<text text-anchor="start" x="549" y="-655.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock exists</text>
<polyline fill="none" stroke="#8a8898" points="541,-647.5 723,-647.5 "/>
<text text-anchor="start" x="549" y="-632.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">1.lock存在</text>
<text text-anchor="start" x="549" y="-617.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2.并且lock.ts == self.start_ts</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;lock__exists -->
<g id="edge16" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;lock__exists</title>
<path fill="none" stroke="#666666" d="M431.58,-579.57C461.52,-588.64 497.79,-599.63 531.14,-609.74"/>
<polygon fill="#666666" stroke="#666666" points="530.34,-613.15 540.92,-612.7 532.37,-606.45 530.34,-613.15"/>
</g>
<!-- TxnCommitRecord__None -->
<g id="node24" class="node">
<title>TxnCommitRecord__None</title>
<path fill="none" stroke="#1c2123" d="M1212.5,-574C1212.5,-574 1311.5,-574 1311.5,-574 1317.5,-574 1323.5,-580 1323.5,-586 1323.5,-586 1323.5,-600 1323.5,-600 1323.5,-606 1317.5,-612 1311.5,-612 1311.5,-612 1212.5,-612 1212.5,-612 1206.5,-612 1200.5,-606 1200.5,-600 1200.5,-600 1200.5,-586 1200.5,-586 1200.5,-580 1206.5,-574 1212.5,-574"/>
<text text-anchor="start" x="1208.5" y="-596.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="1208.5" y="-581.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> None</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None -->
<g id="edge28" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1120.19,-516.2C1148.01,-531.37 1187,-552.64 1216.9,-568.95"/>
<polygon fill="green" stroke="green" points="1215.41,-572.12 1225.87,-573.84 1218.76,-565.98 1215.41,-572.12"/>
</g>
<!-- TxnCommitRecord__SingleRecord -->
<g id="node25" class="node">
<title>TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="#1c2123" d="M1212.5,-382C1212.5,-382 1311.5,-382 1311.5,-382 1317.5,-382 1323.5,-388 1323.5,-394 1323.5,-394 1323.5,-408 1323.5,-408 1323.5,-414 1317.5,-420 1311.5,-420 1311.5,-420 1212.5,-420 1212.5,-420 1206.5,-420 1200.5,-414 1200.5,-408 1200.5,-408 1200.5,-394 1200.5,-394 1200.5,-388 1206.5,-382 1212.5,-382"/>
<text text-anchor="start" x="1208.5" y="-404.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="1208.5" y="-389.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> SingleRecord</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord -->
<g id="edge29" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1140.53,-477.96C1147.19,-475.18 1153.82,-472.18 1160,-469 1183.91,-456.71 1208.99,-439.84 1228.18,-425.99"/>
<polygon fill="green" stroke="green" points="1230.28,-428.79 1236.28,-420.06 1226.15,-423.14 1230.28,-428.79"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback -->
<g id="node26" class="node">
<title>TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="#1c2123" d="M1208,-478C1208,-478 1316,-478 1316,-478 1322,-478 1328,-484 1328,-490 1328,-490 1328,-504 1328,-504 1328,-510 1322,-516 1316,-516 1316,-516 1208,-516 1208,-516 1202,-516 1196,-510 1196,-504 1196,-504 1196,-490 1196,-490 1196,-484 1202,-478 1208,-478"/>
<text text-anchor="start" x="1204" y="-500.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord</text>
<text text-anchor="start" x="1204" y="-485.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> OverlappedRollback</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback -->
<g id="edge30" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1160.15,-497C1168.59,-497 1177.18,-497 1185.62,-497"/>
<polygon fill="green" stroke="green" points="1185.81,-500.5 1195.81,-497 1185.81,-493.5 1185.81,-500.5"/>
</g>
<!-- SecondaryLockStatus__RolledBack&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge50" class="edge">
<title>SecondaryLockStatus__RolledBack&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1467.41,-438.82C1509.01,-402.41 1599.41,-323.29 1645.6,-282.86"/>
<polygon fill="green" stroke="green" points="1647.93,-285.47 1653.15,-276.25 1643.32,-280.2 1647.93,-285.47"/>
</g>
<!-- Lock__rollback_ts__push -->
<g id="node31" class="node">
<title>Lock__rollback_ts__push</title>
<path fill="none" stroke="#1c2123" d="M1856.5,-535C1856.5,-535 1989.5,-535 1989.5,-535 1995.5,-535 2001.5,-541 2001.5,-547 2001.5,-547 2001.5,-599 2001.5,-599 2001.5,-605 1995.5,-611 1989.5,-611 1989.5,-611 1856.5,-611 1856.5,-611 1850.5,-611 1844.5,-605 1844.5,-599 1844.5,-599 1844.5,-547 1844.5,-547 1844.5,-541 1850.5,-535 1856.5,-535"/>
<text text-anchor="start" x="1852.5" y="-595.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock</text>
<text text-anchor="start" x="1852.5" y="-580.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rollback_ts::push</text>
<polyline fill="none" stroke="#1c2123" points="1844.5,-573 2001.5,-573 "/>
<text text-anchor="start" x="1852.5" y="-557.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">将事务ts加入rollback_ts</text>
<text text-anchor="start" x="1852.5" y="-542.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 数组</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts__push -->
<g id="edge51" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts__push</title>
<path fill="none" stroke="#666666" d="M1789.28,-609.15C1804.44,-605.02 1819.8,-600.83 1834.44,-596.85"/>
<polygon fill="#666666" stroke="#666666" points="1835.71,-600.13 1844.44,-594.13 1833.87,-593.38 1835.71,-600.13"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node32" class="node">
<title>MvccTxn__put_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M2070.5,-579.5C2070.5,-579.5 2174.5,-579.5 2174.5,-579.5 2180.5,-579.5 2186.5,-585.5 2186.5,-591.5 2186.5,-591.5 2186.5,-628.5 2186.5,-628.5 2186.5,-634.5 2180.5,-640.5 2174.5,-640.5 2174.5,-640.5 2070.5,-640.5 2070.5,-640.5 2064.5,-640.5 2058.5,-634.5 2058.5,-628.5 2058.5,-628.5 2058.5,-591.5 2058.5,-591.5 2058.5,-585.5 2064.5,-579.5 2070.5,-579.5"/>
<text text-anchor="start" x="2066.5" y="-625.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="2066.5" y="-610.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<polyline fill="none" stroke="#8a8898" points="2058.5,-602.5 2186.5,-602.5 "/>
<text text-anchor="start" x="2066.5" y="-587.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">更新mistached lock</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock -->
<g id="edge52" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1789.15,-635.31C1856.54,-632.13 1943.73,-627.35 2021,-621 2029.77,-620.28 2038.96,-619.42 2048.07,-618.5"/>
<polygon fill="green" stroke="green" points="2048.7,-621.95 2058.29,-617.45 2047.98,-614.99 2048.7,-621.95"/>
</g>
<!-- Write__set_ovelapped_rollback -->
<g id="node27" class="node">
<title>Write__set_ovelapped_rollback</title>
<path fill="none" stroke="#1c2123" d="M1842.5,-669C1842.5,-669 2003.5,-669 2003.5,-669 2009.5,-669 2015.5,-675 2015.5,-681 2015.5,-681 2015.5,-733 2015.5,-733 2015.5,-739 2009.5,-745 2003.5,-745 2003.5,-745 1842.5,-745 1842.5,-745 1836.5,-745 1830.5,-739 1830.5,-733 1830.5,-733 1830.5,-681 1830.5,-681 1830.5,-675 1836.5,-669 1842.5,-669"/>
<text text-anchor="start" x="1838.5" y="-729.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
<text text-anchor="start" x="1838.5" y="-714.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> set_ovelapped_rollback</text>
<text text-anchor="start" x="1838.5" y="-699.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 设置has_overlapped_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1830.5,-692 2015.5,-692 "/>
<text text-anchor="start" x="1838.5" y="-676.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">和gc_fenece</text>
</g>
<!-- make_rollback&#45;&gt;Write__set_ovelapped_rollback -->
<g id="edge38" class="edge">
<title>make_rollback&#45;&gt;Write__set_ovelapped_rollback</title>
<path fill="none" stroke="#666666" d="M1758.6,-747.52C1778.48,-742.59 1799.95,-737.27 1820.58,-732.15"/>
<polygon fill="#666666" stroke="#666666" points="1821.44,-735.54 1830.31,-729.74 1819.76,-728.75 1821.44,-735.54"/>
</g>
<!-- Write__new_rollback -->
<g id="node28" class="node">
<title>Write__new_rollback</title>
<path fill="none" stroke="#1c2123" d="M1837,-764C1837,-764 2009,-764 2009,-764 2015,-764 2021,-770 2021,-776 2021,-776 2021,-828 2021,-828 2021,-834 2015,-840 2009,-840 2009,-840 1837,-840 1837,-840 1831,-840 1825,-834 1825,-828 1825,-828 1825,-776 1825,-776 1825,-770 1831,-764 1837,-764"/>
<text text-anchor="start" x="1833" y="-824.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
<text text-anchor="start" x="1833" y="-809.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1825,-802 2021,-802 "/>
<text text-anchor="start" x="1833" y="-786.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">新建Write类型为Rollback</text>
<text text-anchor="start" x="1833" y="-771.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> has_overlapped_rollback为false</text>
</g>
<!-- make_rollback&#45;&gt;Write__new_rollback -->
<g id="edge39" class="edge">
<title>make_rollback&#45;&gt;Write__new_rollback</title>
<path fill="none" stroke="#666666" d="M1758.6,-779.42C1776.58,-781.9 1795.86,-784.57 1814.65,-787.16"/>
<polygon fill="#666666" stroke="#666666" points="1814.33,-790.65 1824.72,-788.55 1815.29,-783.72 1814.33,-790.65"/>
</g>
<!-- SnapshotReader__seek_write -->
<g id="node18" class="node">
<title>SnapshotReader__seek_write</title>
<path fill="none" stroke="#1c2123" d="M2686,-448C2686,-448 2766,-448 2766,-448 2772,-448 2778,-454 2778,-460 2778,-460 2778,-474 2778,-474 2778,-480 2772,-486 2766,-486 2766,-486 2686,-486 2686,-486 2680,-486 2674,-480 2674,-474 2674,-474 2674,-460 2674,-460 2674,-454 2680,-448 2686,-448"/>
<text text-anchor="start" x="2682" y="-470.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="2682" y="-455.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> seek_write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write -->
<g id="edge46" class="edge">
<title>collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write</title>
<path fill="none" stroke="#666666" d="M2630.17,-480.75C2641.22,-479.15 2652.56,-477.5 2663.39,-475.93"/>
<polygon fill="#666666" stroke="#666666" points="2664.2,-479.35 2673.59,-474.46 2663.19,-472.43 2664.2,-479.35"/>
</g>
<!-- MvccTxn__delete_write -->
<g id="node19" class="node">
<title>MvccTxn__delete_write</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M2826,-445.5C2826,-445.5 2967,-445.5 2967,-445.5 2973,-445.5 2979,-451.5 2979,-457.5 2979,-457.5 2979,-524.5 2979,-524.5 2979,-530.5 2973,-536.5 2967,-536.5 2967,-536.5 2826,-536.5 2826,-536.5 2820,-536.5 2814,-530.5 2814,-524.5 2814,-524.5 2814,-457.5 2814,-457.5 2814,-451.5 2820,-445.5 2826,-445.5"/>
<text text-anchor="start" x="2822" y="-521.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="2822" y="-506.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> delete_write</text>
<polyline fill="none" stroke="#8a8898" points="2814,-498.5 2979,-498.5 "/>
<text text-anchor="start" x="2822" y="-483.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">删除之前的Rollback类型</text>
<text text-anchor="start" x="2822" y="-468.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 并且没被protected</text>
<text text-anchor="start" x="2822" y="-453.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 的Write</text>
</g>
<!-- collapse_prev_rollback&#45;&gt;MvccTxn__delete_write -->
<g id="edge47" class="edge">
<title>collapse_prev_rollback&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="#666666" d="M2630.03,-494.56C2644.57,-495.16 2659.78,-495.69 2674,-496 2720.21,-497.01 2731.79,-496.98 2778,-496 2786.36,-495.82 2795.06,-495.57 2803.77,-495.28"/>
<polygon fill="#666666" stroke="#666666" points="2804.1,-498.77 2813.97,-494.92 2803.86,-491.78 2804.1,-498.77"/>
</g>
<!-- ReleasedLocks__push&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge49" class="edge">
<title>ReleasedLocks__push&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1513.13,-258C1535.47,-258 1560.68,-258 1584.4,-258"/>
<polygon fill="green" stroke="green" points="1584.46,-261.5 1594.46,-258 1584.46,-254.5 1584.46,-261.5"/>
</g>
<!-- ReleasedLocks__new&#45;&gt;ReleasedLocks__push -->
<g id="edge48" class="edge">
<title>ReleasedLocks__new&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M699.33,-265.35C847.95,-263.88 1207.06,-260.33 1365.81,-258.77"/>
<polygon fill="green" stroke="green" points="1366.01,-262.27 1375.97,-258.67 1365.94,-255.27 1366.01,-262.27"/>
</g>
<!-- lock__mismatch&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge25" class="edge">
<title>lock__mismatch&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M712.11,-529.42C727.46,-524.51 743.58,-520.05 759,-517 838.9,-501.2 931.84,-496.86 997.64,-496.08"/>
<polygon fill="green" stroke="green" points="997.99,-499.58 1007.96,-495.99 997.93,-492.58 997.99,-499.58"/>
</g>
<!-- lock__mismatch&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge26" class="edge">
<title>lock__mismatch&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M713.63,-589.1C728.56,-593.67 744.14,-597.9 759,-601 1023.46,-656.24 1094.15,-646.87 1364,-660 1435.47,-663.48 1453.6,-664.77 1525,-660 1533.33,-659.44 1541.9,-658.71 1550.53,-657.86"/>
<polygon fill="green" stroke="green" points="1551.09,-661.32 1560.67,-656.81 1550.36,-654.36 1551.09,-661.32"/>
</g>
<!-- lock__mismatch&#45;&gt;TxnCommitRecord__None -->
<g id="edge27" class="edge">
<title>lock__mismatch&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M713.75,-575.96C728.74,-578.39 744.3,-580.56 759,-582 912.14,-596.96 1092.74,-596.52 1190.14,-594.8"/>
<polygon fill="green" stroke="green" points="1190.23,-598.3 1200.16,-594.62 1190.1,-591.3 1190.23,-598.3"/>
</g>
<!-- lock__exists__Pessimistic -->
<g id="node20" class="node">
<title>lock__exists__Pessimistic</title>
<path fill="none" stroke="#1c2123" d="M771,-526C771,-526 960,-526 960,-526 966,-526 972,-532 972,-538 972,-538 972,-560 972,-560 972,-566 966,-572 960,-572 960,-572 771,-572 771,-572 765,-572 759,-566 759,-560 759,-560 759,-538 759,-538 759,-532 765,-526 771,-526"/>
<text text-anchor="start" x="767" y="-556.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock__exists__Pessimistic</text>
<polyline fill="none" stroke="#1c2123" points="759,-549 972,-549 "/>
<text text-anchor="start" x="767" y="-533.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">case1: 并且Lock type为Pessimistic</text>
</g>
<!-- lock__exists&#45;&gt;lock__exists__Pessimistic -->
<g id="edge18" class="edge">
<title>lock__exists&#45;&gt;lock__exists__Pessimistic</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M710.73,-609.45C738.46,-598.54 769.47,-586.36 796.33,-575.8"/>
<polygon fill="green" stroke="green" points="797.62,-579.05 805.65,-572.13 795.06,-572.54 797.62,-579.05"/>
</g>
<!-- lock__exists__NOT__Pessimistic -->
<g id="node21" class="node">
<title>lock__exists__NOT__Pessimistic</title>
<path fill="none" stroke="#1c2123" d="M777.5,-688C777.5,-688 953.5,-688 953.5,-688 959.5,-688 965.5,-694 965.5,-700 965.5,-700 965.5,-714 965.5,-714 965.5,-720 959.5,-726 953.5,-726 953.5,-726 777.5,-726 777.5,-726 771.5,-726 765.5,-720 765.5,-714 765.5,-714 765.5,-700 765.5,-700 765.5,-694 771.5,-688 777.5,-688"/>
<text text-anchor="start" x="773.5" y="-710.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock__exists__NOT__Pessimistic</text>
<text text-anchor="start" x="773.5" y="-695.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> case2: 不是悲观lock</text>
</g>
<!-- lock__exists&#45;&gt;lock__exists__NOT__Pessimistic -->
<g id="edge19" class="edge">
<title>lock__exists&#45;&gt;lock__exists__NOT__Pessimistic</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M723.17,-666.1C744.87,-672.38 767.83,-679.02 788.8,-685.09"/>
<polygon fill="green" stroke="green" points="788.01,-688.51 798.59,-687.93 789.96,-681.78 788.01,-688.51"/>
</g>
<!-- SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write -->
<g id="edge17" class="edge">
<title>SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2778.01,-474.27C2786.25,-475.44 2794.99,-476.68 2803.83,-477.94"/>
<polygon fill="green" stroke="green" points="2803.46,-481.43 2813.85,-479.37 2804.44,-474.5 2803.46,-481.43"/>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge20" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M962.41,-525.96C974.33,-523.1 986.47,-520.19 998.21,-517.37"/>
<polygon fill="#666666" stroke="#666666" points="999.07,-520.76 1007.97,-515.02 997.43,-513.95 999.07,-520.76"/>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge21" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M972.01,-557.86C1067.15,-562.56 1209.84,-561.38 1328,-526 1328.53,-525.84 1369.6,-501.63 1402.61,-482.15"/>
<polygon fill="#666666" stroke="#666666" points="1404.4,-485.16 1411.23,-477.06 1400.84,-479.13 1404.4,-485.16"/>
</g>
<!-- MvccTxn__unlock_key -->
<g id="node22" class="node">
<title>MvccTxn__unlock_key</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1054.5,-421C1054.5,-421 1113.5,-421 1113.5,-421 1119.5,-421 1125.5,-427 1125.5,-433 1125.5,-433 1125.5,-447 1125.5,-447 1125.5,-453 1119.5,-459 1113.5,-459 1113.5,-459 1054.5,-459 1054.5,-459 1048.5,-459 1042.5,-453 1042.5,-447 1042.5,-447 1042.5,-433 1042.5,-433 1042.5,-427 1048.5,-421 1054.5,-421"/>
<text text-anchor="start" x="1050.5" y="-443.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1050.5" y="-428.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> unlock_key</text>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;MvccTxn__unlock_key -->
<g id="edge22" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M903.84,-525.91C931.92,-509.03 971.65,-486.19 1008,-469 1015.98,-465.23 1024.59,-461.55 1033.03,-458.15"/>
<polygon fill="#666666" stroke="#666666" points="1034.43,-461.36 1042.45,-454.44 1031.87,-454.85 1034.43,-461.36"/>
</g>
<!-- need_rollback -->
<g id="node23" class="node">
<title>need_rollback</title>
<path fill="#feed9b" stroke="#f7e495" d="M1376,-544C1376,-544 1513,-544 1513,-544 1519,-544 1525,-550 1525,-556 1525,-556 1525,-638 1525,-638 1525,-644 1519,-650 1513,-650 1513,-650 1376,-650 1376,-650 1370,-650 1364,-644 1364,-638 1364,-638 1364,-556 1364,-556 1364,-550 1370,-544 1376,-544"/>
<text text-anchor="start" x="1372" y="-634.8" font-family="Times,serif" font-size="14.00" fill="#40575d">need_rollback</text>
<polyline fill="none" stroke="#f7e495" points="1364,-627 1525,-627 "/>
<text text-anchor="start" x="1372" y="-611.8" font-family="Times,serif" font-size="14.00" fill="#40575d">to prevent the status</text>
<text text-anchor="start" x="1372" y="-596.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> to being changed</text>
<text text-anchor="start" x="1372" y="-581.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> a rollback may be written</text>
<text text-anchor="start" x="1372" y="-566.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> and this rollback need to</text>
<text text-anchor="start" x="1372" y="-551.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> be protected</text>
</g>
<!-- lock__exists__Pessimistic&#45;&gt;need_rollback -->
<g id="edge23" class="edge">
<title>lock__exists__Pessimistic&#45;&gt;need_rollback</title>
<path fill="none" stroke="#666666" d="M937.75,-572.1C1028.16,-598.68 1189.07,-636.86 1328,-622 1336.36,-621.11 1345,-619.86 1353.62,-618.39"/>
<polygon fill="#666666" stroke="#666666" points="1354.48,-621.79 1363.71,-616.58 1353.25,-614.9 1354.48,-621.79"/>
</g>
<!-- lock__exists__NOT__Pessimistic&#45;&gt;SecondaryLockStatus__Locked -->
<g id="edge24" class="edge">
<title>lock__exists__NOT__Pessimistic&#45;&gt;SecondaryLockStatus__Locked</title>
<path fill="none" stroke="#666666" d="M965.69,-711.99C1079.66,-717.71 1264.21,-726.99 1367.42,-732.18"/>
<polygon fill="#666666" stroke="#666666" points="1367.29,-735.67 1377.45,-732.68 1367.64,-728.68 1367.29,-735.67"/>
</g>
<!-- released_lock -->
<g id="node33" class="node">
<title>released_lock</title>
<path fill="#feed9b" stroke="#f7e495" d="M1223.5,-325C1223.5,-325 1300.5,-325 1300.5,-325 1306.5,-325 1312.5,-331 1312.5,-337 1312.5,-337 1312.5,-351 1312.5,-351 1312.5,-357 1306.5,-363 1300.5,-363 1300.5,-363 1223.5,-363 1223.5,-363 1217.5,-363 1211.5,-357 1211.5,-351 1211.5,-351 1211.5,-337 1211.5,-337 1211.5,-331 1217.5,-325 1223.5,-325"/>
<text text-anchor="start" x="1219.5" y="-347.8" font-family="Times,serif" font-size="14.00" fill="#40575d">released_lock</text>
<text text-anchor="start" x="1219.5" y="-332.8" font-family="Times,serif" font-size="14.00" fill="#40575d"> 被释放的lock</text>
</g>
<!-- MvccTxn__unlock_key&#45;&gt;released_lock -->
<g id="edge53" class="edge">
<title>MvccTxn__unlock_key&#45;&gt;released_lock</title>
<path fill="none" stroke="#666666" d="M1113.56,-420.94C1135.6,-406.62 1167.11,-386.98 1196,-372 1199.04,-370.43 1202.18,-368.86 1205.38,-367.33"/>
<polygon fill="#666666" stroke="#666666" points="1206.88,-370.49 1214.46,-363.08 1203.92,-364.15 1206.88,-370.49"/>
</g>
<!-- need_rollback&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge36" class="edge">
<title>need_rollback&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M1525.1,-611.98C1533.52,-613.56 1542.22,-615.2 1550.99,-616.85"/>
<polygon fill="#666666" stroke="#666666" points="1550.43,-620.31 1560.91,-618.72 1551.73,-613.43 1550.43,-620.31"/>
</g>
<!-- need_rollback&#45;&gt;make_rollback -->
<g id="edge37" class="edge">
<title>need_rollback&#45;&gt;make_rollback</title>
<path fill="none" stroke="#666666" d="M1505.13,-650.15C1522.74,-665.13 1542.31,-681.13 1561,-695 1578.08,-707.68 1597.32,-720.58 1615.01,-731.94"/>
<polygon fill="#666666" stroke="#666666" points="1613.24,-734.96 1623.55,-737.38 1617,-729.06 1613.24,-734.96"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge34" class="edge">
<title>TxnCommitRecord__None&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M1307.43,-573.87C1314.76,-569.6 1321.94,-564.63 1328,-559 1350.23,-538.35 1341.92,-521.8 1364,-501 1371.62,-493.82 1380.66,-487.47 1389.87,-481.99"/>
<polygon fill="#666666" stroke="#666666" points="1391.71,-484.97 1398.71,-477.02 1388.28,-478.87 1391.71,-484.97"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;need_rollback -->
<g id="edge35" class="edge">
<title>TxnCommitRecord__None&#45;&gt;need_rollback</title>
<path fill="none" stroke="#666666" d="M1323.61,-594.34C1333.28,-594.56 1343.47,-594.78 1353.66,-595.01"/>
<polygon fill="#666666" stroke="#666666" points="1353.74,-598.51 1363.82,-595.23 1353.9,-591.51 1353.74,-598.51"/>
</g>
<!-- overlapped_write -->
<g id="node34" class="node">
<title>overlapped_write</title>
<path fill="none" stroke="#1c2123" d="M1604.5,-480.5C1604.5,-480.5 1745.5,-480.5 1745.5,-480.5 1751.5,-480.5 1757.5,-486.5 1757.5,-492.5 1757.5,-492.5 1757.5,-537.5 1757.5,-537.5 1757.5,-543.5 1751.5,-549.5 1745.5,-549.5 1745.5,-549.5 1604.5,-549.5 1604.5,-549.5 1598.5,-549.5 1592.5,-543.5 1592.5,-537.5 1592.5,-537.5 1592.5,-492.5 1592.5,-492.5 1592.5,-486.5 1598.5,-480.5 1604.5,-480.5"/>
<text text-anchor="start" x="1600.5" y="-534.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">OverlappedWrite</text>
<polyline fill="none" stroke="#1c2123" points="1592.5,-526.5 1757.5,-526.5 "/>
<text text-anchor="start" x="1600.5" y="-511.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub write: Write,</text>
<polyline fill="none" stroke="#1c2123" points="1592.5,-503.5 1757.5,-503.5 "/>
<text text-anchor="start" x="1600.5" y="-488.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub gc_fence: TimeStamp,</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;overlapped_write -->
<g id="edge56" class="edge">
<title>TxnCommitRecord__None&#45;&gt;overlapped_write</title>
<path fill="none" stroke="#666666" d="M1301.18,-573.89C1310.08,-569.2 1319.45,-564.06 1328,-559 1344.54,-549.2 1345.78,-541.16 1364,-535 1434.53,-511.14 1519.15,-507.2 1582.15,-508.63"/>
<polygon fill="#666666" stroke="#666666" points="1582.37,-512.14 1592.46,-508.92 1582.57,-505.14 1582.37,-512.14"/>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__Committed -->
<g id="edge31" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__Committed</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1323.61,-386.56C1337.67,-383.21 1352.81,-379.6 1367.45,-376.12"/>
<polygon fill="green" stroke="green" points="1368.56,-379.45 1377.47,-373.73 1366.94,-372.64 1368.56,-379.45"/>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge32" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1323.35,-420.06C1339.46,-425.15 1357,-430.68 1373.57,-435.92"/>
<polygon fill="green" stroke="green" points="1372.61,-439.28 1383.2,-438.96 1374.72,-432.61 1372.61,-439.28"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback&#45;&gt;SecondaryLockStatus__RolledBack -->
<g id="edge33" class="edge">
<title>TxnCommitRecord__OverlappedRollback&#45;&gt;SecondaryLockStatus__RolledBack</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1328.16,-482.92C1340.88,-480.17 1354.31,-477.27 1367.35,-474.45"/>
<polygon fill="green" stroke="green" points="1368.18,-477.85 1377.22,-472.32 1366.7,-471.01 1368.18,-477.85"/>
</g>
<!-- Write -->
<g id="node30" class="node">
<title>Write</title>
<path fill="none" stroke="#1c2123" d="M2236,-659C2236,-659 2431,-659 2431,-659 2437,-659 2443,-665 2443,-671 2443,-671 2443,-777 2443,-777 2443,-783 2437,-789 2431,-789 2431,-789 2236,-789 2236,-789 2230,-789 2224,-783 2224,-777 2224,-777 2224,-671 2224,-671 2224,-665 2230,-659 2236,-659"/>
<text text-anchor="start" x="2232" y="-773.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write</text>
<text text-anchor="start" x="2232" y="-758.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> pub write_type: WriteType,</text>
<polyline fill="none" stroke="#1c2123" points="2224,-751 2443,-751 "/>
<text text-anchor="start" x="2232" y="-735.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub start_ts: TimeStamp,</text>
<polyline fill="none" stroke="#1c2123" points="2224,-728 2443,-728 "/>
<text text-anchor="start" x="2232" y="-712.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub short_value: Option&lt;Value&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="2224,-705 2443,-705 "/>
<text text-anchor="start" x="2232" y="-689.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub has_overlapped_rollback: bool,</text>
<polyline fill="none" stroke="#1c2123" points="2224,-682 2443,-682 "/>
<text text-anchor="start" x="2232" y="-666.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">pub gc_fence: Option&lt;TimeStamp&gt;,</text>
</g>
<!-- Write__set_ovelapped_rollback&#45;&gt;Write -->
<g id="edge43" class="edge">
<title>Write__set_ovelapped_rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2015.67,-708.47C2066.47,-709.53 2130.75,-711.26 2188,-714 2196.3,-714.4 2204.87,-714.86 2213.5,-715.36"/>
<polygon fill="green" stroke="green" points="2213.45,-718.86 2223.65,-715.97 2213.87,-711.88 2213.45,-718.86"/>
</g>
<!-- WriteType__Rollback -->
<g id="node29" class="node">
<title>WriteType__Rollback</title>
<path fill="none" stroke="#1c2123" d="M2069,-723.5C2069,-723.5 2176,-723.5 2176,-723.5 2182,-723.5 2188,-729.5 2188,-735.5 2188,-735.5 2188,-772.5 2188,-772.5 2188,-778.5 2182,-784.5 2176,-784.5 2176,-784.5 2069,-784.5 2069,-784.5 2063,-784.5 2057,-778.5 2057,-772.5 2057,-772.5 2057,-735.5 2057,-735.5 2057,-729.5 2063,-723.5 2069,-723.5"/>
<text text-anchor="start" x="2065" y="-769.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteType</text>
<text text-anchor="start" x="2065" y="-754.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Rollback</text>
<polyline fill="none" stroke="#1c2123" points="2057,-746.5 2188,-746.5 "/>
<text text-anchor="start" x="2065" y="-731.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">write类型为rollback</text>
</g>
<!-- Write__new_rollback&#45;&gt;WriteType__Rollback -->
<g id="edge40" class="edge">
<title>Write__new_rollback&#45;&gt;WriteType__Rollback</title>
<path fill="none" stroke="#666666" d="M2021.01,-778.42C2029.78,-776.29 2038.56,-774.16 2047.09,-772.09"/>
<polygon fill="#666666" stroke="#666666" points="2048.07,-775.45 2056.96,-769.69 2046.41,-768.65 2048.07,-775.45"/>
</g>
<!-- Write__new_rollback&#45;&gt;Write -->
<g id="edge41" class="edge">
<title>Write__new_rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2021.24,-808.69C2071.68,-809.76 2133.89,-807.28 2188,-794 2196.75,-791.85 2205.59,-789.13 2214.36,-786.02"/>
<polygon fill="green" stroke="green" points="2215.69,-789.26 2223.85,-782.49 2213.25,-782.7 2215.69,-789.26"/>
</g>
<!-- WriteType__Rollback&#45;&gt;Write -->
<g id="edge42" class="edge">
<title>WriteType__Rollback&#45;&gt;Write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2188.2,-744.71C2196.47,-743.53 2205.14,-742.28 2213.94,-741.02"/>
<polygon fill="green" stroke="green" points="2214.52,-744.47 2223.92,-739.59 2213.53,-737.54 2214.52,-744.47"/>
</g>
<!-- Write&#45;&gt;MvccTxn__put_write -->
<g id="edge44" class="edge">
<title>Write&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2443.06,-761.97C2451.83,-765.04 2460.63,-768.12 2469.23,-771.13"/>
<polygon fill="green" stroke="green" points="2468.26,-774.49 2478.85,-774.49 2470.57,-767.89 2468.26,-774.49"/>
</g>
<!-- Write&#45;&gt;collapse_prev_rollback -->
<g id="edge45" class="edge">
<title>Write&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2396.91,-658.79C2442,-611.67 2500.48,-550.58 2532.97,-516.63"/>
<polygon fill="green" stroke="green" points="2535.88,-518.65 2540.27,-509.01 2530.82,-513.81 2535.88,-518.65"/>
</g>
<!-- Lock__rollback_ts__push&#45;&gt;MvccTxn__put_lock -->
<g id="edge55" class="edge">
<title>Lock__rollback_ts__push&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2001.77,-587.57C2017.18,-590.46 2033.3,-593.48 2048.54,-596.33"/>
<polygon fill="green" stroke="green" points="2047.94,-599.78 2058.41,-598.18 2049.23,-592.9 2047.94,-599.78"/>
</g>
<!-- released_lock&#45;&gt;ReleasedLocks__push -->
<g id="edge54" class="edge">
<title>released_lock&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1303.06,-324.91C1330.71,-311.74 1367.57,-294.18 1396.59,-280.35"/>
<polygon fill="green" stroke="green" points="1398.19,-283.46 1405.71,-276 1395.18,-277.15 1398.19,-283.46"/>
</g>
<!-- overlapped_write&#45;&gt;Write__set_ovelapped_rollback -->
<g id="edge57" class="edge">
<title>overlapped_write&#45;&gt;Write__set_ovelapped_rollback</title>
<path fill="none" stroke="#666666" d="M1737.56,-549.58C1754.76,-560.18 1773.08,-572.39 1789,-585 1806.74,-599.05 1808.53,-605.49 1825,-621 1839.37,-634.53 1855.28,-648.89 1869.99,-661.91"/>
<polygon fill="#666666" stroke="#666666" points="1867.74,-664.6 1877.56,-668.59 1872.37,-659.35 1867.74,-664.6"/>
</g>
<!-- overlapped_write&#45;&gt;Write -->
<g id="edge58" class="edge">
<title>overlapped_write&#45;&gt;Write</title>
<path fill="none" stroke="#666666" d="M1757.89,-503.89C1864.78,-493.6 2053.99,-490.14 2188,-570 2222.69,-590.67 2254.28,-622.07 2279.02,-651.13"/>
<polygon fill="#666666" stroke="#666666" points="2276.38,-653.44 2285.48,-658.86 2281.75,-648.94 2276.38,-653.44"/>
</g>
</g>
</svg>
