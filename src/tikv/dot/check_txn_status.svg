<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="2320pt" height="1182pt"
 viewBox="0.00 0.00 2320.00 1182.39" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1178.39)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1178.39 2316,-1178.39 2316,4 -4,4"/>
<!-- CheckTxnStatus__process_write -->
<g id="node1" class="node">
<title>CheckTxnStatus__process_write</title>
<path fill="none" stroke="#1c2123" d="M12,-358.89C12,-358.89 146,-358.89 146,-358.89 152,-358.89 158,-364.89 158,-370.89 158,-370.89 158,-407.89 158,-407.89 158,-413.89 152,-419.89 146,-419.89 146,-419.89 12,-419.89 12,-419.89 6,-419.89 0,-413.89 0,-407.89 0,-407.89 0,-370.89 0,-370.89 0,-364.89 6,-358.89 12,-358.89"/>
<text text-anchor="start" x="8" y="-404.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">CheckTxnStatus</text>
<text text-anchor="start" x="8" y="-389.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="0,-381.89 158,-381.89 "/>
<text text-anchor="start" x="8" y="-366.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">处理CheckTxnStatu命令</text>
</g>
<!-- ConcurrencyManager__update_max_ts -->
<g id="node2" class="node">
<title>ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#1c2123" d="M389,-399.39C389,-399.39 528,-399.39 528,-399.39 534,-399.39 540,-405.39 540,-411.39 540,-411.39 540,-463.39 540,-463.39 540,-469.39 534,-475.39 528,-475.39 528,-475.39 389,-475.39 389,-475.39 383,-475.39 377,-469.39 377,-463.39 377,-463.39 377,-411.39 377,-411.39 377,-405.39 383,-399.39 389,-399.39"/>
<text text-anchor="start" x="385" y="-460.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">ConcurrencyManager</text>
<polyline fill="none" stroke="#1c2123" points="377,-452.39 540,-452.39 "/>
<text text-anchor="start" x="385" y="-437.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">update_max_ts</text>
<text text-anchor="start" x="385" y="-422.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 如果caller_ts比max_ts大</text>
<text text-anchor="start" x="385" y="-407.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新max_ts</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge1" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="#666666" d="M158.22,-399.34C218.9,-407.05 303.11,-417.76 366.75,-425.85"/>
<polygon fill="#666666" stroke="#666666" points="366.42,-429.34 376.78,-427.13 367.3,-422.4 366.42,-429.34"/>
</g>
<!-- MvccTxn__new -->
<g id="node3" class="node">
<title>MvccTxn__new</title>
<path fill="none" stroke="#1c2123" d="M1563,-248.39C1563,-248.39 1609,-248.39 1609,-248.39 1615,-248.39 1621,-254.39 1621,-260.39 1621,-260.39 1621,-274.39 1621,-274.39 1621,-280.39 1615,-286.39 1609,-286.39 1609,-286.39 1563,-286.39 1563,-286.39 1557,-286.39 1551,-280.39 1551,-274.39 1551,-274.39 1551,-260.39 1551,-260.39 1551,-254.39 1557,-248.39 1563,-248.39"/>
<text text-anchor="start" x="1559" y="-271.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="1559" y="-256.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;MvccTxn__new -->
<g id="edge2" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;MvccTxn__new</title>
<path fill="none" stroke="#666666" d="M97.03,-358.79C116.38,-326.88 150.94,-277.78 194,-250.39 295.96,-185.55 336.66,-183.39 457.5,-183.39 457.5,-183.39 457.5,-183.39 671.5,-183.39 1006.82,-183.39 1408.49,-240.21 1540.55,-260.39"/>
<polygon fill="#666666" stroke="#666666" points="1540.26,-263.89 1550.68,-261.95 1541.33,-256.97 1540.26,-263.89"/>
</g>
<!-- SnapshotReader__new -->
<g id="node4" class="node">
<title>SnapshotReader__new</title>
<path fill="none" stroke="#1c2123" d="M227.5,-524.39C227.5,-524.39 307.5,-524.39 307.5,-524.39 313.5,-524.39 319.5,-530.39 319.5,-536.39 319.5,-536.39 319.5,-550.39 319.5,-550.39 319.5,-556.39 313.5,-562.39 307.5,-562.39 307.5,-562.39 227.5,-562.39 227.5,-562.39 221.5,-562.39 215.5,-556.39 215.5,-550.39 215.5,-550.39 215.5,-536.39 215.5,-536.39 215.5,-530.39 221.5,-524.39 227.5,-524.39"/>
<text text-anchor="start" x="223.5" y="-547.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="223.5" y="-532.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;SnapshotReader__new -->
<g id="edge3" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;SnapshotReader__new</title>
<path fill="none" stroke="#666666" d="M101.56,-420.04C122.46,-447.85 156.46,-488.38 194,-514.39 197.9,-517.1 202.1,-519.61 206.43,-521.92"/>
<polygon fill="#666666" stroke="#666666" points="204.94,-525.09 215.46,-526.4 208.05,-518.82 204.94,-525.09"/>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node5" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M418.5,-604.89C418.5,-604.89 498.5,-604.89 498.5,-604.89 504.5,-604.89 510.5,-610.89 510.5,-616.89 510.5,-616.89 510.5,-653.89 510.5,-653.89 510.5,-659.89 504.5,-665.89 498.5,-665.89 498.5,-665.89 418.5,-665.89 418.5,-665.89 412.5,-665.89 406.5,-659.89 406.5,-653.89 406.5,-653.89 406.5,-616.89 406.5,-616.89 406.5,-610.89 412.5,-604.89 418.5,-604.89"/>
<text text-anchor="start" x="414.5" y="-650.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="414.5" y="-635.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
<polyline fill="none" stroke="#1c2123" points="406.5,-627.89 510.5,-627.89 "/>
<text text-anchor="start" x="414.5" y="-612.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">读取lock</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;SnapshotReader__load_lock -->
<g id="edge4" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M83.22,-420.18C90.94,-476.25 116.08,-593.88 194,-644.39 254.15,-683.39 339.31,-671.31 396.37,-656.05"/>
<polygon fill="#666666" stroke="#666666" points="397.64,-659.33 406.34,-653.28 395.76,-652.58 397.64,-659.33"/>
</g>
<!-- check_txn_status_lock_exists -->
<g id="node6" class="node">
<title>check_txn_status_lock_exists</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M594,-346.89C594,-346.89 747,-346.89 747,-346.89 753,-346.89 759,-352.89 759,-358.89 759,-358.89 759,-463.89 759,-463.89 759,-469.89 753,-475.89 747,-475.89 747,-475.89 594,-475.89 594,-475.89 588,-475.89 582,-469.89 582,-463.89 582,-463.89 582,-358.89 582,-358.89 582,-352.89 588,-346.89 594,-346.89"/>
<text text-anchor="start" x="590" y="-460.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_txn_status_lock_exists</text>
<polyline fill="none" stroke="#8a8898" points="582,-452.89 759,-452.89 "/>
<text text-anchor="start" x="590" y="-437.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果Lock存在</text>
<text text-anchor="start" x="590" y="-422.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 且lock.ts是</text>
<text text-anchor="start" x="590" y="-407.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 传入的lock_ts</text>
<polyline fill="none" stroke="#8a8898" points="582,-399.89 759,-399.89 "/>
<text text-anchor="start" x="590" y="-384.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">check whether there&#39;s </text>
<text text-anchor="start" x="590" y="-369.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> an overlapped write record</text>
<text text-anchor="start" x="590" y="-354.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> and tehn perform rollback</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;check_txn_status_lock_exists -->
<g id="edge5" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="#666666" d="M158.3,-385.4C249.98,-381.64 406.31,-378.12 540,-389.39 550.33,-390.27 561.08,-391.52 571.77,-393"/>
<polygon fill="#666666" stroke="#666666" points="571.59,-396.51 581.98,-394.47 572.59,-389.58 571.59,-396.51"/>
</g>
<!-- check_txn_status_missing_lock -->
<g id="node7" class="node">
<title>check_txn_status_missing_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M588,-772.89C588,-772.89 753,-772.89 753,-772.89 759,-772.89 765,-778.89 765,-784.89 765,-784.89 765,-859.89 765,-859.89 765,-865.89 759,-871.89 753,-871.89 753,-871.89 588,-871.89 588,-871.89 582,-871.89 576,-865.89 576,-859.89 576,-859.89 576,-784.89 576,-784.89 576,-778.89 582,-772.89 588,-772.89"/>
<text text-anchor="start" x="584" y="-856.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_txn_status_missing_lock</text>
<polyline fill="none" stroke="#8a8898" points="576,-848.89 765,-848.89 "/>
<text text-anchor="start" x="584" y="-833.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果Lock不存在</text>
<text text-anchor="start" x="584" y="-818.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 或者lock.ts和lock_ts不match</text>
<polyline fill="none" stroke="#8a8898" points="576,-810.89 765,-810.89 "/>
<text text-anchor="start" x="584" y="-795.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">1. lock可能被提交了</text>
<text text-anchor="start" x="584" y="-780.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 2. lock被rollback了</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;check_txn_status_missing_lock -->
<g id="edge6" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="#666666" d="M83.8,-420.09C92.54,-477.68 119.42,-602.32 194,-671.39 296.81,-766.61 459.58,-801.78 565.46,-814.78"/>
<polygon fill="#666666" stroke="#666666" points="565.19,-818.27 575.53,-815.97 566.01,-811.32 565.19,-818.27"/>
</g>
<!-- ReleasedLocks__new -->
<g id="node8" class="node">
<title>ReleasedLocks__new</title>
<path fill="none" stroke="#1c2123" d="M421.5,-40.39C421.5,-40.39 495.5,-40.39 495.5,-40.39 501.5,-40.39 507.5,-46.39 507.5,-52.39 507.5,-52.39 507.5,-66.39 507.5,-66.39 507.5,-72.39 501.5,-78.39 495.5,-78.39 495.5,-78.39 421.5,-78.39 421.5,-78.39 415.5,-78.39 409.5,-72.39 409.5,-66.39 409.5,-66.39 409.5,-52.39 409.5,-52.39 409.5,-46.39 415.5,-40.39 421.5,-40.39"/>
<text text-anchor="start" x="417.5" y="-63.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="417.5" y="-48.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> new</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__new -->
<g id="edge7" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__new</title>
<path fill="none" stroke="#666666" d="M81.91,-358.75C87.5,-297.45 109.33,-159.89 194,-93.39 252.26,-47.64 341.13,-45.91 399.27,-50.98"/>
<polygon fill="#666666" stroke="#666666" points="399.11,-54.48 409.4,-51.96 399.78,-47.51 399.11,-54.48"/>
</g>
<!-- ReleasedLocks__push -->
<g id="node9" class="node">
<title>ReleasedLocks__push</title>
<path fill="none" stroke="#1c2123" d="M1297.5,-40.39C1297.5,-40.39 1371.5,-40.39 1371.5,-40.39 1377.5,-40.39 1383.5,-46.39 1383.5,-52.39 1383.5,-52.39 1383.5,-66.39 1383.5,-66.39 1383.5,-72.39 1377.5,-78.39 1371.5,-78.39 1371.5,-78.39 1297.5,-78.39 1297.5,-78.39 1291.5,-78.39 1285.5,-72.39 1285.5,-66.39 1285.5,-66.39 1285.5,-52.39 1285.5,-52.39 1285.5,-46.39 1291.5,-40.39 1297.5,-40.39"/>
<text text-anchor="start" x="1293.5" y="-63.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1293.5" y="-48.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> push</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__push -->
<g id="edge8" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="#666666" d="M80.04,-358.7C81.95,-290.38 96.92,-125.45 194,-45.39 285.1,29.73 339.42,-11.39 457.5,-11.39 457.5,-11.39 457.5,-11.39 886,-11.39 1026.41,-11.39 1190.19,-35.04 1275.35,-49.14"/>
<polygon fill="#666666" stroke="#666666" points="1274.9,-52.62 1285.34,-50.81 1276.05,-45.71 1274.9,-52.62"/>
</g>
<!-- ReleasedLocks__wakeup -->
<g id="node10" class="node">
<title>ReleasedLocks__wakeup</title>
<path fill="none" stroke="#1c2123" d="M2300,-170.39C2300,-170.39 2170,-170.39 2170,-170.39 2164,-170.39 2158,-164.39 2158,-158.39 2158,-158.39 2158,-146.39 2158,-146.39 2158,-140.39 2164,-134.39 2170,-134.39 2170,-134.39 2300,-134.39 2300,-134.39 2306,-134.39 2312,-140.39 2312,-146.39 2312,-146.39 2312,-158.39 2312,-158.39 2312,-164.39 2306,-170.39 2300,-170.39"/>
<text text-anchor="middle" x="2235" y="-148.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks__wakeup</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge9" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="#666666" d="M80.28,-420.17C83.34,-565.3 116.49,-1174.39 457.5,-1174.39 457.5,-1174.39 457.5,-1174.39 1821,-1174.39 1966.72,-1174.39 2038.24,-1163.64 2122,-1044.39 2223.22,-900.29 2233.02,-317.16 2233.92,-180.95"/>
<polygon fill="#666666" stroke="#666666" points="2237.42,-180.56 2233.98,-170.54 2230.42,-180.52 2237.42,-180.56"/>
</g>
<!-- TxnStatus__TtlExpire -->
<g id="node11" class="node">
<title>TxnStatus__TtlExpire</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1954,-95.39C1954,-95.39 2108,-95.39 2108,-95.39 2114,-95.39 2120,-101.39 2120,-107.39 2120,-107.39 2120,-197.39 2120,-197.39 2120,-203.39 2114,-209.39 2108,-209.39 2108,-209.39 1954,-209.39 1954,-209.39 1948,-209.39 1942,-203.39 1942,-197.39 1942,-197.39 1942,-107.39 1942,-107.39 1942,-101.39 1948,-95.39 1954,-95.39"/>
<text text-anchor="start" x="1950" y="-194.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1950" y="-179.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> TtlExpire</text>
<polyline fill="none" stroke="#8a8898" points="1942,-171.39 2120,-171.39 "/>
<text text-anchor="start" x="1950" y="-156.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">just rollback</text>
<text text-anchor="start" x="1950" y="-141.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> due to expiration</text>
<polyline fill="none" stroke="#8a8898" points="1942,-133.39 2120,-133.39 "/>
<text text-anchor="start" x="1950" y="-118.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">由于ttl过期</text>
<text text-anchor="start" x="1950" y="-103.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 在本次check时被rolback了</text>
</g>
<!-- CheckTxnStatus__process_write&#45;&gt;TxnStatus__TtlExpire -->
<g id="edge10" class="edge">
<title>CheckTxnStatus__process_write&#45;&gt;TxnStatus__TtlExpire</title>
<path fill="none" stroke="#666666" d="M88.97,-358.56C103.59,-313.79 136.8,-231.13 194,-185.39 289.39,-109.12 335.37,-107.39 457.5,-107.39 457.5,-107.39 457.5,-107.39 1587,-107.39 1705.91,-107.39 1841.86,-123.64 1931.45,-136.61"/>
<polygon fill="#666666" stroke="#666666" points="1931.19,-140.11 1941.59,-138.09 1932.21,-133.18 1931.19,-140.11"/>
</g>
<!-- MvccTxn__unlock_key -->
<g id="node27" class="node">
<title>MvccTxn__unlock_key</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1748,-254.39C1748,-254.39 1892,-254.39 1892,-254.39 1898,-254.39 1904,-260.39 1904,-266.39 1904,-266.39 1904,-364.39 1904,-364.39 1904,-370.39 1898,-376.39 1892,-376.39 1892,-376.39 1748,-376.39 1748,-376.39 1742,-376.39 1736,-370.39 1736,-364.39 1736,-364.39 1736,-266.39 1736,-266.39 1736,-260.39 1742,-254.39 1748,-254.39"/>
<text text-anchor="start" x="1744" y="-361.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1744" y="-346.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> UnlockKey</text>
<polyline fill="none" stroke="#8a8898" points="1736,-338.39 1904,-338.39 "/>
<text text-anchor="start" x="1744" y="-323.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">如果是悲观事务</text>
<polyline fill="none" stroke="#8a8898" points="1736,-315.39 1904,-315.39 "/>
<text text-anchor="start" x="1744" y="-300.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">且请求要求</text>
<text text-anchor="start" x="1744" y="-285.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolving_pessimistic_lock</text>
<polyline fill="none" stroke="#8a8898" points="1736,-277.39 1904,-277.39 "/>
<text text-anchor="middle" x="1820" y="-262.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> </text>
</g>
<!-- MvccTxn__new&#45;&gt;MvccTxn__unlock_key -->
<g id="edge49" class="edge">
<title>MvccTxn__new&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1621.23,-274.48C1648.89,-280.2 1689.15,-288.53 1726.15,-296.18"/>
<polygon fill="green" stroke="green" points="1725.47,-299.62 1735.97,-298.22 1726.89,-292.76 1725.47,-299.62"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node30" class="node">
<title>MvccTxn__put_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1779,-439.39C1779,-439.39 1861,-439.39 1861,-439.39 1867,-439.39 1873,-445.39 1873,-451.39 1873,-451.39 1873,-503.39 1873,-503.39 1873,-509.39 1867,-515.39 1861,-515.39 1861,-515.39 1779,-515.39 1779,-515.39 1773,-515.39 1767,-509.39 1767,-503.39 1767,-503.39 1767,-451.39 1767,-451.39 1767,-445.39 1773,-439.39 1779,-439.39"/>
<text text-anchor="start" x="1775" y="-500.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1775" y="-485.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<text text-anchor="start" x="1775" y="-470.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 写入更新后的</text>
<polyline fill="none" stroke="#8a8898" points="1767,-462.39 1873,-462.39 "/>
<text text-anchor="start" x="1775" y="-447.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">后的Lock</text>
</g>
<!-- MvccTxn__new&#45;&gt;MvccTxn__put_lock -->
<g id="edge50" class="edge">
<title>MvccTxn__new&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1608,-286.4C1644.18,-319.15 1719.2,-387.05 1769.33,-432.43"/>
<polygon fill="green" stroke="green" points="1767.08,-435.12 1776.84,-439.23 1771.78,-429.93 1767.08,-435.12"/>
</g>
<!-- SnapshotReader__new&#45;&gt;SnapshotReader__load_lock -->
<g id="edge12" class="edge">
<title>SnapshotReader__new&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M318.36,-562.45C326,-565.63 333.76,-569 341,-572.39 359.53,-581.07 379.25,-591.33 397.1,-601.02"/>
<polygon fill="green" stroke="green" points="395.8,-604.3 406.25,-606.03 399.16,-598.16 395.8,-604.3"/>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;check_txn_status_lock_exists -->
<g id="edge13" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;check_txn_status_lock_exists</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M488.26,-604.72C517.34,-573.7 563.35,-524.62 601.73,-483.68"/>
<polygon fill="green" stroke="green" points="604.52,-485.82 608.81,-476.13 599.41,-481.03 604.52,-485.82"/>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;check_txn_status_missing_lock -->
<g id="edge14" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M494.18,-666.27C524.52,-693.29 569.37,-733.23 606.11,-765.94"/>
<polygon fill="green" stroke="green" points="604.02,-768.77 613.81,-772.81 608.67,-763.54 604.02,-768.77"/>
</g>
<!-- mismatch_lock -->
<g id="node13" class="node">
<title>mismatch_lock</title>
<path fill="none" stroke="#1c2123" d="M825.5,-802.39C825.5,-802.39 944.5,-802.39 944.5,-802.39 950.5,-802.39 956.5,-808.39 956.5,-814.39 956.5,-814.39 956.5,-858.39 956.5,-858.39 956.5,-864.39 950.5,-870.39 944.5,-870.39 944.5,-870.39 825.5,-870.39 825.5,-870.39 819.5,-870.39 813.5,-864.39 813.5,-858.39 813.5,-858.39 813.5,-814.39 813.5,-814.39 813.5,-808.39 819.5,-802.39 825.5,-802.39"/>
<text text-anchor="start" x="821.5" y="-855.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">mismatch_lock</text>
<text text-anchor="start" x="821.5" y="-840.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> lock.ts != lock_ts</text>
<text text-anchor="start" x="821.5" y="-825.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> lock已经被其他事务</text>
<text text-anchor="start" x="821.5" y="-810.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 持有了</text>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;mismatch_lock -->
<g id="edge15" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;mismatch_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M510.65,-651.57C573.19,-672.5 681.07,-712.43 765,-763.39 782.8,-774.2 783.65,-781.87 801,-793.39 802.87,-794.63 804.77,-795.87 806.71,-797.09"/>
<polygon fill="green" stroke="green" points="805.01,-800.15 815.37,-802.36 808.65,-794.17 805.01,-800.15"/>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;MvccTxn__unlock_key -->
<g id="edge34" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M759.15,-400.35C845.64,-390.43 981.72,-377.39 1100,-377.39 1100,-377.39 1100,-377.39 1335.5,-377.39 1472.2,-377.39 1628.89,-352.71 1725.92,-334.49"/>
<polygon fill="#666666" stroke="#666666" points="1726.82,-337.88 1735.99,-332.58 1725.52,-331 1726.82,-337.88"/>
</g>
<!-- rollback_lock -->
<g id="node28" class="node">
<title>rollback_lock</title>
<path fill="none" stroke="#1c2123" d="M1050,-136.39C1050,-136.39 1152,-136.39 1152,-136.39 1158,-136.39 1164,-142.39 1164,-148.39 1164,-148.39 1164,-170.39 1164,-170.39 1164,-176.39 1158,-182.39 1152,-182.39 1152,-182.39 1050,-182.39 1050,-182.39 1044,-182.39 1038,-176.39 1038,-170.39 1038,-170.39 1038,-148.39 1038,-148.39 1038,-142.39 1044,-136.39 1050,-136.39"/>
<text text-anchor="start" x="1046" y="-167.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback_lock</text>
<polyline fill="none" stroke="#1c2123" points="1038,-159.39 1164,-159.39 "/>
<text text-anchor="start" x="1046" y="-144.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">清理掉primary key</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;rollback_lock -->
<g id="edge35" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M694.22,-346.7C714.54,-298.83 749.21,-236.28 801,-202.39 868.58,-158.17 963.07,-151.59 1027.62,-153.37"/>
<polygon fill="#666666" stroke="#666666" points="1027.6,-156.87 1037.72,-153.72 1027.85,-149.88 1027.6,-156.87"/>
</g>
<!-- Lock__min_commit_ts -->
<g id="node29" class="node">
<title>Lock__min_commit_ts</title>
<path fill="none" stroke="#1c2123" d="M815.5,-405.89C815.5,-405.89 954.5,-405.89 954.5,-405.89 960.5,-405.89 966.5,-411.89 966.5,-417.89 966.5,-417.89 966.5,-484.89 966.5,-484.89 966.5,-490.89 960.5,-496.89 954.5,-496.89 954.5,-496.89 815.5,-496.89 815.5,-496.89 809.5,-496.89 803.5,-490.89 803.5,-484.89 803.5,-484.89 803.5,-417.89 803.5,-417.89 803.5,-411.89 809.5,-405.89 815.5,-405.89"/>
<text text-anchor="start" x="811.5" y="-481.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">txn还持有该lock</text>
<text text-anchor="start" x="811.5" y="-466.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> lock没有过期</text>
<polyline fill="none" stroke="#1c2123" points="803.5,-458.89 966.5,-458.89 "/>
<text text-anchor="start" x="811.5" y="-443.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据caller_start_ts</text>
<text text-anchor="start" x="811.5" y="-428.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> current_ts</text>
<text text-anchor="start" x="811.5" y="-413.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新lock.min_commit_ts</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;Lock__min_commit_ts -->
<g id="edge36" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="#666666" d="M759.16,-427.89C770.48,-430.02 782.09,-432.21 793.45,-434.35"/>
<polygon fill="#666666" stroke="#666666" points="792.88,-437.8 803.36,-436.21 794.18,-430.92 792.88,-437.8"/>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;MvccTxn__put_lock -->
<g id="edge37" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="#666666" d="M744.69,-476.01C762.09,-488.15 781.34,-499.26 801,-506.39 926.17,-551.83 966.84,-525.39 1100,-525.39 1100,-525.39 1100,-525.39 1335.5,-525.39 1487.54,-525.39 1665.17,-501.6 1756.98,-487.52"/>
<polygon fill="#666666" stroke="#666666" points="1757.59,-490.96 1766.94,-485.98 1756.52,-484.05 1757.59,-490.96"/>
</g>
<!-- Lock__expired -->
<g id="node31" class="node">
<title>Lock__expired</title>
<path fill="none" stroke="#1c2123" d="M813,-211.89C813,-211.89 957,-211.89 957,-211.89 963,-211.89 969,-217.89 969,-223.89 969,-223.89 969,-336.89 969,-336.89 969,-342.89 963,-348.89 957,-348.89 957,-348.89 813,-348.89 813,-348.89 807,-348.89 801,-342.89 801,-336.89 801,-336.89 801,-223.89 801,-223.89 801,-217.89 807,-211.89 813,-211.89"/>
<text text-anchor="middle" x="885" y="-333.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock__expired</text>
<polyline fill="none" stroke="#1c2123" points="801,-325.89 969,-325.89 "/>
<text text-anchor="start" x="809" y="-310.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">txn还持有该lock</text>
<text text-anchor="start" x="809" y="-295.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 但lock已过期</text>
<polyline fill="none" stroke="#1c2123" points="801,-287.89 969,-287.89 "/>
<text text-anchor="start" x="809" y="-272.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock.ts.physical() </text>
<text text-anchor="start" x="809" y="-257.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> + lock.ttl &lt; </text>
<text text-anchor="start" x="809" y="-242.69" font-family="Times,serif" font-size="14.00" fill="#2f3638"> current_ts.physical</text>
<polyline fill="none" stroke="#1c2123" points="801,-234.89 969,-234.89 "/>
<text text-anchor="start" x="809" y="-219.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">lock过期了，需要清理掉</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;Lock__expired -->
<g id="edge38" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;Lock__expired</title>
<path fill="none" stroke="#666666" d="M759.16,-357.35C770.07,-350.63 781.26,-343.73 792.24,-336.96"/>
<polygon fill="#666666" stroke="#666666" points="794.31,-339.8 800.98,-331.57 790.63,-333.84 794.31,-339.8"/>
</g>
<!-- TxnStatus__Uncommitted -->
<g id="node32" class="node">
<title>TxnStatus__Uncommitted</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1992,-498.89C1992,-498.89 2070,-498.89 2070,-498.89 2076,-498.89 2082,-504.89 2082,-510.89 2082,-510.89 2082,-547.89 2082,-547.89 2082,-553.89 2076,-559.89 2070,-559.89 2070,-559.89 1992,-559.89 1992,-559.89 1986,-559.89 1980,-553.89 1980,-547.89 1980,-547.89 1980,-510.89 1980,-510.89 1980,-504.89 1986,-498.89 1992,-498.89"/>
<text text-anchor="start" x="1988" y="-544.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1988" y="-529.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Uncommitted</text>
<polyline fill="none" stroke="#8a8898" points="1980,-521.89 2082,-521.89 "/>
<text text-anchor="start" x="1988" y="-506.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务还没提交</text>
</g>
<!-- check_txn_status_lock_exists&#45;&gt;TxnStatus__Uncommitted -->
<g id="edge39" class="edge">
<title>check_txn_status_lock_exists&#45;&gt;TxnStatus__Uncommitted</title>
<path fill="none" stroke="#666666" d="M723.53,-476.15C745.05,-498.41 771.8,-521.07 801,-534.39 922.46,-589.83 966.49,-563.39 1100,-563.39 1100,-563.39 1100,-563.39 1587,-563.39 1724.31,-563.39 1884.87,-546.95 1969.94,-536.94"/>
<polygon fill="#666666" stroke="#666666" points="1970.42,-540.41 1979.94,-535.75 1969.59,-533.45 1970.42,-540.41"/>
</g>
<!-- SnapshotReader__get_txn_commit_record -->
<g id="node14" class="node">
<title>SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M821,-707.39C821,-707.39 949,-707.39 949,-707.39 955,-707.39 961,-713.39 961,-719.39 961,-719.39 961,-771.39 961,-771.39 961,-777.39 955,-783.39 949,-783.39 949,-783.39 821,-783.39 821,-783.39 815,-783.39 809,-777.39 809,-771.39 809,-771.39 809,-719.39 809,-719.39 809,-713.39 815,-707.39 821,-707.39"/>
<text text-anchor="start" x="817" y="-768.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="817" y="-753.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_txn_commit_record</text>
<polyline fill="none" stroke="#1c2123" points="809,-745.39 961,-745.39 "/>
<text text-anchor="start" x="817" y="-730.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">获取primary key 的</text>
<text text-anchor="start" x="817" y="-715.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> commit record</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge53" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M765.01,-788.51C776.5,-784.35 788.18,-780.11 799.52,-776.01"/>
<polygon fill="#666666" stroke="#666666" points="800.74,-779.29 808.95,-772.59 798.36,-772.7 800.74,-779.29"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node23" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M1645.5,-852.39C1645.5,-852.39 1526.5,-852.39 1526.5,-852.39 1520.5,-852.39 1514.5,-846.39 1514.5,-840.39 1514.5,-840.39 1514.5,-828.39 1514.5,-828.39 1514.5,-822.39 1520.5,-816.39 1526.5,-816.39 1526.5,-816.39 1645.5,-816.39 1645.5,-816.39 1651.5,-816.39 1657.5,-822.39 1657.5,-828.39 1657.5,-828.39 1657.5,-840.39 1657.5,-840.39 1657.5,-846.39 1651.5,-852.39 1645.5,-852.39"/>
<text text-anchor="middle" x="1586" y="-830.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;collapse_prev_rollback -->
<g id="edge54" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M765.07,-869.75C776.92,-874.11 789.08,-877.85 801,-880.39 939,-909.88 1299.03,-914.32 1436,-880.39 1453.56,-876.04 1455.07,-867.77 1472,-861.39 1482.37,-857.49 1493.48,-854.02 1504.56,-850.98"/>
<polygon fill="#666666" stroke="#666666" points="1505.48,-854.35 1514.25,-848.41 1503.69,-847.58 1505.48,-854.35"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="node24" class="node">
<title>MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#1c2123" d="M1484,-1039.39C1484,-1039.39 1688,-1039.39 1688,-1039.39 1694,-1039.39 1700,-1045.39 1700,-1051.39 1700,-1051.39 1700,-1095.39 1700,-1095.39 1700,-1101.39 1694,-1107.39 1688,-1107.39 1688,-1107.39 1484,-1107.39 1484,-1107.39 1478,-1107.39 1472,-1101.39 1472,-1095.39 1472,-1095.39 1472,-1051.39 1472,-1051.39 1472,-1045.39 1478,-1039.39 1484,-1039.39"/>
<text text-anchor="start" x="1480" y="-1092.19" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="1480" y="-1077.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mark_rollback_on_mismatching_lock</text>
<text text-anchor="start" x="1480" y="-1062.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 将start_ts加入到lock</text>
<text text-anchor="start" x="1480" y="-1047.19" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的rollback_ts数组中</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge55" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M745.89,-871.97C763.61,-882.92 782.7,-894.04 801,-903.39 983.85,-996.89 1030.92,-1030.79 1233,-1067.39 1308.08,-1080.99 1393.64,-1082.76 1461.61,-1080.99"/>
<polygon fill="#666666" stroke="#666666" points="1462.04,-1084.48 1471.94,-1080.69 1461.84,-1077.48 1462.04,-1084.48"/>
</g>
<!-- MvccTxn__put_write -->
<g id="node25" class="node">
<title>MvccTxn__put_write</title>
<path fill="none" stroke="#1c2123" d="M1875.5,-1146.39C1875.5,-1146.39 1764.5,-1146.39 1764.5,-1146.39 1758.5,-1146.39 1752.5,-1140.39 1752.5,-1134.39 1752.5,-1134.39 1752.5,-1122.39 1752.5,-1122.39 1752.5,-1116.39 1758.5,-1110.39 1764.5,-1110.39 1764.5,-1110.39 1875.5,-1110.39 1875.5,-1110.39 1881.5,-1110.39 1887.5,-1116.39 1887.5,-1122.39 1887.5,-1122.39 1887.5,-1134.39 1887.5,-1134.39 1887.5,-1140.39 1881.5,-1146.39 1875.5,-1146.39"/>
<text text-anchor="middle" x="1820" y="-1124.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn__put_write</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;MvccTxn__put_write -->
<g id="edge56" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M705.76,-872.15C771.22,-960.69 923.38,-1136.39 1100,-1136.39 1100,-1136.39 1100,-1136.39 1335.5,-1136.39 1479.07,-1136.39 1646.6,-1132.82 1742,-1130.45"/>
<polygon fill="#666666" stroke="#666666" points="1742.22,-1133.95 1752.13,-1130.2 1742.05,-1126.95 1742.22,-1133.95"/>
</g>
<!-- ReleasedLocks__new&#45;&gt;ReleasedLocks__push -->
<g id="edge31" class="edge">
<title>ReleasedLocks__new&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M507.73,-59.39C657.26,-59.39 1112.67,-59.39 1275.14,-59.39"/>
<polygon fill="green" stroke="green" points="1275.41,-62.89 1285.41,-59.39 1275.41,-55.89 1275.41,-62.89"/>
</g>
<!-- ReleasedLocks__push&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge32" class="edge">
<title>ReleasedLocks__push&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1383.8,-52.78C1508.93,-37.38 1852.66,-6.17 2122,-85.39 2151.94,-94.2 2182.08,-112.92 2203.54,-128.34"/>
<polygon fill="green" stroke="green" points="2201.48,-131.17 2211.6,-134.28 2205.62,-125.53 2201.48,-131.17"/>
</g>
<!-- TxnStatus__TtlExpire&#45;&gt;ReleasedLocks__wakeup -->
<g id="edge33" class="edge">
<title>TxnStatus__TtlExpire&#45;&gt;ReleasedLocks__wakeup</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2120.01,-152.39C2129.2,-152.39 2138.54,-152.39 2147.72,-152.39"/>
<polygon fill="green" stroke="green" points="2147.99,-155.89 2157.99,-152.39 2147.99,-148.89 2147.99,-155.89"/>
</g>
<!-- CheckTxnStatus__primary_key -->
<g id="node12" class="node">
<title>CheckTxnStatus__primary_key</title>
<path fill="#feed9b" stroke="#f7e495" d="M206,-581.89C206,-581.89 329,-581.89 329,-581.89 335,-581.89 341,-587.89 341,-593.89 341,-593.89 341,-622.89 341,-622.89 341,-628.89 335,-634.89 329,-634.89 329,-634.89 206,-634.89 206,-634.89 200,-634.89 194,-628.89 194,-622.89 194,-622.89 194,-593.89 194,-593.89 194,-587.89 200,-581.89 206,-581.89"/>
<text text-anchor="start" x="202" y="-619.69" font-family="Times,serif" font-size="14.00" fill="#40575d">CheckTxnStatus</text>
<text text-anchor="start" x="202" y="-604.69" font-family="Times,serif" font-size="14.00" fill="#40575d"> primary_key</text>
<text text-anchor="start" x="202" y="-589.69" font-family="Times,serif" font-size="14.00" fill="#40575d"> 请求中的primary_key</text>
</g>
<!-- CheckTxnStatus__primary_key&#45;&gt;SnapshotReader__load_lock -->
<g id="edge11" class="edge">
<title>CheckTxnStatus__primary_key&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M341.03,-618.76C359.22,-621.35 378.56,-624.12 396.14,-626.63"/>
<polygon fill="green" stroke="green" points="395.87,-630.13 406.27,-628.07 396.86,-623.2 395.87,-630.13"/>
</g>
<!-- mismatch_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge57" class="edge">
<title>mismatch_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M930.76,-870.53C994.18,-916.88 1115.61,-998.3 1233,-1036.39 1306.67,-1060.3 1393.14,-1069.64 1461.93,-1072.95"/>
<polygon fill="green" stroke="green" points="1461.8,-1076.45 1471.95,-1073.4 1462.11,-1069.46 1461.8,-1076.45"/>
</g>
<!-- TxnCommitRecord__SingleRecord -->
<g id="node15" class="node">
<title>TxnCommitRecord__SingleRecord</title>
<path fill="#f5b691" stroke="#d69043" d="M1271.5,-591.89C1271.5,-591.89 1397.5,-591.89 1397.5,-591.89 1403.5,-591.89 1409.5,-597.89 1409.5,-603.89 1409.5,-603.89 1409.5,-678.89 1409.5,-678.89 1409.5,-684.89 1403.5,-690.89 1397.5,-690.89 1397.5,-690.89 1271.5,-690.89 1271.5,-690.89 1265.5,-690.89 1259.5,-684.89 1259.5,-678.89 1259.5,-678.89 1259.5,-603.89 1259.5,-603.89 1259.5,-597.89 1265.5,-591.89 1271.5,-591.89"/>
<text text-anchor="start" x="1267.5" y="-675.69" font-family="Times,serif" font-size="14.00" fill="#6b6969">TxnCommitRecord</text>
<text text-anchor="start" x="1267.5" y="-660.69" font-family="Times,serif" font-size="14.00" fill="#6b6969"> SingleRecord</text>
<polyline fill="none" stroke="#d69043" points="1259.5,-652.89 1409.5,-652.89 "/>
<text text-anchor="start" x="1267.5" y="-637.69" font-family="Times,serif" font-size="14.00" fill="#6b6969">write.start_ts == start_ts</text>
<polyline fill="none" stroke="#d69043" points="1259.5,-629.89 1409.5,-629.89 "/>
<text text-anchor="start" x="1267.5" y="-614.69" font-family="Times,serif" font-size="14.00" fill="#6b6969">Found the transaction&#39;s</text>
<text text-anchor="start" x="1267.5" y="-599.69" font-family="Times,serif" font-size="14.00" fill="#6b6969"> write record</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord -->
<g id="edge16" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__SingleRecord</title>
<path fill="none" stroke="#666666" d="M961.15,-727.93C1040.82,-709.41 1166.34,-680.24 1249.29,-660.96"/>
<polygon fill="#666666" stroke="#666666" points="1250.24,-664.34 1259.19,-658.66 1248.66,-657.52 1250.24,-664.34"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback -->
<g id="node16" class="node">
<title>TxnCommitRecord__OverlappedRollback</title>
<path fill="#f5b691" stroke="#d69043" d="M1249.5,-710.39C1249.5,-710.39 1419.5,-710.39 1419.5,-710.39 1425.5,-710.39 1431.5,-716.39 1431.5,-722.39 1431.5,-722.39 1431.5,-858.39 1431.5,-858.39 1431.5,-864.39 1425.5,-870.39 1419.5,-870.39 1419.5,-870.39 1249.5,-870.39 1249.5,-870.39 1243.5,-870.39 1237.5,-864.39 1237.5,-858.39 1237.5,-858.39 1237.5,-722.39 1237.5,-722.39 1237.5,-716.39 1243.5,-710.39 1249.5,-710.39"/>
<text text-anchor="start" x="1245.5" y="-855.19" font-family="Times,serif" font-size="14.00" fill="#6b6969">TxnCommitRecord</text>
<text text-anchor="start" x="1245.5" y="-840.19" font-family="Times,serif" font-size="14.00" fill="#6b6969"> OverlappedRollback</text>
<polyline fill="none" stroke="#d69043" points="1237.5,-832.39 1431.5,-832.39 "/>
<text text-anchor="start" x="1245.5" y="-817.19" font-family="Times,serif" font-size="14.00" fill="#6b6969">1.commit_ts == start_ts</text>
<polyline fill="none" stroke="#d69043" points="1237.5,-809.39 1431.5,-809.39 "/>
<text text-anchor="start" x="1245.5" y="-794.19" font-family="Times,serif" font-size="14.00" fill="#6b6969">2.write.has_overlapped_rollback</text>
<polyline fill="none" stroke="#d69043" points="1237.5,-786.39 1431.5,-786.39 "/>
<text text-anchor="start" x="1245.5" y="-771.19" font-family="Times,serif" font-size="14.00" fill="#6b6969">在别的事务(t2)的write reocrds</text>
<text text-anchor="start" x="1245.5" y="-756.19" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 中的oerlapped_rollback找到</text>
<text text-anchor="start" x="1245.5" y="-741.19" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 了该事务(t1)</text>
<polyline fill="none" stroke="#d69043" points="1237.5,-733.39 1431.5,-733.39 "/>
<text text-anchor="start" x="1245.5" y="-718.19" font-family="Times,serif" font-size="14.00" fill="#6b6969">t1.start_ts == t2.commit_ts</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback -->
<g id="edge17" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="#666666" d="M961.03,-747.3C1024.17,-749.55 1116.76,-754.34 1197,-764.39 1206.78,-765.62 1216.92,-767.12 1227.06,-768.77"/>
<polygon fill="#666666" stroke="#666666" points="1226.73,-772.26 1237.17,-770.46 1227.89,-765.36 1226.73,-772.26"/>
</g>
<!-- TxnCommitRecord__None -->
<g id="node17" class="node">
<title>TxnCommitRecord__None</title>
<path fill="#f5b691" stroke="#d69043" d="M1245,-927.89C1245,-927.89 1424,-927.89 1424,-927.89 1430,-927.89 1436,-933.89 1436,-939.89 1436,-939.89 1436,-1014.89 1436,-1014.89 1436,-1020.89 1430,-1026.89 1424,-1026.89 1424,-1026.89 1245,-1026.89 1245,-1026.89 1239,-1026.89 1233,-1020.89 1233,-1014.89 1233,-1014.89 1233,-939.89 1233,-939.89 1233,-933.89 1239,-927.89 1245,-927.89"/>
<text text-anchor="start" x="1241" y="-1011.69" font-family="Times,serif" font-size="14.00" fill="#6b6969">TxnCommitRecord</text>
<text text-anchor="start" x="1241" y="-996.69" font-family="Times,serif" font-size="14.00" fill="#6b6969"> None</text>
<polyline fill="none" stroke="#d69043" points="1233,-988.89 1436,-988.89 "/>
<text text-anchor="start" x="1241" y="-973.69" font-family="Times,serif" font-size="14.00" fill="#6b6969">1.commit_ts == start_ts</text>
<text text-anchor="start" x="1241" y="-958.69" font-family="Times,serif" font-size="14.00" fill="#6b6969"> 2.!write.has_overlapped_rollback</text>
<polyline fill="none" stroke="#d69043" points="1233,-950.89 1436,-950.89 "/>
<text text-anchor="start" x="1241" y="-935.69" font-family="Times,serif" font-size="14.00" fill="#6b6969">没找t1的commit record</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None -->
<g id="edge18" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="#666666" d="M952.88,-783.43C958.37,-786.74 963.8,-790.09 969,-793.39 985.45,-803.83 988.18,-808.56 1005,-818.39 1075.65,-859.68 1158.62,-899.78 1223.5,-929.38"/>
<polygon fill="#666666" stroke="#666666" points="1222.39,-932.71 1232.94,-933.67 1225.28,-926.34 1222.39,-932.71"/>
</g>
<!-- Write__has_ovelapped_rollback -->
<g id="node18" class="node">
<title>Write__has_ovelapped_rollback</title>
<path fill="none" stroke="#1c2123" d="M1185,-809.39C1185,-809.39 1017,-809.39 1017,-809.39 1011,-809.39 1005,-803.39 1005,-797.39 1005,-797.39 1005,-785.39 1005,-785.39 1005,-779.39 1011,-773.39 1017,-773.39 1017,-773.39 1185,-773.39 1185,-773.39 1191,-773.39 1197,-779.39 1197,-785.39 1197,-785.39 1197,-797.39 1197,-797.39 1197,-803.39 1191,-809.39 1185,-809.39"/>
<text text-anchor="middle" x="1101" y="-787.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write__has_ovelapped_rollback</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;Write__has_ovelapped_rollback -->
<g id="edge19" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;Write__has_ovelapped_rollback</title>
<path fill="none" stroke="#666666" d="M961.15,-761.55C975.67,-764.67 991.05,-767.98 1006.09,-771.21"/>
<polygon fill="#666666" stroke="#666666" points="1005.39,-774.64 1015.9,-773.32 1006.86,-767.79 1005.39,-774.64"/>
</g>
<!-- TxnStatus__Committed -->
<g id="node19" class="node">
<title>TxnStatus__Committed</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1977.5,-610.89C1977.5,-610.89 2084.5,-610.89 2084.5,-610.89 2090.5,-610.89 2096.5,-616.89 2096.5,-622.89 2096.5,-622.89 2096.5,-659.89 2096.5,-659.89 2096.5,-665.89 2090.5,-671.89 2084.5,-671.89 2084.5,-671.89 1977.5,-671.89 1977.5,-671.89 1971.5,-671.89 1965.5,-665.89 1965.5,-659.89 1965.5,-659.89 1965.5,-622.89 1965.5,-622.89 1965.5,-616.89 1971.5,-610.89 1977.5,-610.89"/>
<text text-anchor="start" x="1973.5" y="-656.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1973.5" y="-641.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Committed</text>
<polyline fill="none" stroke="#8a8898" points="1965.5,-633.89 2096.5,-633.89 "/>
<text text-anchor="start" x="1973.5" y="-618.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务已经被提交了</text>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__Committed -->
<g id="edge22" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__Committed</title>
<path fill="none" stroke="#666666" d="M1409.82,-641.39C1543.17,-641.39 1821.57,-641.39 1955.24,-641.39"/>
<polygon fill="#666666" stroke="#666666" points="1955.38,-644.89 1965.38,-641.39 1955.38,-637.89 1955.38,-644.89"/>
</g>
<!-- TxnStatus__RolledBack -->
<g id="node20" class="node">
<title>TxnStatus__RolledBack</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1979.5,-714.39C1979.5,-714.39 2082.5,-714.39 2082.5,-714.39 2088.5,-714.39 2094.5,-720.39 2094.5,-726.39 2094.5,-726.39 2094.5,-816.39 2094.5,-816.39 2094.5,-822.39 2088.5,-828.39 2082.5,-828.39 2082.5,-828.39 1979.5,-828.39 1979.5,-828.39 1973.5,-828.39 1967.5,-822.39 1967.5,-816.39 1967.5,-816.39 1967.5,-726.39 1967.5,-726.39 1967.5,-720.39 1973.5,-714.39 1979.5,-714.39"/>
<text text-anchor="start" x="1975.5" y="-813.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1975.5" y="-798.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> RolledBack</text>
<polyline fill="none" stroke="#8a8898" points="1967.5,-790.39 2094.5,-790.39 "/>
<text text-anchor="start" x="1975.5" y="-775.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">The txn was already</text>
<text text-anchor="start" x="1975.5" y="-760.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> rollback before</text>
<polyline fill="none" stroke="#8a8898" points="1967.5,-752.39 2094.5,-752.39 "/>
<text text-anchor="start" x="1975.5" y="-737.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">事务之前就</text>
<text text-anchor="start" x="1975.5" y="-722.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 被rollback了</text>
</g>
<!-- TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__RolledBack -->
<g id="edge23" class="edge">
<title>TxnCommitRecord__SingleRecord&#45;&gt;TxnStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M1409.82,-655.31C1543.85,-680.39 1824.42,-732.91 1957.28,-757.78"/>
<polygon fill="#666666" stroke="#666666" points="1956.88,-761.27 1967.35,-759.67 1958.17,-754.39 1956.88,-761.27"/>
</g>
<!-- TxnCommitRecord__OverlappedRollback&#45;&gt;TxnStatus__RolledBack -->
<g id="edge24" class="edge">
<title>TxnCommitRecord__OverlappedRollback&#45;&gt;TxnStatus__RolledBack</title>
<path fill="none" stroke="#666666" d="M1431.7,-787.76C1572.25,-783.92 1830.66,-776.85 1956.82,-773.4"/>
<polygon fill="#666666" stroke="#666666" points="1957.24,-776.89 1967.15,-773.11 1957.05,-769.89 1957.24,-776.89"/>
</g>
<!-- ErrorInner__TxnNotFound -->
<g id="node21" class="node">
<title>ErrorInner__TxnNotFound</title>
<path fill="none" stroke="#1c2123" d="M1656,-906.39C1656,-906.39 1516,-906.39 1516,-906.39 1510,-906.39 1504,-900.39 1504,-894.39 1504,-894.39 1504,-882.39 1504,-882.39 1504,-876.39 1510,-870.39 1516,-870.39 1516,-870.39 1656,-870.39 1656,-870.39 1662,-870.39 1668,-876.39 1668,-882.39 1668,-882.39 1668,-894.39 1668,-894.39 1668,-900.39 1662,-906.39 1656,-906.39"/>
<text text-anchor="middle" x="1586" y="-884.69" font-family="Times,serif" font-size="14.00" fill="#2f3638">ErrorInner__TxnNotFound</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;ErrorInner__TxnNotFound -->
<g id="edge25" class="edge">
<title>TxnCommitRecord__None&#45;&gt;ErrorInner__TxnNotFound</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1436.35,-933.7C1448.29,-929 1460.36,-924.46 1472,-920.39 1483.05,-916.54 1494.83,-912.8 1506.46,-909.32"/>
<polygon fill="green" stroke="green" points="1507.56,-912.65 1516.17,-906.47 1505.59,-905.93 1507.56,-912.65"/>
</g>
<!-- TxnStatus__LockNotExistDoNothing -->
<g id="node22" class="node">
<title>TxnStatus__LockNotExistDoNothing</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1964.5,-943.89C1964.5,-943.89 2097.5,-943.89 2097.5,-943.89 2103.5,-943.89 2109.5,-949.89 2109.5,-955.89 2109.5,-955.89 2109.5,-1022.89 2109.5,-1022.89 2109.5,-1028.89 2103.5,-1034.89 2097.5,-1034.89 2097.5,-1034.89 1964.5,-1034.89 1964.5,-1034.89 1958.5,-1034.89 1952.5,-1028.89 1952.5,-1022.89 1952.5,-1022.89 1952.5,-955.89 1952.5,-955.89 1952.5,-949.89 1958.5,-943.89 1964.5,-943.89"/>
<text text-anchor="start" x="1960.5" y="-1019.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1960.5" y="-1004.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> LockNotExistDoNothing</text>
<polyline fill="none" stroke="#8a8898" points="1952.5,-996.89 2109.5,-996.89 "/>
<text text-anchor="start" x="1960.5" y="-981.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">the txn primary key</text>
<text text-anchor="start" x="1960.5" y="-966.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> is not found and nothing</text>
<text text-anchor="start" x="1960.5" y="-951.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> is done;</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExistDoNothing -->
<g id="edge26" class="edge">
<title>TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExistDoNothing</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1436.12,-979.13C1572.27,-981.48 1812.99,-985.64 1942.19,-987.88"/>
<polygon fill="green" stroke="green" points="1942.38,-991.38 1952.44,-988.05 1942.5,-984.38 1942.38,-991.38"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;collapse_prev_rollback -->
<g id="edge27" class="edge">
<title>TxnCommitRecord__None&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1419.21,-927.88C1425.11,-923.26 1430.78,-918.41 1436,-913.39 1456.26,-893.9 1448.8,-877.26 1472,-861.39 1481.82,-854.68 1493.11,-849.62 1504.68,-845.82"/>
<polygon fill="green" stroke="green" points="1505.85,-849.12 1514.43,-842.91 1503.85,-842.41 1505.85,-849.12"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge28" class="edge">
<title>TxnCommitRecord__None&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1436.26,-1016.16C1452.88,-1022.56 1470.09,-1029.18 1486.65,-1035.55"/>
<polygon fill="green" stroke="green" points="1485.73,-1038.95 1496.32,-1039.27 1488.24,-1032.41 1485.73,-1038.95"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;MvccTxn__put_write -->
<g id="edge29" class="edge">
<title>TxnCommitRecord__None&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1436.02,-987.23C1536.42,-997.81 1678.8,-1015.17 1700,-1030.39 1728.73,-1051.04 1709.12,-1078.39 1736,-1101.39 1738.34,-1103.4 1740.84,-1105.26 1743.44,-1106.97"/>
<polygon fill="green" stroke="green" points="1741.7,-1110.01 1752.1,-1112.01 1745.22,-1103.96 1741.7,-1110.01"/>
</g>
<!-- TxnStatus__LockNotExist -->
<g id="node26" class="node">
<title>TxnStatus__LockNotExist</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1982,-848.39C1982,-848.39 2080,-848.39 2080,-848.39 2086,-848.39 2092,-854.39 2092,-860.39 2092,-860.39 2092,-912.39 2092,-912.39 2092,-918.39 2086,-924.39 2080,-924.39 2080,-924.39 1982,-924.39 1982,-924.39 1976,-924.39 1970,-918.39 1970,-912.39 1970,-912.39 1970,-860.39 1970,-860.39 1970,-854.39 1976,-848.39 1982,-848.39"/>
<text text-anchor="start" x="1978" y="-909.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1978" y="-894.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> LockNotExist</text>
<polyline fill="none" stroke="#8a8898" points="1970,-886.39 2092,-886.39 "/>
<text text-anchor="start" x="1978" y="-871.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">由于lock不存在</text>
<text text-anchor="start" x="1978" y="-856.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 事务被rollback了</text>
</g>
<!-- TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExist -->
<g id="edge30" class="edge">
<title>TxnCommitRecord__None&#45;&gt;TxnStatus__LockNotExist</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1436.12,-964.21C1578.72,-945.53 1836.01,-911.81 1959.77,-895.6"/>
<polygon fill="green" stroke="green" points="1960.42,-899.04 1969.88,-894.27 1959.51,-892.1 1960.42,-899.04"/>
</g>
<!-- Write__has_ovelapped_rollback&#45;&gt;TxnCommitRecord__OverlappedRollback -->
<g id="edge20" class="edge">
<title>Write__has_ovelapped_rollback&#45;&gt;TxnCommitRecord__OverlappedRollback</title>
<path fill="none" stroke="#666666" d="M1197.16,-790.98C1206.97,-790.94 1216.99,-790.9 1226.91,-790.85"/>
<polygon fill="#666666" stroke="#666666" points="1227.23,-794.35 1237.21,-790.81 1227.2,-787.35 1227.23,-794.35"/>
</g>
<!-- Write__has_ovelapped_rollback&#45;&gt;TxnCommitRecord__None -->
<g id="edge21" class="edge">
<title>Write__has_ovelapped_rollback&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="#666666" d="M1152.32,-809.51C1167.52,-816.31 1183.7,-824.96 1197,-835.39 1217.16,-851.2 1215.75,-861.46 1233,-880.39 1245.26,-893.85 1258.98,-907.76 1272.24,-920.7"/>
<polygon fill="#666666" stroke="#666666" points="1269.93,-923.34 1279.55,-927.78 1274.8,-918.31 1269.93,-923.34"/>
</g>
<!-- MvccTxn__put_lock2 -->
<g id="node36" class="node">
<title>MvccTxn__put_lock2</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1760.5,-1008.89C1760.5,-1008.89 1879.5,-1008.89 1879.5,-1008.89 1885.5,-1008.89 1891.5,-1014.89 1891.5,-1020.89 1891.5,-1020.89 1891.5,-1079.89 1891.5,-1079.89 1891.5,-1085.89 1885.5,-1091.89 1879.5,-1091.89 1879.5,-1091.89 1760.5,-1091.89 1760.5,-1091.89 1754.5,-1091.89 1748.5,-1085.89 1748.5,-1079.89 1748.5,-1079.89 1748.5,-1020.89 1748.5,-1020.89 1748.5,-1014.89 1754.5,-1008.89 1760.5,-1008.89"/>
<text text-anchor="start" x="1756.5" y="-1076.69" font-family="Times,serif" font-size="14.00" fill="#5d6179">MvccTxn</text>
<text text-anchor="start" x="1756.5" y="-1061.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> put_lock</text>
<text text-anchor="start" x="1756.5" y="-1046.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 更新其他事务lock的</text>
<text text-anchor="start" x="1756.5" y="-1031.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> rollback_ts</text>
<text text-anchor="start" x="1756.5" y="-1016.69" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 字段</text>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock2 -->
<g id="edge58" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock2</title>
<path fill="none" stroke="#666666" d="M1700.28,-1062.16C1713.04,-1060.9 1725.85,-1059.63 1738.08,-1058.42"/>
<polygon fill="#666666" stroke="#666666" points="1738.59,-1061.88 1748.2,-1057.41 1737.9,-1054.92 1738.59,-1061.88"/>
</g>
<!-- TxnStatus__PessimisticRollback -->
<g id="node35" class="node">
<title>TxnStatus__PessimisticRollback</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1952,-258.39C1952,-258.39 2110,-258.39 2110,-258.39 2116,-258.39 2122,-264.39 2122,-270.39 2122,-270.39 2122,-360.39 2122,-360.39 2122,-366.39 2116,-372.39 2110,-372.39 2110,-372.39 1952,-372.39 1952,-372.39 1946,-372.39 1940,-366.39 1940,-360.39 1940,-360.39 1940,-270.39 1940,-270.39 1940,-264.39 1946,-258.39 1952,-258.39"/>
<text text-anchor="start" x="1948" y="-357.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<text text-anchor="start" x="1948" y="-342.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> PessimisticRollback</text>
<polyline fill="none" stroke="#8a8898" points="1940,-334.39 2122,-334.39 "/>
<text text-anchor="start" x="1948" y="-319.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">the primary key is </text>
<text text-anchor="start" x="1948" y="-304.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> pessimistically</text>
<text text-anchor="start" x="1948" y="-289.19" font-family="Times,serif" font-size="14.00" fill="#5d6179"> rolled back</text>
<polyline fill="none" stroke="#8a8898" points="1940,-281.39 2122,-281.39 "/>
<text text-anchor="start" x="1948" y="-266.19" font-family="Times,serif" font-size="14.00" fill="#5d6179">在本次check中被rollblack了</text>
</g>
<!-- MvccTxn__unlock_key&#45;&gt;TxnStatus__PessimisticRollback -->
<g id="edge51" class="edge">
<title>MvccTxn__unlock_key&#45;&gt;TxnStatus__PessimisticRollback</title>
<path fill="none" stroke="#666666" d="M1904.2,-315.39C1912.63,-315.39 1921.25,-315.39 1929.83,-315.39"/>
<polygon fill="#666666" stroke="#666666" points="1929.87,-318.89 1939.87,-315.39 1929.87,-311.89 1929.87,-318.89"/>
</g>
<!-- rollback_lock&#45;&gt;ReleasedLocks__push -->
<g id="edge48" class="edge">
<title>rollback_lock&#45;&gt;ReleasedLocks__push</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1155.4,-136.33C1192.82,-120.16 1242.64,-98.64 1280.07,-82.48"/>
<polygon fill="green" stroke="green" points="1281.51,-85.66 1289.3,-78.49 1278.73,-79.24 1281.51,-85.66"/>
</g>
<!-- rollback_lock&#45;&gt;TxnStatus__TtlExpire -->
<g id="edge47" class="edge">
<title>rollback_lock&#45;&gt;TxnStatus__TtlExpire</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1164.33,-158.92C1322.53,-157.73 1740.6,-154.58 1931.91,-153.13"/>
<polygon fill="green" stroke="green" points="1931.99,-156.63 1941.96,-153.06 1931.94,-149.63 1931.99,-156.63"/>
</g>
<!-- Lock__min_commit_ts&#45;&gt;MvccTxn__put_lock -->
<g id="edge44" class="edge">
<title>Lock__min_commit_ts&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M966.76,-453.64C1149.67,-458.74 1592.37,-471.08 1756.45,-475.65"/>
<polygon fill="green" stroke="green" points="1756.76,-479.16 1766.85,-475.94 1756.95,-472.16 1756.76,-479.16"/>
</g>
<!-- MvccTxn__put_lock&#45;&gt;TxnStatus__Uncommitted -->
<g id="edge52" class="edge">
<title>MvccTxn__put_lock&#45;&gt;TxnStatus__Uncommitted</title>
<path fill="none" stroke="#666666" d="M1873.2,-490.38C1902.53,-497.68 1939.26,-506.82 1969.8,-514.42"/>
<polygon fill="#666666" stroke="#666666" points="1969.35,-517.91 1979.9,-516.93 1971.04,-511.12 1969.35,-517.91"/>
</g>
<!-- Lock__expired&#45;&gt;MvccTxn__unlock_key -->
<g id="edge45" class="edge">
<title>Lock__expired&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M969.21,-283.52C1143.01,-290.04 1543.52,-305.06 1725.71,-311.89"/>
<polygon fill="green" stroke="green" points="1725.69,-315.4 1735.81,-312.27 1725.95,-308.4 1725.69,-315.4"/>
</g>
<!-- Lock__expired&#45;&gt;rollback_lock -->
<g id="edge46" class="edge">
<title>Lock__expired&#45;&gt;rollback_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M969.04,-233.44C996.44,-217.95 1026.05,-201.21 1050.17,-187.57"/>
<polygon fill="green" stroke="green" points="1052.15,-190.47 1059.13,-182.5 1048.7,-184.38 1052.15,-190.47"/>
</g>
<!-- CheckTxnStatus__current_ts -->
<g id="node33" class="node">
<title>CheckTxnStatus__current_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M212.5,-260.39C212.5,-260.39 322.5,-260.39 322.5,-260.39 328.5,-260.39 334.5,-266.39 334.5,-272.39 334.5,-272.39 334.5,-316.39 334.5,-316.39 334.5,-322.39 328.5,-328.39 322.5,-328.39 322.5,-328.39 212.5,-328.39 212.5,-328.39 206.5,-328.39 200.5,-322.39 200.5,-316.39 200.5,-316.39 200.5,-272.39 200.5,-272.39 200.5,-266.39 206.5,-260.39 212.5,-260.39"/>
<text text-anchor="start" x="208.5" y="-313.19" font-family="Times,serif" font-size="14.00" fill="#40575d">CheckTxnStatus</text>
<text text-anchor="start" x="208.5" y="-298.19" font-family="Times,serif" font-size="14.00" fill="#40575d"> current_ts</text>
<text text-anchor="start" x="208.5" y="-283.19" font-family="Times,serif" font-size="14.00" fill="#40575d"> 当前时间戳</text>
<text text-anchor="start" x="208.5" y="-268.19" font-family="Times,serif" font-size="14.00" fill="#40575d"> 用来判断是否过期</text>
</g>
<!-- CheckTxnStatus__current_ts&#45;&gt;Lock__min_commit_ts -->
<g id="edge40" class="edge">
<title>CheckTxnStatus__current_ts&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M334.77,-300.58C348.71,-301.86 363.34,-303.18 377,-304.39 463.2,-312.03 686.14,-301.76 765,-337.39 794.98,-350.94 822.04,-375.32 842.75,-398.07"/>
<polygon fill="green" stroke="green" points="840.27,-400.55 849.53,-405.7 845.51,-395.9 840.27,-400.55"/>
</g>
<!-- CheckTxnStatus__current_ts&#45;&gt;Lock__expired -->
<g id="edge42" class="edge">
<title>CheckTxnStatus__current_ts&#45;&gt;Lock__expired</title>
<path fill="none" stroke="#666666" d="M334.66,-292.89C444.51,-290.39 664.86,-285.38 790.54,-282.52"/>
<polygon fill="#666666" stroke="#666666" points="790.99,-286.01 800.91,-282.28 790.83,-279.01 790.99,-286.01"/>
</g>
<!-- CheckTxnStatus__caller_start_ts -->
<g id="node34" class="node">
<title>CheckTxnStatus__caller_start_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M214,-437.39C214,-437.39 321,-437.39 321,-437.39 327,-437.39 333,-443.39 333,-449.39 333,-449.39 333,-493.39 333,-493.39 333,-499.39 327,-505.39 321,-505.39 321,-505.39 214,-505.39 214,-505.39 208,-505.39 202,-499.39 202,-493.39 202,-493.39 202,-449.39 202,-449.39 202,-443.39 208,-437.39 214,-437.39"/>
<text text-anchor="start" x="210" y="-490.19" font-family="Times,serif" font-size="14.00" fill="#40575d">CheckTxnStatus</text>
<text text-anchor="start" x="210" y="-475.19" font-family="Times,serif" font-size="14.00" fill="#40575d"> caller_start_ts</text>
<text text-anchor="start" x="210" y="-460.19" font-family="Times,serif" font-size="14.00" fill="#40575d"> 会用于更新max_ts</text>
<text text-anchor="start" x="210" y="-445.19" font-family="Times,serif" font-size="14.00" fill="#40575d"> 和min_commit_ts</text>
</g>
<!-- CheckTxnStatus__caller_start_ts&#45;&gt;ConcurrencyManager__update_max_ts -->
<g id="edge43" class="edge">
<title>CheckTxnStatus__caller_start_ts&#45;&gt;ConcurrencyManager__update_max_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M333.01,-459.79C343.93,-457.82 355.45,-455.75 366.88,-453.7"/>
<polygon fill="green" stroke="green" points="367.68,-457.11 376.9,-451.89 366.44,-450.22 367.68,-457.11"/>
</g>
<!-- CheckTxnStatus__caller_start_ts&#45;&gt;Lock__min_commit_ts -->
<g id="edge41" class="edge">
<title>CheckTxnStatus__caller_start_ts&#45;&gt;Lock__min_commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M333.15,-480.06C428.27,-491.26 611.28,-506.92 765,-485.39 774.32,-484.09 783.93,-482.24 793.46,-480.06"/>
<polygon fill="green" stroke="green" points="794.45,-483.42 803.35,-477.68 792.81,-476.62 794.45,-483.42"/>
</g>
</g>
</svg>
