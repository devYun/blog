<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: create_resolver Pages: 1 -->
<svg width="1764pt" height="402pt"
 viewBox="0.00 0.00 1764.00 401.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 397.5)">
<title>create_resolver</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-397.5 1760,-397.5 1760,4 -4,4"/>
<!-- TiKVEngines_init -->
<g id="node1" class="node">
<title>TiKVEngines_init</title>
<path fill="none" stroke="#1c2123" d="M104,-205.5C104,-205.5 12,-205.5 12,-205.5 6,-205.5 0,-199.5 0,-193.5 0,-193.5 0,-181.5 0,-181.5 0,-175.5 6,-169.5 12,-169.5 12,-169.5 104,-169.5 104,-169.5 110,-169.5 116,-175.5 116,-181.5 116,-181.5 116,-193.5 116,-193.5 116,-199.5 110,-205.5 104,-205.5"/>
<text text-anchor="middle" x="58" y="-183.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">TiKVEngines_init</text>
</g>
<!-- WorkerBuilder_new_create -->
<g id="node2" class="node">
<title>WorkerBuilder_new_create</title>
<path fill="none" stroke="#1c2123" d="M164,-205C164,-205 346,-205 346,-205 352,-205 358,-211 358,-217 358,-217 358,-254 358,-254 358,-260 352,-266 346,-266 346,-266 164,-266 164,-266 158,-266 152,-260 152,-254 152,-254 152,-217 152,-217 152,-211 158,-205 164,-205"/>
<text text-anchor="start" x="160" y="-250.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">WorkerBuilder::new(&quot;backgroud&quot;)</text>
<text text-anchor="middle" x="255" y="-235.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .create()</text>
<polyline fill="none" stroke="#1c2123" points="152,-228 358,-228 "/>
<text text-anchor="start" x="160" y="-212.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建后台worker pool</text>
</g>
<!-- TiKVEngines_init&#45;&gt;WorkerBuilder_new_create -->
<g id="edge1" class="edge">
<title>TiKVEngines_init&#45;&gt;WorkerBuilder_new_create</title>
<path fill="none" stroke="#666666" d="M116.19,-201.58C124.35,-203.59 132.98,-205.71 141.76,-207.87"/>
<polygon fill="#666666" stroke="#666666" points="141.19,-211.34 151.74,-210.33 142.86,-204.54 141.19,-211.34"/>
</g>
<!-- resolve_new_resolver -->
<g id="node3" class="node">
<title>resolve_new_resolver</title>
<path fill="none" stroke="#1c2123" d="M917,-144.5C917,-144.5 1057,-144.5 1057,-144.5 1063,-144.5 1069,-150.5 1069,-156.5 1069,-156.5 1069,-238.5 1069,-238.5 1069,-244.5 1063,-250.5 1057,-250.5 1057,-250.5 917,-250.5 917,-250.5 911,-250.5 905,-244.5 905,-238.5 905,-238.5 905,-156.5 905,-156.5 905,-150.5 911,-144.5 917,-144.5"/>
<text text-anchor="middle" x="987" y="-235.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">resolve::new_resolver</text>
<polyline fill="none" stroke="#1c2123" points="905,-227.5 1069,-227.5 "/>
<text text-anchor="start" x="913" y="-212.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建PdStoreAddrResolver</text>
<text text-anchor="start" x="913" y="-197.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> backgroup worker 启动</text>
<text text-anchor="start" x="913" y="-182.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> add&#45;resolver runner</text>
<text text-anchor="start" x="913" y="-167.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并将scheduler放到</text>
<text text-anchor="start" x="913" y="-152.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> PdStoreAddrResolver</text>
</g>
<!-- TiKVEngines_init&#45;&gt;resolve_new_resolver -->
<g id="edge2" class="edge">
<title>TiKVEngines_init&#45;&gt;resolve_new_resolver</title>
<path fill="none" stroke="#666666" d="M116.44,-177.79C249.7,-156.91 589.81,-113.19 869,-158.5 877.52,-159.88 886.26,-161.8 894.94,-164.04"/>
<polygon fill="#666666" stroke="#666666" points="894.13,-167.45 904.7,-166.71 895.97,-160.7 894.13,-167.45"/>
</g>
<!-- YatpPoolBuilder_new -->
<g id="node4" class="node">
<title>YatpPoolBuilder_new</title>
<path fill="none" stroke="#1c2123" d="M406,-264.5C406,-264.5 547,-264.5 547,-264.5 553,-264.5 559,-270.5 559,-276.5 559,-276.5 559,-328.5 559,-328.5 559,-334.5 553,-340.5 547,-340.5 547,-340.5 406,-340.5 406,-340.5 400,-340.5 394,-334.5 394,-328.5 394,-328.5 394,-276.5 394,-276.5 394,-270.5 400,-264.5 406,-264.5"/>
<text text-anchor="middle" x="476.5" y="-325.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">YatpPoolBuilder_new</text>
<polyline fill="none" stroke="#1c2123" points="394,-317.5 559,-317.5 "/>
<text text-anchor="start" x="402" y="-302.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建YatpPool</text>
<text text-anchor="start" x="402" y="-287.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 线程数为config.server</text>
<text text-anchor="start" x="402" y="-272.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> .background_thread_count</text>
</g>
<!-- WorkerBuilder_new_create&#45;&gt;YatpPoolBuilder_new -->
<g id="edge3" class="edge">
<title>WorkerBuilder_new_create&#45;&gt;YatpPoolBuilder_new</title>
<path fill="none" stroke="#666666" d="M356.12,-266.06C365.51,-268.93 375.01,-271.83 384.32,-274.67"/>
<polygon fill="#666666" stroke="#666666" points="383.36,-278.03 393.94,-277.61 385.4,-271.34 383.36,-278.03"/>
</g>
<!-- Worker -->
<g id="node5" class="node">
<title>Worker</title>
<path fill="none" stroke="#1c2123" d="M607,-168.5C607,-168.5 857,-168.5 857,-168.5 863,-168.5 869,-174.5 869,-180.5 869,-180.5 869,-332.5 869,-332.5 869,-338.5 863,-344.5 857,-344.5 857,-344.5 607,-344.5 607,-344.5 601,-344.5 595,-338.5 595,-332.5 595,-332.5 595,-180.5 595,-180.5 595,-174.5 601,-168.5 607,-168.5"/>
<text text-anchor="middle" x="732" y="-329.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Worker</text>
<polyline fill="none" stroke="#1c2123" points="595,-321.5 869,-321.5 "/>
<text text-anchor="start" x="603" y="-306.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pool: Arc&lt;Mutex&lt;Option&lt;ThreadPool</text>
<text text-anchor="start" x="603" y="-291.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> &lt;yatp::task::future::TaskCell&gt;&gt;&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="595,-283.5 869,-283.5 "/>
<text text-anchor="start" x="603" y="-268.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">remote: Remote&lt;yatp::task::future::TaskCell&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="595,-260.5 869,-260.5 "/>
<text text-anchor="start" x="603" y="-245.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pending_capacity: usize,</text>
<polyline fill="none" stroke="#1c2123" points="595,-237.5 869,-237.5 "/>
<text text-anchor="start" x="603" y="-222.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">counter: Arc&lt;AtomicUsize&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="595,-214.5 869,-214.5 "/>
<text text-anchor="start" x="603" y="-199.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">stop: Arc&lt;AtomicBool&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="595,-191.5 869,-191.5 "/>
<text text-anchor="start" x="603" y="-176.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">thread_count: usize,</text>
</g>
<!-- WorkerBuilder_new_create&#45;&gt;Worker -->
<g id="edge4" class="edge">
<title>WorkerBuilder_new_create&#45;&gt;Worker</title>
<path fill="none" stroke="#666666" d="M358.19,-240.02C424.21,-242.94 511.15,-246.78 584.47,-250.02"/>
<polygon fill="#666666" stroke="#666666" points="584.58,-253.53 594.72,-250.48 584.89,-246.54 584.58,-253.53"/>
</g>
<!-- Worker_start -->
<g id="node6" class="node">
<title>Worker_start</title>
<path fill="none" stroke="#1c2123" d="M1169,-226C1169,-226 1308,-226 1308,-226 1314,-226 1320,-232 1320,-238 1320,-238 1320,-381 1320,-381 1320,-387 1314,-393 1308,-393 1308,-393 1169,-393 1169,-393 1163,-393 1157,-387 1157,-381 1157,-381 1157,-238 1157,-238 1157,-232 1163,-226 1169,-226"/>
<text text-anchor="middle" x="1238.5" y="-377.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Worker_start</text>
<polyline fill="none" stroke="#1c2123" points="1157,-370 1320,-370 "/>
<text text-anchor="start" x="1165" y="-354.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">start(addr&#45;resolver, runner)</text>
<polyline fill="none" stroke="#1c2123" points="1157,-347 1320,-347 "/>
<text text-anchor="start" x="1165" y="-331.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">创建一个channel</text>
<text text-anchor="start" x="1165" y="-316.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从channel中Poll task</text>
<text text-anchor="start" x="1165" y="-301.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用Runner.run(task)</text>
<text text-anchor="start" x="1165" y="-286.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 处理task</text>
<polyline fill="none" stroke="#1c2123" points="1157,-279 1320,-279 "/>
<text text-anchor="start" x="1165" y="-263.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">返回一个scheduler</text>
<text text-anchor="start" x="1165" y="-248.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 用于向该channel</text>
<text text-anchor="start" x="1165" y="-233.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送task</text>
</g>
<!-- resolve_new_resolver&#45;&gt;Worker_start -->
<g id="edge7" class="edge">
<title>resolve_new_resolver&#45;&gt;Worker_start</title>
<path fill="none" stroke="#666666" d="M1069.01,-233.86C1094.1,-245.13 1121.89,-257.6 1147.55,-269.12"/>
<polygon fill="#666666" stroke="#666666" points="1146.34,-272.42 1156.9,-273.32 1149.21,-266.03 1146.34,-272.42"/>
</g>
<!-- PdStoreAddrResolver_new -->
<g id="node7" class="node">
<title>PdStoreAddrResolver_new</title>
<path fill="none" stroke="#1c2123" d="M1744,-241.5C1744,-241.5 1604,-241.5 1604,-241.5 1598,-241.5 1592,-235.5 1592,-229.5 1592,-229.5 1592,-217.5 1592,-217.5 1592,-211.5 1598,-205.5 1604,-205.5 1604,-205.5 1744,-205.5 1744,-205.5 1750,-205.5 1756,-211.5 1756,-217.5 1756,-217.5 1756,-229.5 1756,-229.5 1756,-235.5 1750,-241.5 1744,-241.5"/>
<text text-anchor="middle" x="1674" y="-219.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">PdStoreAddrResolver_new</text>
</g>
<!-- resolve_new_resolver&#45;&gt;PdStoreAddrResolver_new -->
<g id="edge8" class="edge">
<title>resolve_new_resolver&#45;&gt;PdStoreAddrResolver_new</title>
<path fill="none" stroke="#666666" d="M1069.27,-200.58C1197.76,-205.46 1447,-214.92 1581.56,-220.03"/>
<polygon fill="#666666" stroke="#666666" points="1581.71,-223.54 1591.84,-220.42 1581.98,-216.54 1581.71,-223.54"/>
</g>
<!-- Runner -->
<g id="node8" class="node">
<title>Runner</title>
<path fill="none" stroke="#1c2123" d="M1117,-0.5C1117,-0.5 1360,-0.5 1360,-0.5 1366,-0.5 1372,-6.5 1372,-12.5 1372,-12.5 1372,-156.5 1372,-156.5 1372,-162.5 1366,-168.5 1360,-168.5 1360,-168.5 1117,-168.5 1117,-168.5 1111,-168.5 1105,-162.5 1105,-156.5 1105,-156.5 1105,-12.5 1105,-12.5 1105,-6.5 1111,-0.5 1117,-0.5"/>
<text text-anchor="middle" x="1238.5" y="-153.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Runner</text>
<polyline fill="none" stroke="#1c2123" points="1105,-145.5 1372,-145.5 "/>
<text text-anchor="start" x="1113" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">pd_client: Arc&lt;T&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1105,-122.5 1372,-122.5 "/>
<text text-anchor="start" x="1113" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">store_addrs: HashMap&lt;u64, StoreAddr&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1105,-99.5 1372,-99.5 "/>
<text text-anchor="start" x="1113" y="-84.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">state: Arc&lt;Mutex&lt;GlobalReplicationState&gt;&gt;,</text>
<polyline fill="none" stroke="#1c2123" points="1105,-76.5 1372,-76.5 "/>
<text text-anchor="start" x="1113" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">router: RR,</text>
<polyline fill="none" stroke="#1c2123" points="1105,-53.5 1372,-53.5 "/>
<text text-anchor="start" x="1113" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用pd_server</text>
<text text-anchor="start" x="1113" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取store的addr</text>
<text text-anchor="start" x="1113" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 中间加了一道缓存</text>
</g>
<!-- resolve_new_resolver&#45;&gt;Runner -->
<g id="edge9" class="edge">
<title>resolve_new_resolver&#45;&gt;Runner</title>
<path fill="none" stroke="#666666" d="M1069.01,-160.81C1077.65,-156.9 1086.61,-152.84 1095.7,-148.72"/>
<polygon fill="#666666" stroke="#666666" points="1097.16,-151.9 1104.82,-144.59 1094.27,-145.53 1097.16,-151.9"/>
</g>
<!-- YatpPoolBuilder_new&#45;&gt;Worker -->
<g id="edge6" class="edge">
<title>YatpPoolBuilder_new&#45;&gt;Worker:pool</title>
<path fill="none" stroke="#666666" d="M559.04,-302.5C567.61,-302.5 576.29,-302.5 584.78,-302.5"/>
<polygon fill="#666666" stroke="#666666" points="585,-306 595,-302.5 585,-299 585,-306"/>
</g>
<!-- Worker&#45;&gt;resolve_new_resolver -->
<g id="edge5" class="edge">
<title>Worker&#45;&gt;resolve_new_resolver</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M869.13,-224.75C877.87,-222.72 886.55,-220.69 895,-218.72"/>
<polygon fill="green" stroke="green" points="895.86,-222.11 904.81,-216.43 894.27,-215.3 895.86,-222.11"/>
</g>
<!-- scheduler -->
<g id="node9" class="node">
<title>scheduler</title>
<path fill="none" stroke="#1c2123" d="M1420,-256.5C1420,-256.5 1544,-256.5 1544,-256.5 1550,-256.5 1556,-262.5 1556,-268.5 1556,-268.5 1556,-290.5 1556,-290.5 1556,-296.5 1550,-302.5 1544,-302.5 1544,-302.5 1420,-302.5 1420,-302.5 1414,-302.5 1408,-296.5 1408,-290.5 1408,-290.5 1408,-268.5 1408,-268.5 1408,-262.5 1414,-256.5 1420,-256.5"/>
<text text-anchor="middle" x="1482" y="-287.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">scheduler</text>
<polyline fill="none" stroke="#1c2123" points="1408,-279.5 1556,-279.5 "/>
<text text-anchor="start" x="1416" y="-264.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">用于向worker发送task</text>
</g>
<!-- Worker_start&#45;&gt;scheduler -->
<g id="edge10" class="edge">
<title>Worker_start&#45;&gt;scheduler</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1320.25,-299.47C1345.08,-296.38 1372.45,-292.98 1397.46,-289.88"/>
<polygon fill="green" stroke="green" points="1398.15,-293.32 1407.65,-288.61 1397.29,-286.37 1398.15,-293.32"/>
</g>
<!-- scheduler&#45;&gt;PdStoreAddrResolver_new -->
<g id="edge11" class="edge">
<title>scheduler&#45;&gt;PdStoreAddrResolver_new</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1556.19,-257.93C1571.28,-253.48 1587.15,-248.8 1602.16,-244.38"/>
<polygon fill="green" stroke="green" points="1603.28,-247.7 1611.88,-241.51 1601.3,-240.98 1603.28,-247.7"/>
</g>
</g>
</svg>
