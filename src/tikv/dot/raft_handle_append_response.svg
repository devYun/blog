<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: raft_handle_append_response Pages: 1 -->
<svg width="1015pt" height="529pt"
 viewBox="0.00 0.00 1015.00 529.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 525)">
<title>raft_handle_append_response</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-525 1011,-525 1011,4 -4,4"/>
<!-- RaftCore__handle_append_response -->
<g id="node1" class="node">
<title>RaftCore__handle_append_response</title>
<path fill="none" stroke="#1c2123" d="M203,-322C203,-322 12,-322 12,-322 6,-322 0,-316 0,-310 0,-310 0,-298 0,-298 0,-292 6,-286 12,-286 12,-286 203,-286 203,-286 209,-286 215,-292 215,-298 215,-298 215,-310 215,-310 215,-316 209,-322 203,-322"/>
<text text-anchor="middle" x="107.5" y="-300.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__handle_append_response</text>
</g>
<!-- Progress__update_committed -->
<g id="node2" class="node">
<title>Progress__update_committed</title>
<path fill="none" stroke="#1c2123" d="M427.5,-521C427.5,-521 272.5,-521 272.5,-521 266.5,-521 260.5,-515 260.5,-509 260.5,-509 260.5,-497 260.5,-497 260.5,-491 266.5,-485 272.5,-485 272.5,-485 427.5,-485 427.5,-485 433.5,-485 439.5,-491 439.5,-497 439.5,-497 439.5,-509 439.5,-509 439.5,-515 433.5,-521 427.5,-521"/>
<text text-anchor="middle" x="350" y="-499.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__update_committed</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;Progress__update_committed -->
<g id="edge1" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;Progress__update_committed</title>
<path fill="none" stroke="#666666" d="M202.5,-322.01C207.02,-324.88 211.24,-328.19 215,-332 261.36,-378.93 204.91,-428.8 251,-476 251.8,-476.82 252.63,-477.62 253.47,-478.39"/>
<polygon fill="#666666" stroke="#666666" points="251.55,-481.33 261.59,-484.73 255.86,-475.82 251.55,-481.33"/>
</g>
<!-- Progress__maybe_decr_to -->
<g id="node3" class="node">
<title>Progress__maybe_decr_to</title>
<path fill="none" stroke="#1c2123" d="M281.5,-405.5C281.5,-405.5 418.5,-405.5 418.5,-405.5 424.5,-405.5 430.5,-411.5 430.5,-417.5 430.5,-417.5 430.5,-454.5 430.5,-454.5 430.5,-460.5 424.5,-466.5 418.5,-466.5 418.5,-466.5 281.5,-466.5 281.5,-466.5 275.5,-466.5 269.5,-460.5 269.5,-454.5 269.5,-454.5 269.5,-417.5 269.5,-417.5 269.5,-411.5 275.5,-405.5 281.5,-405.5"/>
<text text-anchor="middle" x="350" y="-451.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__maybe_decr_to</text>
<polyline fill="none" stroke="#1c2123" points="269.5,-443.5 430.5,-443.5 "/>
<text text-anchor="start" x="277.5" y="-428.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">重新调整发送给</text>
<text text-anchor="start" x="277.5" y="-413.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> follower的next_idx</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;Progress__maybe_decr_to -->
<g id="edge2" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;Progress__maybe_decr_to</title>
<path fill="none" stroke="#666666" d="M198.36,-322.02C204.25,-324.87 209.86,-328.18 215,-332 239.64,-350.35 228.04,-370.59 251,-391 254.57,-394.18 258.41,-397.17 262.42,-399.98"/>
<polygon fill="#666666" stroke="#666666" points="260.57,-402.95 270.86,-405.49 264.4,-397.09 260.57,-402.95"/>
</g>
<!-- RaftCore__send_append -->
<g id="node4" class="node">
<title>RaftCore__send_append</title>
<path fill="none" stroke="#1c2123" d="M935,-338C935,-338 809,-338 809,-338 803,-338 797,-332 797,-326 797,-326 797,-314 797,-314 797,-308 803,-302 809,-302 809,-302 935,-302 935,-302 941,-302 947,-308 947,-314 947,-314 947,-326 947,-326 947,-332 941,-338 935,-338"/>
<text text-anchor="middle" x="872" y="-316.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send_append</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__send_append -->
<g id="edge3" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__send_append</title>
<path fill="none" stroke="#666666" d="M191.52,-322.08C306.21,-344.66 519.54,-378.03 701,-358 732.6,-354.51 766.91,-347.48 796.38,-340.41"/>
<polygon fill="#666666" stroke="#666666" points="797.29,-343.78 806.18,-338.01 795.63,-336.99 797.29,-343.78"/>
</g>
<!-- Progress__maybe_update -->
<g id="node5" class="node">
<title>Progress__maybe_update</title>
<path fill="none" stroke="#1c2123" d="M270,-108.5C270,-108.5 430,-108.5 430,-108.5 436,-108.5 442,-114.5 442,-120.5 442,-120.5 442,-157.5 442,-157.5 442,-163.5 436,-169.5 430,-169.5 430,-169.5 270,-169.5 270,-169.5 264,-169.5 258,-163.5 258,-157.5 258,-157.5 258,-120.5 258,-120.5 258,-114.5 264,-108.5 270,-108.5"/>
<text text-anchor="middle" x="350" y="-154.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__maybe_update</text>
<polyline fill="none" stroke="#1c2123" points="258,-146.5 442,-146.5 "/>
<text text-anchor="start" x="266" y="-131.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用AppendRespMsg的index</text>
<text text-anchor="start" x="266" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 更新Progress__matched</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;Progress__maybe_update -->
<g id="edge4" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;Progress__maybe_update</title>
<path fill="none" stroke="#666666" d="M125.47,-285.94C150.78,-259.81 200.87,-211.16 251,-180 254.16,-178.03 257.43,-176.12 260.78,-174.27"/>
<polygon fill="#666666" stroke="#666666" points="262.58,-177.28 269.79,-169.51 259.31,-171.09 262.58,-177.28"/>
</g>
<!-- RaftCore__maybe_commit -->
<g id="node6" class="node">
<title>RaftCore__maybe_commit</title>
<path fill="none" stroke="#1c2123" d="M271,-254C271,-254 429,-254 429,-254 435,-254 441,-260 441,-266 441,-266 441,-288 441,-288 441,-294 435,-300 429,-300 429,-300 271,-300 271,-300 265,-300 259,-294 259,-288 259,-288 259,-266 259,-266 259,-260 265,-254 271,-254"/>
<text text-anchor="middle" x="350" y="-284.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__maybe_commit</text>
<polyline fill="none" stroke="#1c2123" points="259,-277 441,-277 "/>
<text text-anchor="start" x="267" y="-261.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">计算可以commit的log index</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_commit -->
<g id="edge5" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__maybe_commit</title>
<path fill="none" stroke="#666666" d="M215.04,-292.04C226.2,-290.79 237.51,-289.52 248.6,-288.27"/>
<polygon fill="#666666" stroke="#666666" points="249.16,-291.73 258.71,-287.14 248.38,-284.77 249.16,-291.73"/>
</g>
<!-- RaftCore__should_bcast_commit -->
<g id="node7" class="node">
<title>RaftCore__should_bcast_commit</title>
<path fill="none" stroke="#1c2123" d="M681,-349C681,-349 505,-349 505,-349 499,-349 493,-343 493,-337 493,-337 493,-325 493,-325 493,-319 499,-313 505,-313 505,-313 681,-313 681,-313 687,-313 693,-319 693,-325 693,-325 693,-337 693,-337 693,-343 687,-349 681,-349"/>
<text text-anchor="middle" x="593" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__should_bcast_commit</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__should_bcast_commit -->
<g id="edge6" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__should_bcast_commit</title>
<path fill="none" stroke="#666666" d="M215.2,-309.96C294.68,-314.4 402.82,-320.44 482.87,-324.91"/>
<polygon fill="#666666" stroke="#666666" points="482.8,-328.41 492.98,-325.47 483.19,-321.42 482.8,-328.41"/>
</g>
<!-- RraftCore__maybe_send_append -->
<g id="node8" class="node">
<title>RraftCore__maybe_send_append</title>
<path fill="none" stroke="#1c2123" d="M437,-90C437,-90 263,-90 263,-90 257,-90 251,-84 251,-78 251,-78 251,-66 251,-66 251,-60 257,-54 263,-54 263,-54 437,-54 437,-54 443,-54 449,-60 449,-66 449,-66 449,-78 449,-78 449,-84 443,-90 437,-90"/>
<text text-anchor="middle" x="350" y="-68.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RraftCore__maybe_send_append</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RraftCore__maybe_send_append -->
<g id="edge7" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RraftCore__maybe_send_append</title>
<path fill="none" stroke="#666666" d="M115.95,-285.75C133.31,-245.55 180.43,-148.97 251,-99 253.08,-97.53 255.24,-96.14 257.45,-94.82"/>
<polygon fill="#666666" stroke="#666666" points="259.11,-97.9 266.29,-90.11 255.81,-91.73 259.11,-97.9"/>
</g>
<!-- RaftCore__send_timeout_now -->
<g id="node9" class="node">
<title>RaftCore__send_timeout_now</title>
<path fill="none" stroke="#1c2123" d="M429.5,-36C429.5,-36 270.5,-36 270.5,-36 264.5,-36 258.5,-30 258.5,-24 258.5,-24 258.5,-12 258.5,-12 258.5,-6 264.5,0 270.5,0 270.5,0 429.5,0 429.5,0 435.5,0 441.5,-6 441.5,-12 441.5,-12 441.5,-24 441.5,-24 441.5,-30 435.5,-36 429.5,-36"/>
<text text-anchor="middle" x="350" y="-14.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__send_timeout_now</text>
</g>
<!-- RaftCore__handle_append_response&#45;&gt;RaftCore__send_timeout_now -->
<g id="edge8" class="edge">
<title>RaftCore__handle_append_response&#45;&gt;RaftCore__send_timeout_now</title>
<path fill="none" stroke="#666666" d="M113.19,-285.72C126.31,-238.3 168.02,-110.51 251,-45 252.61,-43.73 254.28,-42.52 255.99,-41.36"/>
<polygon fill="#666666" stroke="#666666" points="258.11,-44.17 264.91,-36.05 254.53,-38.16 258.11,-44.17"/>
</g>
<!-- Progress__next_idx -->
<g id="node15" class="node">
<title>Progress__next_idx</title>
<path fill="none" stroke="#1c2123" d="M643,-454C643,-454 543,-454 543,-454 537,-454 531,-448 531,-442 531,-442 531,-430 531,-430 531,-424 537,-418 543,-418 543,-418 643,-418 643,-418 649,-418 655,-424 655,-430 655,-430 655,-442 655,-442 655,-448 649,-454 643,-454"/>
<text text-anchor="middle" x="593" y="-432.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Progress__next_idx</text>
</g>
<!-- Progress__maybe_decr_to&#45;&gt;Progress__next_idx -->
<g id="edge17" class="edge">
<title>Progress__maybe_decr_to&#45;&gt;Progress__next_idx</title>
<path fill="none" stroke="#666666" d="M430.58,-436C459.64,-436 492.31,-436 520.61,-436"/>
<polygon fill="#666666" stroke="#666666" points="520.83,-439.5 530.83,-436 520.83,-432.5 520.83,-439.5"/>
</g>
<!-- Progress__matched -->
<g id="node14" class="node">
<title>Progress__matched</title>
<path fill="#feed9b" stroke="#f7e495" d="M535,-61.5C535,-61.5 651,-61.5 651,-61.5 657,-61.5 663,-67.5 663,-73.5 663,-73.5 663,-110.5 663,-110.5 663,-116.5 657,-122.5 651,-122.5 651,-122.5 535,-122.5 535,-122.5 529,-122.5 523,-116.5 523,-110.5 523,-110.5 523,-73.5 523,-73.5 523,-67.5 529,-61.5 535,-61.5"/>
<text text-anchor="middle" x="593" y="-107.3" font-family="Times,serif" font-size="14.00" fill="#40575d">Progress__matched</text>
<polyline fill="none" stroke="#f7e495" points="523,-99.5 663,-99.5 "/>
<text text-anchor="start" x="531" y="-84.3" font-family="Times,serif" font-size="14.00" fill="#40575d">peer已经持久化存储</text>
<text text-anchor="start" x="531" y="-69.3" font-family="Times,serif" font-size="14.00" fill="#40575d"> 的日志index</text>
</g>
<!-- Progress__maybe_update&#45;&gt;Progress__matched -->
<g id="edge16" class="edge">
<title>Progress__maybe_update&#45;&gt;Progress__matched</title>
<path fill="none" stroke="#666666" d="M442.11,-121.23C465.45,-116.68 490.36,-111.82 513.03,-107.4"/>
<polygon fill="#666666" stroke="#666666" points="513.79,-110.82 522.93,-105.47 512.45,-103.95 513.79,-110.82"/>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;RaftCore__should_bcast_commit -->
<g id="edge11" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;RaftCore__should_bcast_commit</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M441.08,-297.18C460.87,-301.62 481.83,-306.31 501.62,-310.75"/>
<polygon fill="green" stroke="green" points="501.02,-314.2 511.55,-312.97 502.56,-307.37 501.02,-314.2"/>
</g>
<!-- RaftLog__maybe_commit -->
<g id="node10" class="node">
<title>RaftLog__maybe_commit</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M497,-141.5C497,-141.5 689,-141.5 689,-141.5 695,-141.5 701,-147.5 701,-153.5 701,-153.5 701,-190.5 701,-190.5 701,-196.5 695,-202.5 689,-202.5 689,-202.5 497,-202.5 497,-202.5 491,-202.5 485,-196.5 485,-190.5 485,-190.5 485,-153.5 485,-153.5 485,-147.5 491,-141.5 497,-141.5"/>
<text text-anchor="middle" x="593" y="-187.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">RraftLog__maybe_commit</text>
<polyline fill="none" stroke="#8a8898" points="485,-179.5 701,-179.5 "/>
<text text-anchor="start" x="493" y="-164.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">只有当前leader自己term任期</text>
<text text-anchor="start" x="493" y="-149.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 内的Log entry才能安全的commit</text>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;RaftLog__maybe_commit -->
<g id="edge9" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;RaftLog__maybe_commit</title>
<path fill="none" stroke="#666666" d="M429.84,-253.95C436.44,-251.22 442.91,-248.23 449,-245 466.9,-235.49 467.51,-227.24 485,-217 490.84,-213.58 496.99,-210.28 503.27,-207.13"/>
<polygon fill="#666666" stroke="#666666" points="505.08,-210.15 512.54,-202.63 502.02,-203.85 505.08,-210.15"/>
</g>
<!-- ProgressTracker__maximal_committed_index -->
<g id="node11" class="node">
<title>ProgressTracker__maximal_committed_index</title>
<path fill="none" stroke="#1c2123" d="M749,-141.5C749,-141.5 995,-141.5 995,-141.5 1001,-141.5 1007,-147.5 1007,-153.5 1007,-153.5 1007,-220.5 1007,-220.5 1007,-226.5 1001,-232.5 995,-232.5 995,-232.5 749,-232.5 749,-232.5 743,-232.5 737,-226.5 737,-220.5 737,-220.5 737,-153.5 737,-153.5 737,-147.5 743,-141.5 749,-141.5"/>
<text text-anchor="middle" x="872" y="-217.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">ProgressTracker__maximal_committed_index</text>
<polyline fill="none" stroke="#1c2123" points="737,-209.5 1007,-209.5 "/>
<text text-anchor="start" x="745" y="-194.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">计算已经复制到大部分</text>
<text text-anchor="start" x="745" y="-179.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> peer的log entry index</text>
<text text-anchor="start" x="745" y="-164.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 会使用所有的voters的Progress::matched</text>
<text text-anchor="start" x="745" y="-149.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 来计算commit index</text>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;ProgressTracker__maximal_committed_index -->
<g id="edge10" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;ProgressTracker__maximal_committed_index</title>
<path fill="none" stroke="#666666" d="M441.01,-258.39C455.7,-255.49 470.76,-252.6 485,-250 564.75,-235.46 654.06,-220.78 726.68,-209.26"/>
<polygon fill="#666666" stroke="#666666" points="727.48,-212.67 736.81,-207.65 726.39,-205.76 727.48,-212.67"/>
</g>
<!-- RaftCore__bcast_append -->
<g id="node12" class="node">
<title>RaftCore__bcast_append</title>
<path fill="none" stroke="#1c2123" d="M657.5,-295C657.5,-295 528.5,-295 528.5,-295 522.5,-295 516.5,-289 516.5,-283 516.5,-283 516.5,-271 516.5,-271 516.5,-265 522.5,-259 528.5,-259 528.5,-259 657.5,-259 657.5,-259 663.5,-259 669.5,-265 669.5,-271 669.5,-271 669.5,-283 669.5,-283 669.5,-289 663.5,-295 657.5,-295"/>
<text text-anchor="middle" x="593" y="-273.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__bcast_append</text>
</g>
<!-- RaftCore__maybe_commit&#45;&gt;RaftCore__bcast_append -->
<g id="edge12" class="edge">
<title>RaftCore__maybe_commit&#45;&gt;RaftCore__bcast_append</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M441.08,-277C462.34,-277 484.94,-277 506.01,-277"/>
<polygon fill="green" stroke="green" points="506.22,-280.5 516.22,-277 506.22,-273.5 506.22,-280.5"/>
</g>
<!-- RaftCore__bcast_append&#45;&gt;RaftCore__send_append -->
<g id="edge13" class="edge">
<title>RaftCore__bcast_append&#45;&gt;RaftCore__send_append</title>
<path fill="none" stroke="#666666" d="M669.69,-288.75C705.86,-294.36 749.27,-301.1 786.51,-306.88"/>
<polygon fill="#666666" stroke="#666666" points="786.42,-310.41 796.84,-308.49 787.49,-303.49 786.42,-310.41"/>
</g>
<!-- RaftCore__term -->
<g id="node13" class="node">
<title>RaftCore__term</title>
<path fill="#feed9b" stroke="#f7e495" d="M289,-189C289,-189 411,-189 411,-189 417,-189 423,-195 423,-201 423,-201 423,-223 423,-223 423,-229 417,-235 411,-235 411,-235 289,-235 289,-235 283,-235 277,-229 277,-223 277,-223 277,-201 277,-201 277,-195 283,-189 289,-189"/>
<text text-anchor="middle" x="350" y="-219.8" font-family="Times,serif" font-size="14.00" fill="#40575d">RaftCore__term</text>
<polyline fill="none" stroke="#f7e495" points="277,-212 423,-212 "/>
<text text-anchor="start" x="285" y="-196.8" font-family="Times,serif" font-size="14.00" fill="#40575d">当前leader的term任期</text>
</g>
<!-- RaftCore__term&#45;&gt;RaftLog__maybe_commit -->
<g id="edge14" class="edge">
<title>RaftCore__term&#45;&gt;RaftLog__maybe_commit</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M423.31,-200C439.53,-197.31 457.16,-194.38 474.69,-191.47"/>
<polygon fill="green" stroke="green" points="475.7,-194.85 484.99,-189.76 474.55,-187.95 475.7,-194.85"/>
</g>
<!-- Progress__matched&#45;&gt;ProgressTracker__maximal_committed_index -->
<g id="edge15" class="edge">
<title>Progress__matched&#45;&gt;ProgressTracker__maximal_committed_index</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M663.18,-115.73C683.16,-122.58 705.74,-130.32 728.46,-138.11"/>
<polygon fill="green" stroke="green" points="727.6,-141.52 738.2,-141.45 729.87,-134.9 727.6,-141.52"/>
</g>
<!-- RaftCore__maybe_send_append -->
<g id="node16" class="node">
<title>RaftCore__maybe_send_append</title>
<path fill="none" stroke="#1c2123" d="M22.5,-341C22.5,-341 192.5,-341 192.5,-341 198.5,-341 204.5,-347 204.5,-353 204.5,-353 204.5,-375 204.5,-375 204.5,-381 198.5,-387 192.5,-387 192.5,-387 22.5,-387 22.5,-387 16.5,-387 10.5,-381 10.5,-375 10.5,-375 10.5,-353 10.5,-353 10.5,-347 16.5,-341 22.5,-341"/>
<text text-anchor="middle" x="107.5" y="-371.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">RaftCore__maybe_send_append</text>
<polyline fill="none" stroke="#1c2123" points="10.5,-364 204.5,-364 "/>
<text text-anchor="start" x="18.5" y="-348.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">发送多个inflight msg给follwer</text>
</g>
</g>
</svg>
