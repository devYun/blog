<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="1189pt" height="532pt"
 viewBox="0.00 0.00 1189.00 532.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 528)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-528 1185,-528 1185,4 -4,4"/>
<!-- LockResolver__getTxnStatusFromLock -->
<g id="node1" class="node">
<title>LockResolver__getTxnStatusFromLock</title>
<path fill="none" stroke="#1c2123" d="M12,-98C12,-98 137,-98 137,-98 143,-98 149,-104 149,-110 149,-110 149,-147 149,-147 149,-153 143,-159 137,-159 137,-159 12,-159 12,-159 6,-159 0,-153 0,-147 0,-147 0,-110 0,-110 0,-104 6,-98 12,-98"/>
<text text-anchor="start" x="8" y="-143.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="8" y="-128.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> getTxnStatusFromLock</text>
<polyline fill="none" stroke="#1c2123" points="0,-121 149,-121 "/>
<text text-anchor="start" x="8" y="-105.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">根据lock获取txn 状态</text>
</g>
<!-- TxnStatus -->
<g id="node2" class="node">
<title>TxnStatus</title>
<path fill="#bcffb9" stroke="#8a8898" d="M410,-112C410,-112 583,-112 583,-112 589,-112 595,-118 595,-124 595,-124 595,-215 595,-215 595,-221 589,-227 583,-227 583,-227 410,-227 410,-227 404,-227 398,-221 398,-215 398,-215 398,-124 398,-124 398,-118 404,-112 410,-112"/>
<text text-anchor="middle" x="496.5" y="-211.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">TxnStatus</text>
<polyline fill="none" stroke="#8a8898" points="398,-204 595,-204 "/>
<text text-anchor="start" x="406" y="-188.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">ttl uint64</text>
<polyline fill="none" stroke="#8a8898" points="398,-181 595,-181 "/>
<text text-anchor="start" x="406" y="-165.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">commitTS uint64</text>
<polyline fill="none" stroke="#8a8898" points="398,-158 595,-158 "/>
<text text-anchor="start" x="406" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">action kvrpcpb.Action</text>
<polyline fill="none" stroke="#8a8898" points="398,-135 595,-135 "/>
<text text-anchor="start" x="406" y="-119.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">primaryLock *kvrpcpb.LockInfo</text>
</g>
<!-- LockResolver__getTxnStatusFromLock&#45;&gt;TxnStatus -->
<g id="edge1" class="edge">
<title>LockResolver__getTxnStatusFromLock&#45;&gt;TxnStatus</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M149.19,-144.74C161.12,-146.95 173.37,-148.98 185,-150.5 252.08,-159.25 327.85,-163.98 387.74,-166.54"/>
<polygon fill="green" stroke="green" points="387.84,-170.05 397.98,-166.96 388.13,-163.05 387.84,-170.05"/>
</g>
<!-- LockResolver__getTxnStatus -->
<g id="node7" class="node">
<title>LockResolver__getTxnStatus</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M197,-34.5C197,-34.5 350,-34.5 350,-34.5 356,-34.5 362,-40.5 362,-46.5 362,-46.5 362,-128.5 362,-128.5 362,-134.5 356,-140.5 350,-140.5 350,-140.5 197,-140.5 197,-140.5 191,-140.5 185,-134.5 185,-128.5 185,-128.5 185,-46.5 185,-46.5 185,-40.5 191,-34.5 197,-34.5"/>
<text text-anchor="start" x="193" y="-125.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="193" y="-110.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> getTxnStatus</text>
<polyline fill="none" stroke="#8a8898" points="185,-102.5 362,-102.5 "/>
<text text-anchor="start" x="193" y="-87.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">发送CheckTxnStatus请求到</text>
<text text-anchor="start" x="193" y="-72.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> lock.primary key所在的</text>
<text text-anchor="start" x="193" y="-57.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> region TiKV 服务</text>
<text text-anchor="start" x="193" y="-42.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 获取txn状态</text>
</g>
<!-- LockResolver__getTxnStatusFromLock&#45;&gt;LockResolver__getTxnStatus -->
<g id="edge6" class="edge">
<title>LockResolver__getTxnStatusFromLock&#45;&gt;LockResolver__getTxnStatus</title>
<path fill="none" stroke="#666666" d="M149.14,-113.17C157.63,-111.41 166.39,-109.58 175.14,-107.76"/>
<polygon fill="#666666" stroke="#666666" points="175.92,-111.18 185,-105.71 174.49,-104.32 175.92,-111.18"/>
</g>
<!-- TxnStatus__ttl -->
<g id="node3" class="node">
<title>TxnStatus__ttl</title>
<path fill="none" stroke="#1c2123" d="M743.5,-372.5C743.5,-372.5 811.5,-372.5 811.5,-372.5 817.5,-372.5 823.5,-378.5 823.5,-384.5 823.5,-384.5 823.5,-436.5 823.5,-436.5 823.5,-442.5 817.5,-448.5 811.5,-448.5 811.5,-448.5 743.5,-448.5 743.5,-448.5 737.5,-448.5 731.5,-442.5 731.5,-436.5 731.5,-436.5 731.5,-384.5 731.5,-384.5 731.5,-378.5 737.5,-372.5 743.5,-372.5"/>
<text text-anchor="start" x="739.5" y="-433.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnStatus::ttl</text>
<polyline fill="none" stroke="#1c2123" points="731.5,-425.5 823.5,-425.5 "/>
<text text-anchor="start" x="739.5" y="-410.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">事务ttl为0</text>
<text text-anchor="start" x="739.5" y="-395.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> txn过期了</text>
<text text-anchor="start" x="739.5" y="-380.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 可以清理掉</text>
</g>
<!-- TxnStatus&#45;&gt;TxnStatus__ttl -->
<g id="edge2" class="edge">
<title>TxnStatus&#45;&gt;TxnStatus__ttl</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M538.32,-227.21C562.81,-259.22 595.94,-298.33 631,-327.5 658.64,-350.49 693.51,-370.63 722.19,-385.31"/>
<polygon fill="green" stroke="green" points="720.76,-388.51 731.27,-389.89 723.91,-382.26 720.76,-388.51"/>
</g>
<!-- LockResolver__saveResolved -->
<g id="node8" class="node">
<title>LockResolver__saveResolved</title>
<path fill="none" stroke="#1c2123" d="M712,-265C712,-265 843,-265 843,-265 849,-265 855,-271 855,-277 855,-277 855,-306 855,-306 855,-312 849,-318 843,-318 843,-318 712,-318 712,-318 706,-318 700,-312 700,-306 700,-306 700,-277 700,-277 700,-271 706,-265 712,-265"/>
<text text-anchor="start" x="708" y="-302.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="708" y="-287.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> saveResolved</text>
<text text-anchor="start" x="708" y="-272.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 保存已经resolved的txn</text>
</g>
<!-- TxnStatus&#45;&gt;LockResolver__saveResolved -->
<g id="edge7" class="edge">
<title>TxnStatus&#45;&gt;LockResolver__saveResolved</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M577.73,-227.17C594.76,-237.67 613.03,-247.74 631,-255.5 649.5,-263.48 670.11,-269.93 689.88,-275.04"/>
<polygon fill="green" stroke="green" points="689.26,-278.49 699.81,-277.52 690.95,-271.7 689.26,-278.49"/>
</g>
<!-- Action -->
<g id="node12" class="node">
<title>Action</title>
<path fill="none" stroke="#1c2123" d="M643,-93C643,-93 912,-93 912,-93 918,-93 924,-99 924,-105 924,-105 924,-234 924,-234 924,-240 918,-246 912,-246 912,-246 643,-246 643,-246 637,-246 631,-240 631,-234 631,-234 631,-105 631,-105 631,-99 637,-93 643,-93"/>
<text text-anchor="start" x="639" y="-230.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action</text>
<text text-anchor="start" x="639" y="-215.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Action_NoAction Action = 0</text>
<polyline fill="none" stroke="#1c2123" points="631,-208 924,-208 "/>
<text text-anchor="start" x="639" y="-192.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action_TTLExpireRollback Action = 1</text>
<polyline fill="none" stroke="#1c2123" points="631,-185 924,-185 "/>
<text text-anchor="start" x="639" y="-169.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action_LockNotExistRollback Action = 2</text>
<polyline fill="none" stroke="#1c2123" points="631,-162 924,-162 "/>
<text text-anchor="start" x="639" y="-146.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action_MinCommitTSPushed Action = 3</text>
<polyline fill="none" stroke="#1c2123" points="631,-139 924,-139 "/>
<text text-anchor="start" x="639" y="-123.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action_TTLExpirePessimisticRollback Action = 4</text>
<polyline fill="none" stroke="#1c2123" points="631,-116 924,-116 "/>
<text text-anchor="start" x="639" y="-100.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">Action_LockNotExistDoNothing Action = 5</text>
</g>
<!-- TxnStatus&#45;&gt;Action -->
<g id="edge13" class="edge">
<title>TxnStatus&#45;&gt;Action</title>
<path fill="none" stroke="#666666" d="M595.08,-169.5C603.44,-169.5 612.02,-169.5 620.68,-169.5"/>
<polygon fill="#666666" stroke="#666666" points="620.88,-173 630.88,-169.5 620.88,-166 620.88,-173"/>
</g>
<!-- LockInfo -->
<g id="node13" class="node">
<title>LockInfo</title>
<path fill="none" stroke="#1c2123" d="M799,-74.5C799,-74.5 756,-74.5 756,-74.5 750,-74.5 744,-68.5 744,-62.5 744,-62.5 744,-50.5 744,-50.5 744,-44.5 750,-38.5 756,-38.5 756,-38.5 799,-38.5 799,-38.5 805,-38.5 811,-44.5 811,-50.5 811,-50.5 811,-62.5 811,-62.5 811,-68.5 805,-74.5 799,-74.5"/>
<text text-anchor="middle" x="777.5" y="-52.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockInfo</text>
</g>
<!-- TxnStatus&#45;&gt;LockInfo -->
<g id="edge14" class="edge">
<title>TxnStatus&#45;&gt;LockInfo</title>
<path fill="none" stroke="#666666" d="M575.95,-111.87C593.4,-101.11 612.29,-90.93 631,-83.5 664.11,-70.36 704.03,-63.53 733.68,-60.03"/>
<polygon fill="#666666" stroke="#666666" points="734.15,-63.5 743.71,-58.93 733.39,-56.55 734.15,-63.5"/>
</g>
<!-- LockResolver__resolveLock -->
<g id="node4" class="node">
<title>LockResolver__resolveLock</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1036.5,-485.5C1036.5,-485.5 1104.5,-485.5 1104.5,-485.5 1110.5,-485.5 1116.5,-491.5 1116.5,-497.5 1116.5,-497.5 1116.5,-511.5 1116.5,-511.5 1116.5,-517.5 1110.5,-523.5 1104.5,-523.5 1104.5,-523.5 1036.5,-523.5 1036.5,-523.5 1030.5,-523.5 1024.5,-517.5 1024.5,-511.5 1024.5,-511.5 1024.5,-497.5 1024.5,-497.5 1024.5,-491.5 1030.5,-485.5 1036.5,-485.5"/>
<text text-anchor="start" x="1032.5" y="-508.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="1032.5" y="-493.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolveLock</text>
</g>
<!-- TxnStatus__ttl&#45;&gt;LockResolver__resolveLock -->
<g id="edge3" class="edge">
<title>TxnStatus__ttl&#45;&gt;LockResolver__resolveLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M823.58,-428.3C860.05,-442.35 912.91,-461.96 960,-476.5 977.55,-481.92 996.91,-487.12 1014.41,-491.54"/>
<polygon fill="green" stroke="green" points="1013.92,-495.02 1024.47,-494.04 1015.61,-488.23 1013.92,-495.02"/>
</g>
<!-- LockResolver__resolveLockAsync -->
<g id="node5" class="node">
<title>LockResolver__resolveLockAsync</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1021.5,-390.5C1021.5,-390.5 1119.5,-390.5 1119.5,-390.5 1125.5,-390.5 1131.5,-396.5 1131.5,-402.5 1131.5,-402.5 1131.5,-454.5 1131.5,-454.5 1131.5,-460.5 1125.5,-466.5 1119.5,-466.5 1119.5,-466.5 1021.5,-466.5 1021.5,-466.5 1015.5,-466.5 1009.5,-460.5 1009.5,-454.5 1009.5,-454.5 1009.5,-402.5 1009.5,-402.5 1009.5,-396.5 1015.5,-390.5 1021.5,-390.5"/>
<text text-anchor="start" x="1017.5" y="-451.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="1017.5" y="-436.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolveLockAsync</text>
<polyline fill="none" stroke="#8a8898" points="1009.5,-428.5 1131.5,-428.5 "/>
<text text-anchor="start" x="1017.5" y="-413.3" font-family="Times,serif" font-size="14.00" fill="#5d6179">resolve async </text>
<text text-anchor="start" x="1017.5" y="-398.3" font-family="Times,serif" font-size="14.00" fill="#5d6179"> commit的lock</text>
</g>
<!-- TxnStatus__ttl&#45;&gt;LockResolver__resolveLockAsync -->
<g id="edge4" class="edge">
<title>TxnStatus__ttl&#45;&gt;LockResolver__resolveLockAsync</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M823.65,-413.29C870.52,-416.19 944.47,-420.77 999.04,-424.14"/>
<polygon fill="green" stroke="green" points="999.13,-427.65 1009.33,-424.78 999.57,-420.67 999.13,-427.65"/>
</g>
<!-- LockResolver__resolvePessimisticLock -->
<g id="node6" class="node">
<title>LockResolver__resolvePessimisticLock</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1008,-310C1008,-310 1133,-310 1133,-310 1139,-310 1145,-316 1145,-322 1145,-322 1145,-359 1145,-359 1145,-365 1139,-371 1133,-371 1133,-371 1008,-371 1008,-371 1002,-371 996,-365 996,-359 996,-359 996,-322 996,-322 996,-316 1002,-310 1008,-310"/>
<text text-anchor="start" x="1004" y="-355.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">LockResolver</text>
<text text-anchor="start" x="1004" y="-340.8" font-family="Times,serif" font-size="14.00" fill="#5d6179"> resolvePessimisticLock</text>
<polyline fill="none" stroke="#8a8898" points="996,-333 1145,-333 "/>
<text text-anchor="start" x="1004" y="-317.8" font-family="Times,serif" font-size="14.00" fill="#5d6179">resolve悲观事务Lock</text>
</g>
<!-- TxnStatus__ttl&#45;&gt;LockResolver__resolvePessimisticLock -->
<g id="edge5" class="edge">
<title>TxnStatus__ttl&#45;&gt;LockResolver__resolvePessimisticLock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M823.65,-399.64C866.84,-389.25 933.04,-373.33 985.87,-360.62"/>
<polygon fill="green" stroke="green" points="987,-363.95 995.9,-358.2 985.36,-357.14 987,-363.95"/>
</g>
<!-- LockResolver__getTxnStatus&#45;&gt;TxnStatus -->
<g id="edge8" class="edge">
<title>LockResolver__getTxnStatus&#45;&gt;TxnStatus</title>
<path fill="none" stroke="#666666" d="M362.16,-120.03C370.75,-123.21 379.52,-126.47 388.27,-129.71"/>
<polygon fill="#666666" stroke="#666666" points="387.15,-133.03 397.75,-133.23 389.59,-126.47 387.15,-133.03"/>
</g>
<!-- LockResolver__getResolved -->
<g id="node9" class="node">
<title>LockResolver__getResolved</title>
<path fill="none" stroke="#1c2123" d="M429,-0.5C429,-0.5 564,-0.5 564,-0.5 570,-0.5 576,-6.5 576,-12.5 576,-12.5 576,-56.5 576,-56.5 576,-62.5 570,-68.5 564,-68.5 564,-68.5 429,-68.5 429,-68.5 423,-68.5 417,-62.5 417,-56.5 417,-56.5 417,-12.5 417,-12.5 417,-6.5 423,-0.5 429,-0.5"/>
<text text-anchor="start" x="425" y="-53.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="425" y="-38.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> getResolved</text>
<text text-anchor="start" x="425" y="-23.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 向TiKV发起请求之前</text>
<text text-anchor="start" x="425" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先看是否已经resolve了</text>
</g>
<!-- LockResolver__getTxnStatus&#45;&gt;LockResolver__getResolved -->
<g id="edge9" class="edge">
<title>LockResolver__getTxnStatus&#45;&gt;LockResolver__getResolved</title>
<path fill="none" stroke="#666666" d="M362.16,-66.48C376.85,-62.95 392.1,-59.3 406.81,-55.77"/>
<polygon fill="#666666" stroke="#666666" points="407.99,-59.09 416.9,-53.35 406.36,-52.28 407.99,-59.09"/>
</g>
<!-- LockResolver__mu__recentResolved -->
<g id="node10" class="node">
<title>LockResolver__mu__recentResolved</title>
<path fill="none" stroke="#1c2123" d="M1169,-291.5C1169,-291.5 972,-291.5 972,-291.5 966,-291.5 960,-285.5 960,-279.5 960,-279.5 960,-267.5 960,-267.5 960,-261.5 966,-255.5 972,-255.5 972,-255.5 1169,-255.5 1169,-255.5 1175,-255.5 1181,-261.5 1181,-267.5 1181,-267.5 1181,-279.5 1181,-279.5 1181,-285.5 1175,-291.5 1169,-291.5"/>
<text text-anchor="middle" x="1070.5" y="-269.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver__mu__recentResolved</text>
</g>
<!-- LockResolver__saveResolved&#45;&gt;LockResolver__mu__recentResolved -->
<g id="edge10" class="edge">
<title>LockResolver__saveResolved&#45;&gt;LockResolver__mu__recentResolved</title>
<path fill="none" stroke="#666666" d="M855.34,-286.75C884.21,-284.96 917.76,-282.89 949.61,-280.92"/>
<polygon fill="#666666" stroke="#666666" points="950.12,-284.39 959.89,-280.28 949.69,-277.4 950.12,-284.39"/>
</g>
<!-- LockResolver__mu__resolved -->
<g id="node11" class="node">
<title>LockResolver__mu__resolved</title>
<path fill="none" stroke="#1c2123" d="M1011,-82C1011,-82 1130,-82 1130,-82 1136,-82 1142,-88 1142,-94 1142,-94 1142,-161 1142,-161 1142,-167 1136,-173 1130,-173 1130,-173 1011,-173 1011,-173 1005,-173 999,-167 999,-161 999,-161 999,-94 999,-94 999,-88 1005,-82 1011,-82"/>
<text text-anchor="start" x="1007" y="-157.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">LockResolver</text>
<text text-anchor="start" x="1007" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mu.resolved</text>
<text text-anchor="start" x="1007" y="-127.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> map[uint64]TxnStatus</text>
<polyline fill="none" stroke="#1c2123" points="999,-120 1142,-120 "/>
<text text-anchor="start" x="1007" y="-104.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">记录已经resolved</text>
<text text-anchor="start" x="1007" y="-89.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 的txn</text>
</g>
<!-- LockResolver__saveResolved&#45;&gt;LockResolver__mu__resolved -->
<g id="edge11" class="edge">
<title>LockResolver__saveResolved&#45;&gt;LockResolver__mu__resolved</title>
<path fill="none" stroke="#666666" d="M855.02,-279.77C878.03,-274.37 902.79,-266.6 924,-255.5 960.38,-236.47 995.13,-206.5 1021.55,-180.34"/>
<polygon fill="#666666" stroke="#666666" points="1024.2,-182.63 1028.77,-173.07 1019.24,-177.7 1024.2,-182.63"/>
</g>
<!-- LockResolver__getResolved&#45;&gt;LockResolver__mu__resolved -->
<g id="edge12" class="edge">
<title>LockResolver__getResolved&#45;&gt;LockResolver__mu__resolved</title>
<path fill="none" stroke="#666666" d="M576.17,-19.59C663.31,-6.25 806.97,6.24 924,-29.5 954.88,-38.93 985.14,-57.36 1009.99,-75.71"/>
<polygon fill="#666666" stroke="#666666" points="1008.12,-78.68 1018.21,-81.92 1012.34,-73.1 1008.12,-78.68"/>
</g>
</g>
</svg>
