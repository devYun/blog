<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: doActionOnBatches Pages: 1 -->
<svg width="839pt" height="434pt"
 viewBox="0.00 0.00 839.00 433.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 429.5)">
<title>doActionOnBatches</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-429.5 835,-429.5 835,4 -4,4"/>
<g id="clust2" class="cluster">
<title>cluster_batchExecutor</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M179.5,-55.5C179.5,-55.5 811,-55.5 811,-55.5 817,-55.5 823,-61.5 823,-67.5 823,-67.5 823,-369.5 823,-369.5 823,-375.5 817,-381.5 811,-381.5 811,-381.5 179.5,-381.5 179.5,-381.5 173.5,-381.5 167.5,-375.5 167.5,-369.5 167.5,-369.5 167.5,-67.5 167.5,-67.5 167.5,-61.5 173.5,-55.5 179.5,-55.5"/>
<text text-anchor="middle" x="495.25" y="-361.5" font-family="Times,serif" font-size="20.00">batchExecutor</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_RateLimiter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M349.5,-63.5C349.5,-63.5 801,-63.5 801,-63.5 807,-63.5 813,-69.5 813,-75.5 813,-75.5 813,-165.5 813,-165.5 813,-171.5 807,-177.5 801,-177.5 801,-177.5 349.5,-177.5 349.5,-177.5 343.5,-177.5 337.5,-171.5 337.5,-165.5 337.5,-165.5 337.5,-75.5 337.5,-75.5 337.5,-69.5 343.5,-63.5 349.5,-63.5"/>
<text text-anchor="middle" x="575.25" y="-157.5" font-family="Times,serif" font-size="20.00">RateLimiter</text>
</g>
<!-- doActionOnBatches -->
<g id="node1" class="node">
<title>doActionOnBatches</title>
<path fill="none" stroke="#1c2123" d="M114,-302.5C114,-302.5 12,-302.5 12,-302.5 6,-302.5 0,-296.5 0,-290.5 0,-290.5 0,-278.5 0,-278.5 0,-272.5 6,-266.5 12,-266.5 12,-266.5 114,-266.5 114,-266.5 120,-266.5 126,-272.5 126,-278.5 126,-278.5 126,-290.5 126,-290.5 126,-296.5 120,-302.5 114,-302.5"/>
<text text-anchor="middle" x="63" y="-280.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnBatches</text>
</g>
<!-- handleSignleBatch -->
<g id="node2" class="node">
<title>handleSignleBatch</title>
<path fill="none" stroke="#1c2123" d="M282.5,-425.5C282.5,-425.5 187.5,-425.5 187.5,-425.5 181.5,-425.5 175.5,-419.5 175.5,-413.5 175.5,-413.5 175.5,-401.5 175.5,-401.5 175.5,-395.5 181.5,-389.5 187.5,-389.5 187.5,-389.5 282.5,-389.5 282.5,-389.5 288.5,-389.5 294.5,-395.5 294.5,-401.5 294.5,-401.5 294.5,-413.5 294.5,-413.5 294.5,-419.5 288.5,-425.5 282.5,-425.5"/>
<text text-anchor="middle" x="235" y="-403.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">handleSignleBatch</text>
</g>
<!-- doActionOnBatches&#45;&gt;handleSignleBatch -->
<g id="edge1" class="edge">
<title>doActionOnBatches&#45;&gt;handleSignleBatch</title>
<path fill="none" stroke="#666666" d="M76.85,-302.52C93.86,-325.08 125.93,-363.46 162,-385.5 163.29,-386.29 164.61,-387.05 165.95,-387.79"/>
<polygon fill="#666666" stroke="#666666" points="164.62,-391.03 175.14,-392.28 167.7,-384.74 164.62,-391.03"/>
</g>
<!-- newBatchExecutor -->
<g id="node3" class="node">
<title>newBatchExecutor</title>
<path fill="none" stroke="#1c2123" d="M282.5,-329.5C282.5,-329.5 187.5,-329.5 187.5,-329.5 181.5,-329.5 175.5,-323.5 175.5,-317.5 175.5,-317.5 175.5,-305.5 175.5,-305.5 175.5,-299.5 181.5,-293.5 187.5,-293.5 187.5,-293.5 282.5,-293.5 282.5,-293.5 288.5,-293.5 294.5,-299.5 294.5,-305.5 294.5,-305.5 294.5,-317.5 294.5,-317.5 294.5,-323.5 288.5,-329.5 282.5,-329.5"/>
<text text-anchor="middle" x="235" y="-307.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">newBatchExecutor</text>
</g>
<!-- doActionOnBatches&#45;&gt;newBatchExecutor -->
<g id="edge2" class="edge">
<title>doActionOnBatches&#45;&gt;newBatchExecutor</title>
<path fill="none" stroke="#666666" d="M126.34,-294.4C138.97,-296.41 152.33,-298.53 165.18,-300.57"/>
<polygon fill="#666666" stroke="#666666" points="164.92,-304.07 175.35,-302.18 166.02,-297.16 164.92,-304.07"/>
</g>
<!-- process -->
<g id="node4" class="node">
<title>process</title>
<path fill="none" stroke="#1c2123" d="M251.5,-275.5C251.5,-275.5 218.5,-275.5 218.5,-275.5 212.5,-275.5 206.5,-269.5 206.5,-263.5 206.5,-263.5 206.5,-251.5 206.5,-251.5 206.5,-245.5 212.5,-239.5 218.5,-239.5 218.5,-239.5 251.5,-239.5 251.5,-239.5 257.5,-239.5 263.5,-245.5 263.5,-251.5 263.5,-251.5 263.5,-263.5 263.5,-263.5 263.5,-269.5 257.5,-275.5 251.5,-275.5"/>
<text text-anchor="middle" x="235" y="-253.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">process</text>
</g>
<!-- doActionOnBatches&#45;&gt;process -->
<g id="edge3" class="edge">
<title>doActionOnBatches&#45;&gt;process</title>
<path fill="none" stroke="#666666" d="M126.34,-274.6C149.85,-270.87 175.85,-266.74 196.41,-263.47"/>
<polygon fill="#666666" stroke="#666666" points="197,-266.92 206.33,-261.89 195.9,-260.01 197,-266.92"/>
</g>
<!-- CommitterConcurrency -->
<g id="node5" class="node">
<title>CommitterConcurrency</title>
<path fill="none" stroke="#1c2123" d="M174,-0.5C174,-0.5 296,-0.5 296,-0.5 302,-0.5 308,-6.5 308,-12.5 308,-12.5 308,-34.5 308,-34.5 308,-40.5 302,-46.5 296,-46.5 296,-46.5 174,-46.5 174,-46.5 168,-46.5 162,-40.5 162,-34.5 162,-34.5 162,-12.5 162,-12.5 162,-6.5 168,-0.5 174,-0.5"/>
<text text-anchor="middle" x="235" y="-31.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">CommitterConcurrency</text>
<polyline fill="none" stroke="#1c2123" points="162,-23.5 308,-23.5 "/>
<text text-anchor="middle" x="235" y="-8.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">控制rateLimiter</text>
</g>
<!-- doActionOnBatches&#45;&gt;CommitterConcurrency -->
<g id="edge4" class="edge">
<title>doActionOnBatches&#45;&gt;CommitterConcurrency</title>
<path fill="none" stroke="#666666" d="M66.71,-266.35C73.8,-224.71 96.63,-121.11 160.37,-53.93"/>
<polygon fill="#666666" stroke="#666666" points="162.95,-56.3 167.5,-46.74 157.98,-51.38 162.95,-56.3"/>
</g>
<!-- startWorker -->
<g id="node6" class="node">
<title>startWorker</title>
<path fill="none" stroke="#1c2123" d="M413,-262.5C413,-262.5 356,-262.5 356,-262.5 350,-262.5 344,-256.5 344,-250.5 344,-250.5 344,-238.5 344,-238.5 344,-232.5 350,-226.5 356,-226.5 356,-226.5 413,-226.5 413,-226.5 419,-226.5 425,-232.5 425,-238.5 425,-238.5 425,-250.5 425,-250.5 425,-256.5 419,-262.5 413,-262.5"/>
<text text-anchor="middle" x="384.5" y="-240.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">startWorker</text>
</g>
<!-- process&#45;&gt;startWorker -->
<g id="edge5" class="edge">
<title>process&#45;&gt;startWorker</title>
<path fill="none" stroke="#666666" d="M263.74,-255.05C283.44,-253.32 310.44,-250.94 333.81,-248.88"/>
<polygon fill="#666666" stroke="#666666" points="334.26,-252.35 343.91,-247.99 333.64,-245.38 334.26,-252.35"/>
</g>
<!-- wait_ch -->
<g id="node7" class="node">
<title>wait_ch</title>
<path fill="none" stroke="#1c2123" d="M490.5,-296.5C490.5,-296.5 591.5,-296.5 591.5,-296.5 597.5,-296.5 603.5,-302.5 603.5,-308.5 603.5,-308.5 603.5,-330.5 603.5,-330.5 603.5,-336.5 597.5,-342.5 591.5,-342.5 591.5,-342.5 490.5,-342.5 490.5,-342.5 484.5,-342.5 478.5,-336.5 478.5,-330.5 478.5,-330.5 478.5,-308.5 478.5,-308.5 478.5,-302.5 484.5,-296.5 490.5,-296.5"/>
<text text-anchor="middle" x="541" y="-327.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">wait ch</text>
<polyline fill="none" stroke="#1c2123" points="478.5,-319.5 603.5,-319.5 "/>
<text text-anchor="start" x="486.5" y="-304.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">等待baches处理完</text>
</g>
<!-- process&#45;&gt;wait_ch -->
<g id="edge6" class="edge">
<title>process&#45;&gt;wait_ch</title>
<path fill="none" stroke="#666666" d="M263.51,-263.11C309.39,-272.47 402.93,-291.55 468.45,-304.91"/>
<polygon fill="#666666" stroke="#666666" points="467.81,-308.35 478.31,-306.92 469.21,-301.49 467.81,-308.35"/>
</g>
<!-- rateLimiter -->
<g id="node12" class="node">
<title>rateLimiter</title>
<path fill="none" stroke="#1c2123" d="M411.5,-107.5C411.5,-107.5 357.5,-107.5 357.5,-107.5 351.5,-107.5 345.5,-101.5 345.5,-95.5 345.5,-95.5 345.5,-83.5 345.5,-83.5 345.5,-77.5 351.5,-71.5 357.5,-71.5 357.5,-71.5 411.5,-71.5 411.5,-71.5 417.5,-71.5 423.5,-77.5 423.5,-83.5 423.5,-83.5 423.5,-95.5 423.5,-95.5 423.5,-101.5 417.5,-107.5 411.5,-107.5"/>
<text text-anchor="middle" x="384.5" y="-85.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">rateLimiter</text>
</g>
<!-- CommitterConcurrency&#45;&gt;rateLimiter -->
<g id="edge12" class="edge">
<title>CommitterConcurrency&#45;&gt;rateLimiter</title>
<path fill="none" stroke="#666666" d="M296.67,-46.61C300.52,-48.23 304.32,-49.86 308,-51.5 318.58,-56.21 329.81,-61.62 340.28,-66.86"/>
<polygon fill="#666666" stroke="#666666" points="338.75,-70.01 349.25,-71.4 341.91,-63.76 338.75,-70.01"/>
</g>
<!-- startWorker&#45;&gt;wait_ch -->
<g id="edge9" class="edge">
<title>startWorker&#45;&gt;wait_ch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M416.31,-262.66C429.84,-270.37 446.02,-279.23 461,-286.5 465.02,-288.45 469.19,-290.4 473.41,-292.32"/>
<polygon fill="green" stroke="green" points="472.14,-295.58 482.7,-296.46 474.99,-289.19 472.14,-295.58"/>
</g>
<!-- rateLimiter_GetToken -->
<g id="node8" class="node">
<title>rateLimiter_GetToken</title>
<path fill="none" stroke="#1c2123" d="M479,-92.5C479,-92.5 603,-92.5 603,-92.5 609,-92.5 615,-98.5 615,-104.5 615,-104.5 615,-126.5 615,-126.5 615,-132.5 609,-138.5 603,-138.5 603,-138.5 479,-138.5 479,-138.5 473,-138.5 467,-132.5 467,-126.5 467,-126.5 467,-104.5 467,-104.5 467,-98.5 473,-92.5 479,-92.5"/>
<text text-anchor="middle" x="541" y="-123.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rateLimiter::GetToken</text>
<polyline fill="none" stroke="#1c2123" points="467,-115.5 615,-115.5 "/>
<text text-anchor="start" x="475" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">block一直等到有token</text>
</g>
<!-- startWorker&#45;&gt;rateLimiter_GetToken -->
<g id="edge7" class="edge">
<title>startWorker&#45;&gt;rateLimiter_GetToken</title>
<path fill="none" stroke="#666666" d="M397.32,-226.17C412.4,-203.19 438.55,-164.84 460.48,-145.02"/>
<polygon fill="#666666" stroke="#666666" points="462.8,-147.64 468.35,-138.61 458.38,-142.21 462.8,-147.64"/>
</g>
<!-- go_func -->
<g id="node9" class="node">
<title>go_func</title>
<path fill="none" stroke="#1c2123" d="M473,-186C473,-186 609,-186 609,-186 615,-186 621,-192 621,-198 621,-198 621,-265 621,-265 621,-271 615,-277 609,-277 609,-277 473,-277 473,-277 467,-277 461,-271 461,-265 461,-265 461,-198 461,-198 461,-192 467,-186 473,-186"/>
<text text-anchor="start" x="469" y="-261.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">go func {...}</text>
<polyline fill="none" stroke="#1c2123" points="461,-254 621,-254 "/>
<text text-anchor="start" x="469" y="-238.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">启动一个新的go routine</text>
<text text-anchor="start" x="469" y="-223.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 发送batches</text>
<text text-anchor="start" x="469" y="-208.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> go routine跑完后</text>
<text text-anchor="start" x="469" y="-193.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 调用PutToken归还token</text>
</g>
<!-- startWorker&#45;&gt;go_func -->
<g id="edge8" class="edge">
<title>startWorker&#45;&gt;go_func</title>
<path fill="none" stroke="#666666" d="M425.29,-241.15C433.21,-240.49 441.83,-239.76 450.67,-239.02"/>
<polygon fill="#666666" stroke="#666666" points="451.04,-242.5 460.71,-238.17 450.45,-235.52 451.04,-242.5"/>
</g>
<!-- rateLimiter_PutToken -->
<g id="node10" class="node">
<title>rateLimiter_PutToken</title>
<path fill="none" stroke="#1c2123" d="M679,-82.5C679,-82.5 793,-82.5 793,-82.5 799,-82.5 805,-88.5 805,-94.5 805,-94.5 805,-116.5 805,-116.5 805,-122.5 799,-128.5 793,-128.5 793,-128.5 679,-128.5 679,-128.5 673,-128.5 667,-122.5 667,-116.5 667,-116.5 667,-94.5 667,-94.5 667,-88.5 673,-82.5 679,-82.5"/>
<text text-anchor="middle" x="736" y="-113.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">rateLimiter::PutToken</text>
<polyline fill="none" stroke="#1c2123" points="667,-105.5 805,-105.5 "/>
<text text-anchor="middle" x="736" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">go routin归还token</text>
</g>
<!-- go_func&#45;&gt;rateLimiter_PutToken -->
<g id="edge10" class="edge">
<title>go_func&#45;&gt;rateLimiter_PutToken</title>
<path fill="none" stroke="#666666" d="M616.22,-185.74C617.85,-184.35 619.45,-182.93 621,-181.5 640.59,-163.41 635.55,-149.34 657,-133.5 657.39,-133.21 657.78,-132.93 658.18,-132.64"/>
<polygon fill="#666666" stroke="#666666" points="660.36,-135.41 666.92,-127.09 656.6,-129.5 660.36,-135.41"/>
</g>
<!-- action_handleSingleBatch -->
<g id="node11" class="node">
<title>action_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M803,-249.5C803,-249.5 669,-249.5 669,-249.5 663,-249.5 657,-243.5 657,-237.5 657,-237.5 657,-225.5 657,-225.5 657,-219.5 663,-213.5 669,-213.5 669,-213.5 803,-213.5 803,-213.5 809,-213.5 815,-219.5 815,-225.5 815,-225.5 815,-237.5 815,-237.5 815,-243.5 809,-249.5 803,-249.5"/>
<text text-anchor="middle" x="736" y="-227.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">action_handleSingleBatch</text>
</g>
<!-- go_func&#45;&gt;action_handleSingleBatch -->
<g id="edge11" class="edge">
<title>go_func&#45;&gt;action_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M621.06,-231.5C629.42,-231.5 637.96,-231.5 646.43,-231.5"/>
<polygon fill="#666666" stroke="#666666" points="646.69,-235 656.69,-231.5 646.69,-228 646.69,-235"/>
</g>
<!-- rateLimiter&#45;&gt;rateLimiter_GetToken -->
<g id="edge13" class="edge">
<title>rateLimiter&#45;&gt;rateLimiter_GetToken</title>
<path fill="none" stroke="#666666" d="M423.69,-95.93C433.85,-97.64 445.23,-99.55 456.8,-101.5"/>
<polygon fill="#666666" stroke="#666666" points="456.53,-105 466.98,-103.21 457.7,-98.1 456.53,-105"/>
</g>
<!-- rateLimiter&#45;&gt;rateLimiter_PutToken -->
<g id="edge14" class="edge">
<title>rateLimiter&#45;&gt;rateLimiter_PutToken</title>
<path fill="none" stroke="#666666" d="M423.87,-85.86C435.76,-84.89 448.91,-83.98 461,-83.5 532.06,-80.68 550.21,-76.73 621,-83.5 632.68,-84.62 644.94,-86.36 656.91,-88.39"/>
<polygon fill="#666666" stroke="#666666" points="656.43,-91.86 666.89,-90.16 657.65,-84.97 656.43,-91.86"/>
</g>
</g>
</svg>
