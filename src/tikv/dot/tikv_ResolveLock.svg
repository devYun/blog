<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: dig Pages: 1 -->
<svg width="2406pt" height="972pt"
 viewBox="0.00 0.00 2406.00 972.22" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 968.22)">
<title>dig</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-968.22 2402,-968.22 2402,4 -4,4"/>
<!-- ResolveLock__process_write -->
<g id="node1" class="node">
<title>ResolveLock__process_write</title>
<path fill="none" stroke="#1c2123" d="M337,-344.72C337,-344.72 441,-344.72 441,-344.72 447,-344.72 453,-350.72 453,-356.72 453,-356.72 453,-393.72 453,-393.72 453,-399.72 447,-405.72 441,-405.72 441,-405.72 337,-405.72 337,-405.72 331,-405.72 325,-399.72 325,-393.72 325,-393.72 325,-356.72 325,-356.72 325,-350.72 331,-344.72 337,-344.72"/>
<text text-anchor="start" x="333" y="-390.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">ResolveLock</text>
<text text-anchor="start" x="333" y="-375.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> process_write</text>
<polyline fill="none" stroke="#1c2123" points="325,-367.72 453,-367.72 "/>
<text text-anchor="start" x="333" y="-352.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">遍历key_locks数组</text>
</g>
<!-- TxnStatus__Get -->
<g id="node2" class="node">
<title>TxnStatus__Get</title>
<path fill="none" stroke="#1c2123" d="M684,-395.72C684,-395.72 814,-395.72 814,-395.72 820,-395.72 826,-401.72 826,-407.72 826,-407.72 826,-474.72 826,-474.72 826,-480.72 820,-486.72 814,-486.72 814,-486.72 684,-486.72 684,-486.72 678,-486.72 672,-480.72 672,-474.72 672,-474.72 672,-407.72 672,-407.72 672,-401.72 678,-395.72 684,-395.72"/>
<text text-anchor="start" x="680" y="-471.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnStatus</text>
<text text-anchor="start" x="680" y="-456.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Get</text>
<polyline fill="none" stroke="#1c2123" points="672,-448.72 826,-448.72 "/>
<text text-anchor="start" x="680" y="-433.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">使用Lock.ts</text>
<text text-anchor="start" x="680" y="-418.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从txn_status map</text>
<text text-anchor="start" x="680" y="-403.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取事务的 commit_ts</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;TxnStatus__Get -->
<g id="edge1" class="edge">
<title>ResolveLock__process_write&#45;&gt;TxnStatus__Get</title>
<path fill="none" stroke="#666666" d="M453.08,-385.25C502.85,-393.33 573.99,-405.29 636,-417.22 644.44,-418.85 653.23,-420.61 662,-422.41"/>
<polygon fill="#666666" stroke="#666666" points="661.37,-425.86 671.88,-424.46 662.8,-419 661.37,-425.86"/>
</g>
<!-- cleanup -->
<g id="node3" class="node">
<title>cleanup</title>
<path fill="none" stroke="#1c2123" d="M1032,-328.72C1032,-328.72 1163,-328.72 1163,-328.72 1169,-328.72 1175,-334.72 1175,-340.72 1175,-340.72 1175,-377.72 1175,-377.72 1175,-383.72 1169,-389.72 1163,-389.72 1163,-389.72 1032,-389.72 1032,-389.72 1026,-389.72 1020,-383.72 1020,-377.72 1020,-377.72 1020,-340.72 1020,-340.72 1020,-334.72 1026,-328.72 1032,-328.72"/>
<text text-anchor="start" x="1028" y="-374.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">cleaup</text>
<polyline fill="none" stroke="#1c2123" points="1020,-366.72 1175,-366.72 "/>
<text text-anchor="start" x="1028" y="-351.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">如果commit_ts.is_zero()</text>
<text text-anchor="start" x="1028" y="-336.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 则cleaup txn</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;cleanup -->
<g id="edge2" class="edge">
<title>ResolveLock__process_write&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M453.01,-373.8C579.67,-370.93 865.33,-364.46 1009.62,-361.19"/>
<polygon fill="#666666" stroke="#666666" points="1009.84,-364.69 1019.76,-360.96 1009.68,-357.69 1009.84,-364.69"/>
</g>
<!-- commit -->
<g id="node4" class="node">
<title>commit</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1034.5,-149.22C1034.5,-149.22 1160.5,-149.22 1160.5,-149.22 1166.5,-149.22 1172.5,-155.22 1172.5,-161.22 1172.5,-161.22 1172.5,-213.22 1172.5,-213.22 1172.5,-219.22 1166.5,-225.22 1160.5,-225.22 1160.5,-225.22 1034.5,-225.22 1034.5,-225.22 1028.5,-225.22 1022.5,-219.22 1022.5,-213.22 1022.5,-213.22 1022.5,-161.22 1022.5,-161.22 1022.5,-155.22 1028.5,-149.22 1034.5,-149.22"/>
<text text-anchor="start" x="1030.5" y="-210.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">commit</text>
<polyline fill="none" stroke="#8a8898" points="1022.5,-202.22 1172.5,-202.22 "/>
<text text-anchor="start" x="1030.5" y="-187.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">提交事务</text>
<text text-anchor="start" x="1030.5" y="-172.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 如果事务的commit_ts</text>
<text text-anchor="start" x="1030.5" y="-157.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> &gt;0就提交事务</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;commit -->
<g id="edge3" class="edge">
<title>ResolveLock__process_write&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M405.62,-344.61C422.13,-315.74 451.03,-273.9 489,-253.22 656.88,-161.8 889.39,-166.38 1012.39,-177.11"/>
<polygon fill="#666666" stroke="#666666" points="1012.22,-180.61 1022.5,-178.02 1012.85,-173.64 1012.22,-180.61"/>
</g>
<!-- ResolveLockReadPhase -->
<g id="node5" class="node">
<title>ResolveLockReadPhase</title>
<path fill="none" stroke="#1c2123" d="M624,-331.22C624,-331.22 501,-331.22 501,-331.22 495,-331.22 489,-325.22 489,-319.22 489,-319.22 489,-307.22 489,-307.22 489,-301.22 495,-295.22 501,-295.22 501,-295.22 624,-295.22 624,-295.22 630,-295.22 636,-301.22 636,-307.22 636,-307.22 636,-319.22 636,-319.22 636,-325.22 630,-331.22 624,-331.22"/>
<text text-anchor="middle" x="562.5" y="-309.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">ResolveLockReadPhase</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;ResolveLockReadPhase -->
<g id="edge4" class="edge">
<title>ResolveLock__process_write&#45;&gt;ResolveLockReadPhase</title>
<path fill="none" stroke="#666666" d="M453.37,-352.31C469.26,-346.57 486.24,-340.43 501.93,-334.76"/>
<polygon fill="#666666" stroke="#666666" points="503.3,-337.99 511.51,-331.3 500.92,-331.4 503.3,-337.99"/>
</g>
<!-- ReleasedLocks__wake_up -->
<g id="node6" class="node">
<title>ReleasedLocks__wake_up</title>
<path fill="none" stroke="#1c2123" d="M1270,-249.22C1270,-249.22 1344,-249.22 1344,-249.22 1350,-249.22 1356,-255.22 1356,-261.22 1356,-261.22 1356,-275.22 1356,-275.22 1356,-281.22 1350,-287.22 1344,-287.22 1344,-287.22 1270,-287.22 1270,-287.22 1264,-287.22 1258,-281.22 1258,-275.22 1258,-275.22 1258,-261.22 1258,-261.22 1258,-255.22 1264,-249.22 1270,-249.22"/>
<text text-anchor="start" x="1266" y="-272.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">ReleasedLocks</text>
<text text-anchor="start" x="1266" y="-257.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> wake_up</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge5" class="edge">
<title>ResolveLock__process_write&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="#666666" d="M414.61,-344.34C432.8,-323.97 459.44,-298.82 489,-286.22 595.19,-240.99 632.58,-267.22 748,-267.22 748,-267.22 748,-267.22 924,-267.22 1038.65,-267.22 1172.65,-267.68 1247.58,-267.98"/>
<polygon fill="#666666" stroke="#666666" points="1247.74,-271.48 1257.76,-268.02 1247.77,-264.48 1247.74,-271.48"/>
</g>
<!-- ErrorInner__InvalidTxnTso -->
<g id="node7" class="node">
<title>ErrorInner__InvalidTxnTso</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1935.5,-907.22C1935.5,-907.22 2012.5,-907.22 2012.5,-907.22 2018.5,-907.22 2024.5,-913.22 2024.5,-919.22 2024.5,-919.22 2024.5,-933.22 2024.5,-933.22 2024.5,-939.22 2018.5,-945.22 2012.5,-945.22 2012.5,-945.22 1935.5,-945.22 1935.5,-945.22 1929.5,-945.22 1923.5,-939.22 1923.5,-933.22 1923.5,-933.22 1923.5,-919.22 1923.5,-919.22 1923.5,-913.22 1929.5,-907.22 1935.5,-907.22"/>
<text text-anchor="start" x="1931.5" y="-930.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">ErrorInner</text>
<text text-anchor="start" x="1931.5" y="-915.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> InvalidTxnTso</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;ErrorInner__InvalidTxnTso -->
<g id="edge6" class="edge">
<title>ResolveLock__process_write&#45;&gt;ErrorInner__InvalidTxnTso</title>
<path fill="none" stroke="#666666" d="M393.52,-406.06C409.23,-527.25 484.14,-964.22 748,-964.22 748,-964.22 748,-964.22 1531.5,-964.22 1668.64,-964.22 1828.85,-945.8 1913.52,-934.61"/>
<polygon fill="#666666" stroke="#666666" points="1914.01,-938.08 1923.46,-933.28 1913.09,-931.14 1914.01,-938.08"/>
</g>
<!-- current_lock_ts -->
<g id="node8" class="node">
<title>current_lock_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M514.5,-426.22C514.5,-426.22 610.5,-426.22 610.5,-426.22 616.5,-426.22 622.5,-432.22 622.5,-438.22 622.5,-438.22 622.5,-460.22 622.5,-460.22 622.5,-466.22 616.5,-472.22 610.5,-472.22 610.5,-472.22 514.5,-472.22 514.5,-472.22 508.5,-472.22 502.5,-466.22 502.5,-460.22 502.5,-460.22 502.5,-438.22 502.5,-438.22 502.5,-432.22 508.5,-426.22 514.5,-426.22"/>
<text text-anchor="start" x="510.5" y="-457.02" font-family="Times,serif" font-size="14.00" fill="#40575d">current_lock.ts</text>
<polyline fill="none" stroke="#f7e495" points="502.5,-449.22 622.5,-449.22 "/>
<text text-anchor="start" x="510.5" y="-434.02" font-family="Times,serif" font-size="14.00" fill="#40575d">当前遍历lock的ts</text>
</g>
<!-- ResolveLock__process_write&#45;&gt;current_lock_ts -->
<g id="edge7" class="edge">
<title>ResolveLock__process_write&#45;&gt;current_lock_ts</title>
<path fill="none" stroke="#666666" d="M453.37,-402.57C468.09,-408.92 483.75,-415.68 498.45,-422.02"/>
<polygon fill="#666666" stroke="#666666" points="497.38,-425.37 507.95,-426.12 500.16,-418.94 497.38,-425.37"/>
</g>
<!-- commit_ts -->
<g id="node10" class="node">
<title>commit_ts</title>
<path fill="#feed9b" stroke="#f7e495" d="M874,-401.22C874,-401.22 972,-401.22 972,-401.22 978,-401.22 984,-407.22 984,-413.22 984,-413.22 984,-427.22 984,-427.22 984,-433.22 978,-439.22 972,-439.22 972,-439.22 874,-439.22 874,-439.22 868,-439.22 862,-433.22 862,-427.22 862,-427.22 862,-413.22 862,-413.22 862,-407.22 868,-401.22 874,-401.22"/>
<text text-anchor="start" x="870" y="-424.02" font-family="Times,serif" font-size="14.00" fill="#40575d">commit_ts</text>
<text text-anchor="start" x="870" y="-409.02" font-family="Times,serif" font-size="14.00" fill="#40575d"> 事务的commit_ts</text>
</g>
<!-- TxnStatus__Get&#45;&gt;commit_ts -->
<g id="edge9" class="edge">
<title>TxnStatus__Get&#45;&gt;commit_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M826.19,-431.92C834.69,-430.88 843.32,-429.83 851.73,-428.8"/>
<polygon fill="green" stroke="green" points="852.37,-432.25 861.87,-427.57 851.52,-425.3 852.37,-432.25"/>
</g>
<!-- cleanup&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge34" class="edge">
<title>cleanup&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1155.36,-328.67C1172.98,-319.68 1192.6,-310.14 1211,-302.22 1222.81,-297.14 1235.65,-292.18 1247.97,-287.69"/>
<polygon fill="green" stroke="green" points="1249.48,-290.87 1257.7,-284.19 1247.11,-284.28 1249.48,-290.87"/>
</g>
<!-- SnapshotReader__load_lock -->
<g id="node11" class="node">
<title>SnapshotReader__load_lock</title>
<path fill="none" stroke="#1c2123" d="M1490.5,-205.22C1490.5,-205.22 1570.5,-205.22 1570.5,-205.22 1576.5,-205.22 1582.5,-211.22 1582.5,-217.22 1582.5,-217.22 1582.5,-231.22 1582.5,-231.22 1582.5,-237.22 1576.5,-243.22 1570.5,-243.22 1570.5,-243.22 1490.5,-243.22 1490.5,-243.22 1484.5,-243.22 1478.5,-237.22 1478.5,-231.22 1478.5,-231.22 1478.5,-217.22 1478.5,-217.22 1478.5,-211.22 1484.5,-205.22 1490.5,-205.22"/>
<text text-anchor="start" x="1486.5" y="-228.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="1486.5" y="-213.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> load_lock</text>
</g>
<!-- cleanup&#45;&gt;SnapshotReader__load_lock -->
<g id="edge18" class="edge">
<title>cleanup&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M1175.14,-371.32C1241.25,-377.54 1336.32,-375.95 1403,-330.22 1432.51,-309.99 1412.42,-282.17 1439,-258.22 1447.58,-250.49 1458.1,-244.46 1468.88,-239.77"/>
<polygon fill="#666666" stroke="#666666" points="1470.38,-242.94 1478.38,-235.99 1467.79,-236.44 1470.38,-242.94"/>
</g>
<!-- rollback_lock -->
<g id="node12" class="node">
<title>rollback_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1252,-588.22C1252,-588.22 1362,-588.22 1362,-588.22 1368,-588.22 1374,-594.22 1374,-600.22 1374,-600.22 1374,-652.22 1374,-652.22 1374,-658.22 1368,-664.22 1362,-664.22 1362,-664.22 1252,-664.22 1252,-664.22 1246,-664.22 1240,-658.22 1240,-652.22 1240,-652.22 1240,-600.22 1240,-600.22 1240,-594.22 1246,-588.22 1252,-588.22"/>
<text text-anchor="start" x="1248" y="-649.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">rollback_lock</text>
<polyline fill="none" stroke="#8a8898" points="1240,-641.22 1374,-641.22 "/>
<text text-anchor="start" x="1248" y="-626.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">回滚事务</text>
<text text-anchor="start" x="1248" y="-611.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 如果lock_type为Put</text>
<text text-anchor="start" x="1248" y="-596.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 需要delete_value</text>
</g>
<!-- cleanup&#45;&gt;rollback_lock -->
<g id="edge19" class="edge">
<title>cleanup&#45;&gt;rollback_lock</title>
<path fill="none" stroke="#666666" d="M1122.3,-389.85C1158.45,-436.37 1227.45,-525.15 1269.83,-579.68"/>
<polygon fill="#666666" stroke="#666666" points="1267.24,-582.05 1276.14,-587.8 1272.76,-577.75 1267.24,-582.05"/>
</g>
<!-- check_txn_status_missing_lock -->
<g id="node13" class="node">
<title>check_txn_status_missing_lock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M1224.5,-383.22C1224.5,-383.22 1389.5,-383.22 1389.5,-383.22 1395.5,-383.22 1401.5,-389.22 1401.5,-395.22 1401.5,-395.22 1401.5,-447.22 1401.5,-447.22 1401.5,-453.22 1395.5,-459.22 1389.5,-459.22 1389.5,-459.22 1224.5,-459.22 1224.5,-459.22 1218.5,-459.22 1212.5,-453.22 1212.5,-447.22 1212.5,-447.22 1212.5,-395.22 1212.5,-395.22 1212.5,-389.22 1218.5,-383.22 1224.5,-383.22"/>
<text text-anchor="start" x="1220.5" y="-444.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">check_txn_status_missing_lock</text>
<polyline fill="none" stroke="#8a8898" points="1212.5,-436.22 1401.5,-436.22 "/>
<text text-anchor="start" x="1220.5" y="-421.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">lock不存在</text>
<text text-anchor="start" x="1220.5" y="-406.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 或者Lock已经</text>
<text text-anchor="start" x="1220.5" y="-391.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> 被其他事务所持有</text>
</g>
<!-- cleanup&#45;&gt;check_txn_status_missing_lock -->
<g id="edge20" class="edge">
<title>cleanup&#45;&gt;check_txn_status_missing_lock</title>
<path fill="none" stroke="#666666" d="M1175.18,-382.13C1184.17,-384.82 1193.46,-387.6 1202.74,-390.37"/>
<polygon fill="#666666" stroke="#666666" points="1201.82,-393.75 1212.4,-393.26 1203.83,-387.04 1201.82,-393.75"/>
</g>
<!-- ErrorInner__KeyIsLocked -->
<g id="node14" class="node">
<title>ErrorInner__KeyIsLocked</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1939.5,-81.22C1939.5,-81.22 2008.5,-81.22 2008.5,-81.22 2014.5,-81.22 2020.5,-87.22 2020.5,-93.22 2020.5,-93.22 2020.5,-107.22 2020.5,-107.22 2020.5,-113.22 2014.5,-119.22 2008.5,-119.22 2008.5,-119.22 1939.5,-119.22 1939.5,-119.22 1933.5,-119.22 1927.5,-113.22 1927.5,-107.22 1927.5,-107.22 1927.5,-93.22 1927.5,-93.22 1927.5,-87.22 1933.5,-81.22 1939.5,-81.22"/>
<text text-anchor="start" x="1935.5" y="-104.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">ErrorInner</text>
<text text-anchor="start" x="1935.5" y="-89.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> KeyIsLocked</text>
</g>
<!-- cleanup&#45;&gt;ErrorInner__KeyIsLocked -->
<g id="edge21" class="edge">
<title>cleanup&#45;&gt;ErrorInner__KeyIsLocked</title>
<path fill="none" stroke="#666666" d="M1175.17,-338.62C1187.13,-335.65 1199.37,-332.75 1211,-330.22 1295.69,-311.84 1336.82,-352.17 1403,-296.22 1439.39,-265.46 1402.62,-226.01 1439,-195.22 1577.79,-77.79 1810.97,-83.46 1917.22,-93.34"/>
<polygon fill="#666666" stroke="#666666" points="1917.11,-96.84 1927.4,-94.33 1917.79,-89.88 1917.11,-96.84"/>
</g>
<!-- commit&#45;&gt;ReleasedLocks__wake_up -->
<g id="edge33" class="edge">
<title>commit&#45;&gt;ReleasedLocks__wake_up</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1172.71,-218.87C1185.44,-224.11 1198.57,-229.41 1211,-234.22 1222.99,-238.87 1235.91,-243.65 1248.24,-248.1"/>
<polygon fill="green" stroke="green" points="1247.38,-251.51 1257.98,-251.59 1249.75,-244.92 1247.38,-251.51"/>
</g>
<!-- commit&#45;&gt;SnapshotReader__load_lock -->
<g id="edge22" class="edge">
<title>commit&#45;&gt;SnapshotReader__load_lock</title>
<path fill="none" stroke="#666666" d="M1172.59,-193.59C1256.09,-200.75 1390.3,-212.27 1468.16,-218.96"/>
<polygon fill="#666666" stroke="#666666" points="1468.03,-222.46 1478.3,-219.83 1468.63,-215.49 1468.03,-222.46"/>
</g>
<!-- Write__has_ovelapped_rollback -->
<g id="node15" class="node">
<title>Write__has_ovelapped_rollback</title>
<path fill="none" stroke="#1c2123" d="M1391,-154.22C1391,-154.22 1223,-154.22 1223,-154.22 1217,-154.22 1211,-148.22 1211,-142.22 1211,-142.22 1211,-130.22 1211,-130.22 1211,-124.22 1217,-118.22 1223,-118.22 1223,-118.22 1391,-118.22 1391,-118.22 1397,-118.22 1403,-124.22 1403,-130.22 1403,-130.22 1403,-142.22 1403,-142.22 1403,-148.22 1397,-154.22 1391,-154.22"/>
<text text-anchor="middle" x="1307" y="-132.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">Write__has_ovelapped_rollback</text>
</g>
<!-- commit&#45;&gt;Write__has_ovelapped_rollback -->
<g id="edge23" class="edge">
<title>commit&#45;&gt;Write__has_ovelapped_rollback</title>
<path fill="none" stroke="#666666" d="M1172.53,-169.03C1188.88,-165.01 1206.3,-160.73 1222.97,-156.63"/>
<polygon fill="#666666" stroke="#666666" points="1223.82,-160.03 1232.69,-154.24 1222.15,-153.23 1223.82,-160.03"/>
</g>
<!-- Lock__rollback_ts -->
<g id="node16" class="node">
<title>Lock__rollback_ts</title>
<path fill="none" stroke="#1c2123" d="M2136,-344.22C2136,-344.22 2192,-344.22 2192,-344.22 2198,-344.22 2204,-350.22 2204,-356.22 2204,-356.22 2204,-370.22 2204,-370.22 2204,-376.22 2198,-382.22 2192,-382.22 2192,-382.22 2136,-382.22 2136,-382.22 2130,-382.22 2124,-376.22 2124,-370.22 2124,-370.22 2124,-356.22 2124,-356.22 2124,-350.22 2130,-344.22 2136,-344.22"/>
<text text-anchor="start" x="2132" y="-367.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">Lock</text>
<text text-anchor="start" x="2132" y="-352.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rollback_ts</text>
</g>
<!-- commit&#45;&gt;Lock__rollback_ts -->
<g id="edge24" class="edge">
<title>commit&#45;&gt;Lock__rollback_ts</title>
<path fill="none" stroke="#666666" d="M1172.81,-184.2C1389.78,-175.98 2011.95,-157.01 2088,-206.22 2132.09,-234.75 2150.88,-296.93 2158.41,-333.91"/>
<polygon fill="#666666" stroke="#666666" points="2155.03,-334.88 2160.32,-344.06 2161.91,-333.59 2155.03,-334.88"/>
</g>
<!-- MvccTxn__put_write -->
<g id="node17" class="node">
<title>MvccTxn__put_write</title>
<path fill="none" stroke="#1c2123" d="M2252,-295.22C2252,-295.22 2386,-295.22 2386,-295.22 2392,-295.22 2398,-301.22 2398,-307.22 2398,-307.22 2398,-397.22 2398,-397.22 2398,-403.22 2392,-409.22 2386,-409.22 2386,-409.22 2252,-409.22 2252,-409.22 2246,-409.22 2240,-403.22 2240,-397.22 2240,-397.22 2240,-307.22 2240,-307.22 2240,-301.22 2246,-295.22 2252,-295.22"/>
<text text-anchor="start" x="2248" y="-394.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="2248" y="-379.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> put_write</text>
<polyline fill="none" stroke="#1c2123" points="2240,-371.22 2398,-371.22 "/>
<text text-anchor="start" x="2248" y="-356.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback 时，write key为</text>
<text text-anchor="start" x="2248" y="-341.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> key start_ts</text>
<polyline fill="none" stroke="#1c2123" points="2240,-333.22 2398,-333.22 "/>
<text text-anchor="start" x="2248" y="-318.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">commit时， write key为</text>
<text text-anchor="start" x="2248" y="-303.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> key commit_ts</text>
</g>
<!-- commit&#45;&gt;MvccTxn__put_write -->
<g id="edge25" class="edge">
<title>commit&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M1132.18,-149.14C1152.79,-128.45 1180.91,-104.45 1211,-91.22 1341.56,-33.84 1386.89,-52.22 1529.5,-52.22 1529.5,-52.22 1529.5,-52.22 1975,-52.22 2025.93,-52.22 2043.95,-45.67 2088,-71.22 2175.88,-122.21 2244.27,-220.38 2282.88,-286.11"/>
<polygon fill="#666666" stroke="#666666" points="2280.08,-288.26 2288.13,-295.16 2286.14,-284.75 2280.08,-288.26"/>
</g>
<!-- MvccTxn__unlock_key -->
<g id="node18" class="node">
<title>MvccTxn__unlock_key</title>
<path fill="none" stroke="#1c2123" d="M2265,-6.22C2265,-6.22 2373,-6.22 2373,-6.22 2379,-6.22 2385,-12.22 2385,-18.22 2385,-18.22 2385,-70.22 2385,-70.22 2385,-76.22 2379,-82.22 2373,-82.22 2373,-82.22 2265,-82.22 2265,-82.22 2259,-82.22 2253,-76.22 2253,-70.22 2253,-70.22 2253,-18.22 2253,-18.22 2253,-12.22 2259,-6.22 2265,-6.22"/>
<text text-anchor="start" x="2261" y="-67.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="2261" y="-52.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> unlock_key</text>
<polyline fill="none" stroke="#1c2123" points="2253,-44.22 2385,-44.22 "/>
<text text-anchor="start" x="2261" y="-29.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">rollback或者commit</text>
<text text-anchor="start" x="2261" y="-14.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 时，会unlock key</text>
</g>
<!-- commit&#45;&gt;MvccTxn__unlock_key -->
<g id="edge26" class="edge">
<title>commit&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M1115.57,-149.22C1133.73,-113.77 1166.05,-62.76 1211,-38.22 1335.6,29.79 1387.54,-14.22 1529.5,-14.22 1529.5,-14.22 1529.5,-14.22 1975,-14.22 2067.44,-14.22 2173.36,-25.17 2242.75,-33.84"/>
<polygon fill="#666666" stroke="#666666" points="2242.35,-37.32 2252.71,-35.1 2243.23,-30.37 2242.35,-37.32"/>
</g>
<!-- ErrorInner__TxnLockNotFound -->
<g id="node19" class="node">
<title>ErrorInner__TxnLockNotFound</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1923.5,-253.22C1923.5,-253.22 2024.5,-253.22 2024.5,-253.22 2030.5,-253.22 2036.5,-259.22 2036.5,-265.22 2036.5,-265.22 2036.5,-279.22 2036.5,-279.22 2036.5,-285.22 2030.5,-291.22 2024.5,-291.22 2024.5,-291.22 1923.5,-291.22 1923.5,-291.22 1917.5,-291.22 1911.5,-285.22 1911.5,-279.22 1911.5,-279.22 1911.5,-265.22 1911.5,-265.22 1911.5,-259.22 1917.5,-253.22 1923.5,-253.22"/>
<text text-anchor="start" x="1919.5" y="-276.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">ErrorInner</text>
<text text-anchor="start" x="1919.5" y="-261.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> TxnLockNotFound</text>
</g>
<!-- commit&#45;&gt;ErrorInner__TxnLockNotFound -->
<g id="edge27" class="edge">
<title>commit&#45;&gt;ErrorInner__TxnLockNotFound</title>
<path fill="none" stroke="#666666" d="M1140.34,-149.11C1160.22,-133.52 1185.25,-117.28 1211,-109.22 1292.44,-83.75 1318.49,-97.38 1403,-109.22 1594.81,-136.11 1812.62,-211.55 1914.57,-249.63"/>
<polygon fill="#666666" stroke="#666666" points="1913.47,-252.96 1924.07,-253.19 1915.93,-246.4 1913.47,-252.96"/>
</g>
<!-- current_lock_ts&#45;&gt;TxnStatus__Get -->
<g id="edge15" class="edge">
<title>current_lock_ts&#45;&gt;TxnStatus__Get</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M622.64,-446.66C635.15,-446.12 648.61,-445.53 661.89,-444.96"/>
<polygon fill="green" stroke="green" points="662.15,-448.45 671.99,-444.52 661.85,-441.46 662.15,-448.45"/>
</g>
<!-- current_lock_ts&#45;&gt;commit -->
<g id="edge13" class="edge">
<title>current_lock_ts&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M601.46,-426.09C622.08,-413.8 648.17,-398.7 672,-386.22 788.37,-325.31 926.7,-262.12 1013.07,-223.73"/>
<polygon fill="#666666" stroke="#666666" points="1014.58,-226.89 1022.3,-219.63 1011.74,-220.49 1014.58,-226.89"/>
</g>
<!-- current_lock_ts&#45;&gt;ErrorInner__InvalidTxnTso -->
<g id="edge14" class="edge">
<title>current_lock_ts&#45;&gt;ErrorInner__InvalidTxnTso</title>
<path fill="none" stroke="#666666" d="M568.62,-472.23C591.31,-567.51 692.02,-926.22 922,-926.22 922,-926.22 922,-926.22 1531.5,-926.22 1667.99,-926.22 1828.22,-926.22 1913.12,-926.22"/>
<polygon fill="#666666" stroke="#666666" points="1913.34,-929.72 1923.34,-926.22 1913.34,-922.72 1913.34,-929.72"/>
</g>
<!-- ResolveLock -->
<g id="node9" class="node">
<title>ResolveLock</title>
<path fill="#a2dbfa" stroke="#8a8898" d="M12,-438.22C12,-438.22 277,-438.22 277,-438.22 283,-438.22 289,-444.22 289,-450.22 289,-450.22 289,-518.22 289,-518.22 289,-524.22 283,-530.22 277,-530.22 277,-530.22 12,-530.22 12,-530.22 6,-530.22 0,-524.22 0,-518.22 0,-518.22 0,-450.22 0,-450.22 0,-444.22 6,-438.22 12,-438.22"/>
<text text-anchor="start" x="8" y="-515.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">ResolveLock</text>
<polyline fill="none" stroke="#8a8898" points="0,-507.22 289,-507.22 "/>
<text text-anchor="start" x="8" y="-492.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">txn_status: HashMap&lt;TimeStamp, TimeStamp&gt;,</text>
<polyline fill="none" stroke="#8a8898" points="0,-484.22 289,-484.22 "/>
<text text-anchor="start" x="8" y="-469.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">scan_key: Option&lt;Key&gt;,</text>
<polyline fill="none" stroke="#8a8898" points="0,-461.22 289,-461.22 "/>
<text text-anchor="start" x="8" y="-446.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">key_locks: Vec&lt;(Key, Lock)&gt;,</text>
</g>
<!-- ResolveLock&#45;&gt;ResolveLock__process_write -->
<g id="edge17" class="edge">
<title>ResolveLock&#45;&gt;ResolveLock__process_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M247.99,-438.16C270.74,-427.93 294.38,-417.3 315.63,-407.75"/>
<polygon fill="green" stroke="green" points="317.2,-410.88 324.89,-403.59 314.33,-404.5 317.2,-410.88"/>
</g>
<!-- ResolveLock&#45;&gt;TxnStatus__Get -->
<g id="edge8" class="edge">
<title>ResolveLock:txn_status&#45;&gt;TxnStatus__Get</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M289,-496.22C443.35,-496.22 484.6,-512.23 636,-482.22 644.56,-480.53 653.34,-478.28 662.03,-475.71"/>
<polygon fill="green" stroke="green" points="663.27,-478.98 671.78,-472.68 661.2,-472.3 663.27,-478.98"/>
</g>
<!-- ResolveLock&#45;&gt;current_lock_ts -->
<g id="edge10" class="edge">
<title>ResolveLock:key_lock&#45;&gt;current_lock_ts</title>
<path fill="none" stroke="#666666" d="M289,-449.22C358.11,-449.22 437.08,-449.22 492.16,-449.22"/>
<polygon fill="#666666" stroke="#666666" points="492.5,-452.72 502.5,-449.22 492.5,-445.72 492.5,-452.72"/>
</g>
<!-- commit_ts&#45;&gt;cleanup -->
<g id="edge11" class="edge">
<title>commit_ts&#45;&gt;cleanup</title>
<path fill="none" stroke="#666666" d="M978.11,-401.09C988.35,-397.47 999.29,-393.6 1010.24,-389.73"/>
<polygon fill="#666666" stroke="#666666" points="1011.58,-392.97 1019.84,-386.33 1009.25,-386.37 1011.58,-392.97"/>
</g>
<!-- commit_ts&#45;&gt;commit -->
<g id="edge12" class="edge">
<title>commit_ts&#45;&gt;commit</title>
<path fill="none" stroke="#666666" d="M938.12,-401.16C964.95,-364.92 1024,-285.15 1061.93,-233.91"/>
<polygon fill="#666666" stroke="#666666" points="1064.93,-235.75 1068.06,-225.63 1059.3,-231.59 1064.93,-235.75"/>
</g>
<!-- commit_ts&#45;&gt;ErrorInner__InvalidTxnTso -->
<g id="edge16" class="edge">
<title>commit_ts&#45;&gt;ErrorInner__InvalidTxnTso</title>
<path fill="none" stroke="#666666" d="M929.15,-439.44C954.02,-527.51 1070.28,-888.22 1306,-888.22 1306,-888.22 1306,-888.22 1531.5,-888.22 1668.64,-888.22 1828.85,-906.65 1913.52,-917.84"/>
<polygon fill="#666666" stroke="#666666" points="1913.09,-921.31 1923.46,-919.17 1914.01,-914.37 1913.09,-921.31"/>
</g>
<!-- SnapshotReader__load_lock&#45;&gt;Lock__rollback_ts -->
<g id="edge52" class="edge">
<title>SnapshotReader__load_lock&#45;&gt;Lock__rollback_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1582.7,-219.99C1703.62,-210.94 2003.11,-194.26 2088,-243.22 2122.46,-263.1 2143.33,-305.83 2154.02,-334.56"/>
<polygon fill="green" stroke="green" points="2150.75,-335.82 2157.38,-344.08 2157.35,-333.49 2150.75,-335.82"/>
</g>
<!-- rollback_lock&#45;&gt;MvccTxn__put_write -->
<g id="edge45" class="edge">
<title>rollback_lock&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M1374.16,-638.99C1513.53,-662.62 1844.53,-701.33 2088,-591.22 2169.14,-554.53 2236.18,-474.95 2276.55,-417.69"/>
<polygon fill="#666666" stroke="#666666" points="2279.47,-419.62 2282.31,-409.42 2273.72,-415.63 2279.47,-419.62"/>
</g>
<!-- rollback_lock&#45;&gt;MvccTxn__unlock_key -->
<g id="edge46" class="edge">
<title>rollback_lock&#45;&gt;MvccTxn__unlock_key</title>
<path fill="none" stroke="#666666" d="M1374.09,-621.51C1551,-608.49 2026.16,-570.7 2088,-536.22 2159.78,-496.21 2164.79,-464.45 2204,-392.22 2207.71,-385.39 2272.29,-185.89 2302.57,-92.09"/>
<polygon fill="#666666" stroke="#666666" points="2305.91,-93.13 2305.65,-82.54 2299.25,-90.98 2305.91,-93.13"/>
</g>
<!-- SnapshotReader__get_txn_commit_record -->
<g id="node20" class="node">
<title>SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#1c2123" d="M1466.5,-487.22C1466.5,-487.22 1594.5,-487.22 1594.5,-487.22 1600.5,-487.22 1606.5,-493.22 1606.5,-499.22 1606.5,-499.22 1606.5,-513.22 1606.5,-513.22 1606.5,-519.22 1600.5,-525.22 1594.5,-525.22 1594.5,-525.22 1466.5,-525.22 1466.5,-525.22 1460.5,-525.22 1454.5,-519.22 1454.5,-513.22 1454.5,-513.22 1454.5,-499.22 1454.5,-499.22 1454.5,-493.22 1460.5,-487.22 1466.5,-487.22"/>
<text text-anchor="start" x="1462.5" y="-510.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="1462.5" y="-495.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> get_txn_commit_record</text>
</g>
<!-- rollback_lock&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge47" class="edge">
<title>rollback_lock&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M1374.16,-590.38C1410.01,-570.96 1453.34,-547.48 1485.13,-530.26"/>
<polygon fill="#666666" stroke="#666666" points="1487.06,-533.2 1494.18,-525.36 1483.72,-527.05 1487.06,-533.2"/>
</g>
<!-- collapse_prev_rollback -->
<g id="node25" class="node">
<title>collapse_prev_rollback</title>
<path fill="none" stroke="#1c2123" d="M1914.5,-664.22C1914.5,-664.22 2033.5,-664.22 2033.5,-664.22 2039.5,-664.22 2045.5,-670.22 2045.5,-676.22 2045.5,-676.22 2045.5,-728.22 2045.5,-728.22 2045.5,-734.22 2039.5,-740.22 2033.5,-740.22 2033.5,-740.22 1914.5,-740.22 1914.5,-740.22 1908.5,-740.22 1902.5,-734.22 1902.5,-728.22 1902.5,-728.22 1902.5,-676.22 1902.5,-676.22 1902.5,-670.22 1908.5,-664.22 1914.5,-664.22"/>
<text text-anchor="start" x="1910.5" y="-725.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">collapse_prev_rollback</text>
<polyline fill="none" stroke="#1c2123" points="1902.5,-717.22 2045.5,-717.22 "/>
<text text-anchor="start" x="1910.5" y="-702.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">清理掉之前的</text>
<text text-anchor="start" x="1910.5" y="-687.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Rollback类型的</text>
<text text-anchor="start" x="1910.5" y="-672.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> Write</text>
</g>
<!-- rollback_lock&#45;&gt;collapse_prev_rollback -->
<g id="edge48" class="edge">
<title>rollback_lock&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M1374.31,-657.5C1394.63,-665.72 1417.35,-673.58 1439,-678.22 1596.62,-712.05 1786.22,-711.02 1891.81,-706.86"/>
<polygon fill="#666666" stroke="#666666" points="1892.23,-710.35 1902.08,-706.44 1891.94,-703.36 1892.23,-710.35"/>
</g>
<!-- MvccTxn__delete_value -->
<g id="node30" class="node">
<title>MvccTxn__delete_value</title>
<path fill="none" stroke="#1c2123" d="M2267,-812.22C2267,-812.22 2371,-812.22 2371,-812.22 2377,-812.22 2383,-818.22 2383,-824.22 2383,-824.22 2383,-876.22 2383,-876.22 2383,-882.22 2377,-888.22 2371,-888.22 2371,-888.22 2267,-888.22 2267,-888.22 2261,-888.22 2255,-882.22 2255,-876.22 2255,-876.22 2255,-824.22 2255,-824.22 2255,-818.22 2261,-812.22 2267,-812.22"/>
<text text-anchor="start" x="2263" y="-873.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="2263" y="-858.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> delete_value</text>
<polyline fill="none" stroke="#1c2123" points="2255,-850.22 2383,-850.22 "/>
<text text-anchor="start" x="2263" y="-835.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">删掉lock类型为put</text>
<text text-anchor="start" x="2263" y="-820.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 所写入的value</text>
</g>
<!-- rollback_lock&#45;&gt;MvccTxn__delete_value -->
<g id="edge49" class="edge">
<title>rollback_lock&#45;&gt;MvccTxn__delete_value</title>
<path fill="none" stroke="#666666" d="M1320.22,-664.36C1337.92,-712.61 1375.69,-793.91 1439,-831.22 1554.48,-899.29 1605.96,-850.22 1740,-850.22 1740,-850.22 1740,-850.22 1975,-850.22 2067.89,-850.22 2174.93,-850.22 2244.39,-850.22"/>
<polygon fill="#666666" stroke="#666666" points="2244.78,-853.72 2254.78,-850.22 2244.78,-846.72 2244.78,-853.72"/>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;MvccTxn__put_write -->
<g id="edge37" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="#666666" d="M1374.32,-383.15C1394.64,-372.49 1417.36,-361.55 1439,-353.22 1712.06,-248.2 1802.58,-179.01 2088,-243.22 2137.7,-254.41 2189.29,-277.62 2230.97,-299.77"/>
<polygon fill="#666666" stroke="#666666" points="2229.52,-302.96 2239.99,-304.62 2232.84,-296.8 2229.52,-302.96"/>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;SnapshotReader__get_txn_commit_record -->
<g id="edge38" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;SnapshotReader__get_txn_commit_record</title>
<path fill="none" stroke="#666666" d="M1401.69,-457.85C1414.22,-462.71 1426.92,-467.6 1439,-472.22 1448.62,-475.91 1458.83,-479.78 1468.8,-483.53"/>
<polygon fill="#666666" stroke="#666666" points="1467.66,-486.84 1478.25,-487.09 1470.12,-480.29 1467.66,-486.84"/>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;collapse_prev_rollback -->
<g id="edge39" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="#666666" d="M1343.5,-459.43C1368.22,-484.07 1403.08,-515.15 1439,-535.22 1588.04,-618.51 1784.14,-666.16 1892.43,-687.84"/>
<polygon fill="#666666" stroke="#666666" points="1891.82,-691.29 1902.31,-689.79 1893.18,-684.42 1891.82,-691.29"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="node26" class="node">
<title>MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#1c2123" d="M1872,-488.22C1872,-488.22 2076,-488.22 2076,-488.22 2082,-488.22 2088,-494.22 2088,-500.22 2088,-500.22 2088,-514.22 2088,-514.22 2088,-520.22 2082,-526.22 2076,-526.22 2076,-526.22 1872,-526.22 1872,-526.22 1866,-526.22 1860,-520.22 1860,-514.22 1860,-514.22 1860,-500.22 1860,-500.22 1860,-494.22 1866,-488.22 1872,-488.22"/>
<text text-anchor="start" x="1868" y="-511.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="1868" y="-496.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> mark_rollback_on_mismatching_lock</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge40" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="#666666" d="M1401.52,-433.32C1518.75,-448.48 1720.04,-474.51 1849.75,-491.29"/>
<polygon fill="#666666" stroke="#666666" points="1849.37,-494.77 1859.74,-492.58 1850.27,-487.82 1849.37,-494.77"/>
</g>
<!-- ErrorInner__Committed -->
<g id="node27" class="node">
<title>ErrorInner__Committed</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1944.5,-367.22C1944.5,-367.22 2003.5,-367.22 2003.5,-367.22 2009.5,-367.22 2015.5,-373.22 2015.5,-379.22 2015.5,-379.22 2015.5,-393.22 2015.5,-393.22 2015.5,-399.22 2009.5,-405.22 2003.5,-405.22 2003.5,-405.22 1944.5,-405.22 1944.5,-405.22 1938.5,-405.22 1932.5,-399.22 1932.5,-393.22 1932.5,-393.22 1932.5,-379.22 1932.5,-379.22 1932.5,-373.22 1938.5,-367.22 1944.5,-367.22"/>
<text text-anchor="start" x="1940.5" y="-390.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">ErrorInner</text>
<text text-anchor="start" x="1940.5" y="-375.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> Committed</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;ErrorInner__Committed -->
<g id="edge35" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;ErrorInner__Committed</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1401.76,-408.94C1472.12,-400.37 1570.92,-389.69 1658,-385.22 1731.68,-381.45 1750.22,-384.98 1824,-385.22 1856.6,-385.33 1893.21,-385.58 1921.99,-385.8"/>
<polygon fill="green" stroke="green" points="1922.18,-389.3 1932.21,-385.88 1922.24,-382.3 1922.18,-389.3"/>
</g>
<!-- ErrorInner__TxnNotFound -->
<g id="node28" class="node">
<title>ErrorInner__TxnNotFound</title>
<path fill="#bcffb9" stroke="#8a8898" d="M1937.5,-310.22C1937.5,-310.22 2010.5,-310.22 2010.5,-310.22 2016.5,-310.22 2022.5,-316.22 2022.5,-322.22 2022.5,-322.22 2022.5,-336.22 2022.5,-336.22 2022.5,-342.22 2016.5,-348.22 2010.5,-348.22 2010.5,-348.22 1937.5,-348.22 1937.5,-348.22 1931.5,-348.22 1925.5,-342.22 1925.5,-336.22 1925.5,-336.22 1925.5,-322.22 1925.5,-322.22 1925.5,-316.22 1931.5,-310.22 1937.5,-310.22"/>
<text text-anchor="start" x="1933.5" y="-333.02" font-family="Times,serif" font-size="14.00" fill="#5d6179">ErrorInner</text>
<text text-anchor="start" x="1933.5" y="-318.02" font-family="Times,serif" font-size="14.00" fill="#5d6179"> TxnNotFound</text>
</g>
<!-- check_txn_status_missing_lock&#45;&gt;ErrorInner__TxnNotFound -->
<g id="edge36" class="edge">
<title>check_txn_status_missing_lock&#45;&gt;ErrorInner__TxnNotFound</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1401.59,-391.85C1414.09,-388.59 1426.8,-385.59 1439,-383.22 1610.4,-349.98 1816.96,-336.47 1915.4,-331.62"/>
<polygon fill="green" stroke="green" points="1915.61,-335.11 1925.43,-331.14 1915.28,-328.12 1915.61,-335.11"/>
</g>
<!-- MvccTxn__put_lock -->
<g id="node29" class="node">
<title>MvccTxn__put_lock</title>
<path fill="none" stroke="#1c2123" d="M2276.5,-525.22C2276.5,-525.22 2361.5,-525.22 2361.5,-525.22 2367.5,-525.22 2373.5,-531.22 2373.5,-537.22 2373.5,-537.22 2373.5,-589.22 2373.5,-589.22 2373.5,-595.22 2367.5,-601.22 2361.5,-601.22 2361.5,-601.22 2276.5,-601.22 2276.5,-601.22 2270.5,-601.22 2264.5,-595.22 2264.5,-589.22 2264.5,-589.22 2264.5,-537.22 2264.5,-537.22 2264.5,-531.22 2270.5,-525.22 2276.5,-525.22"/>
<text text-anchor="start" x="2272.5" y="-586.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="2272.5" y="-571.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> put_lock</text>
<polyline fill="none" stroke="#1c2123" points="2264.5,-563.22 2373.5,-563.22 "/>
<text text-anchor="start" x="2272.5" y="-548.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">更新lock的</text>
<text text-anchor="start" x="2272.5" y="-533.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> rollback_ts数组</text>
</g>
<!-- Lock__rollback_ts&#45;&gt;MvccTxn__put_lock -->
<g id="edge43" class="edge">
<title>Lock__rollback_ts&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2179.67,-382.4C2203.21,-413.17 2250.08,-474.43 2282.7,-517.08"/>
<polygon fill="green" stroke="green" points="2279.96,-519.26 2288.82,-525.08 2285.52,-515.01 2279.96,-519.26"/>
</g>
<!-- WriteType__Rollback -->
<g id="node21" class="node">
<title>WriteType__Rollback</title>
<path fill="none" stroke="#1c2123" d="M1797.5,-430.22C1797.5,-430.22 1684.5,-430.22 1684.5,-430.22 1678.5,-430.22 1672.5,-424.22 1672.5,-418.22 1672.5,-418.22 1672.5,-406.22 1672.5,-406.22 1672.5,-400.22 1678.5,-394.22 1684.5,-394.22 1684.5,-394.22 1797.5,-394.22 1797.5,-394.22 1803.5,-394.22 1809.5,-400.22 1809.5,-406.22 1809.5,-406.22 1809.5,-418.22 1809.5,-418.22 1809.5,-424.22 1803.5,-430.22 1797.5,-430.22"/>
<text text-anchor="middle" x="1741" y="-408.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">WriteType__Rollback</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;WriteType__Rollback -->
<g id="edge28" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;WriteType__Rollback</title>
<path fill="none" stroke="#666666" d="M1573.69,-487.2C1607.55,-471.94 1655.15,-450.48 1690.75,-434.43"/>
<polygon fill="#666666" stroke="#666666" points="1692.31,-437.56 1699.99,-430.26 1689.44,-431.18 1692.31,-437.56"/>
</g>
<!-- TxnCommitRecord__None -->
<g id="node22" class="node">
<title>TxnCommitRecord__None</title>
<path fill="none" stroke="#1c2123" d="M1812,-560.22C1812,-560.22 1670,-560.22 1670,-560.22 1664,-560.22 1658,-554.22 1658,-548.22 1658,-548.22 1658,-536.22 1658,-536.22 1658,-530.22 1664,-524.22 1670,-524.22 1670,-524.22 1812,-524.22 1812,-524.22 1818,-524.22 1824,-530.22 1824,-536.22 1824,-536.22 1824,-548.22 1824,-548.22 1824,-554.22 1818,-560.22 1812,-560.22"/>
<text text-anchor="middle" x="1741" y="-538.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">TxnCommitRecord__None</text>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None -->
<g id="edge29" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;TxnCommitRecord__None</title>
<path fill="none" stroke="#666666" d="M1606.77,-519.22C1620.1,-521.52 1634.12,-523.94 1647.85,-526.31"/>
<polygon fill="#666666" stroke="#666666" points="1647.33,-529.78 1657.78,-528.03 1648.52,-522.88 1647.33,-529.78"/>
</g>
<!-- SnapshotReader__get_txn_commit_record&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge53" class="edge">
<title>SnapshotReader__get_txn_commit_record&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1606.64,-506.39C1673.08,-506.55 1771.27,-506.77 1849.28,-506.94"/>
<polygon fill="green" stroke="green" points="1849.65,-510.45 1859.66,-506.97 1849.66,-503.45 1849.65,-510.45"/>
</g>
<!-- WriteType__Rollback&#45;&gt;ErrorInner__TxnLockNotFound -->
<g id="edge54" class="edge">
<title>WriteType__Rollback&#45;&gt;ErrorInner__TxnLockNotFound</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1755.91,-394.09C1776.08,-369.09 1815.91,-324.38 1860,-300.22 1872.75,-293.24 1887.25,-287.97 1901.51,-284.01"/>
<polygon fill="green" stroke="green" points="1902.52,-287.36 1911.32,-281.46 1900.77,-280.58 1902.52,-287.36"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;collapse_prev_rollback -->
<g id="edge31" class="edge">
<title>TxnCommitRecord__None&#45;&gt;collapse_prev_rollback</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1768.05,-560.27C1802.11,-583.86 1862.91,-625.97 1909.48,-658.22"/>
<polygon fill="green" stroke="green" points="1907.49,-661.1 1917.7,-663.92 1911.47,-655.35 1907.49,-661.1"/>
</g>
<!-- TxnCommitRecord__None&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock -->
<g id="edge32" class="edge">
<title>TxnCommitRecord__None&#45;&gt;MvccTxn__mark_rollback_on_mismatching_lock</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1824.09,-529.79C1832.39,-528.53 1840.93,-527.23 1849.54,-525.93"/>
<polygon fill="green" stroke="green" points="1850.3,-529.36 1859.66,-524.4 1849.25,-522.44 1850.3,-529.36"/>
</g>
<!-- SnapshotReader__seek_write -->
<g id="node23" class="node">
<title>SnapshotReader__seek_write</title>
<path fill="none" stroke="#1c2123" d="M1451,-730.72C1451,-730.72 1610,-730.72 1610,-730.72 1616,-730.72 1622,-736.72 1622,-742.72 1622,-742.72 1622,-809.72 1622,-809.72 1622,-815.72 1616,-821.72 1610,-821.72 1610,-821.72 1451,-821.72 1451,-821.72 1445,-821.72 1439,-815.72 1439,-809.72 1439,-809.72 1439,-742.72 1439,-742.72 1439,-736.72 1445,-730.72 1451,-730.72"/>
<text text-anchor="start" x="1447" y="-806.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">SnapshotReader</text>
<text text-anchor="start" x="1447" y="-791.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> seek_write</text>
<polyline fill="none" stroke="#1c2123" points="1439,-783.72 1622,-783.72 "/>
<text text-anchor="start" x="1447" y="-768.52" font-family="Times,serif" font-size="14.00" fill="#2f3638">参数为key, start_ts</text>
<text text-anchor="start" x="1447" y="-753.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 用于清理掉之前的Rollback</text>
<text text-anchor="start" x="1447" y="-738.52" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 类型的write</text>
</g>
<!-- MvccTxn__delete_write -->
<g id="node24" class="node">
<title>MvccTxn__delete_write</title>
<path fill="none" stroke="#1c2123" d="M2258.5,-668.22C2258.5,-668.22 2379.5,-668.22 2379.5,-668.22 2385.5,-668.22 2391.5,-674.22 2391.5,-680.22 2391.5,-680.22 2391.5,-762.22 2391.5,-762.22 2391.5,-768.22 2385.5,-774.22 2379.5,-774.22 2379.5,-774.22 2258.5,-774.22 2258.5,-774.22 2252.5,-774.22 2246.5,-768.22 2246.5,-762.22 2246.5,-762.22 2246.5,-680.22 2246.5,-680.22 2246.5,-674.22 2252.5,-668.22 2258.5,-668.22"/>
<text text-anchor="start" x="2254.5" y="-759.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">MvccTxn</text>
<text text-anchor="start" x="2254.5" y="-744.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> delete_write</text>
<polyline fill="none" stroke="#1c2123" points="2246.5,-736.22 2391.5,-736.22 "/>
<text text-anchor="start" x="2254.5" y="-721.02" font-family="Times,serif" font-size="14.00" fill="#2f3638">删掉write column 中</text>
<text text-anchor="start" x="2254.5" y="-706.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> key, start_ts之前的</text>
<text text-anchor="start" x="2254.5" y="-691.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 类型为rollback的</text>
<text text-anchor="start" x="2254.5" y="-676.02" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 切不被protected write</text>
</g>
<!-- SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write -->
<g id="edge30" class="edge">
<title>SnapshotReader__seek_write&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1622.25,-774.18C1732.53,-771.19 1924.18,-764.36 2088,-750.22 2137.38,-745.96 2192.48,-739.09 2236.37,-733.11"/>
<polygon fill="green" stroke="green" points="2236.98,-736.55 2246.41,-731.72 2236.03,-729.62 2236.98,-736.55"/>
</g>
<!-- collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write -->
<g id="edge50" class="edge">
<title>collapse_prev_rollback&#45;&gt;SnapshotReader__seek_write</title>
<path fill="none" stroke="#666666" d="M1902.4,-714.06C1829.35,-726.3 1714.6,-745.54 1632.08,-759.37"/>
<polygon fill="#666666" stroke="#666666" points="1631.46,-755.92 1622.18,-761.03 1632.62,-762.83 1631.46,-755.92"/>
</g>
<!-- collapse_prev_rollback&#45;&gt;MvccTxn__delete_write -->
<g id="edge51" class="edge">
<title>collapse_prev_rollback&#45;&gt;MvccTxn__delete_write</title>
<path fill="none" stroke="#666666" d="M2045.65,-706.14C2100.97,-709.2 2177.99,-713.47 2236.02,-716.68"/>
<polygon fill="#666666" stroke="#666666" points="2236.08,-720.19 2246.26,-717.25 2236.47,-713.2 2236.08,-720.19"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts -->
<g id="edge42" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;Lock__rollback_ts</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M1999.96,-488.1C2033.39,-462.5 2092.78,-417.01 2129.91,-388.57"/>
<polygon fill="green" stroke="green" points="2132.12,-391.29 2137.93,-382.43 2127.86,-385.73 2132.12,-391.29"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_write -->
<g id="edge41" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_write</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M2017.06,-488.22C2069.94,-464.32 2162.07,-422.69 2230.5,-391.76"/>
<polygon fill="green" stroke="green" points="2232.32,-394.78 2239.99,-387.48 2229.44,-388.4 2232.32,-394.78"/>
</g>
<!-- MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock -->
<g id="edge44" class="edge">
<title>MvccTxn__mark_rollback_on_mismatching_lock&#45;&gt;MvccTxn__put_lock</title>
<path fill="none" stroke="#666666" d="M1996.24,-526.42C2023.5,-549.64 2073.34,-587.45 2124,-602.22 2167.02,-614.77 2216.57,-604.41 2254.82,-591.22"/>
<polygon fill="#666666" stroke="#666666" points="2256.07,-594.49 2264.3,-587.82 2253.7,-587.91 2256.07,-594.49"/>
</g>
</g>
</svg>
