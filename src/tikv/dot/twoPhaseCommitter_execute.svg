<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.1 (20210417.1919)
 -->
<!-- Title: execute Pages: 1 -->
<svg width="1558pt" height="252pt"
 viewBox="0.00 0.00 1558.00 252.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 248)">
<title>execute</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-248 1554,-248 1554,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_twoPhaseCommitter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M118,-8C118,-8 1530,-8 1530,-8 1536,-8 1542,-14 1542,-20 1542,-20 1542,-224 1542,-224 1542,-230 1536,-236 1530,-236 1530,-236 118,-236 118,-236 112,-236 106,-230 106,-224 106,-224 106,-20 106,-20 106,-14 112,-8 118,-8"/>
<text text-anchor="middle" x="824" y="-216" font-family="Times,serif" font-size="20.00">twoPhaseCommitter</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_KVTxn</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-47C20,-47 74,-47 74,-47 80,-47 86,-53 86,-59 86,-59 86,-117 86,-117 86,-123 80,-129 74,-129 74,-129 20,-129 20,-129 14,-129 8,-123 8,-117 8,-117 8,-59 8,-59 8,-53 14,-47 20,-47"/>
<text text-anchor="middle" x="47" y="-109" font-family="Times,serif" font-size="20.00">KVTxn</text>
</g>
<!-- execute -->
<g id="node1" class="node">
<title>execute</title>
<path fill="none" stroke="#1c2123" d="M160,-91C160,-91 126,-91 126,-91 120,-91 114,-85 114,-79 114,-79 114,-67 114,-67 114,-61 120,-55 126,-55 126,-55 160,-55 160,-55 166,-55 172,-61 172,-67 172,-67 172,-79 172,-79 172,-85 166,-91 160,-91"/>
<text text-anchor="middle" x="143" y="-69.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">execute</text>
</g>
<!-- prewriteMutations -->
<g id="node2" class="node">
<title>prewriteMutations</title>
<path fill="none" stroke="#1c2123" d="M663,-30C663,-30 809,-30 809,-30 815,-30 821,-36 821,-42 821,-42 821,-64 821,-64 821,-70 815,-76 809,-76 809,-76 663,-76 663,-76 657,-76 651,-70 651,-64 651,-64 651,-42 651,-42 651,-36 657,-30 663,-30"/>
<text text-anchor="middle" x="736" y="-60.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewriteMutations</text>
<polyline fill="none" stroke="#1c2123" points="651,-53 821,-53 "/>
<text text-anchor="start" x="659" y="-37.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">由batchExecutor 并发执行</text>
</g>
<!-- execute&#45;&gt;prewriteMutations -->
<g id="edge1" class="edge">
<title>execute&#45;&gt;prewriteMutations</title>
<path fill="none" stroke="#666666" d="M172.02,-70.51C183.2,-69.59 196.2,-68.63 208,-68 359.26,-59.94 535.18,-56.04 640.68,-54.28"/>
<polygon fill="#666666" stroke="#666666" points="641.04,-57.77 650.98,-54.11 640.92,-50.77 641.04,-57.77"/>
</g>
<!-- commitTxn -->
<g id="node3" class="node">
<title>commitTxn</title>
<path fill="none" stroke="#1c2123" d="M408,-82C408,-82 603,-82 603,-82 609,-82 615,-88 615,-94 615,-94 615,-146 615,-146 615,-152 609,-158 603,-158 603,-158 408,-158 408,-158 402,-158 396,-152 396,-146 396,-146 396,-94 396,-94 396,-88 402,-82 408,-82"/>
<text text-anchor="middle" x="505.5" y="-142.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitTxn</text>
<polyline fill="none" stroke="#1c2123" points="396,-135 615,-135 "/>
<text text-anchor="start" x="404" y="-119.8" font-family="Times,serif" font-size="14.00" fill="#2f3638">等primary ke提交成功后</text>
<text text-anchor="start" x="404" y="-104.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 才会返回, 其他的secondaries keys</text>
<text text-anchor="start" x="404" y="-89.8" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 由go rutine异步提交</text>
</g>
<!-- execute&#45;&gt;commitTxn -->
<g id="edge2" class="edge">
<title>execute&#45;&gt;commitTxn</title>
<path fill="none" stroke="#666666" d="M172.14,-72.48C213.53,-72.12 293.17,-73 360,-83 368.47,-84.27 377.16,-85.82 385.87,-87.57"/>
<polygon fill="#666666" stroke="#666666" points="385.2,-91.01 395.71,-89.63 386.63,-84.16 385.2,-91.01"/>
</g>
<!-- getTimestampWithRetry -->
<g id="node4" class="node">
<title>getTimestampWithRetry</title>
<path fill="none" stroke="#1c2123" d="M220,-92.5C220,-92.5 348,-92.5 348,-92.5 354,-92.5 360,-98.5 360,-104.5 360,-104.5 360,-171.5 360,-171.5 360,-177.5 354,-183.5 348,-183.5 348,-183.5 220,-183.5 220,-183.5 214,-183.5 208,-177.5 208,-171.5 208,-171.5 208,-104.5 208,-104.5 208,-98.5 214,-92.5 220,-92.5"/>
<text text-anchor="middle" x="284" y="-168.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">getTimestampWithRetry</text>
<polyline fill="none" stroke="#1c2123" points="208,-160.5 360,-160.5 "/>
<text text-anchor="start" x="216" y="-145.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在提交事务之前</text>
<text text-anchor="start" x="216" y="-130.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先获取commit_ts</text>
<text text-anchor="start" x="216" y="-115.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从time Oracle服务</text>
<text text-anchor="start" x="216" y="-100.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取commitTs</text>
</g>
<!-- execute&#45;&gt;getTimestampWithRetry -->
<g id="edge3" class="edge">
<title>execute&#45;&gt;getTimestampWithRetry</title>
<path fill="none" stroke="#666666" d="M172.13,-86.15C180.06,-89.86 189.13,-94.1 198.58,-98.52"/>
<polygon fill="#666666" stroke="#666666" points="197.2,-101.74 207.74,-102.81 200.17,-95.4 197.2,-101.74"/>
</g>
<!-- doActionOnGroupMutations -->
<g id="node6" class="node">
<title>doActionOnGroupMutations</title>
<path fill="none" stroke="#1c2123" d="M869,-53.5C869,-53.5 1054,-53.5 1054,-53.5 1060,-53.5 1066,-59.5 1066,-65.5 1066,-65.5 1066,-140.5 1066,-140.5 1066,-146.5 1060,-152.5 1054,-152.5 1054,-152.5 869,-152.5 869,-152.5 863,-152.5 857,-146.5 857,-140.5 857,-140.5 857,-65.5 857,-65.5 857,-59.5 863,-53.5 869,-53.5"/>
<text text-anchor="middle" x="961.5" y="-137.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnGroupMutations</text>
<polyline fill="none" stroke="#1c2123" points="857,-129.5 1066,-129.5 "/>
<text text-anchor="start" x="865" y="-114.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">primaryBatch的size 为1</text>
<text text-anchor="start" x="865" y="-99.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 并且是最先提交的</text>
<polyline fill="none" stroke="#1c2123" points="857,-91.5 1066,-91.5 "/>
<text text-anchor="start" x="865" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">primayBatch后面会同步直调用</text>
<text text-anchor="start" x="865" y="-61.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> actionCommit::handleSingleBatch</text>
</g>
<!-- prewriteMutations&#45;&gt;doActionOnGroupMutations -->
<g id="edge7" class="edge">
<title>prewriteMutations&#45;&gt;doActionOnGroupMutations</title>
<path fill="none" stroke="#666666" d="M821.18,-71.83C829.63,-73.72 838.3,-75.66 846.99,-77.61"/>
<polygon fill="#666666" stroke="#666666" points="846.28,-81.03 856.8,-79.8 847.8,-74.2 846.28,-81.03"/>
</g>
<!-- actionPrewrite_handleSingleBatch -->
<g id="node7" class="node">
<title>actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M1341,-62C1341,-62 1522,-62 1522,-62 1528,-62 1534,-68 1534,-74 1534,-74 1534,-86 1534,-86 1534,-92 1528,-98 1522,-98 1522,-98 1341,-98 1341,-98 1335,-98 1329,-92 1329,-86 1329,-86 1329,-74 1329,-74 1329,-68 1335,-62 1341,-62"/>
<text text-anchor="middle" x="1431.5" y="-76.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionPrewrite::handleSingleBatch</text>
</g>
<!-- prewriteMutations&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge8" class="edge">
<title>prewriteMutations&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M821.18,-37.16C930.81,-19.24 1127.93,3.71 1293,-27 1324.92,-32.94 1358.99,-46.02 1385.22,-57.69"/>
<polygon fill="green" stroke="green" points="1383.97,-60.97 1394.52,-61.92 1386.86,-54.59 1383.97,-60.97"/>
</g>
<!-- commitMutations -->
<g id="node5" class="node">
<title>commitMutations</title>
<path fill="none" stroke="#1c2123" d="M781.5,-138C781.5,-138 690.5,-138 690.5,-138 684.5,-138 678.5,-132 678.5,-126 678.5,-126 678.5,-114 678.5,-114 678.5,-108 684.5,-102 690.5,-102 690.5,-102 781.5,-102 781.5,-102 787.5,-102 793.5,-108 793.5,-114 793.5,-114 793.5,-126 793.5,-126 793.5,-132 787.5,-138 781.5,-138"/>
<text text-anchor="middle" x="736" y="-116.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitMutations</text>
</g>
<!-- commitTxn&#45;&gt;commitMutations -->
<g id="edge5" class="edge">
<title>commitTxn&#45;&gt;commitMutations</title>
<path fill="none" stroke="#666666" d="M615.06,-120C633.18,-120 651.49,-120 668.16,-120"/>
<polygon fill="#666666" stroke="#666666" points="668.31,-123.5 678.31,-120 668.31,-116.5 668.31,-123.5"/>
</g>
<!-- getTimestampWithRetry&#45;&gt;commitTxn -->
<g id="edge4" class="edge">
<title>getTimestampWithRetry&#45;&gt;commitTxn</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M360.23,-131.83C368.53,-131.15 377.12,-130.45 385.78,-129.74"/>
<polygon fill="green" stroke="green" points="386.29,-133.21 395.97,-128.9 385.72,-126.23 386.29,-133.21"/>
</g>
<!-- commitMutations&#45;&gt;doActionOnGroupMutations -->
<g id="edge6" class="edge">
<title>commitMutations&#45;&gt;doActionOnGroupMutations</title>
<path fill="none" stroke="#666666" d="M793.69,-115.69C809.95,-114.45 828.28,-113.06 846.68,-111.66"/>
<polygon fill="#666666" stroke="#666666" points="847.2,-115.13 856.9,-110.88 846.67,-108.15 847.2,-115.13"/>
</g>
<!-- actionCommit_handleSingleBatch -->
<g id="node8" class="node">
<title>actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M1341,-145C1341,-145 1522,-145 1522,-145 1528,-145 1534,-151 1534,-157 1534,-157 1534,-169 1534,-169 1534,-175 1528,-181 1522,-181 1522,-181 1341,-181 1341,-181 1335,-181 1329,-175 1329,-169 1329,-169 1329,-157 1329,-157 1329,-151 1335,-145 1341,-145"/>
<text text-anchor="middle" x="1431.5" y="-159.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionCommit::handleSingleBatch</text>
</g>
<!-- commitMutations&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge9" class="edge">
<title>commitMutations&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M780.73,-138.09C803.16,-146.65 831.15,-156.24 857,-162 1046.45,-204.2 1099.63,-203.75 1293,-187 1305.1,-185.95 1317.73,-184.4 1330.21,-182.57"/>
<polygon fill="green" stroke="green" points="1330.83,-186.02 1340.19,-181.05 1329.77,-179.1 1330.83,-186.02"/>
</g>
<!-- primaryBatch -->
<g id="node9" class="node">
<title>primaryBatch</title>
<path fill="none" stroke="#1c2123" d="M1141,-36.5C1141,-36.5 1254,-36.5 1254,-36.5 1260,-36.5 1266,-42.5 1266,-48.5 1266,-48.5 1266,-85.5 1266,-85.5 1266,-91.5 1260,-97.5 1254,-97.5 1254,-97.5 1141,-97.5 1141,-97.5 1135,-97.5 1129,-91.5 1129,-85.5 1129,-85.5 1129,-48.5 1129,-48.5 1129,-42.5 1135,-36.5 1141,-36.5"/>
<text text-anchor="middle" x="1197.5" y="-82.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">primaryBatch</text>
<polyline fill="none" stroke="#1c2123" points="1129,-74.5 1266,-74.5 "/>
<text text-anchor="start" x="1137" y="-59.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">b.batches[:1]</text>
<text text-anchor="start" x="1137" y="-44.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> primayBatch size为1</text>
</g>
<!-- doActionOnGroupMutations&#45;&gt;primaryBatch -->
<g id="edge10" class="edge">
<title>doActionOnGroupMutations&#45;&gt;primaryBatch</title>
<path fill="none" stroke="#666666" d="M1066.16,-87.05C1083.77,-84.34 1101.8,-81.57 1118.6,-78.98"/>
<polygon fill="#666666" stroke="#666666" points="1119.55,-82.38 1128.9,-77.4 1118.48,-75.46 1119.55,-82.38"/>
</g>
<!-- doActionOnMutations -->
<g id="node10" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M1114,-116.5C1114,-116.5 1281,-116.5 1281,-116.5 1287,-116.5 1293,-122.5 1293,-128.5 1293,-128.5 1293,-165.5 1293,-165.5 1293,-171.5 1287,-177.5 1281,-177.5 1281,-177.5 1114,-177.5 1114,-177.5 1108,-177.5 1102,-171.5 1102,-165.5 1102,-165.5 1102,-128.5 1102,-128.5 1102,-122.5 1108,-116.5 1114,-116.5"/>
<text text-anchor="middle" x="1197.5" y="-162.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
<polyline fill="none" stroke="#1c2123" points="1102,-154.5 1293,-154.5 "/>
<text text-anchor="start" x="1110" y="-139.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">对Mutation根据region 做分组</text>
<text text-anchor="start" x="1110" y="-124.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后每个组做batch</text>
</g>
<!-- doActionOnGroupMutations&#45;&gt;doActionOnMutations -->
<g id="edge11" class="edge">
<title>doActionOnGroupMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M1066.16,-122.49C1074.68,-124.09 1083.3,-125.71 1091.83,-127.32"/>
<polygon fill="#666666" stroke="#666666" points="1091.32,-130.78 1101.79,-129.19 1092.61,-123.9 1091.32,-130.78"/>
</g>
<!-- doActionOnMutations&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge12" class="edge">
<title>doActionOnMutations&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M1293.2,-119.65C1314.94,-113.37 1337.71,-106.8 1358.32,-100.84"/>
<polygon fill="#666666" stroke="#666666" points="1359.31,-104.2 1367.94,-98.07 1357.36,-97.48 1359.31,-104.2"/>
</g>
<!-- doActionOnMutations&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge13" class="edge">
<title>doActionOnMutations&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M1293.2,-153.53C1301.66,-154.11 1310.28,-154.71 1318.87,-155.3"/>
<polygon fill="#666666" stroke="#666666" points="1318.72,-158.8 1328.93,-156 1319.2,-151.82 1318.72,-158.8"/>
</g>
<!-- Commit -->
<g id="node11" class="node">
<title>Commit</title>
<path fill="none" stroke="#1c2123" d="M66,-91C66,-91 28,-91 28,-91 22,-91 16,-85 16,-79 16,-79 16,-67 16,-67 16,-61 22,-55 28,-55 28,-55 66,-55 66,-55 72,-55 78,-61 78,-67 78,-67 78,-79 78,-79 78,-85 72,-91 66,-91"/>
<text text-anchor="middle" x="47" y="-69.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commit</text>
</g>
<!-- Commit&#45;&gt;execute -->
<g id="edge14" class="edge">
<title>Commit&#45;&gt;execute</title>
<path fill="none" stroke="#666666" d="M78,-73C86.18,-73 95.14,-73 103.71,-73"/>
<polygon fill="#666666" stroke="#666666" points="103.88,-76.5 113.88,-73 103.88,-69.5 103.88,-76.5"/>
</g>
</g>
</svg>
