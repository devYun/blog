<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.0 (20210316.0004)
 -->
<!-- Title: execute Pages: 1 -->
<svg width="1122pt" height="202pt"
 viewBox="0.00 0.00 1122.00 202.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 198)">
<title>execute</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-198 1118,-198 1118,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_twoPhaseCommitter</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M118,-8C118,-8 1094,-8 1094,-8 1100,-8 1106,-14 1106,-20 1106,-20 1106,-174 1106,-174 1106,-180 1100,-186 1094,-186 1094,-186 118,-186 118,-186 112,-186 106,-180 106,-174 106,-174 106,-20 106,-20 106,-14 112,-8 118,-8"/>
<text text-anchor="middle" x="606" y="-166" font-family="Times,serif" font-size="20.00">twoPhaseCommitter</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_KVTxn</title>
<path fill="none" stroke="slategrey" stroke-dasharray="5,2" d="M20,-11C20,-11 74,-11 74,-11 80,-11 86,-17 86,-23 86,-23 86,-81 86,-81 86,-87 80,-93 74,-93 74,-93 20,-93 20,-93 14,-93 8,-87 8,-81 8,-81 8,-23 8,-23 8,-17 14,-11 20,-11"/>
<text text-anchor="middle" x="47" y="-73" font-family="Times,serif" font-size="20.00">KVTxn</text>
</g>
<!-- execute -->
<g id="node1" class="node">
<title>execute</title>
<path fill="none" stroke="#1c2123" d="M160,-55C160,-55 126,-55 126,-55 120,-55 114,-49 114,-43 114,-43 114,-31 114,-31 114,-25 120,-19 126,-19 126,-19 160,-19 160,-19 166,-19 172,-25 172,-31 172,-31 172,-43 172,-43 172,-49 166,-55 160,-55"/>
<text text-anchor="middle" x="143" y="-33.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">execute</text>
</g>
<!-- prewriteMutations -->
<g id="node2" class="node">
<title>prewriteMutations</title>
<path fill="none" stroke="#1c2123" d="M618,-52C618,-52 525,-52 525,-52 519,-52 513,-46 513,-40 513,-40 513,-28 513,-28 513,-22 519,-16 525,-16 525,-16 618,-16 618,-16 624,-16 630,-22 630,-28 630,-28 630,-40 630,-40 630,-46 624,-52 618,-52"/>
<text text-anchor="middle" x="571.5" y="-30.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">prewriteMutations</text>
</g>
<!-- execute&#45;&gt;prewriteMutations -->
<g id="edge1" class="edge">
<title>execute&#45;&gt;prewriteMutations</title>
<path fill="none" stroke="#666666" d="M172.24,-31.62C183.35,-29.76 196.23,-27.91 208,-27 310.43,-19.05 429.61,-24.08 502.54,-28.77"/>
<polygon fill="#666666" stroke="#666666" points="502.74,-32.3 512.95,-29.46 503.21,-25.31 502.74,-32.3"/>
</g>
<!-- commitTxn -->
<g id="node3" class="node">
<title>commitTxn</title>
<path fill="none" stroke="#1c2123" d="M465,-113C465,-113 408,-113 408,-113 402,-113 396,-107 396,-101 396,-101 396,-89 396,-89 396,-83 402,-77 408,-77 408,-77 465,-77 465,-77 471,-77 477,-83 477,-89 477,-89 477,-101 477,-101 477,-107 471,-113 465,-113"/>
<text text-anchor="middle" x="436.5" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitTxn</text>
</g>
<!-- execute&#45;&gt;commitTxn -->
<g id="edge2" class="edge">
<title>execute&#45;&gt;commitTxn</title>
<path fill="none" stroke="#666666" d="M172.07,-33.8C214.06,-30 295.21,-26.51 360,-47 376.28,-52.15 392.5,-61.72 405.71,-70.98"/>
<polygon fill="#666666" stroke="#666666" points="403.78,-73.9 413.92,-76.96 407.9,-68.25 403.78,-73.9"/>
</g>
<!-- getTimestampWithRetry -->
<g id="node4" class="node">
<title>getTimestampWithRetry</title>
<path fill="none" stroke="#1c2123" d="M220,-56.5C220,-56.5 348,-56.5 348,-56.5 354,-56.5 360,-62.5 360,-68.5 360,-68.5 360,-135.5 360,-135.5 360,-141.5 354,-147.5 348,-147.5 348,-147.5 220,-147.5 220,-147.5 214,-147.5 208,-141.5 208,-135.5 208,-135.5 208,-68.5 208,-68.5 208,-62.5 214,-56.5 220,-56.5"/>
<text text-anchor="middle" x="284" y="-132.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">getTimestampWithRetry</text>
<polyline fill="none" stroke="#1c2123" points="208,-124.5 360,-124.5 "/>
<text text-anchor="start" x="216" y="-109.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">在提交事务之前</text>
<text text-anchor="start" x="216" y="-94.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 先获取commit_ts</text>
<text text-anchor="start" x="216" y="-79.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 从time Oracle服务</text>
<text text-anchor="start" x="216" y="-64.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 获取commitTs</text>
</g>
<!-- execute&#45;&gt;getTimestampWithRetry -->
<g id="edge3" class="edge">
<title>execute&#45;&gt;getTimestampWithRetry</title>
<path fill="none" stroke="#666666" d="M172.13,-50.15C180.06,-53.86 189.13,-58.1 198.58,-62.52"/>
<polygon fill="#666666" stroke="#666666" points="197.2,-65.74 207.74,-66.81 200.17,-59.4 197.2,-65.74"/>
</g>
<!-- doActionOnMutations -->
<g id="node6" class="node">
<title>doActionOnMutations</title>
<path fill="none" stroke="#1c2123" d="M678,-44.5C678,-44.5 845,-44.5 845,-44.5 851,-44.5 857,-50.5 857,-56.5 857,-56.5 857,-93.5 857,-93.5 857,-99.5 851,-105.5 845,-105.5 845,-105.5 678,-105.5 678,-105.5 672,-105.5 666,-99.5 666,-93.5 666,-93.5 666,-56.5 666,-56.5 666,-50.5 672,-44.5 678,-44.5"/>
<text text-anchor="middle" x="761.5" y="-90.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">doActionOnMutations</text>
<polyline fill="none" stroke="#1c2123" points="666,-82.5 857,-82.5 "/>
<text text-anchor="start" x="674" y="-67.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">对Mutation根据region 做分组</text>
<text text-anchor="start" x="674" y="-52.3" font-family="Times,serif" font-size="14.00" fill="#2f3638"> 然后每个组做batch</text>
</g>
<!-- prewriteMutations&#45;&gt;doActionOnMutations -->
<g id="edge7" class="edge">
<title>prewriteMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M630.18,-46.58C638.42,-48.38 647.09,-50.27 655.89,-52.19"/>
<polygon fill="#666666" stroke="#666666" points="655.35,-55.65 665.86,-54.36 656.84,-48.81 655.35,-55.65"/>
</g>
<!-- actionPrewrite_handleSingleBatch -->
<g id="node7" class="node">
<title>actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M905,-34C905,-34 1086,-34 1086,-34 1092,-34 1098,-40 1098,-46 1098,-46 1098,-58 1098,-58 1098,-64 1092,-70 1086,-70 1086,-70 905,-70 905,-70 899,-70 893,-64 893,-58 893,-58 893,-46 893,-46 893,-40 899,-34 905,-34"/>
<text text-anchor="middle" x="995.5" y="-48.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionPrewrite::handleSingleBatch</text>
</g>
<!-- prewriteMutations&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge8" class="edge">
<title>prewriteMutations&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M630.05,-32.19C687.57,-30.85 778.5,-30.03 857,-35 865.37,-35.53 874.01,-36.23 882.69,-37.05"/>
<polygon fill="green" stroke="green" points="882.59,-40.55 892.88,-38.05 883.27,-33.59 882.59,-40.55"/>
</g>
<!-- commitMutations -->
<g id="node5" class="node">
<title>commitMutations</title>
<path fill="none" stroke="#1c2123" d="M617,-113C617,-113 526,-113 526,-113 520,-113 514,-107 514,-101 514,-101 514,-89 514,-89 514,-83 520,-77 526,-77 526,-77 617,-77 617,-77 623,-77 629,-83 629,-89 629,-89 629,-101 629,-101 629,-107 623,-113 617,-113"/>
<text text-anchor="middle" x="571.5" y="-91.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">commitMutations</text>
</g>
<!-- commitTxn&#45;&gt;commitMutations -->
<g id="edge5" class="edge">
<title>commitTxn&#45;&gt;commitMutations</title>
<path fill="none" stroke="#666666" d="M477.04,-95C485.39,-95 494.42,-95 503.46,-95"/>
<polygon fill="#666666" stroke="#666666" points="503.63,-98.5 513.63,-95 503.63,-91.5 503.63,-98.5"/>
</g>
<!-- getTimestampWithRetry&#45;&gt;commitTxn -->
<g id="edge4" class="edge">
<title>getTimestampWithRetry&#45;&gt;commitTxn</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M360.25,-98.5C368.93,-98.1 377.61,-97.69 385.83,-97.31"/>
<polygon fill="green" stroke="green" points="386.13,-100.8 395.96,-96.84 385.81,-93.81 386.13,-100.8"/>
</g>
<!-- commitMutations&#45;&gt;doActionOnMutations -->
<g id="edge6" class="edge">
<title>commitMutations&#45;&gt;doActionOnMutations</title>
<path fill="none" stroke="#666666" d="M629.16,-88.97C637.57,-88.08 646.45,-87.13 655.47,-86.17"/>
<polygon fill="#666666" stroke="#666666" points="656.11,-89.62 665.69,-85.09 655.37,-82.66 656.11,-89.62"/>
</g>
<!-- actionCommit_handleSingleBatch -->
<g id="node8" class="node">
<title>actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#1c2123" d="M905,-98C905,-98 1086,-98 1086,-98 1092,-98 1098,-104 1098,-110 1098,-110 1098,-122 1098,-122 1098,-128 1092,-134 1086,-134 1086,-134 905,-134 905,-134 899,-134 893,-128 893,-122 893,-122 893,-110 893,-110 893,-104 899,-98 905,-98"/>
<text text-anchor="middle" x="995.5" y="-112.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">actionCommit::handleSingleBatch</text>
</g>
<!-- commitMutations&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge9" class="edge">
<title>commitMutations&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="green" stroke-dasharray="5,2" d="M629.06,-109.07C641.17,-111.53 653.95,-113.71 666,-115 737.86,-122.71 819.07,-123.03 882.76,-121.39"/>
<polygon fill="green" stroke="green" points="882.93,-124.89 892.83,-121.11 882.74,-117.89 882.93,-124.89"/>
</g>
<!-- doActionOnMutations&#45;&gt;actionPrewrite_handleSingleBatch -->
<g id="edge10" class="edge">
<title>doActionOnMutations&#45;&gt;actionPrewrite_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M857.2,-65.61C865.66,-64.77 874.28,-63.92 882.87,-63.07"/>
<polygon fill="#666666" stroke="#666666" points="883.33,-66.54 892.93,-62.07 882.64,-59.57 883.33,-66.54"/>
</g>
<!-- doActionOnMutations&#45;&gt;actionCommit_handleSingleBatch -->
<g id="edge11" class="edge">
<title>doActionOnMutations&#45;&gt;actionCommit_handleSingleBatch</title>
<path fill="none" stroke="#666666" d="M857.2,-91.74C865.66,-93.23 874.28,-94.76 882.87,-96.27"/>
<polygon fill="#666666" stroke="#666666" points="882.48,-99.76 892.93,-98.05 883.69,-92.86 882.48,-99.76"/>
</g>
<!-- Commit -->
<g id="node9" class="node">
<title>Commit</title>
<path fill="none" stroke="#1c2123" d="M66,-55C66,-55 28,-55 28,-55 22,-55 16,-49 16,-43 16,-43 16,-31 16,-31 16,-25 22,-19 28,-19 28,-19 66,-19 66,-19 72,-19 78,-25 78,-31 78,-31 78,-43 78,-43 78,-49 72,-55 66,-55"/>
<text text-anchor="middle" x="47" y="-33.3" font-family="Times,serif" font-size="14.00" fill="#2f3638">Commit</text>
</g>
<!-- Commit&#45;&gt;execute -->
<g id="edge12" class="edge">
<title>Commit&#45;&gt;execute</title>
<path fill="none" stroke="#666666" d="M78,-37C86.18,-37 95.14,-37 103.71,-37"/>
<polygon fill="#666666" stroke="#666666" points="103.88,-40.5 113.88,-37 103.88,-33.5 103.88,-40.5"/>
</g>
</g>
</svg>
